<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EBOS Group (EBO.NZ) Financial Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #4fc3f7, #29b6f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .header p {
            color: #888;
            font-size: 1.1rem;
        }
        .header .currency-note {
            color: #fdcb6e;
            font-size: 0.9rem;
            margin-top: 8px;
            font-style: italic;
        }

        /* Investment Overview Section */
        .overview-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .overview-toggle {
            width: 100%;
            background: rgba(41, 182, 246, 0.1);
            border: 1px solid rgba(41, 182, 246, 0.3);
            border-radius: 12px;
            padding: 16px 24px;
            color: #4fc3f7;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        .overview-toggle:hover {
            background: rgba(41, 182, 246, 0.2);
        }
        .overview-toggle .arrow {
            transition: transform 0.3s ease;
        }
        .overview-toggle.active .arrow {
            transform: rotate(180deg);
        }
        .overview-content {
            display: none;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            margin-top: -12px;
        }
        .overview-content.active {
            display: block;
        }
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        .overview-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .overview-card h3 {
            color: #4fc3f7;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .overview-card p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        .overview-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .overview-card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            line-height: 1.5;
        }
        .overview-card li:last-child {
            border-bottom: none;
        }
        .overview-card.bull h3 { color: #00d4aa; }
        .overview-card.bear h3 { color: #ff6b6b; }
        .overview-card.risks h3 { color: #fdcb6e; }
        .risk-high { color: #ff6b6b; }
        .risk-moderate { color: #fdcb6e; }
        .risk-low { color: #00d4aa; }
        .revenue-stream {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .revenue-stream .percent {
            color: #4fc3f7;
            font-weight: 600;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        .kpi-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(79, 195, 247, 0.2);
        }
        .kpi-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4fc3f7;
            margin-bottom: 5px;
        }
        .kpi-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .kpi-change {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .kpi-change.positive { color: #00d4aa; }
        .kpi-change.negative { color: #ff6b6b; }

        /* Guidance Section */
        .guidance-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .guidance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .guidance-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .guidance-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #4fc3f7, #29b6f6);
            border-radius: 2px;
        }
        .guidance-meta {
            font-size: 0.85rem;
            color: #888;
        }
        .guidance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .guidance-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease;
        }
        .guidance-card:hover {
            transform: translateY(-2px);
        }
        .guidance-metric {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .guidance-target {
            font-size: 1.4rem;
            font-weight: 600;
            color: #4fc3f7;
            margin-bottom: 6px;
        }
        .guidance-period {
            font-size: 0.85rem;
            color: #e0e0e0;
            margin-bottom: 8px;
        }
        .guidance-vs-prior {
            display: inline-block;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        .guidance-vs-prior.raised {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
        }
        .guidance-vs-prior.lowered {
            background: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
        }
        .guidance-vs-prior.maintained {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }
        .guidance-vs-prior.consistent {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }
        .guidance-notes {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }
        .guidance-commentary {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 16px 20px;
            border-left: 3px solid #4fc3f7;
            font-style: italic;
            color: #b0b0b0;
            line-height: 1.6;
        }
        .guidance-commentary::before {
            content: '"';
            font-size: 1.5rem;
            color: #4fc3f7;
            margin-right: 4px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #fff;
            margin: 40px auto 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(79, 195, 247, 0.3);
            max-width: 1400px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .chart-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #4fc3f7, #29b6f6);
            border-radius: 2px;
        }
        .help-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(79, 195, 247, 0.2);
            border: 1px solid #4fc3f7;
            color: #4fc3f7;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .help-btn:hover {
            background: #4fc3f7;
            color: #0f2027;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: linear-gradient(135deg, #1e2a4a 0%, #16213e 100%);
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(79, 195, 247, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 {
            color: #4fc3f7;
            font-size: 1.4rem;
            margin: 0;
        }
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: #ff6b6b;
            color: #fff;
        }
        .modal-body {
            padding: 25px;
            line-height: 1.7;
        }
        .modal-body p { margin-bottom: 15px; }
        .modal-body strong { color: #4fc3f7; }
        .modal-body ul { margin: 15px 0; padding-left: 20px; }
        .modal-body li { margin-bottom: 8px; }
        .metric-highlight {
            background: rgba(79, 195, 247, 0.1);
            border-left: 3px solid #4fc3f7;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        /* DCF Valuation Section */
        .dcf-section {
            max-width: 1400px;
            margin: 0 auto 40px;
        }
        .dcf-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dcf-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }
        .dcf-card:hover {
            transform: translateY(-3px);
        }
        .dcf-card.highlight {
            background: rgba(79, 195, 247, 0.1);
            border-color: rgba(79, 195, 247, 0.3);
        }
        .dcf-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .dcf-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #4fc3f7;
        }
        .dcf-card:not(.highlight) .dcf-value {
            color: #fff;
        }
        .dcf-change {
            font-size: 1rem;
            margin-top: 8px;
            font-weight: 600;
        }
        .dcf-change.positive { color: #00d4aa; }
        .dcf-change.negative { color: #ff6b6b; }
        .dcf-sublabel {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
        }
        .dcf-warning {
            background: rgba(253, 203, 110, 0.15);
            border: 1px solid rgba(253, 203, 110, 0.4);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fdcb6e;
        }
        .warning-icon {
            font-size: 1.2rem;
        }
        /* DCF Inputs Display */
        .dcf-inputs {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .dcf-inputs h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        .dcf-inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .dcf-input-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .dcf-input-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .dcf-input-value {
            font-size: 1.3rem;
            font-weight: 600;
            color: #4fc3f7;
        }
        .dcf-input-note {
            font-size: 0.7rem;
            color: #666;
            margin-top: 4px;
        }
        .fcf-projections h5 {
            color: #b0b0b0;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .fcf-projection-table {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 12px;
        }
        .fcf-projection-item {
            text-align: center;
        }
        .fcf-projection-item.header {
            font-size: 0.75rem;
            color: #888;
            font-weight: 600;
        }
        .fcf-projection-item .fcf-value {
            font-size: 1rem;
            color: #e0e0e0;
            font-weight: 500;
        }
        .fcf-projection-item .growth-rate {
            font-size: 0.75rem;
            color: #4fc3f7;
            margin-top: 2px;
        }
        .dcf-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .slider-group label {
            font-size: 0.95rem;
            color: #e0e0e0;
            display: flex;
            justify-content: space-between;
        }
        .slider-group label span {
            color: #4fc3f7;
            font-weight: 600;
        }
        .slider-group input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4fc3f7;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        .slider-group input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4fc3f7;
            cursor: pointer;
            border: none;
        }
        .slider-hint {
            font-size: 0.8rem;
            color: #666;
        }
        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .scenario-tab {
            padding: 10px 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: #888;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .scenario-tab:hover {
            border-color: rgba(79, 195, 247, 0.5);
            color: #e0e0e0;
        }
        .scenario-tab.active {
            background: rgba(79, 195, 247, 0.15);
            border-color: #4fc3f7;
            color: #4fc3f7;
        }
        .scenario-details {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .scenario-details h4 {
            color: #4fc3f7;
            margin-bottom: 15px;
        }
        .assumption-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .assumption-item {
            text-align: center;
        }
        .assumption-item .label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
        }
        .assumption-item .value {
            font-size: 1.1rem;
            color: #e0e0e0;
            font-weight: 500;
        }
        .sensitivity-section {
            margin-bottom: 30px;
        }
        .sensitivity-section h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .sensitivity-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            overflow: hidden;
        }
        .sensitivity-table th,
        .sensitivity-table td {
            padding: 12px 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .sensitivity-table th {
            background: rgba(79, 195, 247, 0.1);
            color: #4fc3f7;
            font-weight: 600;
        }
        .sensitivity-table td {
            color: #e0e0e0;
        }
        .sensitivity-table td.highlight {
            background: rgba(79, 195, 247, 0.15);
            color: #4fc3f7;
            font-weight: 600;
        }
        .sensitivity-table td.below-current {
            color: #ff6b6b;
        }
        .sensitivity-table td.above-current {
            color: #00d4aa;
        }
        .historical-growth {
            margin-bottom: 30px;
        }
        .historical-growth h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .growth-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }
        .growth-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .growth-item .metric {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 6px;
        }
        .growth-item .rate {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .growth-item .rate.positive { color: #00d4aa; }
        .growth-item .rate.negative { color: #ff6b6b; }
        .growth-item.selected {
            border-color: #4fc3f7;
            background: rgba(79, 195, 247, 0.1);
        }
        .dcf-download {
            text-align: center;
            margin-top: 30px;
        }
        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            background: rgba(79, 195, 247, 0.15);
            border: 1px solid #4fc3f7;
            border-radius: 8px;
            color: #4fc3f7;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
        }
        .download-btn:hover {
            background: #4fc3f7;
            color: #0f2027;
        }
        .download-icon {
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .charts-container { grid-template-columns: 1fr; }
            .overview-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>EBOS Group Limited (EBO.NZ)</h1>
        <p>Australasian Healthcare & Animal Care Distribution</p>
        <p class="currency-note">Note: Financials in NZD through FY2018, AUD from FY2019 onwards</p>
    </div>

    <!-- Investment Overview Section -->
    <div class="overview-section">
        <button class="overview-toggle" onclick="toggleOverview()">
            <span>Investment Overview & Analysis</span>
            <span class="arrow">▼</span>
        </button>
        <div class="overview-content" id="overviewContent">
            <div class="overview-grid" id="overviewGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid" id="kpiGrid">
        <!-- Populated by JavaScript -->
    </div>

    <!-- Management Guidance -->
    <div class="guidance-section" id="guidanceSection">
        <div class="guidance-header">
            <h3>Management Guidance</h3>
            <span class="guidance-meta">As of <span id="guidanceAsOf"></span> | <span id="guidanceFY"></span></span>
        </div>
        <div class="guidance-grid" id="guidanceGrid">
            <!-- Populated by JavaScript -->
        </div>
        <div class="guidance-commentary" id="guidanceCommentary">
            <!-- Populated by JavaScript -->
        </div>
    </div>

    <!-- Charts -->
    <h2 class="section-title">Revenue & Growth</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Revenue Growth</h3>
                <button class="help-btn" onclick="openModal('revenue')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Segment Revenue Mix</h3>
                <button class="help-btn" onclick="openModal('segments')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="segmentChart"></canvas>
            </div>
        </div>
    </div>

    <h2 class="section-title">Profitability</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>EBITDA & EBITDA Margin</h3>
                <button class="help-btn" onclick="openModal('ebitda')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="ebitdaChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Net Income & Margin</h3>
                <button class="help-btn" onclick="openModal('netincome')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="netIncomeChart"></canvas>
            </div>
        </div>
    </div>

    <h2 class="section-title">Shareholder Returns</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>EPS & Dividends per Share</h3>
                <button class="help-btn" onclick="openModal('eps')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="epsChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Free Cash Flow</h3>
                <button class="help-btn" onclick="openModal('fcf')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="fcfChart"></canvas>
            </div>
        </div>
    </div>

    <h2 class="section-title">Balance Sheet</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Debt vs Equity</h3>
                <button class="help-btn" onclick="openModal('debtequity')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="debtEquityChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Debt-to-Equity Ratio</h3>
                <button class="help-btn" onclick="openModal('deratio')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="deRatioChart"></canvas>
            </div>
        </div>
    </div>

    <!-- DCF Valuation Section -->
    <h2 class="section-title">DCF Valuation</h2>
    <div class="dcf-section">
        <div class="dcf-summary">
            <div class="dcf-card highlight">
                <div class="dcf-label">Intrinsic Value</div>
                <div class="dcf-value" id="dcfIV"></div>
                <div class="dcf-change" id="dcfUpside"></div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Entry Price (15% CAGR)</div>
                <div class="dcf-value" id="dcfEntry"></div>
                <div class="dcf-sublabel">Buy below for 15% annual return</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Current Price</div>
                <div class="dcf-value" id="dcfCurrent"></div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Prob-Weighted IV</div>
                <div class="dcf-value" id="dcfWeighted"></div>
                <div class="dcf-sublabel">25% Bull / 50% Base / 25% Bear</div>
            </div>
        </div>

        <div class="dcf-warning" id="growthWarning" style="display: none;">
            <span class="warning-icon">&#9888;</span>
            <span id="warningText"></span>
        </div>

        <div class="dcf-inputs">
            <h4>DCF Model Inputs</h4>
            <div class="dcf-inputs-grid">
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Base Year FCF</div>
                    <div class="dcf-input-value" id="baseFCF"></div>
                    <div class="dcf-input-note">Starting point for projections</div>
                </div>
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Shares Outstanding</div>
                    <div class="dcf-input-value" id="sharesOut"></div>
                </div>
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Net Debt</div>
                    <div class="dcf-input-value" id="netDebt"></div>
                    <div class="dcf-input-note">Positive = net debt</div>
                </div>
            </div>
            <div class="fcf-projections">
                <h5>Projected FCF (5-Year)</h5>
                <div class="fcf-projection-table" id="fcfProjectionTable"></div>
            </div>
        </div>

        <div class="dcf-controls">
            <div class="slider-group">
                <label>Growth Rate: <span id="growthValue"></span></label>
                <input type="range" id="growthSlider" min="0" max="30" step="1">
                <div class="slider-hint" id="growthHint"></div>
            </div>
            <div class="slider-group">
                <label>WACC: <span id="waccValue"></span></label>
                <input type="range" id="waccSlider" min="6" max="18" step="0.5">
            </div>
            <div class="slider-group">
                <label>Terminal Growth: <span id="terminalValue"></span></label>
                <input type="range" id="terminalSlider" min="0" max="5" step="0.5">
            </div>
        </div>

        <div class="scenario-tabs">
            <button class="scenario-tab active" data-scenario="base" onclick="switchScenario('base')">Base Case</button>
            <button class="scenario-tab" data-scenario="bull" onclick="switchScenario('bull')">Bull Case</button>
            <button class="scenario-tab" data-scenario="bear" onclick="switchScenario('bear')">Bear Case</button>
        </div>

        <div class="scenario-details" id="scenarioDetails">
            <div class="scenario-assumptions">
                <h4>Assumptions</h4>
                <div class="assumption-grid" id="assumptionGrid"></div>
            </div>
        </div>

        <div class="sensitivity-section">
            <h4>Sensitivity Analysis: Intrinsic Value by WACC & Terminal Growth</h4>
            <table class="sensitivity-table" id="sensitivityMatrix"></table>
        </div>

        <div class="historical-growth">
            <h4>Historical Growth Rates (CAGR)</h4>
            <div class="growth-grid" id="growthGrid"></div>
        </div>

        <div class="dcf-download">
            <a href="EBO.NZ_DCF_Model.xlsx" class="download-btn" download>
                <span class="download-icon">&#8681;</span> Download Excel Model
            </a>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // EMBEDDED DATA - CSV
        const csvData = `Period,Currency,Revenue,GrossProfit,GrossMarginPct,EBITDA,EBIT,NetIncome,EPS,DividendPerShare,OperatingCashFlow,FreeCashFlow,ShareholdersEquity,TotalDebt,CashAndEquivalents,SharesOutstanding,HealthcareRevenue,AnimalCareRevenue
FY2015,NZD,6068.1,,,196.7,172.6,105.9,70.8,47.0,133.8,118.9,1051.0,426.1,109.5,149.7,5692.9,375.2
FY2016,NZD,7101.5,,,225.5,200.8,127.0,84.0,58.5,224.1,207.8,1087.3,367.6,120.3,151.1,6686.4,415.0
FY2017,NZD,7625.9,,,234.4,208.6,133.3,87.8,63.0,143.9,107.5,1152.4,596.7,162.2,151.8,6116.8,1509.1
FY2018,NZD,7609.5,,,272.4,237.6,149.6,98.5,71.0,176.2,115.6,1216.2,515.9,250.6,151.8,7197.6,411.9
FY2019,AUD,6930.4,,,250.4,218.3,136.7,89.8,50.0,118.5,85.5,1239.3,521.6,130.8,152.2,6548.3,382.0
FY2020,AUD,8765.5,,,333.6,260.5,161.5,100.6,55.0,229.2,205.0,1310.9,875.1,183.5,160.6,7045.4,1720.1
FY2021,AUD,9202.9,,,363.3,290.7,184.0,113.2,61.0,298.3,221.2,1659.3,1146.9,264.3,162.6,7355.2,1847.7
FY2022,AUD,10734.1,,,405.8,323.9,202.0,114.5,66.0,248.7,167.0,1918.8,1432.0,342.5,176.4,8636.6,2097.5
FY2023,AUD,12237.4,,,568.8,444.0,263.4,132.9,76.0,391.4,297.4,2303.4,1646.0,211.9,198.2,9901.5,2335.9
FY2024,AUD,13189.1,,,605.6,476.7,271.5,141.3,86.0,348.2,252.3,2451.0,1235.8,216.9,192.2,10647.8,2541.2
FY2025,AUD,12266.9,,,555.6,408.7,215.1,109.7,118.5,418.5,293.4,2739.6,1102.5,184.3,196.1,9447.3,2819.6`;

        // EMBEDDED DATA - Analysis JSON
        const analysis = {
  "ticker": "EBO.NZ",
  "company_name": "EBOS Group Limited",
  "analysis_date": "2026-02-03",
  "overview": "EBOS Group is the largest and most diversified Australasian marketer, wholesaler, and distributor of healthcare, medical, and pharmaceutical products, with a leading position in animal care distribution. With over 5,700 employees in 133 locations across Australia, New Zealand, and Southeast Asia, EBOS operates through two main segments: Healthcare (pharmaceutical wholesale, hospital distribution, medical technology, TerryWhite Chemmart pharmacy network, contract logistics) and Animal Care (branded pet foods, veterinary supplies). The company serves pharmacies, hospitals, veterinarians, farmers, and pet specialty retailers across the region.",
  "business_model": {
    "summary": "EBOS operates a diversified distribution and retail model with approximately 75-80% of revenue from Healthcare and 20-25% from Animal Care. Revenue is generated through wholesale distribution margins (typically 7-10%), retail pharmacy operations, and branded product sales in animal care.",
    "revenue_streams": [
      {"name": "Community Pharmacy Wholesale", "percent": 35, "trend": "stable to growing", "description": "Distribution to 5,000+ independent pharmacies in Australia and New Zealand"},
      {"name": "Hospital Wholesale & Medical Technology", "percent": 25, "trend": "growing", "description": "Distribution to 1,300+ hospitals, aged care facilities, and GPs"},
      {"name": "TerryWhite Chemmart Retail Network", "percent": 15, "trend": "growing", "description": "600-store pharmacy network generating retail sales and franchise fees"},
      {"name": "Animal Care - Branded Products", "percent": 18, "trend": "growing", "description": "Branded pet foods (Black Hawk, VitaPet, Evolution, NGPF brands) and veterinary supplies"},
      {"name": "Contract Logistics & Other", "percent": 7, "trend": "stable", "description": "3PL/4PL services, clinical trial logistics, warehousing"}
    ],
    "customer_type": "B2B primarily (pharmacies, hospitals, veterinary clinics, retailers) with B2C through TerryWhite Chemmart network",
    "geographic_mix": "Australia 70%, New Zealand 25%, Southeast Asia 5%",
    "margin_profile": "Wholesale distribution margins typically 7-10%, with community pharmacy at 7% and hospitals at 10% under PBS regulation. Animal Care branded products achieve higher margins (15-20%). Overall EBITDA margin approximately 4.8% in FY2025."
  },
  "competitive_position": {
    "main_competitors": [
      "Sigma Healthcare (merged with Chemist Warehouse in 2024-2025)",
      "API (owned by Wesfarmers since 2022, operates Priceline Pharmacy)",
      "National Veterinary Care (NVS) in animal health",
      "Greencross (owned by TPG Capital) in pet retail and vet services"
    ],
    "market_position": "Second-largest pharmaceutical wholesaler in Australia and New Zealand with strong market share across both countries. Leading position in hospital distribution. TerryWhite Chemmart is one of Australia's top 3 pharmacy networks with 600 stores. In animal care, EBOS holds #1 position in premium pet food in ANZ through Black Hawk and VitaPet brands.",
    "market_share": "Approximately 30-35% of pharmaceutical wholesale market in ANZ (post-Chemist Warehouse contract loss). TerryWhite Chemmart commands 20%+ market share in vaccinations. Merged Sigma-Chemist Warehouse entity has 35-40% wholesale market share.",
    "moat_factors": [
      {
        "factor": "Distribution network and infrastructure",
        "strength": "strong",
        "description": "A$360 million investment in six new distribution centres (2022-2026) creates state-of-the-art cold chain and specialty medicine capabilities. Scale and infrastructure create significant barriers to entry. New Perth facility opening in 2026 with expanded Sydney cold storage for GLP-1 medicines."
      },
      {
        "factor": "Regulatory licenses and compliance",
        "strength": "strong",
        "description": "Pharmaceutical wholesale requires extensive licensing, Good Distribution Practice (GDP) compliance, controlled substance permits, and temperature-controlled logistics capabilities. These regulatory barriers protect established players."
      },
      {
        "factor": "Scale advantages",
        "strength": "strong",
        "description": "As the largest healthcare distributor in ANZ, EBOS benefits from economies of scale in logistics, procurement, and systems. Serving 7,000+ hospitals, aged care facilities, and GPs plus 5,000+ community pharmacies provides negotiating leverage with suppliers."
      },
      {
        "factor": "Customer relationships and switching costs",
        "strength": "moderate to strong",
        "description": "Long-term relationships with hospitals, pharmacies, and veterinary clinics. High service levels and integration of ordering/inventory systems create switching costs. TerryWhite Chemmart franchise network has 600 member pharmacies with multi-year commitments."
      },
      {
        "factor": "Vertical integration",
        "strength": "moderate",
        "description": "Ownership of both wholesale distribution (Symbion) and retail network (TerryWhite Chemmart) creates synergies in supply chain, procurement, and data insights. Animal Care segment benefits from owning brands (Black Hawk, VitaPet) and distribution."
      },
      {
        "factor": "Brand strength in animal care",
        "strength": "moderate",
        "description": "Black Hawk is the leading premium pet food in ANZ. VitaPet is #1 pet treat brand in NZ supermarkets and leading in Australian supermarkets. These brands command pricing power and customer loyalty."
      }
    ],
    "weaknesses": [
      "Lost Chemist Warehouse wholesale contract in Australia (A$1.9 billion annual revenue, ~10% of group revenue) to Sigma in 2024, though partially offset by winning new pharmacy customers",
      "Regulated wholesale margins in PBS (7% community, 10% hospital) limit pricing power in core business",
      "Exposure to intense competition in pharmacy wholesale market, with margin compression during periods of competitive intensity",
      "Dependence on government healthcare spending and pharmaceutical benefit schemes (PBS in Australia, PHARMAC in New Zealand)",
      "Customer concentration risk - largest customers represent significant revenue share",
      "Limited geographic diversification - primarily exposed to Australia and New Zealand economies"
    ]
  },
  "growth_drivers": [
    "Aging population demographics: Australia and New Zealand have rapidly aging populations driving structural growth in pharmaceutical volumes, specialty medicines, and medical devices. Chronic disease prevalence rising.",
    "Specialty pharmaceuticals expansion: GLP-1 drugs (weight loss/diabetes) and other high-value specialty medicines growing rapidly. EBOS investing in expanded cold storage capacity in Sydney to support this growth.",
    "Animal Care acquisitions and organic growth: SVS Veterinary Supplies (2025, serving 500+ NZ vet clinics), Next Generation Pet Foods (July 2025, Australian premium pet treats manufacturer), Kiwi Kitchens (2025) expand market presence. Premium pet food segment growing as pet humanization trend continues.",
    "TerryWhite Chemmart network expansion: Network grew to 600 stores by July 2024 (from 500 in 2023). Targeting continued organic growth and improving store profitability through supply chain efficiencies and enhanced product ranges. Network sales grew 5.7% in FY2024.",
    "New pharmacy wholesale customer wins: Generated approximately A$385 million from new pharmacy customers in FY2025 (~A$540 million annualized), offsetting much of the Chemist Warehouse contract loss. Targeting A$300 million in net new business by end of FY2026.",
    "Distribution centre renewal program benefits: A$360 million four-year program completing in FY2026 will deliver operational efficiencies, improved service levels, and support for specialty medicine growth. Expected to reduce ongoing capex by 30% post-completion.",
    "Medical technology distribution: Entry position in high-growth medical devices market serving hospitals and aged care. Opportunities to expand product range and market share.",
    "Contract logistics (3PL/4PL): Healthcare Logistics (HCL) provides warehousing, distribution, and clinical trial services to pharmaceutical and medical device manufacturers. Growth opportunity as manufacturers outsource logistics.",
    "Southeast Asia expansion: Early-stage presence in Southeast Asia provides long-term growth opportunity as healthcare spending increases in the region.",
    "Cost efficiency program: Delivered A$30 million in cost savings in FY2025, targeting A$25-50 million by end of FY2026. Focus on procurement efficiencies, operational leverage, and technology investments."
  ],
  "risks": {
    "business": [
      {
        "risk": "Loss of major customers or contracts",
        "severity": "high",
        "description": "Loss of Chemist Warehouse wholesale contract (A$1.9B revenue, ~10% of group) in 2024 demonstrated customer concentration risk. While EBOS won new pharmacy customers to partially offset, major contract losses can materially impact revenue and margins. Pharmacy wholesale is competitive with customers regularly renegotiating terms."
      },
      {
        "risk": "Pharmacy wholesale margin compression",
        "severity": "high",
        "description": "FY2025 saw tighter EBITDA margins in pharmacy wholesale due to heightened competition from Sigma-Chemist Warehouse merger and market dynamics. Management expects tight margins to continue through FY2026 as the market realigns. Community pharmacy margins declined due to product/customer mix shifts."
      },
      {
        "risk": "Supplier concentration",
        "severity": "moderate",
        "description": "Pharmaceutical distributors depend on maintaining relationships with major pharmaceutical manufacturers. Loss of key supplier distribution rights could impact revenue. Limited number of generic drug suppliers in ANZ market."
      },
      {
        "risk": "Competition from vertical integration",
        "severity": "moderate",
        "description": "Sigma-Chemist Warehouse merger (2024-2025) creates largest vertically integrated pharmacy player in Australia with 35-40% wholesale market share. API-Priceline (owned by Wesfarmers) is another vertically integrated competitor. These competitors may leverage retail scale to pressure wholesale pricing."
      },
      {
        "risk": "Generic drug price deflation",
        "severity": "moderate",
        "description": "Ongoing PBS price reforms in Australia and PHARMAC pricing pressures in New Zealand reduce drug prices over time, pressuring revenue growth in pharmaceutical wholesale despite volume growth."
      }
    ],
    "financial": [
      {
        "risk": "Debt levels and leverage",
        "severity": "moderate",
        "description": "Debt-to-equity ratio of 0.68 and debt-to-EBITDA of 2.68x (2024) is manageable but limits financial flexibility. Major acquisitions (SVS, NGPF) and distribution centre capex program have increased debt. Free cash flow margin only 1.91%, raising questions about dividend sustainability."
      },
      {
        "risk": "Currency exposure",
        "severity": "moderate",
        "description": "EBOS reports in NZ dollars but generates ~70% of revenue in Australia. AUD/NZD exchange rate fluctuations impact reported earnings. Trans-Tasman business creates natural hedge but volatility remains."
      },
      {
        "risk": "Working capital intensity",
        "severity": "moderate",
        "description": "Pharmaceutical distribution requires significant working capital for inventory and receivables. Growth in business increases working capital needs. Current ratio of 0.95 suggests tight working capital management."
      },
      {
        "risk": "Capital allocation and acquisition integration",
        "severity": "moderate",
        "description": "EBOS has completed 20+ acquisitions over past decade. While track record is generally positive, integration risks exist. Recent acquisitions (SVS, NGPF) need to deliver expected synergies. Dividend payout ratio of 57.5% constrains reinvestment capacity."
      }
    ],
    "regulatory": [
      {
        "risk": "PBS and PHARMAC pricing reforms",
        "severity": "high",
        "description": "Australian PBS and New Zealand PHARMAC control pharmaceutical pricing and reimbursement. Ongoing price reforms typically reduce drug prices, though volumes grow. PBS caps wholesale margins at 7% (community) and 10% (hospital), limiting pricing flexibility. Government budget pressures could accelerate price cuts."
      },
      {
        "risk": "Pharmacy ownership and dispensing regulations",
        "severity": "moderate",
        "description": "Australia maintains pharmacy ownership rules restricting non-pharmacist ownership. Potential regulatory changes could disrupt market structure. Pharmacy location rules and PBS distribution regulations could change."
      },
      {
        "risk": "Cold chain and quality compliance",
        "severity": "moderate",
        "description": "Increasing proportion of specialty medicines require strict temperature control and handling. Regulatory requirements for Good Distribution Practice (GDP) are stringent. Compliance failures could result in license suspension, product recalls, and reputational damage."
      },
      {
        "risk": "Animal health product regulations",
        "severity": "low to moderate",
        "description": "Veterinary medicines and pet foods face regulatory requirements for registration, labeling, and quality standards. Changes in regulations could increase compliance costs or restrict product sales."
      }
    ],
    "macro": [
      {
        "risk": "Healthcare spending and government budgets",
        "severity": "moderate",
        "description": "EBOS revenues are closely tied to government healthcare spending in Australia and New Zealand. Budget constraints or healthcare reforms could reduce pharmaceutical volumes or accelerate generic substitution. Economic downturns may pressure government health budgets."
      },
      {
        "risk": "Consumer discretionary spending in Animal Care",
        "severity": "moderate",
        "description": "Animal Care segment (20-25% of group revenue) is exposed to consumer spending on premium pet food and veterinary services. Economic recession could drive trading down to value brands, impacting branded product margins."
      },
      {
        "risk": "Interest rate sensitivity",
        "severity": "moderate",
        "description": "EBOS carries debt (debt-to-EBITDA 2.68x) and would face higher interest costs in rising rate environment. Higher rates also pressure consumer spending in Animal Care segment and potentially government health budgets."
      },
      {
        "risk": "Supply chain disruption",
        "severity": "low to moderate",
        "description": "COVID-19 demonstrated vulnerability to supply chain disruptions. Australia and New Zealand rely on imported pharmaceuticals and medical supplies. International logistics disruptions (shipping, air freight) could impact product availability and costs."
      }
    ],
    "execution": [
      {
        "risk": "Distribution centre renewal program execution",
        "severity": "moderate",
        "description": "A$360 million capex program (2022-2026) is critical to operational efficiency and service levels. Two sites remain to be delivered. Delays, cost overruns, or operational issues during cutover could disrupt service and customer relationships."
      },
      {
        "risk": "CEO transition",
        "severity": "low to moderate",
        "description": "John Cullity retired as CEO on June 30, 2025 after 7+ years. Successor Adam Hall (appointed July 1, 2025) must maintain momentum during challenging period of margin compression and integration of recent acquisitions. Leadership transition risks are present."
      },
      {
        "risk": "Integration of recent acquisitions",
        "severity": "moderate",
        "description": "SVS Veterinary Supplies, Next Generation Pet Foods, and Kiwi Kitchens all acquired in 2025. Successful integration required to achieve synergy targets and avoid customer/supplier disruption. Track record is positive but execution risk remains."
      }
    ]
  },
  "bull_case": [
    "Structural healthcare tailwinds: Aging population in Australia and New Zealand drives 3%+ annual growth in pharmaceutical volumes. Specialty medicines (GLP-1s, biologics, oncology) growing much faster. EBOS well-positioned with new cold storage infrastructure and hospital distribution leadership.",
    "Successfully offset Chemist Warehouse loss: New pharmacy customer wins of A$540M annualized run rate significantly exceeded expectations and offset majority of lost A$1.9B contract. Demonstrates ability to compete and win business. Further upside as independent pharmacies seek alternatives to Sigma-Chemist Warehouse.",
    "Distribution centre renewal program delivering: A$360M investment program completing in FY2026 will drive operational efficiencies, improved service levels, and support for high-margin specialty medicines. Should expand margins and strengthen competitive position. Capex to decline 30% post-completion, improving free cash flow.",
    "Animal Care growth acceleration: Recent acquisitions (SVS, NGPF, Kiwi Kitchens) expand presence in high-growth pet care market. Premium pet food market growing 5-7% annually. Strong brands (Black Hawk #1 premium pet food, VitaPet #1 pet treats) command pricing power. Animal Care EBITDA grew 10.4% in FY2025.",
    "TerryWhite Chemmart expansion opportunity: 600-store network growing organically with runway to 800+ stores long-term. Improving store profitability through supply chain synergies and product range optimization. Vertical integration provides data insights and competitive advantage vs wholesale-only competitors.",
    "Valuation attractive after derating: Stock underperformed ASX All Ordinaries by 26% over past year. Trading at meaningful discount to analyst price targets (11-35% upside depending on source). Dividend yield 4.5% is attractive. Derating following Chemist Warehouse loss creates entry opportunity.",
    "Defensive business model: Healthcare distribution is non-cyclical with stable government funding (PBS, PHARMAC). Regulatory barriers and scale advantages protect market position. Diversification across community pharmacy, hospital, medical technology, and animal care reduces single-point risk.",
    "Strong execution track record: Delivered on cost savings ($30M in FY2025), won new customers ahead of plan, maintained earnings guidance despite major contract loss, successfully integrated 20+ acquisitions over past decade. New CEO Adam Hall has strong internal background."
  ],
  "bear_case": [
    "Margin compression risk: Pharmacy wholesale margins under sustained pressure from Sigma-Chemist Warehouse competition (35-40% combined market share). Management expects tight margins to continue through FY2026. Community pharmacy margins already declining. Further competitive intensity could pressure group profitability.",
    "Customer concentration and contract risk: Loss of Chemist Warehouse contract demonstrated vulnerability to major customer losses. While new customers were won, contract volatility creates earnings uncertainty. Large customers have negotiating leverage to pressure pricing and terms.",
    "Limited revenue growth outlook: Analyst forecasts show revenue growth slowing to 6.1% CAGR through 2026, below historical 8.6% growth. PBS price deflation offsets volume growth. Pharmaceutical wholesale is mature, low-growth industry. Growth dependent on acquisitions which increase debt and integration risk.",
    "Regulatory and reimbursement headwinds: PBS margin caps (7% community, 10% hospital) limit pricing power. Ongoing PBS and PHARMAC price reforms reduce drug prices over time. Government budget pressures in Australia and New Zealand could accelerate generic substitution or reduce reimbursement rates.",
    "Debt and cash flow concerns: Debt-to-EBITDA of 2.68x limits financial flexibility. Free cash flow margin only 1.91% raises questions about dividend sustainability (payout ratio 57.5%). Recent acquisitions and capex program have increased leverage. Interest costs rising.",
    "Execution risks from major initiatives: A$360M distribution centre program has two sites remaining - delays or operational issues during cutover could disrupt service. CEO transition in July 2025 creates leadership risk during challenging period. Recent acquisitions (SVS, NGPF, Kiwi Kitchens) need to integrate successfully.",
    "Geographic concentration: ~95% of revenue from Australia and New Zealand exposes EBOS to regional economic conditions. Limited international diversification vs global healthcare distributors. Trans-Tasman exposure to currency volatility (70% revenue in AUD, reports in NZD).",
    "Vertical integration by competitors: Sigma-Chemist Warehouse and API-Priceline (Wesfarmers) are vertically integrated with retail scale to leverage against wholesale. Wesfarmers has deep pockets to invest in API/Priceline expansion. EBOS squeezed between larger vertically integrated competitors.",
    "Animal Care segment cyclicality: 20-25% of revenue from premium pet food and veterinary supplies is more economically sensitive. Consumer recession or trading down to value brands could pressure branded product volumes and margins. Recent acquisitions increase exposure to this more cyclical segment."
  ],
  "recent_developments": [
    {
      "date": "2025-Aug",
      "event": "FY2025 results: Revenue $12.3B (+12% YoY), EBITDA $585M (+7.5% YoY excluding Chemist Warehouse contract). Results in line with guidance despite major contract loss.",
      "impact": "positive"
    },
    {
      "date": "2025-Jul",
      "event": "Next Generation Pet Foods acquisition completed, adding Australian premium pet treat manufacturing and distribution capabilities with brands including Evolution, Australian Pet Treat Company, and Dentapet.",
      "impact": "positive"
    },
    {
      "date": "2025-Jul",
      "event": "Adam Hall appointed CEO effective July 1, 2025, succeeding John Cullity who retired after 7 years as CEO (11 years with company).",
      "impact": "neutral"
    },
    {
      "date": "2025-Q4",
      "event": "SVS Veterinary Supplies acquisition completed, adding leading NZ veterinary distributor serving 500+ vet clinics. Also acquired Kiwi Kitchens pet food brand.",
      "impact": "positive"
    },
    {
      "date": "2025-Jul",
      "event": "TerryWhite Chemmart pharmacy network reached 600 stores milestone, up from 500 stores in 2023. Network sales grew 5.7%.",
      "impact": "positive"
    },
    {
      "date": "2025-FY",
      "event": "Generated ~$385M from new pharmacy wholesale customers (~$540M annualized) following loss of Chemist Warehouse contract. Significantly exceeded internal targets, partially offsetting contract loss.",
      "impact": "positive"
    },
    {
      "date": "2025-FY",
      "event": "Delivered $30M in cost savings vs target of $25-50M by end FY2026. Strong execution on efficiency program.",
      "impact": "positive"
    },
    {
      "date": "2024-Dec",
      "event": "Sigma Healthcare and Chemist Warehouse merger officially completed, creating largest vertically integrated pharmacy player in Australia with 35-40% wholesale market share.",
      "impact": "negative"
    },
    {
      "date": "2024-Jul",
      "event": "Lost Chemist Warehouse Australia wholesale contract ($1.9B annual revenue, ~10% of group) to Sigma, effective July 2024. Contract switched back to Sigma after EBOS held it 2019-2024.",
      "impact": "negative"
    },
    {
      "date": "2024-FY",
      "event": "Distribution centre renewal program progressing. Two of six sites remain to be completed by end FY2026. New Perth facility opening in 2026. Sydney cold storage expansion underway for GLP-1 medicines.",
      "impact": "positive"
    }
  ],
  "guidance": {
    "as_of": "FY2025 Full Year Results (August 2025) and AGM (November 2025)",
    "fiscal_year": "FY2026 (ending June 30, 2026)",
    "items": [
      {
        "metric": "Underlying Group EBITDA",
        "target": "A$615-635 million",
        "period": "FY2026",
        "vs_prior": "maintained",
        "notes": "Represents ~7% YoY growth at midpoint from FY2025 base of A$585M. Stronger earnings contribution expected in H2 FY2026 driven by distribution centre program benefits."
      },
      {
        "metric": "Pharmacy wholesale margins",
        "target": "Continued tightness expected",
        "period": "FY2026",
        "vs_prior": "consistent",
        "notes": "Management expects tighter margins seen in FY2025 to continue through FY2026 as wholesale providers and customers realign following Sigma-Chemist Warehouse merger and competitive dynamics."
      },
      {
        "metric": "New pharmacy wholesale customers",
        "target": "Net new business of ~A$300 million",
        "period": "By end FY2026",
        "vs_prior": "N/A",
        "notes": "Already achieved A$540M annualized run rate from new customers in FY2025, well ahead of this target. Continued focus on winning independent pharmacy business."
      },
      {
        "metric": "Cost savings",
        "target": "A$25-50 million cumulative",
        "period": "By end FY2026",
        "vs_prior": "maintained",
        "notes": "Already delivered A$30M in FY2025, on track to exceed target. Focus on procurement efficiencies, operational leverage, and systems investments."
      },
      {
        "metric": "Capital expenditure",
        "target": "Approximately 30% lower from FY2027",
        "period": "FY2027 onwards",
        "vs_prior": "N/A",
        "notes": "Following completion of A$360M distribution centre renewal program in FY2026, ongoing capex expected to normalize significantly lower on like-for-like basis."
      },
      {
        "metric": "Return on Capital Employed (ROCE)",
        "target": "~15% long-term target",
        "period": "Long-term",
        "vs_prior": "N/A",
        "notes": "Strategic focus on improving capital efficiency and returns across the network. Distribution centre investments and operational improvements support this goal."
      }
    ],
    "management_commentary": "CEO Adam Hall noted that EBOS continues to benefit from positive industry tailwinds across both Healthcare and Animal Care sectors, supported by increased spending, demographic shifts, and evolving customer preferences. The company is well-positioned despite near-term margin pressures in pharmacy wholesale. Management emphasized focus on operational excellence, service levels, strategic acquisitions, and capital discipline."
  }
};

        // EMBEDDED DATA - DCF JSON
        const dcfData = {
  "ticker": "EBO.NZ",
  "company_name": "EBOS Group",
  "valuation_date": "2026-02-03",
  "current_price": 37.5,
  "currency": "NZD",
  "note": "Financials in AUD from FY2019 onwards. Stock trades in NZD.",
  "inputs": {
    "shares_outstanding": 196.1,
    "net_debt": 918.2,
    "last_fcf": 293.4,
    "currency": "AUD",
    "units": "millions"
  },
  "historical_growth": {
    "revenue_3yr_cagr": 4.5,
    "revenue_5yr_cagr": 7.0,
    "eps_3yr_cagr": -1.4,
    "eps_5yr_cagr": 1.7,
    "equity_3yr_cagr": 12.6,
    "equity_5yr_cagr": 15.9,
    "fcf_3yr_cagr": 20.7,
    "fcf_5yr_cagr": 7.4,
    "selected_growth_rate": 15.9,
    "growth_rate_source": "equity_5yr_cagr",
    "growth_divergence_warning": null
  },
  "assumptions": {
    "base": {
      "growth_rates": [10.0, 8.5, 7.0, 5.5, 4.0],
      "fcf_margin": 2.4,
      "wacc": 9.5,
      "terminal_growth": 2.5
    },
    "bull": {
      "growth_rates": [15.0, 13.0, 11.0, 9.0, 7.0],
      "fcf_margin": 2.7,
      "wacc": 9.0,
      "terminal_growth": 3.0
    },
    "bear": {
      "growth_rates": [5.0, 3.5, 2.0, 1.0, 0.5],
      "fcf_margin": 2.1,
      "wacc": 10.5,
      "terminal_growth": 2.0
    }
  },
  "valuation": {
    "base": {
      "intrinsic_value": 22.0,
      "upside": -41.3
    },
    "bull": {
      "intrinsic_value": 31.58,
      "upside": -15.8
    },
    "bear": {
      "intrinsic_value": 13.71,
      "upside": -63.4
    }
  },
  "entry_price": {
    "base": {
      "terminal_value_per_share": 30.7,
      "years_to_terminal": 5,
      "entry_price": 15.26,
      "entry_discount_from_current": -59.3
    }
  },
  "sensitivity": {
    "wacc_range": [7.0, 8.0, 9.0, 10.0, 11.0],
    "terminal_growth_range": [1.5, 2.0, 2.5, 3.0, 3.5],
    "matrix": [
      [30.59, 33.5, 37.05, 41.5, 47.21],
      [25.08, 27.05, 29.39, 32.19, 35.61],
      [21.04, 22.45, 24.08, 25.99, 28.24],
      [17.95, 19.0, 20.19, 21.56, 23.13],
      [15.51, 16.32, 17.22, 18.24, 19.39]
    ]
  },
  "probability_weighted": {
    "weights": {"bull": 0.25, "base": 0.5, "bear": 0.25},
    "weighted_iv": 22.32
  }
};

        // Parse CSV
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
                return obj;
            });
        }

        const data = parseCSV(csvData);

        // Sort chronologically
        data.sort((a, b) => {
            const parseDate = (p) => {
                const year = parseInt(p.match(/\d{4}/)?.[0] || '0');
                const isH1 = p.includes('H1');
                const isFY = p.startsWith('FY');
                const subOrder = isH1 ? 3 : isFY ? 7 : 0;
                return year * 10 + subOrder;
            };
            return parseDate(a.Period) - parseDate(b.Period);
        });

        const fyData = data.filter(d => d.Period.startsWith('FY'));

        // Color palette
        const colors = {
            primary: '#4fc3f7',
            secondary: '#29b6f6',
            tertiary: '#0984e3',
            healthcare: '#00d4aa',
            animalcare: '#fdcb6e',
            warning: '#fdcb6e',
            danger: '#ff6b6b'
        };

        // Chart defaults
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#e0e0e0', font: { size: 11 } } }
            },
            scales: {
                x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
        };

        // Helper functions
        function calcYoYChange(current, previous) {
            if (!previous || !current) return null;
            return ((parseFloat(current) - parseFloat(previous)) / Math.abs(parseFloat(previous)) * 100).toFixed(1);
        }

        function formatCurrency(val, currency = 'AUD') {
            if (!val || val === '') return 'N/A';
            const num = parseFloat(val);
            if (num >= 1000) return `${currency} ${(num/1000).toFixed(1)}B`;
            return `${currency} ${num.toFixed(0)}M`;
        }

        // Render Investment Overview
        function renderOverview() {
            const grid = document.getElementById('overviewGrid');

            let html = `
                <div class="overview-card">
                    <h3>Company Overview</h3>
                    <p>${analysis.overview}</p>
                </div>

                <div class="overview-card">
                    <h3>Business Model</h3>
                    <p>${analysis.business_model.summary}</p>
                    <ul>
                        ${analysis.business_model.revenue_streams.map(s => `
                            <li class="revenue-stream">
                                <span>${s.name}</span>
                                <span class="percent">${s.percent}%</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>

                <div class="overview-card">
                    <h3>Competitive Position</h3>
                    <p><strong>Main Competitors:</strong> ${analysis.competitive_position.main_competitors.join(', ')}</p>
                    <p><strong>Market Position:</strong> ${analysis.competitive_position.market_position}</p>
                    <p><strong>Key Moats:</strong></p>
                    <ul>
                        ${analysis.competitive_position.moat_factors.map(m => `
                            <li><strong>${m.factor}:</strong> ${m.description}</li>
                        `).join('')}
                    </ul>
                </div>

                <div class="overview-card">
                    <h3>Growth Drivers</h3>
                    <ul>
                        ${analysis.growth_drivers.slice(0, 6).map(d => `<li>${d}</li>`).join('')}
                    </ul>
                </div>

                <div class="overview-card risks">
                    <h3>Key Risks</h3>
                    <ul>
                        ${analysis.risks.business.slice(0, 3).map(r => `
                            <li><span class="risk-${r.severity}">[${r.severity.toUpperCase()}]</span> ${r.risk}: ${r.description}</li>
                        `).join('')}
                        ${analysis.risks.regulatory.slice(0, 2).map(r => `
                            <li><span class="risk-${r.severity}">[${r.severity.toUpperCase()}]</span> ${r.risk}: ${r.description}</li>
                        `).join('')}
                    </ul>
                </div>

                <div class="overview-card bull">
                    <h3>Bull Case</h3>
                    <ul>
                        ${analysis.bull_case.slice(0, 5).map(b => `<li>${b}</li>`).join('')}
                    </ul>
                </div>

                <div class="overview-card bear">
                    <h3>Bear Case</h3>
                    <ul>
                        ${analysis.bear_case.slice(0, 5).map(b => `<li>${b}</li>`).join('')}
                    </ul>
                </div>

                <div class="overview-card">
                    <h3>Recent Developments</h3>
                    <ul>
                        ${analysis.recent_developments.slice(0, 6).map(d => `
                            <li><strong>${d.date}:</strong> ${d.event}</li>
                        `).join('')}
                    </ul>
                </div>
            `;

            grid.innerHTML = html;
        }

        function toggleOverview() {
            const btn = document.querySelector('.overview-toggle');
            const content = document.getElementById('overviewContent');
            btn.classList.toggle('active');
            content.classList.toggle('active');
        }

        // Render KPIs
        function renderKPIs() {
            const latest = fyData[fyData.length - 1];
            const previous = fyData[fyData.length - 2];

            const kpis = [
                {
                    label: 'Revenue',
                    value: formatCurrency(latest.Revenue, latest.Currency),
                    change: calcYoYChange(latest.Revenue, previous.Revenue)
                },
                {
                    label: 'EBITDA',
                    value: formatCurrency(latest.EBITDA, latest.Currency),
                    change: calcYoYChange(latest.EBITDA, previous.EBITDA)
                },
                {
                    label: 'Net Income',
                    value: formatCurrency(latest.NetIncome, latest.Currency),
                    change: calcYoYChange(latest.NetIncome, previous.NetIncome)
                },
                {
                    label: 'EPS',
                    value: `${latest.Currency} ${parseFloat(latest.EPS).toFixed(1)}c`,
                    change: calcYoYChange(latest.EPS, previous.EPS)
                },
                {
                    label: 'Dividend/Share',
                    value: `${latest.Currency} ${parseFloat(latest.DividendPerShare).toFixed(1)}c`,
                    change: calcYoYChange(latest.DividendPerShare, previous.DividendPerShare)
                },
                {
                    label: 'Free Cash Flow',
                    value: formatCurrency(latest.FreeCashFlow, latest.Currency),
                    change: calcYoYChange(latest.FreeCashFlow, previous.FreeCashFlow)
                }
            ];

            const grid = document.getElementById('kpiGrid');
            grid.innerHTML = kpis.map(kpi => `
                <div class="kpi-card">
                    <div class="kpi-value">${kpi.value}</div>
                    <div class="kpi-label">${kpi.label}</div>
                    ${kpi.change ? `<div class="kpi-change ${parseFloat(kpi.change) >= 0 ? 'positive' : 'negative'}">${parseFloat(kpi.change) >= 0 ? '+' : ''}${kpi.change}% YoY</div>` : ''}
                </div>
            `).join('');
        }

        // Render Guidance
        function renderGuidance() {
            if (!analysis.guidance || !analysis.guidance.items || analysis.guidance.items.length === 0) {
                document.getElementById('guidanceSection').style.display = 'none';
                return;
            }

            const guidance = analysis.guidance;
            document.getElementById('guidanceAsOf').textContent = guidance.as_of || '';
            document.getElementById('guidanceFY').textContent = guidance.fiscal_year || '';

            const grid = document.getElementById('guidanceGrid');
            grid.innerHTML = guidance.items.map(item => {
                const vsClass = item.vs_prior ? item.vs_prior.toLowerCase() : 'new';
                const vsLabel = item.vs_prior ? item.vs_prior.charAt(0).toUpperCase() + item.vs_prior.slice(1) : 'New';
                return `
                    <div class="guidance-card">
                        <div class="guidance-metric">${item.metric}</div>
                        <div class="guidance-target">${item.target}</div>
                        <div class="guidance-period">${item.period}</div>
                        <span class="guidance-vs-prior ${vsClass}">${vsLabel}</span>
                        ${item.notes ? `<div class="guidance-notes">${item.notes}</div>` : ''}
                    </div>
                `;
            }).join('');

            const commentary = document.getElementById('guidanceCommentary');
            if (guidance.management_commentary) {
                commentary.textContent = guidance.management_commentary;
                commentary.style.display = 'block';
            } else {
                commentary.style.display = 'none';
            }
        }

        // Render Charts
        function renderCharts() {
            // Revenue Growth
            new Chart(document.getElementById('revenueChart'), {
                type: 'line',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [{
                        label: 'Revenue',
                        data: fyData.map(d => parseFloat(d.Revenue)),
                        borderColor: colors.primary,
                        backgroundColor: colors.primary + '20',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    ...chartDefaults,
                    plugins: {
                        ...chartDefaults.plugins,
                        title: { display: false }
                    }
                }
            });

            // Segment Revenue
            new Chart(document.getElementById('segmentChart'), {
                type: 'bar',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [
                        {
                            label: 'Healthcare',
                            data: fyData.map(d => parseFloat(d.HealthcareRevenue || 0)),
                            backgroundColor: colors.healthcare
                        },
                        {
                            label: 'Animal Care',
                            data: fyData.map(d => parseFloat(d.AnimalCareRevenue || 0)),
                            backgroundColor: colors.animalcare
                        }
                    ]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        x: { ...chartDefaults.scales.x, stacked: true },
                        y: { ...chartDefaults.scales.y, stacked: true }
                    }
                }
            });

            // EBITDA & Margin
            new Chart(document.getElementById('ebitdaChart'), {
                type: 'bar',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [
                        {
                            label: 'EBITDA',
                            data: fyData.map(d => parseFloat(d.EBITDA)),
                            backgroundColor: colors.primary,
                            yAxisID: 'y'
                        },
                        {
                            label: 'EBITDA Margin %',
                            data: fyData.map(d => (parseFloat(d.EBITDA) / parseFloat(d.Revenue) * 100)),
                            type: 'line',
                            borderColor: colors.warning,
                            backgroundColor: 'transparent',
                            yAxisID: 'y1',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, position: 'left' },
                        y1: {
                            ...chartDefaults.scales.y,
                            position: 'right',
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });

            // Net Income & Margin
            new Chart(document.getElementById('netIncomeChart'), {
                type: 'bar',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [
                        {
                            label: 'Net Income',
                            data: fyData.map(d => parseFloat(d.NetIncome)),
                            backgroundColor: colors.secondary,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Net Margin %',
                            data: fyData.map(d => (parseFloat(d.NetIncome) / parseFloat(d.Revenue) * 100)),
                            type: 'line',
                            borderColor: colors.healthcare,
                            backgroundColor: 'transparent',
                            yAxisID: 'y1',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, position: 'left' },
                        y1: {
                            ...chartDefaults.scales.y,
                            position: 'right',
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });

            // EPS & Dividends
            new Chart(document.getElementById('epsChart'), {
                type: 'line',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [
                        {
                            label: 'EPS (cents)',
                            data: fyData.map(d => parseFloat(d.EPS)),
                            borderColor: colors.primary,
                            backgroundColor: colors.primary + '20',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Dividend/Share (cents)',
                            data: fyData.map(d => parseFloat(d.DividendPerShare)),
                            borderColor: colors.healthcare,
                            backgroundColor: colors.healthcare + '20',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: chartDefaults
            });

            // Free Cash Flow
            new Chart(document.getElementById('fcfChart'), {
                type: 'bar',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [{
                        label: 'Free Cash Flow',
                        data: fyData.map(d => parseFloat(d.FreeCashFlow)),
                        backgroundColor: fyData.map(d => parseFloat(d.FreeCashFlow) >= 0 ? colors.healthcare : colors.danger)
                    }]
                },
                options: chartDefaults
            });

            // Debt vs Equity
            new Chart(document.getElementById('debtEquityChart'), {
                type: 'line',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [
                        {
                            label: 'Total Debt',
                            data: fyData.map(d => parseFloat(d.TotalDebt)),
                            borderColor: colors.danger,
                            backgroundColor: colors.danger + '20',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Shareholders Equity',
                            data: fyData.map(d => parseFloat(d.ShareholdersEquity)),
                            borderColor: colors.healthcare,
                            backgroundColor: colors.healthcare + '20',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: chartDefaults
            });

            // Debt-to-Equity Ratio
            new Chart(document.getElementById('deRatioChart'), {
                type: 'line',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [{
                        label: 'Debt-to-Equity Ratio',
                        data: fyData.map(d => (parseFloat(d.TotalDebt) / parseFloat(d.ShareholdersEquity)).toFixed(2)),
                        borderColor: colors.warning,
                        backgroundColor: colors.warning + '20',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: chartDefaults
            });
        }

        // Modal descriptions
        const metricDescriptions = {
            revenue: {
                title: "Revenue",
                content: `
                    <p><strong>Revenue</strong> represents EBOS's total income from healthcare distribution, animal care products, and retail pharmacy operations.</p>
                    <div class="metric-highlight">
                        <strong>For EBOS:</strong> Revenue is driven by wholesale distribution volumes (75-80% of total), TerryWhite Chemmart pharmacy network sales (15%), and Animal Care branded products (20-25%). Note the currency change from NZD to AUD starting FY2019.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Healthcare segment growth driven by aging demographics and specialty pharmaceuticals (GLP-1s)</li>
                        <li>Impact of major customer wins/losses (e.g., Chemist Warehouse contract loss offset by new customers)</li>
                        <li>Animal Care growth from acquisitions (SVS, NGPF, Kiwi Kitchens) and organic premium pet food expansion</li>
                        <li>PBS price deflation offsetting volume growth in pharmaceutical wholesale</li>
                    </ul>
                `
            },
            segments: {
                title: "Segment Revenue Mix",
                content: `
                    <p><strong>Segment Revenue</strong> shows the split between EBOS's two main business divisions.</p>
                    <div class="metric-highlight">
                        <strong>For EBOS:</strong> Healthcare (75-80% of revenue) includes pharmaceutical wholesale, hospital distribution, TerryWhite Chemmart, and contract logistics. Animal Care (20-25%) includes premium pet food brands (Black Hawk, VitaPet) and veterinary supplies.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Animal Care growing faster than Healthcare, increasing diversification</li>
                        <li>Healthcare revenue impacted by Chemist Warehouse contract loss but offset by new customer wins</li>
                        <li>Animal Care margin profile (15-20%) is higher than wholesale distribution (7-10%)</li>
                        <li>Recent acquisitions (SVS, NGPF) expanding Animal Care presence</li>
                    </ul>
                `
            },
            ebitda: {
                title: "EBITDA & EBITDA Margin",
                content: `
                    <p><strong>EBITDA</strong> (Earnings Before Interest, Tax, Depreciation, and Amortization) measures operating profitability before capital structure and accounting decisions.</p>
                    <div class="metric-highlight">
                        <strong>For EBOS:</strong> EBITDA margin is typically 4-5% due to low wholesale distribution margins (PBS-regulated at 7% community, 10% hospital). Animal Care branded products achieve higher margins (15-20%).
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Margin compression risk from Sigma-Chemist Warehouse competition (management expects tight margins through FY2026)</li>
                        <li>Distribution centre renewal program (A$360M investment) should drive operational efficiencies and margin expansion</li>
                        <li>Cost savings program targeting A$25-50M by FY2026 (already delivered A$30M in FY2025)</li>
                        <li>Mix shift toward higher-margin Animal Care and specialty pharmaceuticals</li>
                    </ul>
                `
            },
            netincome: {
                title: "Net Income & Margin",
                content: `
                    <p><strong>Net Income</strong> represents EBOS's bottom-line profitability after all expenses, including interest and taxes.</p>
                    <div class="metric-highlight">
                        <strong>For EBOS:</strong> Net margin typically 1.5-2.2% reflects the low-margin distribution business model. Profitability is driven by volume growth, operational efficiency, and scale advantages rather than pricing power.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>FY2025 margin decline (1.75% vs 2.06% in FY2024) due to wholesale margin compression</li>
                        <li>Interest expense rising with debt levels (debt-to-EBITDA 2.68x)</li>
                        <li>Currency volatility (70% revenue in AUD, reports in NZD)</li>
                        <li>Acquisition integration costs (SVS, NGPF) pressuring near-term margins</li>
                    </ul>
                `
            },
            eps: {
                title: "EPS & Dividends per Share",
                content: `
                    <p><strong>EPS</strong> (Earnings Per Share) measures profitability per share, while <strong>Dividends</strong> show cash returns to shareholders.</p>
                    <div class="metric-highlight">
                        <strong>For EBOS:</strong> EPS declined in FY2025 (109.7c vs 141.3c in FY2024) due to margin compression. However, dividends increased to 118.5c (from 86.0c), resulting in payout ratio of 108% vs historical 57-66%.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Dividend sustainability at current payout ratio (free cash flow margin only 1.91%)</li>
                        <li>EPS recovery as distribution centre efficiencies materialize and margins stabilize</li>
                        <li>Shares outstanding increasing from acquisitions (196.1M in FY2025 vs 192.2M in FY2024)</li>
                        <li>Management targeting 15% ROCE long-term, which should support EPS growth</li>
                    </ul>
                `
            },
            fcf: {
                title: "Free Cash Flow",
                content: `
                    <p><strong>Free Cash Flow</strong> measures cash generated after capital expenditures, indicating the company's ability to fund dividends, debt reduction, and acquisitions.</p>
                    <div class="metric-highlight">
                        <strong>For EBOS:</strong> FCF improved to A$293M in FY2025 (from A$252M in FY2024) despite earnings decline, driven by working capital management and A$360M distribution centre capex program nearing completion.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Capex expected to decline 30% from FY2027 as distribution centre program completes, boosting FCF</li>
                        <li>Working capital intensity in pharmaceutical distribution (inventory and receivables)</li>
                        <li>FCF conversion vs net income (improved in FY2025 to 136% from 93% in FY2024)</li>
                        <li>Dividend payout sustainability (payout 108% of earnings but 97% of FCF in FY2025)</li>
                    </ul>
                `
            },
            debtequity: {
                title: "Debt vs Equity",
                content: `
                    <p><strong>Debt vs Equity</strong> shows EBOS's capital structure and financial leverage over time.</p>
                    <div class="metric-highlight">
                        <strong>For EBOS:</strong> Total debt declined to A$1.1B in FY2025 (from A$1.2B in FY2024) while equity grew to A$2.7B, improving financial health. Net debt of A$918M represents 33% of equity.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Debt peaked in FY2023 at A$1.6B during distribution centre capex program</li>
                        <li>Debt-to-EBITDA of 2.68x is manageable for stable, cash-generative distribution business</li>
                        <li>Acquisition funding (SVS, NGPF) partially debt-financed but offset by deleveraging</li>
                        <li>Strong FCF post-FY2026 should enable debt reduction and/or further acquisitions</li>
                    </ul>
                `
            },
            deratio: {
                title: "Debt-to-Equity Ratio",
                content: `
                    <p><strong>Debt-to-Equity Ratio</strong> measures financial leverage by comparing total debt to shareholders' equity.</p>
                    <div class="metric-highlight">
                        <strong>For EBOS:</strong> D/E ratio improved to 0.40 in FY2025 (from 0.50 in FY2024 and peak of 0.71 in FY2023), indicating deleveraging progress. Target is to maintain below 0.50 long-term.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Ratio declining due to equity growth (retained earnings) and debt paydown</li>
                        <li>Distribution centre capex completing in FY2026, reducing leverage pressure</li>
                        <li>Acquisition-driven leverage spikes (e.g., FY2017 when ratio jumped to 0.52)</li>
                        <li>Interest rate sensitivity: higher rates increase cost of debt but EBOS has manageable leverage</li>
                    </ul>
                `
            }
        };

        function openModal(key) {
            document.getElementById('modalTitle').textContent = metricDescriptions[key].title;
            document.getElementById('modalBody').innerHTML = metricDescriptions[key].content;
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay')) return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }

        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // DCF Valuation Functions
        let currentScenario = 'base';

        function initDCF() {
            if (!dcfData || !dcfData.valuation) return;

            document.getElementById('dcfCurrent').textContent = '$' + dcfData.current_price.toFixed(2);

            if (dcfData.historical_growth.growth_divergence_warning) {
                document.getElementById('growthWarning').style.display = 'flex';
                document.getElementById('warningText').textContent = dcfData.historical_growth.growth_divergence_warning;
            }

            const base = dcfData.assumptions.base;
            document.getElementById('growthSlider').value = dcfData.historical_growth.selected_growth_rate;
            document.getElementById('waccSlider').value = base.wacc;
            document.getElementById('terminalSlider').value = base.terminal_growth;

            document.getElementById('growthValue').textContent = dcfData.historical_growth.selected_growth_rate + '%';
            document.getElementById('waccValue').textContent = base.wacc + '%';
            document.getElementById('terminalValue').textContent = base.terminal_growth + '%';

            document.getElementById('growthHint').textContent =
                'Based on ' + dcfData.historical_growth.growth_rate_source.replace(/_/g, ' ');

            renderDCFInputs();
            renderHistoricalGrowth();
            renderSensitivityMatrix();
            updateDCFDisplay();
            switchScenario('base');
        }

        function renderDCFInputs() {
            const inputs = dcfData.inputs;
            const currency = 'A$';

            const formatNum = (n) => {
                if (Math.abs(n) >= 1000) return currency + (n/1000).toFixed(1) + 'B';
                return currency + n.toFixed(0) + 'M';
            };

            document.getElementById('baseFCF').textContent = formatNum(inputs.last_fcf);

            const shares = inputs.shares_outstanding;
            document.getElementById('sharesOut').textContent = shares.toFixed(1) + 'M';

            const netDebt = inputs.net_debt;
            const netDebtEl = document.getElementById('netDebt');
            netDebtEl.textContent = formatNum(netDebt);

            renderFCFProjections();
        }

        function renderFCFProjections() {
            const startGrowth = parseFloat(document.getElementById('growthSlider')?.value || dcfData.historical_growth.selected_growth_rate);
            const baseFCF = dcfData.inputs.last_fcf;

            const formatFCF = (n) => {
                if (Math.abs(n) >= 1000) return 'A$' + (n/1000).toFixed(1) + 'B';
                return 'A$' + n.toFixed(0) + 'M';
            };

            const endGrowth = 10;
            const growthRates = [];
            for (let i = 0; i < 5; i++) {
                const rate = startGrowth > endGrowth
                    ? startGrowth - (startGrowth - endGrowth) * (i / 4)
                    : startGrowth;
                growthRates.push(rate);
            }

            let fcf = baseFCF;
            const fcfValues = [baseFCF];

            for (let i = 0; i < 5; i++) {
                fcf = fcf * (1 + growthRates[i] / 100);
                fcfValues.push(fcf);
            }

            let html = `
                <div class="fcf-projection-item header">Base</div>
                <div class="fcf-projection-item header">Year 1</div>
                <div class="fcf-projection-item header">Year 2</div>
                <div class="fcf-projection-item header">Year 3</div>
                <div class="fcf-projection-item header">Year 4</div>
                <div class="fcf-projection-item header">Year 5</div>
            `;

            html += `<div class="fcf-projection-item">
                <div class="fcf-value">${formatFCF(fcfValues[0])}</div>
                <div class="growth-rate">-</div>
            </div>`;

            for (let i = 1; i <= 5; i++) {
                html += `<div class="fcf-projection-item">
                    <div class="fcf-value">${formatFCF(fcfValues[i])}</div>
                    <div class="growth-rate">+${growthRates[i-1].toFixed(0)}%</div>
                </div>`;
            }

            document.getElementById('fcfProjectionTable').innerHTML = html;
        }

        function calculateDCF(startGrowth, wacc, terminalGrowth) {
            const years = 5;
            const fcf = dcfData.inputs.last_fcf;
            let pvFCF = 0;
            let projectedFCF = fcf;

            const endGrowth = 10;

            for (let i = 0; i < years; i++) {
                const yearGrowth = startGrowth > endGrowth
                    ? startGrowth - (startGrowth - endGrowth) * (i / 4)
                    : startGrowth;
                projectedFCF *= (1 + yearGrowth / 100);
                pvFCF += projectedFCF / Math.pow(1 + wacc/100, i + 1);
            }

            const terminalFCF = projectedFCF * (1 + terminalGrowth/100);
            const terminalValue = terminalFCF / (wacc/100 - terminalGrowth/100);
            const pvTerminal = terminalValue / Math.pow(1 + wacc/100, years);

            const enterpriseValue = pvFCF + pvTerminal;
            const equityValue = enterpriseValue - dcfData.inputs.net_debt;
            const iv = equityValue / dcfData.inputs.shares_outstanding;

            const terminalPerShare = terminalValue / dcfData.inputs.shares_outstanding;
            const entryPrice = terminalPerShare / Math.pow(1.15, years);

            return {
                iv: iv,
                entryPrice: entryPrice,
                terminalPerShare: terminalPerShare,
                pvFCF: pvFCF,
                pvTerminal: pvTerminal,
                enterpriseValue: enterpriseValue
            };
        }

        window.updateDCFDisplay = function() {
            const growth = parseFloat(document.getElementById('growthSlider').value);
            const wacc = parseFloat(document.getElementById('waccSlider').value);
            const terminal = parseFloat(document.getElementById('terminalSlider').value);

            document.getElementById('growthValue').textContent = growth + '%';
            document.getElementById('waccValue').textContent = wacc + '%';
            document.getElementById('terminalValue').textContent = terminal + '%';

            renderFCFProjections();

            const result = calculateDCF(growth, wacc, terminal);

            document.getElementById('dcfIV').textContent = '$' + result.iv.toFixed(2);
            document.getElementById('dcfEntry').textContent = '$' + result.entryPrice.toFixed(2);

            const upside = ((result.iv - dcfData.current_price) / dcfData.current_price * 100);
            const upsideEl = document.getElementById('dcfUpside');
            upsideEl.textContent = (upside >= 0 ? '+' : '') + upside.toFixed(1) + '% ' + (upside >= 0 ? 'upside' : 'downside');
            upsideEl.className = 'dcf-change ' + (upside >= 0 ? 'positive' : 'negative');

            document.getElementById('dcfWeighted').textContent = '$' + dcfData.probability_weighted.weighted_iv.toFixed(2);

            const grid = document.getElementById('assumptionGrid');
            if (grid) {
                grid.innerHTML = `
                    <div class="assumption-item">
                        <div class="label">Growth Rate</div>
                        <div class="value">${growth}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">WACC</div>
                        <div class="value">${wacc}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Terminal Growth</div>
                        <div class="value">${terminal}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Intrinsic Value</div>
                        <div class="value" style="color: #4fc3f7;">$${result.iv.toFixed(2)}</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Entry Price</div>
                        <div class="value" style="color: #4fc3f7;">$${result.entryPrice.toFixed(2)}</div>
                    </div>
                `;
            }
        };

        window.switchScenario = function(scenario) {
            currentScenario = scenario;

            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === scenario);
            });

            const assumptions = dcfData.assumptions[scenario];
            const valuation = dcfData.valuation[scenario];

            renderFCFProjections();

            document.getElementById('growthSlider').value = assumptions.growth_rates[0];
            document.getElementById('waccSlider').value = assumptions.wacc;
            document.getElementById('terminalSlider').value = assumptions.terminal_growth;

            const grid = document.getElementById('assumptionGrid');
            grid.innerHTML = `
                <div class="assumption-item">
                    <div class="label">Year 1 Growth</div>
                    <div class="value">${assumptions.growth_rates[0]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Year 5 Growth</div>
                    <div class="value">${assumptions.growth_rates[4]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">FCF Margin</div>
                    <div class="value">${assumptions.fcf_margin}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">WACC</div>
                    <div class="value">${assumptions.wacc}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Terminal Growth</div>
                    <div class="value">${assumptions.terminal_growth}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Intrinsic Value</div>
                    <div class="value" style="color: #4fc3f7;">$${valuation.intrinsic_value.toFixed(2)}</div>
                </div>
            `;

            updateDCFDisplay();
        };

        function renderHistoricalGrowth() {
            const growth = dcfData.historical_growth;
            const selectedSource = growth.growth_rate_source;
            const grid = document.getElementById('growthGrid');

            const metrics = [
                { key: 'revenue_3yr_cagr', label: 'Revenue 3Y' },
                { key: 'revenue_5yr_cagr', label: 'Revenue 5Y' },
                { key: 'eps_3yr_cagr', label: 'EPS 3Y' },
                { key: 'eps_5yr_cagr', label: 'EPS 5Y' },
                { key: 'equity_3yr_cagr', label: 'Equity 3Y' },
                { key: 'equity_5yr_cagr', label: 'Equity 5Y' },
                { key: 'fcf_3yr_cagr', label: 'FCF 3Y' },
                { key: 'fcf_5yr_cagr', label: 'FCF 5Y' }
            ];

            grid.innerHTML = metrics.map(m => {
                const rate = growth[m.key];
                const isSelected = m.key === selectedSource;
                const colorClass = rate >= 0 ? 'positive' : 'negative';
                return `
                    <div class="growth-item ${isSelected ? 'selected' : ''}">
                        <div class="metric">${m.label}</div>
                        <div class="rate ${colorClass}">${rate >= 0 ? '+' : ''}${rate.toFixed(1)}%</div>
                    </div>
                `;
            }).join('');
        }

        function renderSensitivityMatrix() {
            const sens = dcfData.sensitivity;
            const table = document.getElementById('sensitivityMatrix');
            const currentPrice = dcfData.current_price;

            let html = '<tr><th>WACC \\ Term G</th>';
            sens.terminal_growth_range.forEach(tg => {
                html += `<th>${tg}%</th>`;
            });
            html += '</tr>';

            sens.wacc_range.forEach((wacc, i) => {
                html += `<tr><th>${wacc}%</th>`;
                sens.matrix[i].forEach((val, j) => {
                    const isHighlight = wacc === dcfData.assumptions.base.wacc &&
                                       sens.terminal_growth_range[j] === dcfData.assumptions.base.terminal_growth;
                    const colorClass = val >= currentPrice ? 'above-current' : 'below-current';
                    html += `<td class="${isHighlight ? 'highlight' : colorClass}">$${val.toFixed(2)}</td>`;
                });
                html += '</tr>';
            });

            table.innerHTML = html;
        }

        // Initialize
        renderOverview();
        renderKPIs();
        renderGuidance();
        renderCharts();
        initDCF();

        // Bind slider events
        (function() {
            var growthSlider = document.getElementById('growthSlider');
            var waccSlider = document.getElementById('waccSlider');
            var terminalSlider = document.getElementById('terminalSlider');

            if (growthSlider) {
                growthSlider.oninput = window.updateDCFDisplay;
                growthSlider.onchange = window.updateDCFDisplay;
            }
            if (waccSlider) {
                waccSlider.oninput = window.updateDCFDisplay;
                waccSlider.onchange = window.updateDCFDisplay;
            }
            if (terminalSlider) {
                terminalSlider.oninput = window.updateDCFDisplay;
                terminalSlider.onchange = window.updateDCFDisplay;
            }
        })();
    </script>
</body>
</html>