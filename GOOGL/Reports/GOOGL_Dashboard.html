<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alphabet Inc. (GOOGL) Financial Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: #e0e0e0;
    min-height: 100vh;
    padding: 20px;
}
.header {
    text-align: center;
    margin-bottom: 30px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    backdrop-filter: blur(10px);
}
.header h1 {
    font-size: 2.5rem;
    background: linear-gradient(90deg, #00d4aa, #00b894);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
}
.header p {
    color: #888;
    font-size: 1.1rem;
}
.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
    margin-bottom: 30px;
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
}
.kpi-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.kpi-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 212, 170, 0.2);
}
.kpi-value {
    font-size: 1.6rem;
    font-weight: bold;
    color: #00d4aa;
    margin-bottom: 5px;
}
.kpi-label {
    font-size: 0.8rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 1px;
}
.kpi-change {
    font-size: 0.85rem;
    margin-top: 5px;
}
.kpi-change.positive { color: #00d4aa; }
.kpi-change.negative { color: #ff6b6b; }
/* Guidance Section */
.guidance-section {
    max-width: 1400px;
    margin: 0 auto 30px;
}
.guidance-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}
.guidance-header h3 {
    color: #fff;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 10px;
}
.guidance-header h3::before {
    content: '';
    display: inline-block;
    width: 4px;
    height: 20px;
    background: linear-gradient(180deg, #00d4aa, #00b894);
    border-radius: 2px;
}
.guidance-meta {
    font-size: 0.85rem;
    color: #888;
}
.guidance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}
.guidance-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 18px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: transform 0.2s ease;
}
.guidance-card:hover {
    transform: translateY(-2px);
}
.guidance-metric {
    font-size: 0.8rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 6px;
}
.guidance-target {
    font-size: 1.3rem;
    font-weight: 600;
    color: #00d4aa;
    margin-bottom: 6px;
}
.guidance-period {
    font-size: 0.85rem;
    color: #e0e0e0;
    margin-bottom: 8px;
}
.guidance-vs-prior {
    display: inline-block;
    font-size: 0.75rem;
    padding: 3px 8px;
    border-radius: 4px;
    font-weight: 500;
}
.guidance-vs-prior.raised, .guidance-vs-prior.exceeded {
    background: rgba(0, 212, 170, 0.15);
    color: #00d4aa;
}
.guidance-vs-prior.lowered {
    background: rgba(255, 107, 107, 0.15);
    color: #ff6b6b;
}
.guidance-vs-prior.maintained, .guidance-vs-prior.consensus {
    background: rgba(255, 255, 255, 0.1);
    color: #888;
}
.guidance-vs-prior.new {
    background: rgba(99, 102, 241, 0.15);
    color: #818cf8;
}
.guidance-notes {
    font-size: 0.75rem;
    color: #666;
    margin-top: 8px;
    line-height: 1.4;
}
.guidance-commentary {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    padding: 16px 20px;
    border-left: 3px solid #00d4aa;
    font-style: italic;
    color: #b0b0b0;
    line-height: 1.6;
}
.guidance-commentary::before {
    content: '"';
    font-size: 1.5rem;
    color: #00d4aa;
    margin-right: 4px;
}
.section-title {
    font-size: 1.5rem;
    color: #fff;
    margin: 40px auto 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid rgba(0, 212, 170, 0.3);
    max-width: 1400px;
}
.charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
    gap: 25px;
    max-width: 1400px;
    margin: 0 auto;
}
.chart-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 25px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}
.chart-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
}
.chart-header h3 {
    color: #fff;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 10px;
}
.chart-header h3::before {
    content: '';
    display: inline-block;
    width: 4px;
    height: 20px;
    background: linear-gradient(180deg, #00d4aa, #00b894);
    border-radius: 2px;
}
.help-btn {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: rgba(0, 212, 170, 0.2);
    border: 1px solid #00d4aa;
    color: #00d4aa;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}
.help-btn:hover {
    background: #00d4aa;
    color: #1a1a2e;
}
.chart-wrapper {
    position: relative;
    height: 300px;
}
.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    padding: 20px;
}
.modal-overlay.active { display: flex; }
.modal {
    background: linear-gradient(135deg, #1e2a4a 0%, #16213e 100%);
    border-radius: 16px;
    max-width: 600px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
    border: 1px solid rgba(0, 212, 170, 0.3);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}
.modal-header {
    padding: 20px 25px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.modal-header h3 {
    color: #00d4aa;
    font-size: 1.4rem;
    margin: 0;
}
.modal-close {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(255, 107, 107, 0.2);
    border: 1px solid #ff6b6b;
    color: #ff6b6b;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}
.modal-close:hover {
    background: #ff6b6b;
    color: #fff;
}
.modal-body {
    padding: 25px;
    line-height: 1.7;
}
.modal-body p { margin-bottom: 15px; }
.modal-body strong { color: #00d4aa; }
.modal-body ul { margin: 15px 0; padding-left: 20px; }
.modal-body li { margin-bottom: 8px; }
.metric-highlight {
    background: rgba(0, 212, 170, 0.1);
    border-left: 3px solid #00d4aa;
    padding: 12px 15px;
    margin: 15px 0;
    border-radius: 0 8px 8px 0;
}
/* Investment Overview Section */
.overview-section {
    max-width: 1400px;
    margin: 0 auto 30px;
}
.overview-toggle {
    width: 100%;
    background: rgba(0, 212, 170, 0.1);
    border: 1px solid rgba(0, 212, 170, 0.3);
    border-radius: 12px;
    padding: 16px 24px;
    color: #00d4aa;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.2s ease;
}
.overview-toggle:hover {
    background: rgba(0, 212, 170, 0.2);
}
.overview-toggle .arrow {
    transition: transform 0.3s ease;
}
.overview-toggle.active .arrow {
    transform: rotate(180deg);
}
.overview-content {
    display: none;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-top: none;
    border-radius: 0 0 12px 12px;
    padding: 30px;
    margin-top: -12px;
}
.overview-content.active {
    display: block;
}
.overview-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 25px;
}
.overview-card {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.overview-card h3 {
    color: #00d4aa;
    font-size: 1.1rem;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.overview-card p {
    margin-bottom: 12px;
    line-height: 1.6;
}
.overview-card ul {
    list-style: none;
    padding: 0;
    margin: 0;
}
.overview-card li {
    padding: 8px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    line-height: 1.5;
}
.overview-card li:last-child {
    border-bottom: none;
}
.overview-card.bull h3 { color: #00d4aa; }
.overview-card.bear h3 { color: #ff6b6b; }
.overview-card.risks h3 { color: #fdcb6e; }
.risk-high { color: #ff6b6b; }
.risk-moderate { color: #fdcb6e; }
.risk-low { color: #00d4aa; }
.revenue-stream {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.revenue-stream .percent {
    color: #00d4aa;
    font-weight: 600;
}
.trend-growing { color: #00d4aa; }
.trend-stable { color: #888; }
.trend-declining { color: #ff6b6b; }
/* DCF Valuation Section */
.dcf-section {
    max-width: 1400px;
    margin: 0 auto 40px;
}
.dcf-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}
.dcf-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 24px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: transform 0.3s ease;
}
.dcf-card:hover {
    transform: translateY(-3px);
}
.dcf-card.highlight {
    background: rgba(0, 212, 170, 0.1);
    border-color: rgba(0, 212, 170, 0.3);
}
.dcf-label {
    font-size: 0.85rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}
.dcf-value {
    font-size: 2.2rem;
    font-weight: bold;
    color: #00d4aa;
}
.dcf-card:not(.highlight) .dcf-value {
    color: #fff;
}
.dcf-change {
    font-size: 1rem;
    margin-top: 8px;
    font-weight: 600;
}
.dcf-change.positive { color: #00d4aa; }
.dcf-change.negative { color: #ff6b6b; }
.dcf-sublabel {
    font-size: 0.8rem;
    color: #666;
    margin-top: 8px;
}
.dcf-warning {
    background: rgba(253, 203, 110, 0.15);
    border: 1px solid rgba(253, 203, 110, 0.4);
    border-radius: 8px;
    padding: 12px 16px;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 10px;
    color: #fdcb6e;
}
.warning-icon {
    font-size: 1.2rem;
}
.dcf-inputs {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.dcf-inputs h4 {
    color: #e0e0e0;
    margin-bottom: 15px;
    font-size: 1rem;
}
.dcf-inputs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}
.dcf-input-card {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    padding: 12px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.05);
}
.dcf-input-label {
    font-size: 0.75rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
}
.dcf-input-value {
    font-size: 1.3rem;
    font-weight: 600;
    color: #00d4aa;
}
.dcf-input-note {
    font-size: 0.7rem;
    color: #666;
    margin-top: 4px;
}
.fcf-projections h5 {
    color: #b0b0b0;
    font-size: 0.9rem;
    margin-bottom: 10px;
}
.fcf-projection-table {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 8px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 12px;
}
.fcf-projection-item {
    text-align: center;
}
.fcf-projection-item.header {
    font-size: 0.75rem;
    color: #888;
    font-weight: 600;
}
.fcf-projection-item .year {
    font-size: 0.75rem;
    color: #888;
    margin-bottom: 2px;
}
.fcf-projection-item .fcf-val {
    font-size: 1rem;
    color: #e0e0e0;
    font-weight: 500;
}
.fcf-projection-item .growth-rate {
    font-size: 0.75rem;
    color: #00d4aa;
    margin-top: 2px;
}
.dcf-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
    padding: 25px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.slider-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.slider-group label {
    font-size: 0.95rem;
    color: #e0e0e0;
    display: flex;
    justify-content: space-between;
}
.slider-group label span {
    color: #00d4aa;
    font-weight: 600;
}
.slider-group input[type="range"] {
    -webkit-appearance: none;
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: rgba(255, 255, 255, 0.1);
    outline: none;
}
.slider-group input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #00d4aa;
    cursor: pointer;
    transition: transform 0.2s;
}
.slider-group input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
}
.slider-hint {
    font-size: 0.8rem;
    color: #666;
}
.scenario-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}
.scenario-tab {
    padding: 10px 24px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    background: transparent;
    color: #888;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.95rem;
    transition: all 0.2s;
}
.scenario-tab:hover {
    border-color: rgba(0, 212, 170, 0.5);
    color: #e0e0e0;
}
.scenario-tab.active {
    background: rgba(0, 212, 170, 0.15);
    border-color: #00d4aa;
    color: #00d4aa;
}
.scenario-details {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 30px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.scenario-details h4 {
    color: #00d4aa;
    margin-bottom: 15px;
}
.assumption-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
}
.assumption-item {
    text-align: center;
}
.assumption-item .label {
    font-size: 0.8rem;
    color: #888;
    margin-bottom: 4px;
}
.assumption-item .value {
    font-size: 1.1rem;
    color: #e0e0e0;
    font-weight: 500;
}
.sensitivity-section {
    margin-bottom: 30px;
}
.sensitivity-section h4 {
    color: #e0e0e0;
    margin-bottom: 15px;
}
.sensitivity-table {
    width: 100%;
    border-collapse: collapse;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    overflow: hidden;
}
.sensitivity-table th,
.sensitivity-table td {
    padding: 12px 16px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.sensitivity-table th {
    background: rgba(0, 212, 170, 0.1);
    color: #00d4aa;
    font-weight: 600;
}
.sensitivity-table td {
    color: #e0e0e0;
}
.sensitivity-table td.highlight {
    background: rgba(0, 212, 170, 0.15);
    color: #00d4aa;
    font-weight: 600;
}
.sensitivity-table td.below-current {
    color: #ff6b6b;
}
.sensitivity-table td.above-current {
    color: #00d4aa;
}
.historical-growth {
    margin-bottom: 30px;
}
.historical-growth h4 {
    color: #e0e0e0;
    margin-bottom: 15px;
}
.growth-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
}
.growth-item {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.growth-item .metric {
    font-size: 0.8rem;
    color: #888;
    margin-bottom: 6px;
}
.growth-item .rate {
    font-size: 1.2rem;
    font-weight: 600;
}
.growth-item .rate.positive { color: #00d4aa; }
.growth-item .rate.negative { color: #ff6b6b; }
.growth-item.selected {
    border-color: #00d4aa;
    background: rgba(0, 212, 170, 0.1);
}
.dcf-download {
    text-align: center;
    margin-top: 30px;
}
.download-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 14px 28px;
    background: rgba(0, 212, 170, 0.15);
    border: 1px solid #00d4aa;
    border-radius: 8px;
    color: #00d4aa;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.2s;
}
.download-btn:hover {
    background: #00d4aa;
    color: #1a1a2e;
}
.download-icon {
    font-size: 1.2rem;
}
@media (max-width: 768px) {
    .charts-container { grid-template-columns: 1fr; }
    .overview-grid { grid-template-columns: 1fr; }
    .header h1 { font-size: 1.8rem; }
    .kpi-grid { grid-template-columns: repeat(2, 1fr); }
}
    </style>
</head>
<body>
    <div class="header">
        <h1>Alphabet Inc. (GOOGL)</h1>
        <p>Financial Dashboard | Last Updated: January 23, 2026</p>
    </div>

    <!-- Investment Overview Section -->
    <div class="overview-section">
        <button class="overview-toggle" onclick="toggleOverview()">
            <span>Investment Overview & Analysis</span>
            <span class="arrow">&#9660;</span>
        </button>
        <div class="overview-content" id="overviewContent">
            <div class="overview-grid">
                <div class="overview-card">
                    <h3>Company Overview</h3>
                    <p id="overviewText"></p>
                </div>
                <div class="overview-card">
                    <h3>Business Model</h3>
                    <p id="businessModelText"></p>
                    <ul id="revenueStreamsList"></ul>
                </div>
                <div class="overview-card">
                    <h3>Competitive Position</h3>
                    <p><strong>Competitors:</strong> <span id="competitorsList"></span></p>
                    <p><strong>Market Position:</strong> <span id="marketPosition"></span></p>
                    <p><strong>Moat Factors:</strong></p>
                    <ul id="moatList"></ul>
                </div>
                <div class="overview-card">
                    <h3>Growth Drivers</h3>
                    <ul id="growthDriversList"></ul>
                </div>
                <div class="overview-card risks">
                    <h3>Key Risks</h3>
                    <ul id="risksList"></ul>
                </div>
                <div class="overview-card bull">
                    <h3>Bull Case</h3>
                    <ul id="bullCaseList"></ul>
                </div>
                <div class="overview-card bear">
                    <h3>Bear Case</h3>
                    <ul id="bearCaseList"></ul>
                </div>
                <div class="overview-card">
                    <h3>Recent Developments</h3>
                    <ul id="recentDevList"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid" id="kpiGrid"></div>

    <!-- Management Guidance -->
    <div class="guidance-section" id="guidanceSection">
        <div class="guidance-header">
            <h3>Management Guidance</h3>
            <span class="guidance-meta">As of <span id="guidanceAsOf"></span> | <span id="guidanceFY"></span></span>
        </div>
        <div class="guidance-grid" id="guidanceGrid"></div>
        <div class="guidance-commentary" id="guidanceCommentary"></div>
    </div>

    <!-- Revenue Charts -->
    <h2 class="section-title">Revenue & Profitability</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Revenue Growth (Annual)</h3>
                <button class="help-btn" onclick="openModal('revenue')">?</button>
            </div>
            <div class="chart-wrapper"><canvas id="revenueChart"></canvas></div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Quarterly Revenue Trend</h3>
                <button class="help-btn" onclick="openModal('quarterlyRevenue')">?</button>
            </div>
            <div class="chart-wrapper"><canvas id="quarterlyRevenueChart"></canvas></div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Profitability Margins</h3>
                <button class="help-btn" onclick="openModal('margins')">?</button>
            </div>
            <div class="chart-wrapper"><canvas id="marginsChart"></canvas></div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Net Income & EPS</h3>
                <button class="help-btn" onclick="openModal('earnings')">?</button>
            </div>
            <div class="chart-wrapper"><canvas id="earningsChart"></canvas></div>
        </div>
    </div>

    <!-- Segment Revenue -->
    <h2 class="section-title">Revenue Segments</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Revenue by Segment (Annual)</h3>
                <button class="help-btn" onclick="openModal('segments')">?</button>
            </div>
            <div class="chart-wrapper"><canvas id="segmentChart"></canvas></div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Google Cloud Growth</h3>
                <button class="help-btn" onclick="openModal('cloud')">?</button>
            </div>
            <div class="chart-wrapper"><canvas id="cloudChart"></canvas></div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>YouTube Ads Revenue</h3>
                <button class="help-btn" onclick="openModal('youtube')">?</button>
            </div>
            <div class="chart-wrapper"><canvas id="youtubeChart"></canvas></div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Revenue Mix Evolution</h3>
                <button class="help-btn" onclick="openModal('mix')">?</button>
            </div>
            <div class="chart-wrapper"><canvas id="mixChart"></canvas></div>
        </div>
    </div>

    <!-- Cash Flow & Balance Sheet -->
    <h2 class="section-title">Cash Flow & Balance Sheet</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Free Cash Flow</h3>
                <button class="help-btn" onclick="openModal('fcf')">?</button>
            </div>
            <div class="chart-wrapper"><canvas id="fcfChart"></canvas></div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Cash & Debt Position</h3>
                <button class="help-btn" onclick="openModal('cashDebt')">?</button>
            </div>
            <div class="chart-wrapper"><canvas id="cashDebtChart"></canvas></div>
        </div>
    </div>

    <!-- DCF Valuation Section -->
    <h2 class="section-title">DCF Valuation</h2>
    <div class="dcf-section">
        <div class="dcf-summary">
            <div class="dcf-card highlight">
                <div class="dcf-label">Intrinsic Value</div>
                <div class="dcf-value" id="dcfIV">$365</div>
                <div class="dcf-change positive" id="dcfUpside">+83% upside</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Entry Price (15% CAGR)</div>
                <div class="dcf-value" id="dcfEntry">$206</div>
                <div class="dcf-sublabel">Buy below for 15% annual return</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Current Price</div>
                <div class="dcf-value" id="dcfCurrent">$200</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Prob-Weighted IV</div>
                <div class="dcf-value" id="dcfWeighted">$375</div>
                <div class="dcf-sublabel">25% Bull / 50% Base / 25% Bear</div>
            </div>
        </div>

        <div class="dcf-warning" id="growthWarning" style="display: none;">
            <span class="warning-icon">&#9888;</span>
            <span id="warningText"></span>
        </div>

        <div class="dcf-inputs">
            <h4>DCF Model Inputs</h4>
            <div class="dcf-inputs-grid">
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Base Year FCF</div>
                    <div class="dcf-input-value" id="baseFCF">$106.7B</div>
                    <div class="dcf-input-note">FY2025E</div>
                </div>
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Shares Outstanding</div>
                    <div class="dcf-input-value" id="sharesOut">6.68B</div>
                </div>
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Net Debt</div>
                    <div class="dcf-input-value" id="netDebt" style="color: #00d4aa;">-$128.8B</div>
                    <div class="dcf-input-note">Net cash position</div>
                </div>
            </div>
            <div class="fcf-projections">
                <h5>Projected FCF (5-Year)</h5>
                <div class="fcf-projection-table" id="fcfProjectionTable"></div>
            </div>
        </div>

        <div class="dcf-controls">
            <div class="slider-group">
                <label>Growth Rate: <span id="growthValue">18%</span></label>
                <input type="range" id="growthSlider" min="0" max="30" value="18" step="1">
                <div class="slider-hint" id="growthHint">Based on FCF 5Y CAGR</div>
            </div>
            <div class="slider-group">
                <label>WACC: <span id="waccValue">9.5%</span></label>
                <input type="range" id="waccSlider" min="6" max="15" value="9.5" step="0.5">
            </div>
            <div class="slider-group">
                <label>Terminal Growth: <span id="terminalValue">2.5%</span></label>
                <input type="range" id="terminalSlider" min="0" max="5" value="2.5" step="0.5">
            </div>
        </div>

        <div class="scenario-tabs">
            <button class="scenario-tab active" data-scenario="base" onclick="switchScenario('base')">Base Case</button>
            <button class="scenario-tab" data-scenario="bull" onclick="switchScenario('bull')">Bull Case</button>
            <button class="scenario-tab" data-scenario="bear" onclick="switchScenario('bear')">Bear Case</button>
        </div>

        <div class="scenario-details" id="scenarioDetails">
            <h4>Assumptions</h4>
            <div class="assumption-grid" id="assumptionGrid"></div>
        </div>

        <div class="sensitivity-section">
            <h4>Sensitivity Analysis: Intrinsic Value by WACC & Terminal Growth</h4>
            <table class="sensitivity-table" id="sensitivityMatrix"></table>
        </div>

        <div class="historical-growth">
            <h4>Historical Growth Rates (CAGR)</h4>
            <div class="growth-grid" id="growthGrid"></div>
        </div>

        <div class="dcf-download">
            <a href="GOOGL_DCF_Model.xlsx" class="download-btn" download>
                <span class="download-icon">&#8681;</span> Download Excel Model
            </a>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modalTitle">Metric</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

<script>
// EMBEDDED DATA
const csvData = `Period,Revenue,GrossProfit,GrossMargin,OperatingIncome,OperatingMargin,NetIncome,NetMargin,EPS,FreeCashFlow,ShareholdersEquity,TotalDebt,CashAndEquivalents,SharesOutstanding,GoogleSearchRevenue,YouTubeAdsRevenue,GoogleCloudRevenue,GoogleNetworkRevenue,OtherBetsRevenue,TrafficAcquisitionCosts,NumberOfEmployees
Q1 2020,41159,22177,53.9,6988,17.0,6836,16.6,9.87,7874,201442,4554,119686,6925,24502,4038,2777,5224,135,7452,123048
Q2 2020,38297,20593,53.8,6372,16.6,6959,18.2,10.13,9612,203624,4198,121197,6877,21318,3812,3007,5423,148,7188,127498
Q3 2020,46173,24682,53.5,11214,24.3,11247,24.4,16.40,13000,207453,13932,120908,6858,26337,5037,3444,5674,149,7821,132121
Q4 2020,56898,30323,53.3,15652,27.5,15227,26.8,22.30,15901,222544,13932,136694,6868,31887,6885,3831,6735,196,9317,135301
FY2020,182527,97795,53.6,41224,22.6,40269,22.1,58.61,42843,222544,13932,136694,6868,104062,19772,13059,23090,657,32778,135301
Q1 2021,55314,29757,53.8,16437,29.7,17930,32.4,26.29,15003,224925,13932,135860,6834,31879,6005,4047,6524,198,8230,139995
Q2 2021,61880,33682,54.4,19360,31.3,18525,29.9,27.26,15744,233537,14518,135860,6818,35848,7002,4628,6620,192,8617,144056
Q3 2021,65118,35565,54.6,21031,32.3,18936,29.1,27.99,16718,242859,14701,142008,6777,37926,7205,4990,7497,182,8747,150028
Q4 2021,75325,41292,54.8,21885,29.1,20642,27.4,30.69,20000,251635,14817,139649,6723,43298,8633,5541,8059,181,10108,156500
FY2021,257637,140296,54.4,78714,30.5,76033,29.5,112.20,67465,251635,14817,139649,6723,148951,28845,19206,31701,753,35702,156500
Q1 2022,68011,36869,54.2,20094,29.5,16436,24.2,24.62,15361,254455,14701,135863,6678,39618,6869,5821,6426,440,8730,163906
Q2 2022,69685,37746,54.2,19361,27.8,16002,23.0,23.97,16087,255276,14701,124997,6679,40689,7340,6276,6553,193,8814,174014
Q3 2022,69092,37355,54.1,17135,24.8,13910,20.1,20.71,13726,253317,14701,116246,6725,39539,7071,6868,7207,209,8541,186779
Q4 2022,76048,40916,53.8,18988,25.0,13624,17.9,20.22,16200,256144,14701,113753,6728,42604,7963,7315,7594,226,10693,190234
FY2022,282836,152886,54.1,74687,26.4,59972,21.2,89.53,61374,256144,14701,113753,6728,162450,29243,26280,32780,1068,36778,190234
Q1 2023,69787,38011,54.5,17415,25.0,15051,21.6,22.42,16700,262035,14565,114672,6723,40359,6693,7454,7496,288,8881,197159
Q2 2023,74604,40747,54.6,21838,29.3,18368,24.6,27.33,17900,270260,13726,118337,6721,42628,7665,8031,7850,285,9306,181269
Q3 2023,76693,42084,54.9,23054,30.1,19689,25.7,29.32,19500,277081,13296,118084,6715,44026,7952,8411,7548,297,9458,182502
Q4 2023,86310,47387,54.9,23696,27.5,20687,24.0,30.73,20400,283388,13231,110916,6722,48019,9200,9176,8422,657,10695,190711
FY2023,307394,168229,54.7,85994,28.0,73795,24.0,109.80,74500,283388,13231,110916,6722,175032,31510,33088,31316,1527,38340,190711
Q1 2024,80539,43961,54.6,25473,31.6,23662,29.4,35.23,22100,289085,13232,108039,6736,46156,8091,9574,7413,495,9828,191566
Q2 2024,84742,46289,54.6,27429,32.4,23619,27.9,35.17,23700,296403,13219,111693,6720,48509,8663,10347,7443,365,10026,183372
Q3 2024,88268,48267,54.7,28521,32.3,26301,29.8,39.20,24800,304532,13220,93235,6708,49385,8921,11353,7546,388,10485,181269
Q4 2024,96771,53030,54.8,30883,31.9,26471,27.4,39.64,27800,315237,13220,123921,6694,51290,10896,11990,7918,409,11254,191548
FY2024,350320,191547,54.7,112307,32.1,100053,28.6,149.24,98400,315237,13220,123921,6694,199340,37571,43376,31320,1657,41593,191548
Q1 2025,90272,49346,54.7,28991,32.1,26577,29.4,39.58,24600,323412,13213,127844,6688,52262,9378,12347,7695,476,10804,193415
Q2 2025,94949,52022,54.8,30988,32.6,27571,29.0,41.03,26100,331589,13205,132091,6683,53913,9687,12765,7914,497,11137,195234
Q3 2025,98636,54101,54.8,32389,32.8,28054,28.4,41.73,27300,340123,13197,138264,6679,55241,10087,13209,8156,520,11523,197428
Q4 2025E,103600,56776,54.8,33974,32.8,29232,28.2,43.50,28500,348500,13190,142000,6675,57200,10500,13800,8400,540,11900,199000
FY2025E,387457,212245,54.8,126342,32.6,111434,28.8,165.84,106700,348500,13190,142000,6675,218616,39652,52121,32165,2033,45364,199000`;

const analysis = {"ticker":"GOOGL","company_name":"Alphabet Inc.","analysis_date":"2026-01-23","overview":"Alphabet Inc. is a multinational technology conglomerate and the parent company of Google. The company operates through three primary segments: Google Services (Search, YouTube, advertising), Google Cloud (cloud computing and enterprise solutions), and Other Bets (Waymo, Verily, and other moonshot projects). Alphabet dominates global search with ~90% market share and is a leader in digital advertising, generating approximately 70% of revenue from ads across Search, YouTube, and its display network.","business_model":{"summary":"Alphabet's business model is primarily advertising-driven (70%+ of revenue), with growing contributions from cloud computing and subscriptions. Google Search and YouTube remain the core revenue engines, while Google Cloud represents the fastest-growing segment with 34% YoY growth in Q3 2025.","revenue_streams":[{"name":"Google Search & Other","percent":50,"trend":"stable","description":"Core search advertising, generating over $50B quarterly"},{"name":"YouTube Ads","percent":10,"trend":"growing","description":"Video advertising revenue reached $10.3B in Q3 2025, up 15% YoY"},{"name":"Google Cloud","percent":13,"trend":"rapidly growing","description":"Cloud infrastructure and platform services, $15.2B in Q3 2025, growing 34% YoY"},{"name":"Google Network","percent":10,"trend":"declining","description":"AdSense, AdMob, and ad network partner revenue"},{"name":"Subscriptions, Platforms & Devices","percent":13,"trend":"growing","description":"Google One, YouTube Premium (125M subscribers), Pixel devices, Google Play"},{"name":"Other Bets","percent":0.3,"trend":"stable","description":"Waymo, Verily, and other experimental ventures - $344M revenue, $1.4B operating loss in Q3 2025"}]},"competitive_position":{"main_competitors":["Microsoft (Bing, Azure, OpenAI partnership)","Amazon (AWS, advertising)","Meta (social media advertising)","TikTok (video content, emerging search behavior)","OpenAI (ChatGPT Search)","Perplexity (AI search)"],"market_position":"Dominant leader in search (~90% share) and second in digital advertising after Meta. Third-largest cloud provider (13% share) behind AWS and Azure. YouTube is the world's largest video platform.","moat_factors":[{"factor":"Network effects","strength":"strong","description":"Billions of daily queries improve search algorithms; advertiser-user network effects create powerful two-sided marketplace"},{"factor":"Data advantage","strength":"strong","description":"Decades of search data and user behavior create unparalleled training datasets for AI and relevance"},{"factor":"Brand strength","strength":"strong","description":"'Google' as verb; trusted brand for search, maps, email with 2B+ active users across services"},{"factor":"Ecosystem lock-in","strength":"moderate to strong","description":"Android OS, Chrome browser, Google Workspace create switching costs; 300M+ paid subscriptions"},{"factor":"Vertical integration","strength":"strong","description":"Custom TPU chips for AI infrastructure provide cost advantages vs. NVIDIA GPU reliance; full-stack cloud offering"},{"factor":"Scale advantages","strength":"strong","description":"Massive data center infrastructure, content delivery network, and global reach enable superior economics"}]},"growth_drivers":["AI integration across all products: Gemini 3 rollout to Search (AI Overviews reaching 1.5B users/month), YouTube, Cloud, and Workspace","Google Cloud Platform acceleration: 34% YoY growth driven by AI infrastructure, Generative AI Solutions, and enterprise adoption; backlog reached $155B (up 82% YoY)","YouTube monetization expansion: Shorts monetization improving (now earning more per watch hour than long-form in US), YouTube Premium (125M subscribers), YouTube TV growth","Waymo scaling: Expanding to 26 markets including international launch in London 2026; 450K weekly paid rides by Dec 2025; targeting $100-110B valuation","Search AI innovation: AI Overviews and AI Mode driving higher engagement while maintaining 90%+ market share; monetization of AI features roughly in line with traditional results","Subscription services growth: 300M+ paid subscriptions across Google One, YouTube Premium, and other services","Apple partnership: Multi-year $1B/year deal to integrate Gemini 3 into Apple Intelligence and power Siri (Spring 2026 rollout)","Hardware expansion: AI-powered smart glasses launching in 2026 (partners: Samsung, Warby Parker, Gentle Monster)"],"risks":{"business":[{"risk":"AI-driven search disruption","severity":"high","description":"ChatGPT Search and other AI-native search experiences growing rapidly; Gartner predicts 25% drop in traditional search volume by 2026; Microsoft/OpenAI partnership gaining traction with Bing reaching 17-18% market share"},{"risk":"Advertising market concentration","severity":"high","description":"70%+ revenue from advertising creates cyclical exposure and vulnerability to macro slowdowns, shifts in ad spending to TikTok, Amazon"},{"risk":"TikTok competitive threat","severity":"moderate","description":"Gen Z increasingly using TikTok for search; TikTok's $37B creator economy and $34.8B projected 2026 ad revenue eating into YouTube's dominance"},{"risk":"Cloud profitability pressure","severity":"moderate","description":"Tight demand-supply environment but intense competition with AWS and Azure; Amazon gaining parity in targeting capabilities"},{"risk":"Capital intensity","severity":"moderate","description":"CapEx expected $91-93B in 2025, even higher in 2026 for AI infrastructure; depreciation acceleration threatens margins"}],"regulatory":[{"risk":"Antitrust remedies from 2024 ruling","severity":"high","description":"September 2025 court order bans exclusive default search contracts; must share search data with competitors; ongoing appeals could last until 2027-2028; remedies overseen for 6 years"},{"risk":"Ad tech divestiture risk","severity":"high","description":"Separate DOJ case on advertising business found guilty; potential forced divestiture of Google Ad Manager or AdX exchange expected late 2026 - would be most significant corporate restructuring in company history"},{"risk":"EU Digital Markets Act","severity":"moderate","description":"GDPR compliance costs; advanced consent controls reducing addressable advertising audience; CNIL fine for dark patterns"},{"risk":"Privacy regulations impact","severity":"moderate","description":"Cookie depreciation, consent requirements, and stricter data regulations globally reduce targeting effectiveness and ad revenue potential"},{"risk":"App store fee pressure","severity":"moderate","description":"Android and Play Store fee structures under scrutiny similar to Apple; potential margin impact on subscriptions/platforms segment"}]},"bull_case":["AI integration strengthening moat: Gemini 3 proving competitive with OpenAI while integrated across entire ecosystem (Search, YouTube, Cloud, Workspace); AI Overviews maintaining monetization at traditional levels while improving engagement","Google Cloud inflection point: 34% growth with $155B backlog (+82% YoY) and improving margins; positioned to reach $20B in profits by 2026; vertical integration via TPUs creates cost advantage","Search dominance intact: Despite AI disruption fears, Google maintains 90%+ market share; antitrust remedy avoided Chrome divestiture; AI features enhancing rather than cannibalizing search","Multiple revenue streams maturing: YouTube Premium (125M subscribers), Google One, Waymo scaling (26 markets, $100B+ valuation potential), hardware ecosystem all reducing advertising concentration risk","Valuation attractive: Trading <30x forward P/E makes it second-cheapest 'Magnificent Seven' stock despite 10-12% steady growth and 33%+ margins; analyst consensus $320-343 target implies 15-20% upside","Capital return program: Massive free cash flow generation supports continued buybacks; $102B+ quarterly revenue run rate with strong operating leverage","Strategic partnerships: Apple deal ($1B/year) validates Gemini competitive position and expands reach to iOS ecosystem; smart glasses partnerships (Samsung, Warby Parker) open new hardware markets"],"bear_case":["Existential AI search threat: ChatGPT Search sessions average 13 minutes vs. Google's 6 minutes; Gartner predicting 25% drop in traditional search by 2026; Microsoft-OpenAI partnership gaining meaningful share (17-18%)","Massive antitrust overhang: Must share proprietary search data with competitors; separate ad tech case could force divestiture of Ad Manager/AdX in late 2026 (most significant restructuring ever); 6+ years of regulatory oversight","CapEx spiral without clear ROI: $91-93B in 2025, >$110B expected in 2026 with margin compression risk; unclear when AI investments yield proportional returns; depreciation accelerating","Advertising model under siege: 70%+ revenue from ads faces multiple threats - TikTok capturing Gen Z ($37B creator economy), Amazon gaining parity in ad tech, privacy regulations reducing targeting, potential recession cutting budgets","Cloud remains distant #3: 13% market share far behind AWS (30%) and Azure (20%); Microsoft's OpenAI partnership more credible for enterprise AI; GCP late to enterprise adoption","Regulatory death by thousand cuts: GDPR fines, DMA compliance costs, Play Store fee pressure, data localization requirements all eroding margins incrementally","Waymo cash burn continues: $1.4B operating loss in Q3 2025 in Other Bets; CEO admits won't be financially meaningful until 2027-2028; raising capital at $100B+ valuation may disappoint vs. hype","Cultural/execution challenges: Large organization struggling to move with AI startup speed; Gemini playing catch-up to OpenAI despite technical resources; potential talent loss to startups"],"recent_developments":[{"date":"2026-01","event":"Gemini 3 Flash rolled out globally; Apple partnership confirmed ($1B/year) to integrate Gemini into Siri for Spring 2026","impact":"positive"},{"date":"2025-12","event":"Waymo targeting $100-110B valuation in funding round, seeking $15B; operating in 26 markets with 450K weekly rides","impact":"positive"},{"date":"2025-12","event":"Judge finalized antitrust remedy details requiring 6-year oversight period; appeals expected through 2027-2028","impact":"negative"},{"date":"2025-11","event":"Gemini 3 released in sweeping rollout integrated into Search on day one; AI Overviews now at 2B users/month","impact":"positive"},{"date":"2025-11","event":"Q3 2025 earnings: First-ever $100B+ quarter ($102.3B revenue, +16% YoY); Google Cloud +34% to $15.2B; YouTube ads +15% to $10.3B","impact":"positive"},{"date":"2025-09","event":"Federal court issued final antitrust remedies banning exclusive search deals but rejected Chrome divestiture","impact":"mixed"},{"date":"2025-04-05","event":"Antitrust remedies hearing began; separate ad tech case verdict also found Google guilty, awaiting remedy","impact":"negative"},{"date":"2025-02","event":"Announced CapEx plan of $75B for 2025 for AI infrastructure with further increases expected in 2026","impact":"mixed"}],"guidance":{"as_of":"Q3 2025 Earnings (November 2025)","fiscal_year":"2025-2026","items":[{"metric":"Total Revenue","target":"$455B","period":"FY2026","vs_prior":"raised","notes":"Implies 14% growth; analyst consensus based on momentum"},{"metric":"Q3 2025 Revenue","target":"$102.3B","period":"Q3 2025 actual","vs_prior":"exceeded","notes":"First-ever $100B+ quarter, up 16% YoY"},{"metric":"Google Cloud Revenue Growth","target":"Accelerating (34% in Q3)","period":"Ongoing","vs_prior":"raised","notes":"Demand remains high; backlog $155B (+82% YoY); tight supply-demand expected through Q4 and 2026"},{"metric":"Capital Expenditures","target":"$91-93B","period":"FY2025","vs_prior":"raised from $75B","notes":"Focus on AI infrastructure (data centers, TPUs); significant increase expected in 2026"},{"metric":"Operating Margin","target":"33%+","period":"Ongoing","vs_prior":"maintained","notes":"GAAP margins north of 33% with steady 10-12% annual growth"},{"metric":"Waymo Financial Impact","target":"Meaningful contribution","period":"2027-2028","vs_prior":"new guidance","notes":"CEO stated Waymo will be meaningful in financials by 2027-2028 timeframe"}],"management_commentary":"CEO Sundar Pichai emphasized momentum in AI integration across all products with 2B users on AI Overviews and 650M on Gemini app. CFO Anat Ashkenazi noted strong Cloud demand creating tight supply-demand environment through 2026, with continued focus on AI infrastructure investment. Management confident in maintaining search leadership while monetizing AI features. Highlighted 300M+ paid subscriptions milestone."}};

const dcfData = {"ticker":"GOOGL","valuation_date":"2026-01-23","current_price":328.0,"inputs":{"shares_outstanding":6675.0,"net_debt":-128810.0,"last_fcf":106700.0,"currency":"USD","units":"millions","base_year":"FY2025E"},"historical_growth":{"revenue_3yr_cagr":11.05,"revenue_5yr_cagr":16.24,"eps_3yr_cagr":22.82,"eps_5yr_cagr":23.14,"equity_3yr_cagr":10.82,"equity_5yr_cagr":9.38,"fcf_3yr_cagr":12.71,"fcf_5yr_cagr":20.02,"selected_growth_rate":20.02,"growth_rate_source":"fcf_5yr_cagr","growth_divergence_warning":null},"assumptions":{"base":{"growth_rates":[16,14,12,10,8],"wacc":9.5,"terminal_growth":2.5,"fcf_margin":27.5},"bull":{"growth_rates":[22,20,18,15,12],"wacc":9.0,"terminal_growth":3.0,"fcf_margin":30},"bear":{"growth_rates":[10,8,6,5,4],"wacc":10.5,"terminal_growth":2.0,"fcf_margin":24}},"projections":{"base":{"years":["Y1","Y2","Y3","Y4","Y5"],"fcf":[123772.0,141100.0,158032.0,173835.0,187742.0],"discount_factors":[0.9132,0.834,0.7617,0.6956,0.6352],"pv_fcf":[113032.0,117677.0,120374.0,120919.0,119286.0]},"bull":{"years":["Y1","Y2","Y3","Y4","Y5"],"fcf":[130174.0,156209.0,184327.0,211976.0,237413.0],"discount_factors":[0.9174,0.8417,0.7722,0.7084,0.6499],"pv_fcf":[119422.0,131462.0,142325.0,150161.0,154304.0]},"bear":{"years":["Y1","Y2","Y3","Y4","Y5"],"fcf":[117370.0,126760.0,134365.0,141083.0,146727.0],"discount_factors":[0.905,0.819,0.7412,0.6707,0.607],"pv_fcf":[106220.0,103816.0,99583.0,94612.0,89063.0]}},"valuation":{"base":{"sum_pv_fcf":591288.0,"terminal_value":2748716.0,"pv_terminal":1746067.0,"enterprise_value":2337355.0,"equity_value":2466165.0,"intrinsic_value":369.38,"upside":84.7},"bull":{"sum_pv_fcf":697674.0,"terminal_value":4075555.0,"pv_terminal":2648862.0,"enterprise_value":3346536.0,"equity_value":3475346.0,"intrinsic_value":520.57,"upside":160.3},"bear":{"sum_pv_fcf":493294.0,"terminal_value":1761057.0,"pv_terminal":1068959.0,"enterprise_value":1562253.0,"equity_value":1691063.0,"intrinsic_value":253.34,"upside":26.7}},"entry_price":{"base":{"terminal_value_per_share":411.79,"years_to_terminal":5,"entry_price":204.73,"entry_discount_from_current":2.4}},"sensitivity":{"wacc_range":[8,9,10,11,12],"terminal_growth_range":[2,2.5,3,3.5,4],"matrix":[[440.52,472.89,511.75,559.24,618.53],[377.65,399.99,426.14,457.11,494.28],[330.18,346.50,365.18,386.74,411.91],[293.30,305.61,319.50,335.24,353.20],[264.00,273.56,284.19,296.08,309.44]]},"probability_weighted":{"weights":{"bull":0.25,"base":0.5,"bear":0.25},"weighted_iv":378.17}};

// Parse CSV
function parseCSV(csv) {
    const lines = csv.trim().split('\n');
    const headers = lines[0].split(',');
    return lines.slice(1).map(line => {
        const values = line.split(',');
        const obj = {};
        headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
        return obj;
    });
}

const data = parseCSV(csvData);

// Sort chronologically
data.sort((a, b) => {
    const parseDate = (p) => {
        const year = parseInt(p.match(/\d{4}/)?.[0] || '0');
        const isQ1 = p.includes('Q1');
        const isQ2 = p.includes('Q2');
        const isQ3 = p.includes('Q3');
        const isQ4 = p.includes('Q4');
        const isFY = p.startsWith('FY');
        const subOrder = isQ1 ? 1 : isQ2 ? 2 : isQ3 ? 3 : isQ4 ? 4 : isFY ? 5 : 0;
        return year * 10 + subOrder;
    };
    return parseDate(a.Period) - parseDate(b.Period);
});

const fyData = data.filter(d => d.Period.startsWith('FY'));
const qData = data.filter(d => d.Period.startsWith('Q'));

// Utility functions
function formatNum(n, decimals = 1) {
    const num = parseFloat(n);
    if (isNaN(num)) return 'N/A';
    if (Math.abs(num) >= 1000) return '$' + (num/1000).toFixed(decimals) + 'B';
    return '$' + num.toFixed(decimals) + 'M';
}

function calcYoY(current, previous) {
    if (!previous || !current) return null;
    return ((parseFloat(current) - parseFloat(previous)) / Math.abs(parseFloat(previous)) * 100).toFixed(1);
}

// Toggle overview
function toggleOverview() {
    const btn = document.querySelector('.overview-toggle');
    const content = document.getElementById('overviewContent');
    btn.classList.toggle('active');
    content.classList.toggle('active');
}

// Render Investment Overview
function renderOverview() {
    document.getElementById('overviewText').textContent = analysis.overview;
    document.getElementById('businessModelText').textContent = analysis.business_model.summary;

    const streamsList = document.getElementById('revenueStreamsList');
    streamsList.innerHTML = analysis.business_model.revenue_streams.map(s => {
        const trendClass = s.trend.includes('growing') ? 'trend-growing' : s.trend === 'declining' ? 'trend-declining' : 'trend-stable';
        return `<li class="revenue-stream"><span>${s.name}</span><span class="percent ${trendClass}">${s.percent}%</span></li>`;
    }).join('');

    document.getElementById('competitorsList').textContent = analysis.competitive_position.main_competitors.join(', ');
    document.getElementById('marketPosition').textContent = analysis.competitive_position.market_position;

    const moatList = document.getElementById('moatList');
    moatList.innerHTML = analysis.competitive_position.moat_factors.map(m =>
        `<li><strong>${m.factor}</strong> (${m.strength}): ${m.description}</li>`
    ).join('');

    const growthList = document.getElementById('growthDriversList');
    growthList.innerHTML = analysis.growth_drivers.slice(0, 5).map(g => `<li>${g}</li>`).join('');

    const risksList = document.getElementById('risksList');
    const allRisks = [...(analysis.risks.business || []), ...(analysis.risks.regulatory || [])].slice(0, 6);
    risksList.innerHTML = allRisks.map(r => {
        const sevClass = r.severity === 'high' ? 'risk-high' : r.severity === 'moderate' ? 'risk-moderate' : 'risk-low';
        return `<li><span class="${sevClass}">[${r.severity.toUpperCase()}]</span> ${r.risk}: ${r.description}</li>`;
    }).join('');

    document.getElementById('bullCaseList').innerHTML = analysis.bull_case.slice(0, 4).map(b => `<li>${b}</li>`).join('');
    document.getElementById('bearCaseList').innerHTML = analysis.bear_case.slice(0, 4).map(b => `<li>${b}</li>`).join('');

    const devList = document.getElementById('recentDevList');
    devList.innerHTML = analysis.recent_developments.slice(0, 5).map(d => {
        const impactClass = d.impact === 'positive' ? 'trend-growing' : d.impact === 'negative' ? 'trend-declining' : 'trend-stable';
        return `<li><span class="${impactClass}">[${d.date}]</span> ${d.event}</li>`;
    }).join('');
}

// Render KPI cards
function renderKPIs() {
    const latest = qData[qData.length - 1];
    const prevYear = qData.find(d => d.Period === latest.Period.replace(/\d{4}/, (y) => parseInt(y) - 1));
    const latestFY = fyData[fyData.length - 1];
    const prevFY = fyData[fyData.length - 2];

    const kpis = [
        { label: 'Q3 2025 Revenue', value: formatNum(latest.Revenue), change: calcYoY(latest.Revenue, prevYear?.Revenue) },
        { label: 'FY2024 Revenue', value: formatNum(latestFY.Revenue), change: calcYoY(latestFY.Revenue, prevFY?.Revenue) },
        { label: 'Gross Margin', value: latest.GrossMargin + '%', change: null },
        { label: 'Operating Margin', value: latest.OperatingMargin + '%', change: calcYoY(latest.OperatingMargin, prevYear?.OperatingMargin) },
        { label: 'EPS (TTM)', value: '$' + (parseFloat(latestFY.EPS)).toFixed(2), change: calcYoY(latestFY.EPS, prevFY?.EPS) },
        { label: 'Free Cash Flow', value: formatNum(latestFY.FreeCashFlow), change: calcYoY(latestFY.FreeCashFlow, prevFY?.FreeCashFlow) },
        { label: 'Google Cloud Rev', value: formatNum(latest.GoogleCloudRevenue), change: calcYoY(latest.GoogleCloudRevenue, prevYear?.GoogleCloudRevenue) },
        { label: 'Cash Position', value: formatNum(latest.CashAndEquivalents), change: null }
    ];

    const grid = document.getElementById('kpiGrid');
    grid.innerHTML = kpis.map(k => {
        const changeClass = k.change ? (parseFloat(k.change) >= 0 ? 'positive' : 'negative') : '';
        const changeText = k.change ? `${parseFloat(k.change) >= 0 ? '+' : ''}${k.change}% YoY` : '';
        return `<div class="kpi-card">
            <div class="kpi-value">${k.value}</div>
            <div class="kpi-label">${k.label}</div>
            ${changeText ? `<div class="kpi-change ${changeClass}">${changeText}</div>` : ''}
        </div>`;
    }).join('');
}

// Render Guidance
function renderGuidance() {
    if (!analysis.guidance) return;
    const g = analysis.guidance;
    document.getElementById('guidanceAsOf').textContent = g.as_of;
    document.getElementById('guidanceFY').textContent = g.fiscal_year;

    const grid = document.getElementById('guidanceGrid');
    grid.innerHTML = g.items.map(item => {
        const vsClass = item.vs_prior ? item.vs_prior.toLowerCase().replace(' ', '') : 'new';
        return `<div class="guidance-card">
            <div class="guidance-metric">${item.metric}</div>
            <div class="guidance-target">${item.target}</div>
            <div class="guidance-period">${item.period}</div>
            <span class="guidance-vs-prior ${vsClass}">${item.vs_prior || 'New'}</span>
            ${item.notes ? `<div class="guidance-notes">${item.notes}</div>` : ''}
        </div>`;
    }).join('');

    if (g.management_commentary) {
        document.getElementById('guidanceCommentary').textContent = g.management_commentary;
    }
}

// Chart defaults
const chartDefaults = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: { legend: { labels: { color: '#e0e0e0', font: { size: 11 } } } },
    scales: {
        x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
        y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } }
    }
};

const colors = {
    primary: '#00d4aa',
    secondary: '#00b894',
    tertiary: '#0984e3',
    quaternary: '#6c5ce7',
    warning: '#fdcb6e',
    danger: '#ff6b6b'
};

// Render Charts
function renderCharts() {
    // Revenue Chart (Annual)
    new Chart(document.getElementById('revenueChart'), {
        type: 'bar',
        data: {
            labels: fyData.map(d => d.Period),
            datasets: [{
                label: 'Revenue ($B)',
                data: fyData.map(d => parseFloat(d.Revenue)/1000),
                backgroundColor: colors.primary,
                borderRadius: 4
            }]
        },
        options: chartDefaults
    });

    // Quarterly Revenue
    new Chart(document.getElementById('quarterlyRevenueChart'), {
        type: 'line',
        data: {
            labels: qData.map(d => d.Period),
            datasets: [{
                label: 'Revenue ($B)',
                data: qData.map(d => parseFloat(d.Revenue)/1000),
                borderColor: colors.primary,
                backgroundColor: 'rgba(0, 212, 170, 0.1)',
                fill: true,
                tension: 0.3
            }]
        },
        options: chartDefaults
    });

    // Margins Chart
    new Chart(document.getElementById('marginsChart'), {
        type: 'line',
        data: {
            labels: fyData.map(d => d.Period),
            datasets: [
                { label: 'Gross Margin %', data: fyData.map(d => parseFloat(d.GrossMargin)), borderColor: colors.primary, tension: 0.3 },
                { label: 'Operating Margin %', data: fyData.map(d => parseFloat(d.OperatingMargin)), borderColor: colors.tertiary, tension: 0.3 },
                { label: 'Net Margin %', data: fyData.map(d => parseFloat(d.NetMargin)), borderColor: colors.quaternary, tension: 0.3 }
            ]
        },
        options: chartDefaults
    });

    // Earnings Chart
    new Chart(document.getElementById('earningsChart'), {
        type: 'bar',
        data: {
            labels: fyData.map(d => d.Period),
            datasets: [
                { label: 'Net Income ($B)', data: fyData.map(d => parseFloat(d.NetIncome)/1000), backgroundColor: colors.primary, borderRadius: 4, yAxisID: 'y' },
                { label: 'EPS ($)', data: fyData.map(d => parseFloat(d.EPS)), type: 'line', borderColor: colors.warning, yAxisID: 'y1', tension: 0.3 }
            ]
        },
        options: {
            ...chartDefaults,
            scales: {
                ...chartDefaults.scales,
                y: { ...chartDefaults.scales.y, position: 'left' },
                y1: { ...chartDefaults.scales.y, position: 'right', grid: { drawOnChartArea: false } }
            }
        }
    });

    // Segment Revenue
    new Chart(document.getElementById('segmentChart'), {
        type: 'bar',
        data: {
            labels: fyData.map(d => d.Period),
            datasets: [
                { label: 'Search', data: fyData.map(d => parseFloat(d.GoogleSearchRevenue)/1000), backgroundColor: colors.primary },
                { label: 'YouTube', data: fyData.map(d => parseFloat(d.YouTubeAdsRevenue)/1000), backgroundColor: colors.danger },
                { label: 'Cloud', data: fyData.map(d => parseFloat(d.GoogleCloudRevenue)/1000), backgroundColor: colors.tertiary },
                { label: 'Network', data: fyData.map(d => parseFloat(d.GoogleNetworkRevenue)/1000), backgroundColor: colors.quaternary }
            ]
        },
        options: { ...chartDefaults, scales: { ...chartDefaults.scales, x: { ...chartDefaults.scales.x, stacked: true }, y: { ...chartDefaults.scales.y, stacked: true } } }
    });

    // Cloud Growth
    new Chart(document.getElementById('cloudChart'), {
        type: 'bar',
        data: {
            labels: qData.map(d => d.Period),
            datasets: [{
                label: 'Cloud Revenue ($B)',
                data: qData.map(d => parseFloat(d.GoogleCloudRevenue)/1000),
                backgroundColor: colors.tertiary,
                borderRadius: 4
            }]
        },
        options: chartDefaults
    });

    // YouTube Revenue
    new Chart(document.getElementById('youtubeChart'), {
        type: 'line',
        data: {
            labels: qData.map(d => d.Period),
            datasets: [{
                label: 'YouTube Ads ($B)',
                data: qData.map(d => parseFloat(d.YouTubeAdsRevenue)/1000),
                borderColor: colors.danger,
                backgroundColor: 'rgba(255, 107, 107, 0.1)',
                fill: true,
                tension: 0.3
            }]
        },
        options: chartDefaults
    });

    // Revenue Mix
    const latestFY = fyData[fyData.length - 1];
    new Chart(document.getElementById('mixChart'), {
        type: 'doughnut',
        data: {
            labels: ['Search', 'YouTube', 'Cloud', 'Network', 'Other'],
            datasets: [{
                data: [
                    parseFloat(latestFY.GoogleSearchRevenue),
                    parseFloat(latestFY.YouTubeAdsRevenue),
                    parseFloat(latestFY.GoogleCloudRevenue),
                    parseFloat(latestFY.GoogleNetworkRevenue),
                    parseFloat(latestFY.Revenue) - parseFloat(latestFY.GoogleSearchRevenue) - parseFloat(latestFY.YouTubeAdsRevenue) - parseFloat(latestFY.GoogleCloudRevenue) - parseFloat(latestFY.GoogleNetworkRevenue)
                ],
                backgroundColor: [colors.primary, colors.danger, colors.tertiary, colors.quaternary, colors.warning]
            }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: '#e0e0e0' } } } }
    });

    // FCF Chart
    new Chart(document.getElementById('fcfChart'), {
        type: 'bar',
        data: {
            labels: fyData.map(d => d.Period),
            datasets: [{
                label: 'Free Cash Flow ($B)',
                data: fyData.map(d => parseFloat(d.FreeCashFlow)/1000),
                backgroundColor: colors.secondary,
                borderRadius: 4
            }]
        },
        options: chartDefaults
    });

    // Cash & Debt
    new Chart(document.getElementById('cashDebtChart'), {
        type: 'bar',
        data: {
            labels: fyData.map(d => d.Period),
            datasets: [
                { label: 'Cash ($B)', data: fyData.map(d => parseFloat(d.CashAndEquivalents)/1000), backgroundColor: colors.primary },
                { label: 'Debt ($B)', data: fyData.map(d => parseFloat(d.TotalDebt)/1000), backgroundColor: colors.danger }
            ]
        },
        options: chartDefaults
    });
}

// Modal descriptions
const metricDescriptions = {
    revenue: { title: 'Revenue', content: `<p><strong>Revenue</strong> represents Alphabet's total income from all business segments.</p><div class="metric-highlight"><strong>For Alphabet:</strong> Revenue primarily comes from advertising (70%+), with growing contributions from Google Cloud (13%) and subscriptions/hardware (13%).</div><p><strong>What to watch:</strong></p><ul><li>Google Search revenue stability amid AI disruption concerns</li><li>Cloud revenue acceleration (currently 34% YoY)</li><li>YouTube monetization including Shorts</li></ul>` },
    quarterlyRevenue: { title: 'Quarterly Revenue', content: `<p>Quarterly revenue trends show seasonal patterns and growth trajectory.</p><div class="metric-highlight"><strong>Key insight:</strong> Q3 2025 was Alphabet's first $100B+ quarter, demonstrating strong momentum.</div><ul><li>Q4 typically strongest due to holiday advertising</li><li>Watch for YoY growth rates to assess competitive position</li></ul>` },
    margins: { title: 'Profitability Margins', content: `<p><strong>Gross Margin:</strong> Revenue minus cost of revenues (traffic acquisition costs, content costs, data centers).</p><p><strong>Operating Margin:</strong> Includes R&D, sales, and G&A expenses.</p><div class="metric-highlight"><strong>For Alphabet:</strong> Margins have expanded to 32%+ operating margin as Cloud turns profitable and efficiency improves.</div><ul><li>Watch for CapEx impact on depreciation</li><li>Cloud margin improvement is key driver</li></ul>` },
    earnings: { title: 'Net Income & EPS', content: `<p><strong>Net Income</strong> is Alphabet's bottom-line profit after all expenses and taxes.</p><p><strong>EPS</strong> (Earnings Per Share) reflects profitability on a per-share basis.</p><div class="metric-highlight"><strong>Key trend:</strong> FY2024 EPS of $149.24 represents 36% growth, driven by margin expansion and buybacks.</div>` },
    segments: { title: 'Revenue Segments', content: `<p>Alphabet reports revenue across key segments:</p><ul><li><strong>Google Search:</strong> Core search advertising (~50% of revenue)</li><li><strong>YouTube:</strong> Video advertising and subscriptions (~10%)</li><li><strong>Google Cloud:</strong> GCP and Workspace (~13%, fastest growing)</li><li><strong>Google Network:</strong> AdSense, AdMob partner revenue (~10%)</li></ul><div class="metric-highlight">Google Cloud's 34% growth is critical for diversification away from advertising.</div>` },
    cloud: { title: 'Google Cloud Growth', content: `<p><strong>Google Cloud</strong> includes Google Cloud Platform (GCP) infrastructure and Google Workspace productivity tools.</p><div class="metric-highlight"><strong>Current status:</strong> $15.2B in Q3 2025 (+34% YoY), with $155B backlog (+82% YoY).</div><p><strong>What to watch:</strong></p><ul><li>Margin improvement as scale increases</li><li>AI workload wins vs AWS/Azure</li><li>Enterprise adoption momentum</li></ul>` },
    youtube: { title: 'YouTube Ads Revenue', content: `<p><strong>YouTube Ads</strong> captures video advertising revenue across long-form content, Shorts, and connected TV.</p><div class="metric-highlight"><strong>Key trend:</strong> Shorts monetization now earning more per watch hour than long-form in the US.</div><ul><li>YouTube Premium has 125M subscribers</li><li>Competition from TikTok is a key risk</li></ul>` },
    mix: { title: 'Revenue Mix', content: `<p>This chart shows Alphabet's revenue diversification.</p><div class="metric-highlight"><strong>Key insight:</strong> While advertising still dominates, Cloud and subscriptions are reducing concentration risk.</div><ul><li>Search remains stable despite AI fears</li><li>Cloud on path to meaningful profit contribution</li></ul>` },
    fcf: { title: 'Free Cash Flow', content: `<p><strong>Free Cash Flow</strong> is cash from operations minus capital expenditures.</p><div class="metric-highlight"><strong>For Alphabet:</strong> FY2024 FCF of $98.4B despite massive CapEx ($91-93B guidance) demonstrates strong cash generation.</div><p><strong>What to watch:</strong></p><ul><li>CapEx trajectory for AI infrastructure</li><li>FCF margin sustainability</li><li>Capital allocation (buybacks, Waymo investment)</li></ul>` },
    cashDebt: { title: 'Cash & Debt Position', content: `<p>Alphabet maintains a fortress balance sheet with significant net cash.</p><div class="metric-highlight"><strong>Current position:</strong> ~$138B cash vs ~$13B debt = $125B net cash position.</div><p>This provides flexibility for:</p><ul><li>Massive AI infrastructure investment</li><li>Share buybacks</li><li>Strategic acquisitions</li><li>Weathering regulatory challenges</li></ul>` }
};

function openModal(key) {
    document.getElementById('modalTitle').textContent = metricDescriptions[key].title;
    document.getElementById('modalBody').innerHTML = metricDescriptions[key].content;
    document.getElementById('modalOverlay').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeModal(event) {
    if (event && event.target !== document.getElementById('modalOverlay')) return;
    document.getElementById('modalOverlay').classList.remove('active');
    document.body.style.overflow = '';
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

// DCF Functions
let currentScenario = 'base';

function initDCF() {
    document.getElementById('dcfCurrent').textContent = '$' + dcfData.current_price.toFixed(0);

    if (dcfData.historical_growth.growth_divergence_warning) {
        document.getElementById('growthWarning').style.display = 'flex';
        document.getElementById('warningText').textContent = dcfData.historical_growth.growth_divergence_warning;
    }

    renderHistoricalGrowth();
    renderSensitivityMatrix();
    renderFCFProjections();
    switchScenario('base');
}

function renderFCFProjections() {
    const startGrowth = parseFloat(document.getElementById('growthSlider').value);
    const baseFCF = dcfData.inputs.last_fcf;

    // Calculate declining growth rates from start growth toward 10% (market-beating floor)
    // Linear interpolation over 5 years
    const endGrowth = 10; // Quality companies should keep beating the market
    const growthRates = [];
    for (let i = 0; i < 5; i++) {
        // Interpolate: Year 1 = startGrowth, Year 5 = 10% (or startGrowth if already below 10%)
        const rate = startGrowth > endGrowth
            ? startGrowth - (startGrowth - endGrowth) * (i / 4)
            : startGrowth; // If starting below 10%, keep flat
        growthRates.push(rate);
    }

    // Calculate projected FCF using declining growth rates
    const fcfValues = [baseFCF];
    let fcf = baseFCF;
    for (let i = 0; i < 5; i++) {
        fcf = fcf * (1 + growthRates[i] / 100);
        fcfValues.push(fcf);
    }

    let html = `
        <div class="fcf-projection-item header">Base</div>
        <div class="fcf-projection-item header">Year 1</div>
        <div class="fcf-projection-item header">Year 2</div>
        <div class="fcf-projection-item header">Year 3</div>
        <div class="fcf-projection-item header">Year 4</div>
        <div class="fcf-projection-item header">Year 5</div>
    `;

    html += `<div class="fcf-projection-item"><div class="fcf-val">$${(baseFCF/1000).toFixed(1)}B</div><div class="growth-rate">-</div></div>`;

    for (let i = 1; i <= 5; i++) {
        html += `<div class="fcf-projection-item">
            <div class="fcf-val">$${(fcfValues[i]/1000).toFixed(1)}B</div>
            <div class="growth-rate">+${growthRates[i-1].toFixed(0)}%</div>
        </div>`;
    }

    document.getElementById('fcfProjectionTable').innerHTML = html;
}

function calculateDCF(startGrowth, wacc, terminalGrowth) {
    const years = 5;
    const fcf = dcfData.inputs.last_fcf;
    let pvFCF = 0;
    let projectedFCF = fcf;

    // Calculate declining growth rates (same logic as renderFCFProjections)
    // Decline to 10% floor - quality companies should keep beating the market
    const endGrowth = 10;

    for (let i = 0; i < years; i++) {
        const yearGrowth = startGrowth > endGrowth
            ? startGrowth - (startGrowth - endGrowth) * (i / 4)
            : startGrowth;
        projectedFCF *= (1 + yearGrowth / 100);
        pvFCF += projectedFCF / Math.pow(1 + wacc/100, i + 1);
    }

    const terminalFCF = projectedFCF * (1 + terminalGrowth/100);
    const terminalValue = terminalFCF / (wacc/100 - terminalGrowth/100);
    const pvTerminal = terminalValue / Math.pow(1 + wacc/100, years);
    const enterpriseValue = pvFCF + pvTerminal;
    const equityValue = enterpriseValue - dcfData.inputs.net_debt;
    const iv = equityValue / dcfData.inputs.shares_outstanding;
    const terminalPerShare = terminalValue / dcfData.inputs.shares_outstanding;
    const entryPrice = terminalPerShare / Math.pow(1.15, years);

    return { iv, entryPrice };
}

function updateDCFDisplay() {
    const growth = parseFloat(document.getElementById('growthSlider').value);
    const wacc = parseFloat(document.getElementById('waccSlider').value);
    const terminal = parseFloat(document.getElementById('terminalSlider').value);

    document.getElementById('growthValue').textContent = growth + '%';
    document.getElementById('waccValue').textContent = wacc + '%';
    document.getElementById('terminalValue').textContent = terminal + '%';

    // Update FCF projections table when growth slider changes
    renderFCFProjections();

    const result = calculateDCF(growth, wacc, terminal);

    document.getElementById('dcfIV').textContent = '$' + result.iv.toFixed(0);
    document.getElementById('dcfEntry').textContent = '$' + result.entryPrice.toFixed(0);

    const upside = ((result.iv - dcfData.current_price) / dcfData.current_price * 100);
    const upsideEl = document.getElementById('dcfUpside');
    upsideEl.textContent = (upside >= 0 ? '+' : '') + upside.toFixed(0) + '% ' + (upside >= 0 ? 'upside' : 'downside');
    upsideEl.className = 'dcf-change ' + (upside >= 0 ? 'positive' : 'negative');

    document.getElementById('dcfWeighted').textContent = '$' + dcfData.probability_weighted.weighted_iv.toFixed(0);

    const grid = document.getElementById('assumptionGrid');
    grid.innerHTML = `
        <div class="assumption-item"><div class="label">Growth Rate</div><div class="value">${growth}%</div></div>
        <div class="assumption-item"><div class="label">WACC</div><div class="value">${wacc}%</div></div>
        <div class="assumption-item"><div class="label">Terminal Growth</div><div class="value">${terminal}%</div></div>
        <div class="assumption-item"><div class="label">Intrinsic Value</div><div class="value" style="color: #00d4aa;">$${result.iv.toFixed(0)}</div></div>
        <div class="assumption-item"><div class="label">Entry Price</div><div class="value" style="color: #00d4aa;">$${result.entryPrice.toFixed(0)}</div></div>
    `;
}

function switchScenario(scenario) {
    currentScenario = scenario;
    document.querySelectorAll('.scenario-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.scenario === scenario);
    });

    const assumptions = dcfData.assumptions[scenario];
    const valuation = dcfData.valuation[scenario];

    document.getElementById('growthSlider').value = assumptions.growth_rates[0];
    document.getElementById('waccSlider').value = assumptions.wacc;
    document.getElementById('terminalSlider').value = assumptions.terminal_growth;

    renderFCFProjections();
    updateDCFDisplay();
}

function renderHistoricalGrowth() {
    const growth = dcfData.historical_growth;
    const selectedSource = growth.growth_rate_source;
    const grid = document.getElementById('growthGrid');

    const metrics = [
        { key: 'revenue_3yr_cagr', label: 'Revenue 3Y' },
        { key: 'revenue_5yr_cagr', label: 'Revenue 5Y' },
        { key: 'eps_3yr_cagr', label: 'EPS 3Y' },
        { key: 'eps_5yr_cagr', label: 'EPS 5Y' },
        { key: 'equity_3yr_cagr', label: 'Equity 3Y' },
        { key: 'equity_5yr_cagr', label: 'Equity 5Y' },
        { key: 'fcf_3yr_cagr', label: 'FCF 3Y' },
        { key: 'fcf_5yr_cagr', label: 'FCF 5Y' }
    ];

    grid.innerHTML = metrics.map(m => {
        const rate = growth[m.key];
        const isSelected = m.key === selectedSource;
        return `<div class="growth-item ${isSelected ? 'selected' : ''}">
            <div class="metric">${m.label}</div>
            <div class="rate ${rate >= 0 ? 'positive' : 'negative'}">${rate >= 0 ? '+' : ''}${rate.toFixed(1)}%</div>
        </div>`;
    }).join('');
}

function renderSensitivityMatrix() {
    const sens = dcfData.sensitivity;
    const table = document.getElementById('sensitivityMatrix');
    const currentPrice = dcfData.current_price;
    const baseWacc = dcfData.assumptions.base.wacc;
    const baseTG = dcfData.assumptions.base.terminal_growth;

    let html = '<tr><th>WACC \\ TG</th>';
    sens.terminal_growth_range.forEach(tg => html += `<th>${tg}%</th>`);
    html += '</tr>';

    sens.wacc_range.forEach((wacc, i) => {
        html += `<tr><th>${wacc}%</th>`;
        sens.matrix[i].forEach((val, j) => {
            const isHighlight = wacc === baseWacc && sens.terminal_growth_range[j] === baseTG;
            const colorClass = val >= currentPrice ? 'above-current' : 'below-current';
            html += `<td class="${isHighlight ? 'highlight' : colorClass}">$${val.toFixed(0)}</td>`;
        });
        html += '</tr>';
    });

    table.innerHTML = html;
}

// Initialize
renderOverview();
renderKPIs();
renderGuidance();
renderCharts();
initDCF();

// Bind sliders
document.getElementById('growthSlider').oninput = updateDCFDisplay;
document.getElementById('waccSlider').oninput = updateDCFDisplay;
document.getElementById('terminalSlider').oninput = updateDCFDisplay;
</script>
</body>
</html>
