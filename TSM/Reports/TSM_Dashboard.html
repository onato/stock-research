<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taiwan Semiconductor (TSM) Financial Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4aa, #00b894);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .header p {
            color: #888;
            font-size: 1.1rem;
        }
        .header .market-info {
            margin-top: 10px;
            font-size: 0.95rem;
            color: #aaa;
        }

        /* Investment Overview Section */
        .overview-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .overview-toggle {
            width: 100%;
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid rgba(0, 212, 170, 0.3);
            border-radius: 12px;
            padding: 16px 24px;
            color: #00d4aa;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        .overview-toggle:hover {
            background: rgba(0, 212, 170, 0.2);
        }
        .overview-toggle .arrow {
            transition: transform 0.3s ease;
        }
        .overview-toggle.active .arrow {
            transform: rotate(180deg);
        }
        .overview-content {
            display: none;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            margin-top: -12px;
        }
        .overview-content.active {
            display: block;
        }
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        .overview-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .overview-card h3 {
            color: #00d4aa;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .overview-card p {
            margin-bottom: 12px;
            line-height: 1.6;
            color: #d0d0d0;
        }
        .overview-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .overview-card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            line-height: 1.5;
        }
        .overview-card li:last-child {
            border-bottom: none;
        }
        .overview-card.bull h3 { color: #00d4aa; }
        .overview-card.bear h3 { color: #ff6b6b; }
        .overview-card.risks h3 { color: #fdcb6e; }
        .risk-extreme { color: #ff3838; font-weight: 600; }
        .risk-high { color: #ff6b6b; }
        .risk-moderate { color: #fdcb6e; }
        .risk-low { color: #00d4aa; }
        .revenue-stream {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .revenue-stream .percent {
            color: #00d4aa;
            font-weight: 600;
        }
        .trend-growing { color: #00d4aa; }
        .trend-stable { color: #888; }
        .trend-declining { color: #ff6b6b; }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        .kpi-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 170, 0.2);
        }
        .kpi-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 5px;
        }
        .kpi-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .kpi-change {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .kpi-change.positive { color: #00d4aa; }
        .kpi-change.negative { color: #ff6b6b; }

        /* Guidance Section */
        .guidance-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .guidance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .guidance-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .guidance-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .guidance-meta {
            font-size: 0.85rem;
            color: #888;
        }
        .guidance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .guidance-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease;
        }
        .guidance-card:hover {
            transform: translateY(-2px);
        }
        .guidance-metric {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .guidance-target {
            font-size: 1.4rem;
            font-weight: 600;
            color: #00d4aa;
            margin-bottom: 6px;
        }
        .guidance-period {
            font-size: 0.85rem;
            color: #e0e0e0;
            margin-bottom: 8px;
        }
        .guidance-vs-prior {
            display: inline-block;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        .guidance-vs-prior.raised {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
        }
        .guidance-vs-prior.lowered {
            background: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
        }
        .guidance-vs-prior.maintained {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }
        .guidance-vs-prior.new {
            background: rgba(99, 102, 241, 0.15);
            color: #818cf8;
        }
        .guidance-notes {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }
        .guidance-commentary {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 16px 20px;
            border-left: 3px solid #00d4aa;
            font-style: italic;
            color: #b0b0b0;
            line-height: 1.6;
        }
        .guidance-commentary::before {
            content: '"';
            font-size: 1.5rem;
            color: #00d4aa;
            margin-right: 4px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #fff;
            margin: 40px auto 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0, 212, 170, 0.3);
            max-width: 1400px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .chart-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .help-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(0, 212, 170, 0.2);
            border: 1px solid #00d4aa;
            color: #00d4aa;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .help-btn:hover {
            background: #00d4aa;
            color: #1a1a2e;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: linear-gradient(135deg, #1e2a4a 0%, #16213e 100%);
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 212, 170, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 {
            color: #00d4aa;
            font-size: 1.4rem;
            margin: 0;
        }
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: #ff6b6b;
            color: #fff;
        }
        .modal-body {
            padding: 25px;
            line-height: 1.7;
        }
        .modal-body p { margin-bottom: 15px; }
        .modal-body strong { color: #00d4aa; }
        .modal-body ul { margin: 15px 0; padding-left: 20px; }
        .modal-body li { margin-bottom: 8px; }
        .metric-highlight {
            background: rgba(0, 212, 170, 0.1);
            border-left: 3px solid #00d4aa;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        /* DCF Valuation Section */
        .dcf-section {
            max-width: 1400px;
            margin: 0 auto 40px;
        }
        .dcf-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dcf-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }
        .dcf-card:hover {
            transform: translateY(-3px);
        }
        .dcf-card.highlight {
            background: rgba(0, 212, 170, 0.1);
            border-color: rgba(0, 212, 170, 0.3);
        }
        .dcf-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .dcf-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #00d4aa;
        }
        .dcf-card:not(.highlight) .dcf-value {
            color: #fff;
        }
        .dcf-change {
            font-size: 1rem;
            margin-top: 8px;
            font-weight: 600;
        }
        .dcf-change.positive { color: #00d4aa; }
        .dcf-change.negative { color: #ff6b6b; }
        .dcf-sublabel {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
        }
        .dcf-warning {
            background: rgba(253, 203, 110, 0.15);
            border: 1px solid rgba(253, 203, 110, 0.4);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fdcb6e;
        }
        .warning-icon {
            font-size: 1.2rem;
        }

        /* DCF Inputs Display */
        .dcf-inputs {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .dcf-inputs h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        .dcf-inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .dcf-input-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .dcf-input-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .dcf-input-value {
            font-size: 1.3rem;
            font-weight: 600;
            color: #00d4aa;
        }
        .dcf-input-note {
            font-size: 0.7rem;
            color: #666;
            margin-top: 4px;
        }
        .fcf-projections h5 {
            color: #b0b0b0;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .fcf-projection-table {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 12px;
        }
        .fcf-projection-item {
            text-align: center;
        }
        .fcf-projection-item.header {
            font-size: 0.75rem;
            color: #888;
            font-weight: 600;
        }
        .fcf-projection-item .year {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 2px;
        }
        .fcf-projection-item .fcf-value {
            font-size: 1rem;
            color: #e0e0e0;
            font-weight: 500;
        }
        .fcf-projection-item .growth-rate {
            font-size: 0.75rem;
            color: #00d4aa;
            margin-top: 2px;
        }

        .dcf-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .slider-group label {
            font-size: 0.95rem;
            color: #e0e0e0;
            display: flex;
            justify-content: space-between;
        }
        .slider-group label span {
            color: #00d4aa;
            font-weight: 600;
        }
        .slider-group input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        .slider-group input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            border: none;
        }
        .slider-hint {
            font-size: 0.8rem;
            color: #666;
        }

        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .scenario-tab {
            padding: 10px 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: #888;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .scenario-tab:hover {
            border-color: rgba(0, 212, 170, 0.5);
            color: #e0e0e0;
        }
        .scenario-tab.active {
            background: rgba(0, 212, 170, 0.15);
            border-color: #00d4aa;
            color: #00d4aa;
        }

        .scenario-details {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .scenario-details h4 {
            color: #00d4aa;
            margin-bottom: 15px;
        }
        .assumption-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .assumption-item {
            text-align: center;
        }
        .assumption-item .label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
        }
        .assumption-item .value {
            font-size: 1.1rem;
            color: #e0e0e0;
            font-weight: 500;
        }

        .sensitivity-section {
            margin-bottom: 30px;
        }
        .sensitivity-section h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .sensitivity-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            overflow: hidden;
        }
        .sensitivity-table th,
        .sensitivity-table td {
            padding: 12px 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .sensitivity-table th {
            background: rgba(0, 212, 170, 0.1);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td {
            color: #e0e0e0;
        }
        .sensitivity-table td.highlight {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td.below-current {
            color: #ff6b6b;
        }
        .sensitivity-table td.above-current {
            color: #00d4aa;
        }

        .historical-growth {
            margin-bottom: 30px;
        }
        .historical-growth h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .growth-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }
        .growth-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .growth-item .metric {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 6px;
        }
        .growth-item .rate {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .growth-item .rate.positive { color: #00d4aa; }
        .growth-item .rate.negative { color: #ff6b6b; }
        .growth-item.selected {
            border-color: #00d4aa;
            background: rgba(0, 212, 170, 0.1);
        }

        .dcf-download {
            text-align: center;
            margin-top: 30px;
        }
        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            background: rgba(0, 212, 170, 0.15);
            border: 1px solid #00d4aa;
            border-radius: 8px;
            color: #00d4aa;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
        }
        .download-btn:hover {
            background: #00d4aa;
            color: #1a1a2e;
        }
        .download-icon {
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .charts-container { grid-template-columns: 1fr; }
            .overview-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Taiwan Semiconductor Manufacturing Company (TSM)</h1>
        <p>World's Leading Semiconductor Foundry</p>
        <div class="market-info">NYSE: TSM (ADR) | 68% Global Foundry Market Share | Last Updated: January 2026</div>
    </div>

    <!-- Investment Overview Section -->
    <div class="overview-section">
        <button class="overview-toggle" onclick="toggleOverview()">
            <span>Investment Overview & Analysis</span>
            <span class="arrow">▼</span>
        </button>
        <div class="overview-content" id="overviewContent">
            <div class="overview-grid">
                <!-- Company Overview -->
                <div class="overview-card">
                    <h3>Company Overview</h3>
                    <p>TSMC is the world's largest and most advanced dedicated semiconductor foundry, manufacturing chips for leading technology companies including Apple, NVIDIA, AMD, and Qualcomm. The company operates under a pure-play foundry model, producing semiconductors based on proprietary designs provided by customers without competing in chip design. TSMC commands approximately 68% market share in the foundry industry and operates advanced fabs in Taiwan, with expanding operations in Arizona (U.S.), Japan, and Germany.</p>
                </div>

                <!-- Business Model -->
                <div class="overview-card">
                    <h3>Business Model</h3>
                    <p><strong>Pure-Play Foundry:</strong> Manufacturing services without designing competing chips. Revenue from wafer fabrication, advanced packaging, testing, and mask making.</p>
                    <ul>
                        <li class="revenue-stream">
                            <span>Wafer Fabrication</span>
                            <span class="percent">87%</span>
                        </li>
                        <li class="revenue-stream">
                            <span>Advanced Packaging (CoWoS, InFO)</span>
                            <span class="percent trend-growing">8% (Rapidly Growing)</span>
                        </li>
                        <li class="revenue-stream">
                            <span>Testing, Mask, Design Services</span>
                            <span class="percent">5%</span>
                        </li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>By Platform (2024):</strong></p>
                    <ul>
                        <li class="revenue-stream">
                            <span>High Performance Computing (AI/Data Center)</span>
                            <span class="percent trend-growing">51% (up from 41% in 2022)</span>
                        </li>
                        <li class="revenue-stream">
                            <span>Smartphone</span>
                            <span class="percent trend-declining">35%</span>
                        </li>
                        <li class="revenue-stream">
                            <span>IoT / Automotive / Consumer</span>
                            <span class="percent">14%</span>
                        </li>
                    </ul>
                </div>

                <!-- Competitive Position -->
                <div class="overview-card">
                    <h3>Competitive Position</h3>
                    <p><strong>Market Leader:</strong> 68% foundry market share - 8x larger than second-place Samsung (7.7%)</p>
                    <p><strong>Key Competitors:</strong> Samsung Foundry (yield issues at 3nm/2nm), Intel Foundry Services (late to market, execution challenges), GlobalFoundries (exited advanced nodes)</p>
                    <p><strong>Moat Factors:</strong></p>
                    <ul>
                        <li><strong class="trend-growing">Technology Leadership:</strong> 2-3 year lead over Samsung at most advanced nodes. N2 (2nm) entering production 2025.</li>
                        <li><strong class="trend-growing">Manufacturing Scale:</strong> 17 million wafer capacity, $50B+ annual capex dwarfs competitors.</li>
                        <li><strong class="trend-growing">Customer Switching Costs:</strong> 18-24+ month qualification cycles. Deep ecosystem lock-in.</li>
                        <li><strong class="trend-growing">Advanced Packaging Leadership:</strong> CoWoS is gold standard for AI chips. Fully booked through 2027.</li>
                        <li><strong class="trend-growing">Execution Excellence:</strong> Track record of on-time technology delivery. Arizona fab achieving 92% yields.</li>
                    </ul>
                </div>

                <!-- Growth Drivers -->
                <div class="overview-card">
                    <h3>Growth Drivers</h3>
                    <ul>
                        <li><strong class="trend-growing">AI Chip Demand Explosion:</strong> AI accelerator 5-year CAGR of mid-to-high 50%. NVIDIA, AMD, hyperscaler custom chips all dependent on TSMC.</li>
                        <li><strong class="trend-growing">HPC Platform Dominance:</strong> Grew from 41% (2022) to 51% (2024) to 58% (2025) of revenue. Structural demand shift to high-margin advanced nodes.</li>
                        <li><strong class="trend-growing">3nm & 2nm Technology Ramps:</strong> N3 already 18% of revenue (2024), ramping to 23% in 2025. N2 volume production starting 2025.</li>
                        <li><strong class="trend-growing">CoWoS Capacity Expansion:</strong> Doubling capacity from 75k to 130k wafers/month by end 2026. High-margin business with pricing power.</li>
                        <li><strong>Geographic Diversification:</strong> Arizona, Japan, Germany fabs reduce Taiwan concentration. $10B+ government subsidies.</li>
                        <li><strong>Market Share Gains:</strong> Samsung's yield struggles and Intel's delays driving customers to TSMC.</li>
                    </ul>
                </div>

                <!-- Key Risks -->
                <div class="overview-card risks">
                    <h3>Key Risks</h3>
                    <ul>
                        <li><span class="risk-extreme">EXTREME:</span> <strong>Geopolitical - Taiwan-China Tensions:</strong> 90%+ of advanced production in Taiwan. Conflict would be catastrophic for global supply chain.</li>
                        <li><span class="risk-high">HIGH:</span> <strong>Customer Concentration:</strong> Top 10 = 76% of revenue (Apple ~22%, NVIDIA ~12%). Loss of major customer would materially impact revenue.</li>
                        <li><span class="risk-high">HIGH:</span> <strong>AI Demand Cyclicality / Bubble Risk:</strong> If AI adoption disappoints or cloud capex pulls back, growth would decelerate sharply. CoWoS overcapacity risk.</li>
                        <li><span class="risk-moderate">MODERATE:</span> <strong>Currency Fluctuation (NT$ vs USD):</strong> Sales in USD, costs in NT$. NT$ strengthening pressures margins.</li>
                        <li><span class="risk-moderate">MODERATE:</span> <strong>Massive Capital Intensity:</strong> $50B+ annual capex strains cash flow. Rising interest rates increase financing costs.</li>
                        <li><span class="risk-moderate">MODERATE:</span> <strong>Export Controls & China Revenue:</strong> China 11% of revenue. Further restrictions possible.</li>
                        <li><span class="risk-moderate">MODERATE:</span> <strong>Natural Disasters:</strong> Taiwan earthquakes (Apr 2024 NT$3B loss, Jan 2025 NT$5.3B loss). Power/water disruption risks.</li>
                    </ul>
                </div>

                <!-- Bull Case -->
                <div class="overview-card bull">
                    <h3>Bull Case</h3>
                    <ul>
                        <li><strong>AI Super Cycle:</strong> Multi-year structural demand growing 50%+ annually through 2029. TSMC is only foundry capable of producing cutting-edge AI chips at scale.</li>
                        <li><strong>Unassailable Technology Moat:</strong> 2-3 year lead over Samsung, 4-5+ years over Intel. N2 ramping with no credible competitor. Premium pricing and market share gains.</li>
                        <li><strong>CoWoS Monopoly:</strong> Only proven solution for AI chip integration. Fully booked through 2027. High-margin business with pricing power.</li>
                        <li><strong>Operating Leverage:</strong> $158B+ revenue at 63-65% gross margins generates massive cash flow. Fixed-cost structure means high incremental margins.</li>
                        <li><strong>Geographic Diversification:</strong> Arizona, Japan, Germany fabs reduce Taiwan risk. $10B+ subsidies. Improves customer confidence.</li>
                        <li><strong>Customer Lock-In:</strong> 18-24 month qualification. Top customers (Apple, NVIDIA) won't switch from proven supplier.</li>
                        <li><strong>Margin Expansion:</strong> Advanced nodes commanding premium pricing. Mix shift driving blended margin expansion.</li>
                    </ul>
                </div>

                <!-- Bear Case -->
                <div class="overview-card bear">
                    <h3>Bear Case</h3>
                    <ul>
                        <li><strong>Geopolitical Catastrophe:</strong> China-Taiwan conflict would be catastrophic. 90%+ of leading-edge production in Taiwan. Existential risk.</li>
                        <li><strong>AI Bubble:</strong> If AI hype deflates or cloud capex contracts, TSMC's 30% growth assumptions collapse. CoWoS overcapacity. Prior semiconductor bubbles ended badly.</li>
                        <li><strong>Customer Concentration:</strong> Apple (22%), NVIDIA (12%), Top 10 (76%). Loss of key customer would devastate revenue. Enormous customer bargaining power.</li>
                        <li><strong>Samsung/Intel Catch Up:</strong> If competitors resolve yield issues, competitive gap narrows. Pricing power and margins could erode.</li>
                        <li><strong>Massive Capex = Stranded Assets:</strong> $50B+ annual capex assumes sustained demand. Cyclical downturn = underutilized fabs, margin compression.</li>
                        <li><strong>Margin Compression from Overseas Expansion:</strong> Arizona fabs reportedly 30-40% higher costs than Taiwan. Mix shift = margin dilution.</li>
                        <li><strong>Regulatory Interference:</strong> CHIPS Act funding comes with restrictions. Risk of government pressure on pricing, capacity, or technology.</li>
                        <li><strong>Valuation - Expensive:</strong> Trading at 30x+ P/E despite cyclical industry. If growth slows to 10-15%, multiple could contract 30-40%.</li>
                    </ul>
                </div>

                <!-- Recent Developments -->
                <div class="overview-card">
                    <h3>Recent Developments</h3>
                    <ul>
                        <li><strong>Jan 2026:</strong> <span class="trend-growing">Q4 2025 earnings beat.</span> Raised 2026 revenue guidance to ~30% growth. AI accelerator CAGR raised to mid-to-high 50%.</li>
                        <li><strong>Dec 2025:</strong> <span class="trend-growing">Arizona Fab 21 achieves 92% yields.</span> Demonstrates execution capability outside Taiwan.</li>
                        <li><strong>Dec 2024:</strong> <span class="trend-growing">Japan Fab 23 enters volume production</span> (28nm specialty). Phase 2 announced.</li>
                        <li><strong>Nov 2024:</strong> <span class="trend-growing">$6.6B U.S. CHIPS Act funding finalized</span> + $5B loans. Reduces Arizona capex burden but includes China restrictions.</li>
                        <li><strong>Jul 2025:</strong> <span class="trend-growing">CoWoS capacity expansion accelerated</span> to 130k wafers/month by end 2026.</li>
                        <li><strong>Oct 2025:</strong> <span class="trend-declining">Export control compliance issue disclosed.</span> Customer chip may have been diverted to restricted entity.</li>
                        <li><strong>Apr 2024 & Jan 2025:</strong> <span class="risk-moderate">Taiwan earthquakes</span> caused NT$3B and NT$5.3B losses respectively.</li>
                        <li><strong>Apr & Oct 2024:</strong> <span class="risk-moderate">Electricity tariff increases</span> of 25% and 14% in Taiwan raise manufacturing costs.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid" id="kpiGrid"></div>

    <!-- Management Guidance Section -->
    <div class="guidance-section" id="guidanceSection">
        <div class="guidance-header">
            <h3>Management Guidance</h3>
            <span class="guidance-meta">As of <span id="guidanceAsOf">Q4 2025 Earnings - January 15, 2026</span> | <span id="guidanceFY">2026</span></span>
        </div>
        <div class="guidance-grid" id="guidanceGrid"></div>
        <div class="guidance-commentary" id="guidanceCommentary"></div>
    </div>

    <!-- Charts -->
    <h2 class="section-title">Financial Performance</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Revenue Trend (NT$ Billions)</h3>
                <button class="help-btn" onclick="openModal('revenue')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>EPS Growth (NT$)</h3>
                <button class="help-btn" onclick="openModal('eps')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="epsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Margin Trends</h3>
                <button class="help-btn" onclick="openModal('margins')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="marginsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Free Cash Flow vs CapEx (NT$ Billions)</h3>
                <button class="help-btn" onclick="openModal('fcf')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="fcfChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Operating Cash Flow (NT$ Billions)</h3>
                <button class="help-btn" onclick="openModal('ocf')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="ocfChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>R&D Investment (NT$ Billions)</h3>
                <button class="help-btn" onclick="openModal('rnd')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="rndChart"></canvas>
            </div>
        </div>
    </div>

    <!-- DCF Valuation Section -->
    <h2 class="section-title">DCF Valuation</h2>
    <div class="dcf-section">
        <!-- Valuation Summary Cards -->
        <div class="dcf-summary">
            <div class="dcf-card highlight">
                <div class="dcf-label">Intrinsic Value</div>
                <div class="dcf-value" id="dcfIV">$188</div>
                <div class="dcf-change negative" id="dcfUpside">-42% downside</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Entry Price (15% CAGR)</div>
                <div class="dcf-value" id="dcfEntry">$115</div>
                <div class="dcf-sublabel">Buy below for 15% annual return</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Current Price</div>
                <div class="dcf-value" id="dcfCurrent">$326</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Prob-Weighted IV</div>
                <div class="dcf-value" id="dcfWeighted">$200</div>
                <div class="dcf-sublabel">30% Bull / 50% Base / 20% Bear</div>
            </div>
        </div>

        <!-- Growth Rate Warning -->
        <div class="dcf-warning" id="growthWarning">
            <span class="warning-icon">&#9888;</span>
            <span id="warningText">Historical growth very strong. FCF 5yr CAGR of 41% reflects operational leverage.</span>
        </div>

        <!-- DCF Inputs Display -->
        <div class="dcf-inputs">
            <h4>DCF Model Inputs</h4>
            <div class="dcf-inputs-grid">
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Base Year FCF</div>
                    <div class="dcf-input-value" id="baseFCF">$27.2B</div>
                    <div class="dcf-input-note">FY2024 Free Cash Flow</div>
                </div>
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Shares Outstanding</div>
                    <div class="dcf-input-value" id="sharesOut">5.19B ADRs</div>
                </div>
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Net Debt</div>
                    <div class="dcf-input-value" id="netDebt">-$36.5B</div>
                    <div class="dcf-input-note">Negative = net cash</div>
                </div>
            </div>
            <div class="fcf-projections">
                <h5>Projected FCF (5-Year, Base Case)</h5>
                <div class="fcf-projection-table" id="fcfProjectionTable"></div>
            </div>
        </div>

        <!-- Interactive Sliders -->
        <div class="dcf-controls">
            <div class="slider-group">
                <label>Growth Rate: <span id="growthValue">22%</span></label>
                <input type="range" id="growthSlider" min="0" max="40" value="22" step="1">
                <div class="slider-hint" id="growthHint">Based on 5-year revenue CAGR</div>
            </div>
            <div class="slider-group">
                <label>WACC: <span id="waccValue">10.5%</span></label>
                <input type="range" id="waccSlider" min="6" max="18" value="10.5" step="0.5">
            </div>
            <div class="slider-group">
                <label>Terminal Growth: <span id="terminalValue">4%</span></label>
                <input type="range" id="terminalSlider" min="0" max="7" value="4" step="0.5">
            </div>
        </div>

        <!-- Scenario Tabs -->
        <div class="scenario-tabs">
            <button class="scenario-tab active" data-scenario="base" onclick="switchScenario('base')">Base Case</button>
            <button class="scenario-tab" data-scenario="bull" onclick="switchScenario('bull')">Bull Case</button>
            <button class="scenario-tab" data-scenario="bear" onclick="switchScenario('bear')">Bear Case</button>
        </div>

        <!-- Scenario Details -->
        <div class="scenario-details" id="scenarioDetails">
            <div class="scenario-assumptions">
                <h4>Assumptions</h4>
                <div class="assumption-grid" id="assumptionGrid"></div>
            </div>
        </div>

        <!-- Sensitivity Table -->
        <div class="sensitivity-section">
            <h4>Sensitivity Analysis: Intrinsic Value by WACC & Terminal Growth</h4>
            <table class="sensitivity-table" id="sensitivityMatrix"></table>
        </div>

        <!-- Historical Growth Rates -->
        <div class="historical-growth">
            <h4>Historical Growth Rates (CAGR)</h4>
            <div class="growth-grid" id="growthGrid"></div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // EMBEDDED CSV DATA
        const csvData = `Period,Revenue,GrossProfit,GrossMargin,OperatingIncome,OperatingMargin,NetIncome,NetMargin,EPS,TotalAssets,ShareholdersEquity,TotalDebt,CashAndEquivalents,SharesOutstanding,OperatingCashFlow,CapEx,FreeCashFlow,RnDExpense,AdvancedTechPct,WaferShipments,CapacityUtilization,HPCRevenuePct,SmartphoneRevenuePct
FY2014,762.8,377.7,49.5,295.9,38.8,254.2,33.3,9.81,,,,,25.930,421.5,288.5,133.0,,,,,,
FY2015,843.5,410.4,48.7,320.0,37.9,302.8,35.9,11.68,,,,,25.930,529.9,257.5,272.4,,,,,,
FY2016,947.9,474.8,50.1,378.0,39.9,331.8,35.0,12.79,,,,,25.930,539.8,328.0,211.8,71.2,,,,,
FY2017,977.4,494.8,50.6,386.9,39.6,345.0,35.3,13.30,,,,,25.930,585.3,330.6,254.7,80.7,,,,,
FY2018,1031.5,497.9,48.3,385.7,37.4,363.1,35.2,14.00,,,,,25.930,574.0,315.6,258.4,85.9,,,,,
FY2019,1070.0,492.7,46.0,372.7,34.8,354.0,33.1,13.65,,,,,25.929,615.1,460.4,154.7,91.4,,,,,
FY2020,1339.3,711.1,53.1,566.8,42.3,511.0,38.2,19.70,,,,,25.929,822.7,507.2,315.5,109.5,,,,,
FY2021,1587.4,819.5,51.6,650.0,41.0,592.9,37.3,22.84,,,,,25.929,1112.2,839.2,273.0,124.7,,,,,
FY2022,2263.9,1348.4,59.6,1121.3,49.5,993.3,43.9,38.29,,,,,25.929,1610.6,1082.7,527.9,163.3,,,,,
FY2023,2161.7,1175.1,54.4,921.5,42.6,851.0,39.4,32.85,5532.2,3453.9,918.3,1465.4,25.929,1242.0,949.8,292.2,182.4,,,,,
FY2024,2894.3,1624.4,56.1,1322.1,45.7,1157.5,40.0,44.68,6691.8,4279.3,958.4,2127.6,25.932,1826.2,956.0,870.2,204.2,,,,,`;

        // EMBEDDED ANALYSIS JSON
        const analysis = {
  "ticker": "TSM",
  "company_name": "Taiwan Semiconductor Manufacturing Company Limited",
  "analysis_date": "2026-01-22",
  "overview": "TSMC is the world's largest and most advanced dedicated semiconductor foundry, manufacturing chips for leading technology companies including Apple, NVIDIA, AMD, and Qualcomm. The company operates under a pure-play foundry model, producing semiconductors based on proprietary designs provided by customers without competing in chip design. TSMC commands approximately 68% market share in the foundry industry and operates advanced fabs in Taiwan, with expanding operations in Arizona (U.S.), Japan, and Germany.",
  "business_model": {
    "summary": "Pure-play foundry model providing semiconductor manufacturing services without designing competing chips. Revenue primarily from wafer fabrication (87%), with additional services in advanced packaging, testing, and mask making.",
    "revenue_streams": [
      {
        "name": "Wafer Fabrication",
        "percent": 87,
        "trend": "stable",
        "description": "Core manufacturing service across all technology nodes"
      },
      {
        "name": "Advanced Packaging (CoWoS, InFO, SoIC)",
        "percent": 8,
        "trend": "rapidly growing",
        "description": "3DFabric technologies enabling AI chip integration, CoWoS capacity doubling through 2026"
      },
      {
        "name": "Testing, Mask Making, Design Services",
        "percent": 5,
        "trend": "stable",
        "description": "Supporting services for comprehensive foundry offering"
      }
    ]
  },
  "competitive_position": {
    "main_competitors": ["Samsung Foundry", "Intel Foundry Services", "GlobalFoundries", "UMC", "SMIC"],
    "moat_factors": [
      {"factor": "Technology Leadership", "strength": "very strong", "description": "2-3 year lead over Samsung at most advanced nodes"},
      {"factor": "Manufacturing Scale & Capacity", "strength": "very strong", "description": "17 million wafer capacity, expanding to support 30% revenue growth"},
      {"factor": "Customer Switching Costs", "strength": "very strong", "description": "18-24+ month qualification cycles. Deep ecosystem lock-in"},
      {"factor": "Advanced Packaging Leadership", "strength": "strong", "description": "CoWoS is gold standard for AI chips"},
      {"factor": "Execution Excellence", "strength": "strong", "description": "Track record of on-time technology delivery"}
    ],
    "weaknesses": [
      "Geographic concentration in Taiwan creates geopolitical vulnerability",
      "High customer concentration (top 10 = 76% of revenue)",
      "Dependence on ASML's EUV lithography equipment",
      "Premium pricing limits addressable market in cost-sensitive segments"
    ]
  },
  "growth_drivers": [
    "AI Chip Demand Explosion - AI accelerator 5-year CAGR of mid-to-high 50%",
    "HPC Platform Dominance - grew from 41% (2022) to 51% (2024) to 58% (2025)",
    "3nm & 2nm Technology Ramps - N3 at 18% revenue, N2 starting 2025",
    "CoWoS Advanced Packaging Expansion - doubling capacity to 130k wafers/month",
    "Geographic Diversification - Arizona, Japan, Germany fabs reduce Taiwan risk",
    "Market Share Gains - Samsung/Intel struggles driving customers to TSMC"
  ],
  "risks": {
    "business": [
      {"risk": "Customer Concentration", "severity": "high", "description": "Top 10 = 76% revenue. Apple ~22%, NVIDIA ~12%."},
      {"risk": "AI Demand Cyclicality / Bubble Risk", "severity": "high", "description": "AI chip demand driving 50%+ growth. If AI disappoints, growth decelerates."},
      {"risk": "Technological Obsolescence", "severity": "moderate-to-high", "description": "If Samsung/Intel catch up, competitive gap narrows."},
      {"risk": "Semiconductor Cyclicality", "severity": "moderate", "description": "Industry historically cyclical. High fixed costs = margin compression in downturns."}
    ],
    "regulatory": [
      {"risk": "U.S. CHIPS Act Compliance", "severity": "moderate", "description": "$6.6B funding contingent on China expansion restrictions."},
      {"risk": "Export Controls & China Revenue", "severity": "moderate", "description": "China 11% revenue. Further restrictions possible."}
    ],
    "macro": [
      {"risk": "Geopolitical - Taiwan-China Tensions", "severity": "extreme", "description": "90%+ advanced production in Taiwan. Conflict catastrophic."},
      {"risk": "Natural Disasters", "severity": "moderate-to-high", "description": "Taiwan earthquakes (Apr 2024 NT$3B loss, Jan 2025 NT$5.3B loss)."},
      {"risk": "Currency Fluctuation", "severity": "moderate", "description": "NT$ appreciation vs USD pressures margins."}
    ]
  },
  "bull_case": [
    "AI-Driven Multi-Year Super Cycle - structural megatrend, not bubble",
    "Unassailable Technology Moat - 2-3 year lead expanding",
    "CoWoS Advanced Packaging Monopoly - fully booked through 2027",
    "Operating Leverage from Scale - $158B+ revenue at 63-65% gross margins",
    "Geographic Diversification - reduces Taiwan risk, $10B+ subsidies",
    "Customer Lock-In - 18-24 month qualification, won't switch",
    "Margin Expansion Potential - advanced nodes commanding premium pricing"
  ],
  "bear_case": [
    "Geopolitical Catastrophe - Taiwan invasion existential risk",
    "AI Bubble / Demand Disappointment - overcapacity and margin compression",
    "Customer Concentration Risk - loss of Apple/NVIDIA devastating",
    "Samsung/Intel Catch Up - competitive gap narrows, pricing pressure",
    "Massive Capex = Stranded Assets - $50B+ capex assumes sustained demand",
    "Margin Compression from Geographic Expansion - Arizona 30-40% higher costs",
    "Valuation - Expensive - 30x+ P/E despite cyclical industry"
  ],
  "recent_developments": [
    {"date": "2026-01", "event": "Q4 2025 earnings beat. 30% revenue growth guidance for 2026."},
    {"date": "2025-12", "event": "Arizona Fab 21 achieves 92% yields. Japan Fab 23 enters volume production."},
    {"date": "2024-11", "event": "$6.6B U.S. CHIPS Act funding finalized + $5B loans."},
    {"date": "2025-07", "event": "CoWoS capacity expansion accelerated to 130k wafers/month by end 2026."}
  ],
  "guidance": {
    "as_of": "Q4 2025 (FY2025) Earnings - January 15, 2026",
    "fiscal_year": "2026 (Calendar Year 2026)",
    "items": [
      {
        "metric": "Revenue Growth",
        "target": "~30% YoY in USD",
        "period": "Full Year 2026",
        "vs_prior": "raised",
        "notes": "Implies ~$122B * 1.30 = $158B revenue. Driven by AI accelerator demand, 3nm/2nm ramps."
      },
      {
        "metric": "Q1 2026 Revenue",
        "target": "$34.6B - $35.8B",
        "period": "Q1 2026",
        "vs_prior": "new",
        "notes": "Midpoint $35.2B vs. Q4 2025 $33.7B, ~4% QoQ growth despite seasonality."
      },
      {
        "metric": "Gross Margin",
        "target": "63% - 65%",
        "period": "Q1 2026",
        "vs_prior": "maintained",
        "notes": "Sustained high margins from advanced node mix, pricing power, operational leverage."
      },
      {
        "metric": "Operating Margin",
        "target": "52% - 54%",
        "period": "Q1 2026",
        "vs_prior": "maintained",
        "notes": "R&D as % of revenue declining with scale; operating leverage from revenue growth."
      },
      {
        "metric": "AI Accelerator Growth",
        "target": "Mid-to-high 50% CAGR",
        "period": "2024-2029 (5-year)",
        "vs_prior": "raised",
        "notes": "AI accelerators now high-teens % of revenue. Expectation for continued strong growth."
      },
      {
        "metric": "Advanced Node Revenue Mix",
        "target": "77%+ of total revenue",
        "period": "2026",
        "vs_prior": "raised",
        "notes": "3nm, 5nm, 7nm nodes. 3nm expected to grow to 30%+ of revenue as N2 ramps."
      },
      {
        "metric": "Capital Expenditure",
        "target": "$52B - $56B USD",
        "period": "2026",
        "vs_prior": "raised",
        "notes": "70-80% for advanced technology capacity (N2, N3, N5). Remainder for mature nodes, advanced packaging, overseas fabs."
      },
      {
        "metric": "CoWoS Capacity",
        "target": "130,000 wafers/month",
        "period": "End of 2026",
        "vs_prior": "raised",
        "notes": "73% increase to meet AI chip packaging demand. Fully booked through 2027."
      }
    ],
    "management_commentary": "CEO C.C. Wei emphasized that 2026 will be an 'even bigger' year for TSMC driven by AI demand. He noted that AI is a 'structural megatrend' not a temporary bubble. CFO Wendell Huang highlighted that N2 is ramping on schedule with strong customer interest from Apple, NVIDIA, and AMD. Management expressed confidence that CoWoS capacity will meet demand and that geographic diversification (Arizona, Japan, Germany) is progressing well. Acknowledged geopolitical risks but emphasized 'Silicon Shield' and strategic importance to multiple nations."
  }
};

        // EMBEDDED DCF JSON
        const dcfData = {
  "ticker": "TSM",
  "company_name": "Taiwan Semiconductor Manufacturing Company Limited",
  "valuation_date": "2026-01-22",
  "current_price": 326.12,
  "currency": "USD",
  "note": "Prices in USD per ADR (1 ADR = 5 ordinary shares). Financial data converted from NT$ at 32:1.",
  "inputs": {
    "shares_outstanding_adr": 5186.4,
    "shares_outstanding_ordinary": 25932.0,
    "adr_ratio": 5,
    "net_debt": -36537.0,
    "net_cash": 36537.0,
    "last_fcf": 27194.0,
    "last_revenue": 90447.0,
    "last_net_income": 36172.0,
    "fcf_margin_fy2024": 30.1,
    "units": "millions USD",
    "exchange_rate": 32.0
  },
  "historical_growth": {
    "revenue_3yr_cagr": 22.17,
    "revenue_5yr_cagr": 22.02,
    "revenue_10yr_cagr": 14.27,
    "eps_3yr_cagr": 25.07,
    "eps_5yr_cagr": 26.76,
    "eps_10yr_cagr": 16.37,
    "equity_1yr_growth": 23.9,
    "fcf_3yr_cagr": 47.17,
    "fcf_5yr_cagr": 41.26,
    "selected_growth_rate": 22.0,
    "growth_rate_source": "revenue_5yr_cagr",
    "growth_divergence_warning": "Historical growth very strong. FCF 5yr CAGR of 41% reflects operational leverage."
  },
  "assumptions": {
    "base": {
      "growth_rates": [28, 22, 18, 15, 12],
      "fcf_margin": 35.0,
      "wacc": 10.5,
      "terminal_growth": 4.0,
      "description": "Management guidance achieved, strong execution continues"
    },
    "bull": {
      "growth_rates": [30, 28, 22, 18, 15],
      "fcf_margin": 38.0,
      "wacc": 9.5,
      "terminal_growth": 4.5,
      "description": "AI super-cycle extends through 2030+, TSM maintains dominance"
    },
    "bear": {
      "growth_rates": [18, 12, 10, 8, 6],
      "fcf_margin": 28.0,
      "wacc": 12.5,
      "terminal_growth": 3.0,
      "description": "AI demand moderates, geopolitical tensions increase"
    }
  },
  "valuation": {
    "base": {
      "intrinsic_value": 188.42,
      "upside": -42.2
    },
    "bull": {
      "intrinsic_value": 299.37,
      "upside": -8.2
    },
    "bear": {
      "intrinsic_value": 80.44,
      "upside": -75.3
    }
  },
  "entry_price": {
    "base": {
      "entry_price": 115.24,
      "entry_discount_from_current": -64.7
    },
    "bull": {
      "entry_price": 189.7,
      "entry_discount_from_current": -41.8
    },
    "bear": {
      "entry_price": 43.81,
      "entry_discount_from_current": -86.6
    }
  },
  "sensitivity": {
    "wacc_range": [8.5, 9.5, 10.5, 11.5, 12.5],
    "terminal_growth_range": [3.0, 3.5, 4.0, 4.5, 5.0],
    "matrix": [
      [230.54, 249.54, 272.77, 301.81, 339.14],
      [194.71, 207.63, 222.9, 241.22, 263.61],
      [168.49, 177.74, 188.42, 200.88, 215.6],
      [148.47, 155.36, 163.17, 172.1, 182.4],
      [132.69, 137.98, 143.89, 150.54, 158.08]
    ]
  },
  "probability_weighted": {
    "weights": {
      "bull": 0.3,
      "base": 0.5,
      "bear": 0.2
    },
    "weighted_iv": 200.11
  }
};

        // Parse embedded CSV
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
                return obj;
            });
        }

        const data = parseCSV(csvData);

        // Sort data chronologically (oldest first)
        data.sort((a, b) => {
            const parseDate = (p) => {
                const year = parseInt(p.match(/\d{4}/)?.[0] || '0');
                const isQ1 = p.includes('Q1');
                const isQ2 = p.includes('Q2');
                const isQ3 = p.includes('Q3');
                const isQ4 = p.includes('Q4');
                const isH1 = p.includes('H1');
                const isH2 = p.includes('H2');
                const isFY = p.startsWith('FY');
                const subOrder = isQ1 ? 1 : isQ2 ? 2 : isH1 ? 3 : isQ3 ? 4 : isQ4 ? 5 : isH2 ? 6 : isFY ? 7 : 0;
                return year * 10 + subOrder;
            };
            return parseDate(a.Period) - parseDate(b.Period);
        });

        const fyData = data.filter(d => d.Period.startsWith('FY'));

        // Helper functions
        function calcYoYChange(current, previous) {
            if (!previous || !current) return null;
            return ((parseFloat(current) - parseFloat(previous)) / Math.abs(parseFloat(previous)) * 100).toFixed(1);
        }

        // Render KPI Cards
        function renderKPIs() {
            const latest = fyData[fyData.length - 1];
            const previous = fyData[fyData.length - 2];

            const kpis = [
                {
                    label: 'FY2024 Revenue',
                    value: 'NT$' + parseFloat(latest.Revenue).toFixed(1) + 'B',
                    change: calcYoYChange(latest.Revenue, previous.Revenue)
                },
                {
                    label: 'FY2024 Gross Margin',
                    value: latest.GrossMargin + '%',
                    change: (parseFloat(latest.GrossMargin) - parseFloat(previous.GrossMargin)).toFixed(1)
                },
                {
                    label: 'FY2024 Operating Margin',
                    value: latest.OperatingMargin + '%',
                    change: (parseFloat(latest.OperatingMargin) - parseFloat(previous.OperatingMargin)).toFixed(1)
                },
                {
                    label: 'FY2024 Net Income',
                    value: 'NT$' + parseFloat(latest.NetIncome).toFixed(1) + 'B',
                    change: calcYoYChange(latest.NetIncome, previous.NetIncome)
                },
                {
                    label: 'FY2024 EPS',
                    value: 'NT$' + parseFloat(latest.EPS).toFixed(2),
                    change: calcYoYChange(latest.EPS, previous.EPS)
                },
                {
                    label: 'FY2024 Free Cash Flow',
                    value: 'NT$' + parseFloat(latest.FreeCashFlow).toFixed(1) + 'B',
                    change: calcYoYChange(latest.FreeCashFlow, previous.FreeCashFlow)
                },
                {
                    label: 'FY2024 R&D Expense',
                    value: 'NT$' + parseFloat(latest.RnDExpense).toFixed(1) + 'B',
                    change: calcYoYChange(latest.RnDExpense, previous.RnDExpense)
                },
                {
                    label: 'FY2024 Operating Cash Flow',
                    value: 'NT$' + parseFloat(latest.OperatingCashFlow).toFixed(1) + 'B',
                    change: calcYoYChange(latest.OperatingCashFlow, previous.OperatingCashFlow)
                }
            ];

            const grid = document.getElementById('kpiGrid');
            grid.innerHTML = kpis.map(kpi => {
                const changeClass = kpi.change > 0 ? 'positive' : kpi.change < 0 ? 'negative' : '';
                const changeSymbol = kpi.change > 0 ? '+' : '';
                return `
                    <div class="kpi-card">
                        <div class="kpi-value">${kpi.value}</div>
                        <div class="kpi-label">${kpi.label}</div>
                        ${kpi.change ? `<div class="kpi-change ${changeClass}">${changeSymbol}${kpi.change}% YoY</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Render guidance section
        function renderGuidance() {
            if (!analysis.guidance || !analysis.guidance.items || analysis.guidance.items.length === 0) {
                document.getElementById('guidanceSection').style.display = 'none';
                return;
            }

            const guidance = analysis.guidance;
            document.getElementById('guidanceAsOf').textContent = guidance.as_of || '';
            document.getElementById('guidanceFY').textContent = guidance.fiscal_year || '';

            const grid = document.getElementById('guidanceGrid');
            grid.innerHTML = guidance.items.map(item => {
                const vsClass = item.vs_prior ? item.vs_prior.toLowerCase().replace(' ', '-') : 'new';
                const vsLabel = item.vs_prior ? item.vs_prior.charAt(0).toUpperCase() + item.vs_prior.slice(1) : 'New';
                return `
                    <div class="guidance-card">
                        <div class="guidance-metric">${item.metric}</div>
                        <div class="guidance-target">${item.target}</div>
                        <div class="guidance-period">${item.period}</div>
                        <span class="guidance-vs-prior ${vsClass}">${vsLabel}</span>
                        ${item.notes ? `<div class="guidance-notes">${item.notes}</div>` : ''}
                    </div>
                `;
            }).join('');

            const commentary = document.getElementById('guidanceCommentary');
            if (guidance.management_commentary) {
                commentary.textContent = guidance.management_commentary;
                commentary.style.display = 'block';
            } else {
                commentary.style.display = 'none';
            }
        }

        // Toggle overview section
        function toggleOverview() {
            const btn = document.querySelector('.overview-toggle');
            const content = document.getElementById('overviewContent');
            btn.classList.toggle('active');
            content.classList.toggle('active');
        }

        // Chart defaults
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#e0e0e0', font: { size: 11 } } }
            },
            scales: {
                x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
        };

        const colors = {
            primary: '#00d4aa',
            secondary: '#00b894',
            tertiary: '#0984e3',
            quaternary: '#6c5ce7',
            warning: '#fdcb6e',
            danger: '#ff6b6b'
        };

        // Create charts
        new Chart(document.getElementById('revenueChart'), {
            type: 'bar',
            data: {
                labels: fyData.map(d => d.Period),
                datasets: [{
                    label: 'Revenue (NT$ Billions)',
                    data: fyData.map(d => parseFloat(d.Revenue)),
                    backgroundColor: colors.primary,
                    borderRadius: 6
                }]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('epsChart'), {
            type: 'line',
            data: {
                labels: fyData.map(d => d.Period),
                datasets: [{
                    label: 'EPS (NT$)',
                    data: fyData.map(d => parseFloat(d.EPS)),
                    borderColor: colors.primary,
                    backgroundColor: 'rgba(0, 212, 170, 0.1)',
                    tension: 0.3,
                    fill: true,
                    borderWidth: 3
                }]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('marginsChart'), {
            type: 'line',
            data: {
                labels: fyData.map(d => d.Period),
                datasets: [
                    {
                        label: 'Gross Margin (%)',
                        data: fyData.map(d => parseFloat(d.GrossMargin)),
                        borderColor: colors.primary,
                        tension: 0.3,
                        borderWidth: 2
                    },
                    {
                        label: 'Operating Margin (%)',
                        data: fyData.map(d => parseFloat(d.OperatingMargin)),
                        borderColor: colors.tertiary,
                        tension: 0.3,
                        borderWidth: 2
                    },
                    {
                        label: 'Net Margin (%)',
                        data: fyData.map(d => parseFloat(d.NetMargin)),
                        borderColor: colors.quaternary,
                        tension: 0.3,
                        borderWidth: 2
                    }
                ]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('fcfChart'), {
            type: 'bar',
            data: {
                labels: fyData.map(d => d.Period),
                datasets: [
                    {
                        label: 'Free Cash Flow',
                        data: fyData.map(d => parseFloat(d.FreeCashFlow)),
                        backgroundColor: colors.primary,
                        borderRadius: 6
                    },
                    {
                        label: 'CapEx',
                        data: fyData.map(d => -parseFloat(d.CapEx)),
                        backgroundColor: colors.danger,
                        borderRadius: 6
                    }
                ]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('ocfChart'), {
            type: 'line',
            data: {
                labels: fyData.map(d => d.Period),
                datasets: [{
                    label: 'Operating Cash Flow (NT$ Billions)',
                    data: fyData.map(d => parseFloat(d.OperatingCashFlow)),
                    borderColor: colors.primary,
                    backgroundColor: 'rgba(0, 212, 170, 0.1)',
                    tension: 0.3,
                    fill: true,
                    borderWidth: 3
                }]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('rndChart'), {
            type: 'bar',
            data: {
                labels: fyData.filter(d => d.RnDExpense).map(d => d.Period),
                datasets: [{
                    label: 'R&D Expense (NT$ Billions)',
                    data: fyData.filter(d => d.RnDExpense).map(d => parseFloat(d.RnDExpense)),
                    backgroundColor: colors.tertiary,
                    borderRadius: 6
                }]
            },
            options: chartDefaults
        });

        // Metric descriptions for help modals
        const metricDescriptions = {
            revenue: {
                title: "Revenue",
                content: `
                    <p><strong>Revenue</strong> represents the total income from TSMC's semiconductor manufacturing services.</p>
                    <div class="metric-highlight">
                        <strong>For TSMC:</strong> Revenue is primarily driven by wafer fabrication (87%), with growing contributions from advanced packaging services like CoWoS (8%). TSMC reports in New Taiwan Dollars (NT$) but most sales are priced in USD.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li><strong>Platform Mix:</strong> HPC revenue grew from 41% (2022) to 51% (2024) to 58% (2025). Shift to HPC/AI is very positive for margins and growth.</li>
                        <li><strong>Technology Node Mix:</strong> Advanced nodes (7nm and below) now 69% of revenue. Higher mix = better margins and pricing power.</li>
                        <li><strong>Customer Concentration:</strong> Apple ~22%, NVIDIA ~12%, Top 10 = 76%. Monitor quarterly customer trends.</li>
                        <li><strong>Currency Impact:</strong> NT$ strength vs USD reduces reported revenue. Every 1% NT$ appreciation = ~1% revenue headwind.</li>
                    </ul>
                `
            },
            eps: {
                title: "Earnings Per Share (EPS)",
                content: `
                    <p><strong>EPS</strong> measures net income divided by shares outstanding. It's the bottom-line profitability metric.</p>
                    <div class="metric-highlight">
                        <strong>For TSMC:</strong> EPS reported in NT$ per ordinary share. On NYSE, TSM is an ADR (1 ADR = 5 ordinary shares), so ADR EPS is 5x the ordinary share EPS. FY2024 EPS of NT$44.68 = ~$8.94 ADR EPS.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li><strong>EPS Growth Rate:</strong> 5-year CAGR of 26.8% reflects strong operational leverage. Management guiding for continued double-digit growth.</li>
                        <li><strong>Margin Expansion:</strong> EPS growth faster than revenue growth = margin expansion. Look for gross margins sustained at 63-65%.</li>
                        <li><strong>Share Buybacks:</strong> TSMC historically stable share count (~25.9B shares). Future buybacks would be EPS accretive.</li>
                        <li><strong>Currency Impact:</strong> NT$ strength reduces USD-denominated earnings when translated back to NT$.</li>
                    </ul>
                `
            },
            margins: {
                title: "Profit Margins",
                content: `
                    <p><strong>Margins</strong> show what percentage of revenue becomes profit at different stages of the income statement.</p>
                    <div class="metric-highlight">
                        <strong>For TSMC:</strong> Semiconductor foundries have high fixed costs (fabs, equipment), so margins are very sensitive to utilization and product mix.
                    </div>
                    <p><strong>Key Margins:</strong></p>
                    <ul>
                        <li><strong>Gross Margin (56.1% in FY2024):</strong> Revenue minus cost of goods sold. Reflects manufacturing efficiency, pricing power, and technology mix. TSMC's 63-65% target for 2026 is industry-leading.</li>
                        <li><strong>Operating Margin (45.7% in FY2024):</strong> Gross profit minus R&D and SG&A. TSMC's R&D spending (~7% of revenue) is massive in absolute terms but declining as % of revenue due to scale.</li>
                        <li><strong>Net Margin (40.0% in FY2024):</strong> Final profit after taxes. TSMC's 40% net margin is exceptional for a capital-intensive manufacturer.</li>
                    </ul>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li><strong>Advanced Node Mix:</strong> 3nm/5nm chips have 55-65% gross margins vs. 30-40% for mature nodes. Mix shift to advanced = margin expansion.</li>
                        <li><strong>Utilization Rates:</strong> High fixed costs mean underutilization = margin compression. Monitor fab utilization in earnings calls.</li>
                        <li><strong>Geographic Mix:</strong> Overseas fabs (Arizona, Germany) reportedly have 30-40% higher costs initially. Watch for margin dilution as these ramp.</li>
                        <li><strong>Pricing Power:</strong> TSMC's technology lead enables premium pricing. Any pricing pressure from Samsung/Intel would compress margins.</li>
                    </ul>
                `
            },
            fcf: {
                title: "Free Cash Flow & CapEx",
                content: `
                    <p><strong>Free Cash Flow (FCF)</strong> is Operating Cash Flow minus Capital Expenditures. It's the cash available for dividends, buybacks, or debt reduction.</p>
                    <div class="metric-highlight">
                        <strong>For TSMC:</strong> FCF is critical for evaluating investment returns. TSMC is extremely capital-intensive - annual capex of $50-56B dwarfs most companies' entire revenue.
                    </div>
                    <p><strong>FY2024 FCF:</strong> NT$870B ($27.2B USD) despite NT$956B capex. This represents 30% FCF margin.</p>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li><strong>CapEx Cycle:</strong> TSMC guiding for $52-56B capex in 2026 (70-80% for advanced nodes). Elevated capex depresses FCF short-term but drives future growth.</li>
                        <li><strong>FCF Margin:</strong> Target 28-38% depending on scenario. Higher margins = better ROIC despite massive capex.</li>
                        <li><strong>FCF vs Earnings:</strong> TSMC's depreciation is massive (~NT$500B annually). FCF closer to true economic earnings than net income.</li>
                        <li><strong>Investment Efficiency:</strong> Each $1 of capex should generate ~$0.40-0.50 of incremental revenue at maturity. Monitor revenue/capex ratios over multi-year periods.</li>
                        <li><strong>Government Subsidies:</strong> U.S. CHIPS Act ($6.6B), European Chips Act, Japan subsidies reduce net capex burden by $10B+ over time.</li>
                    </ul>
                `
            },
            ocf: {
                title: "Operating Cash Flow",
                content: `
                    <p><strong>Operating Cash Flow (OCF)</strong> is cash generated from core business operations before capital expenditures.</p>
                    <div class="metric-highlight">
                        <strong>For TSMC:</strong> OCF shows the raw cash-generating power of the business. FY2024 OCF of NT$1,826B ($57B USD) represents 63% of revenue - exceptional for manufacturing.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li><strong>OCF Growth vs Revenue Growth:</strong> OCF growing faster than revenue = improving cash conversion. Look for operating leverage.</li>
                        <li><strong>OCF as % of Revenue:</strong> TSMC's 63% OCF/revenue ratio reflects high margins and efficient working capital management. Industry-leading.</li>
                        <li><strong>Working Capital Changes:</strong> Receivables, inventory, and payables changes can materially impact OCF quarter-to-quarter. Focus on annual trends.</li>
                        <li><strong>OCF vs Net Income:</strong> OCF should exceed net income due to depreciation add-back. If OCF < net income, may indicate working capital issues or aggressive accounting.</li>
                        <li><strong>CapEx Coverage:</strong> OCF must exceed capex for positive FCF. TSMC's OCF of NT$1,826B vs capex NT$956B = healthy 1.9x coverage in FY2024.</li>
                    </ul>
                `
            },
            rnd: {
                title: "R&D Investment",
                content: `
                    <p><strong>R&D Expense</strong> represents investment in developing next-generation semiconductor technologies.</p>
                    <div class="metric-highlight">
                        <strong>For TSMC:</strong> R&D is critical for maintaining 2-3 year technology lead over Samsung/Intel. FY2024 R&D of NT$204B ($6.4B USD) is ~7% of revenue.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li><strong>Absolute R&D Spending:</strong> TSMC's $6-7B annual R&D dwarfs competitors. Samsung ~$5B, Intel Foundry ~$3-4B. Scale advantage in technology development.</li>
                        <li><strong>R&D as % of Revenue:</strong> Declining from 9.4% (FY2019) to 7.1% (FY2024) due to operating leverage. More revenue spreading fixed R&D costs.</li>
                        <li><strong>Technology Roadmap:</strong> R&D funds development of N2 (2nm), N2P, A16 (1.6nm), and future nodes. Also CoWoS advanced packaging, GAA transistors, backside power delivery.</li>
                        <li><strong>Competitive Positioning:</strong> TSMC's R&D efficiency (revenue per R&D dollar) is 14:1 vs Samsung's 8:1. Better execution and higher yields from R&D investment.</li>
                        <li><strong>Customer Co-Development:</strong> TSMC co-develops with Apple, NVIDIA, AMD. Customer input improves R&D ROI and deepens switching costs.</li>
                    </ul>
                `
            }
        };

        // Modal functions
        function openModal(key) {
            document.getElementById('modalTitle').textContent = metricDescriptions[key].title;
            document.getElementById('modalBody').innerHTML = metricDescriptions[key].content;
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay') && !event.target.classList.contains('modal-close')) return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // DCF Functions
        let currentScenario = 'base';

        function initDCF() {
            if (!dcfData || !dcfData.valuation) return;

            document.getElementById('dcfCurrent').textContent = '$' + dcfData.current_price.toFixed(0);

            if (dcfData.historical_growth.growth_divergence_warning) {
                document.getElementById('growthWarning').style.display = 'flex';
                document.getElementById('warningText').textContent = dcfData.historical_growth.growth_divergence_warning;
            }

            const base = dcfData.assumptions.base;
            document.getElementById('growthSlider').value = dcfData.historical_growth.selected_growth_rate;
            document.getElementById('waccSlider').value = base.wacc;
            document.getElementById('terminalSlider').value = base.terminal_growth;

            document.getElementById('growthValue').textContent = dcfData.historical_growth.selected_growth_rate + '%';
            document.getElementById('waccValue').textContent = base.wacc + '%';
            document.getElementById('terminalValue').textContent = base.terminal_growth + '%';

            document.getElementById('growthHint').textContent = 'Based on ' + dcfData.historical_growth.growth_rate_source.replace(/_/g, ' ');

            renderDCFInputs();
            renderHistoricalGrowth();
            renderSensitivityMatrix();
            updateDCFDisplay();
            switchScenario('base');
        }

        function renderDCFInputs() {
            const inputs = dcfData.inputs;
            const formatNum = (n) => {
                if (Math.abs(n) >= 1000) return '$' + (n/1000).toFixed(1) + 'B';
                return '$' + n.toFixed(0) + 'M';
            };

            document.getElementById('baseFCF').textContent = formatNum(inputs.last_fcf);

            const shares = inputs.shares_outstanding_adr;
            document.getElementById('sharesOut').textContent = (shares/1000).toFixed(2) + 'B ADRs';

            const netDebt = inputs.net_debt;
            const netDebtEl = document.getElementById('netDebt');
            netDebtEl.textContent = (netDebt < 0 ? '-' : '') + formatNum(Math.abs(netDebt));
            if (netDebt < 0) netDebtEl.style.color = '#00d4aa';

            renderFCFProjections();
        }

        function renderFCFProjections() {
            const growth = parseFloat(document.getElementById('growthSlider')?.value || dcfData.historical_growth.selected_growth_rate);
            const baseFCF = dcfData.inputs.last_fcf;

            const formatFCF = (n) => {
                if (Math.abs(n) >= 1000) return '$' + (n/1000).toFixed(1) + 'B';
                return '$' + n.toFixed(0) + 'M';
            };

            let html = `
                <div class="fcf-projection-item header">Base</div>
                <div class="fcf-projection-item header">Year 1</div>
                <div class="fcf-projection-item header">Year 2</div>
                <div class="fcf-projection-item header">Year 3</div>
                <div class="fcf-projection-item header">Year 4</div>
                <div class="fcf-projection-item header">Year 5</div>
            `;

            let fcf = baseFCF;
            const fcfValues = [baseFCF];
            const growthRates = dcfData.assumptions[currentScenario]?.growth_rates || [growth, growth, growth, growth, growth];

            for (let i = 0; i < 5; i++) {
                fcf = fcf * (1 + growthRates[i] / 100);
                fcfValues.push(fcf);
            }

            html += `<div class="fcf-projection-item">
                <div class="fcf-value">${formatFCF(fcfValues[0])}</div>
                <div class="growth-rate">-</div>
            </div>`;

            for (let i = 1; i <= 5; i++) {
                html += `<div class="fcf-projection-item">
                    <div class="fcf-value">${formatFCF(fcfValues[i])}</div>
                    <div class="growth-rate">+${growthRates[i-1]}%</div>
                </div>`;
            }

            document.getElementById('fcfProjectionTable').innerHTML = html;
        }

        function calculateDCF(growthRate, wacc, terminalGrowth) {
            const years = 5;
            const fcf = dcfData.inputs.last_fcf;
            let pvFCF = 0;
            let projectedFCF = fcf;

            for (let i = 0; i < years; i++) {
                projectedFCF *= (1 + growthRate / 100);
                pvFCF += projectedFCF / Math.pow(1 + wacc/100, i + 1);
            }

            const terminalFCF = projectedFCF * (1 + terminalGrowth/100);
            const terminalValue = terminalFCF / (wacc/100 - terminalGrowth/100);
            const pvTerminal = terminalValue / Math.pow(1 + wacc/100, years);

            const enterpriseValue = pvFCF + pvTerminal;
            const equityValue = enterpriseValue - dcfData.inputs.net_debt;
            const iv = equityValue / dcfData.inputs.shares_outstanding_adr;

            const terminalPerShare = terminalValue / dcfData.inputs.shares_outstanding_adr;
            const entryPrice = terminalPerShare / Math.pow(1.15, years);

            return { iv, entryPrice, terminalPerShare, pvFCF, pvTerminal, enterpriseValue };
        }

        window.updateDCFDisplay = function() {
            const growth = parseFloat(document.getElementById('growthSlider').value);
            const wacc = parseFloat(document.getElementById('waccSlider').value);
            const terminal = parseFloat(document.getElementById('terminalSlider').value);

            document.getElementById('growthValue').textContent = growth + '%';
            document.getElementById('waccValue').textContent = wacc + '%';
            document.getElementById('terminalValue').textContent = terminal + '%';

            const result = calculateDCF(growth, wacc, terminal);

            document.getElementById('dcfIV').textContent = '$' + result.iv.toFixed(0);
            document.getElementById('dcfEntry').textContent = '$' + result.entryPrice.toFixed(0);

            const upside = ((result.iv - dcfData.current_price) / dcfData.current_price * 100);
            const upsideEl = document.getElementById('dcfUpside');
            upsideEl.textContent = (upside >= 0 ? '+' : '') + upside.toFixed(0) + '% ' + (upside >= 0 ? 'upside' : 'downside');
            upsideEl.className = 'dcf-change ' + (upside >= 0 ? 'positive' : 'negative');

            document.getElementById('dcfWeighted').textContent = '$' + dcfData.probability_weighted.weighted_iv.toFixed(0);

            const grid = document.getElementById('assumptionGrid');
            if (grid) {
                grid.innerHTML = `
                    <div class="assumption-item">
                        <div class="label">Growth Rate</div>
                        <div class="value">${growth}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">WACC</div>
                        <div class="value">${wacc}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Terminal Growth</div>
                        <div class="value">${terminal}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Intrinsic Value</div>
                        <div class="value" style="color: #00d4aa;">$${result.iv.toFixed(0)}</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Entry Price</div>
                        <div class="value" style="color: #00d4aa;">$${result.entryPrice.toFixed(0)}</div>
                    </div>
                `;
            }

            renderFCFProjections();
        };

        window.switchScenario = function(scenario) {
            currentScenario = scenario;

            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === scenario);
            });

            const assumptions = dcfData.assumptions[scenario];
            const valuation = dcfData.valuation[scenario];

            document.getElementById('growthSlider').value = assumptions.growth_rates[0];
            document.getElementById('waccSlider').value = assumptions.wacc;
            document.getElementById('terminalSlider').value = assumptions.terminal_growth;

            const grid = document.getElementById('assumptionGrid');
            grid.innerHTML = `
                <div class="assumption-item">
                    <div class="label">Year 1 Growth</div>
                    <div class="value">${assumptions.growth_rates[0]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Year 5 Growth</div>
                    <div class="value">${assumptions.growth_rates[4]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">FCF Margin</div>
                    <div class="value">${assumptions.fcf_margin}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">WACC</div>
                    <div class="value">${assumptions.wacc}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Terminal Growth</div>
                    <div class="value">${assumptions.terminal_growth}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Intrinsic Value</div>
                    <div class="value" style="color: #00d4aa;">$${valuation.intrinsic_value.toFixed(0)}</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Description</div>
                    <div class="value" style="font-size: 0.85rem; color: #aaa;">${assumptions.description}</div>
                </div>
            `;

            updateDCFDisplay();
        };

        function renderHistoricalGrowth() {
            const growth = dcfData.historical_growth;
            const selectedSource = growth.growth_rate_source;
            const grid = document.getElementById('growthGrid');

            const metrics = [
                { key: 'revenue_3yr_cagr', label: 'Revenue 3Y' },
                { key: 'revenue_5yr_cagr', label: 'Revenue 5Y' },
                { key: 'revenue_10yr_cagr', label: 'Revenue 10Y' },
                { key: 'eps_3yr_cagr', label: 'EPS 3Y' },
                { key: 'eps_5yr_cagr', label: 'EPS 5Y' },
                { key: 'eps_10yr_cagr', label: 'EPS 10Y' },
                { key: 'fcf_3yr_cagr', label: 'FCF 3Y' },
                { key: 'fcf_5yr_cagr', label: 'FCF 5Y' }
            ];

            grid.innerHTML = metrics.map(m => {
                const rate = growth[m.key];
                const isSelected = m.key === selectedSource;
                const colorClass = rate >= 0 ? 'positive' : 'negative';
                return `
                    <div class="growth-item ${isSelected ? 'selected' : ''}">
                        <div class="metric">${m.label}</div>
                        <div class="rate ${colorClass}">${rate >= 0 ? '+' : ''}${rate.toFixed(1)}%</div>
                    </div>
                `;
            }).join('');
        }

        function renderSensitivityMatrix() {
            const sens = dcfData.sensitivity;
            const table = document.getElementById('sensitivityMatrix');
            const currentPrice = dcfData.current_price;

            let html = '<tr><th>WACC \\ Term G</th>';
            sens.terminal_growth_range.forEach(tg => {
                html += `<th>${tg}%</th>`;
            });
            html += '</tr>';

            sens.wacc_range.forEach((wacc, i) => {
                html += `<tr><th>${wacc}%</th>`;
                sens.matrix[i].forEach((val, j) => {
                    const isHighlight = wacc === dcfData.assumptions.base.wacc &&
                                       sens.terminal_growth_range[j] === dcfData.assumptions.base.terminal_growth;
                    const colorClass = val >= currentPrice ? 'above-current' : 'below-current';
                    html += `<td class="${isHighlight ? 'highlight' : colorClass}">$${val.toFixed(0)}</td>`;
                });
                html += '</tr>';
            });

            table.innerHTML = html;
        }

        // Initialize
        renderKPIs();
        renderGuidance();
        initDCF();

        // Bind slider events
        (function() {
            var growthSlider = document.getElementById('growthSlider');
            var waccSlider = document.getElementById('waccSlider');
            var terminalSlider = document.getElementById('terminalSlider');

            if (growthSlider) {
                growthSlider.oninput = window.updateDCFDisplay;
                growthSlider.onchange = window.updateDCFDisplay;
            }
            if (waccSlider) {
                waccSlider.oninput = window.updateDCFDisplay;
                waccSlider.onchange = window.updateDCFDisplay;
            }
            if (terminalSlider) {
                terminalSlider.oninput = window.updateDCFDisplay;
                terminalSlider.onchange = window.updateDCFDisplay;
            }
        })();
    </script>
</body>
</html>
