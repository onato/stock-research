<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNG.V - Kraken Robotics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        header .subtitle {
            color: #888;
            font-size: 1.1rem;
        }

        header .price-info {
            margin-top: 15px;
            font-size: 1.8rem;
            color: #00d4ff;
        }

        header .price-info .change {
            font-size: 1rem;
            margin-left: 10px;
        }

        header .price-info .positive { color: #10b981; }
        header .price-info .negative { color: #ef4444; }

        .section-title {
            font-size: 1.5rem;
            margin: 30px 0 20px 0;
            color: #fff;
            border-bottom: 2px solid rgba(124, 58, 237, 0.5);
            padding-bottom: 10px;
        }

        .overview-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .overview-section p {
            line-height: 1.7;
            color: #ccc;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .overview-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .overview-card h4 {
            color: #7c3aed;
            margin-bottom: 10px;
        }

        .overview-card ul {
            list-style: none;
            padding-left: 0;
        }

        .overview-card li {
            padding: 5px 0;
            color: #aaa;
            font-size: 0.9rem;
        }

        .overview-card li::before {
            content: "‚Ä¢";
            color: #00d4ff;
            margin-right: 8px;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 212, 255, 0.2);
        }

        .kpi-card .help-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(124, 58, 237, 0.3);
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .kpi-card .label {
            color: #888;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .kpi-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #fff;
        }

        .kpi-card .change {
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .kpi-card .change.positive { color: #10b981; }
        .kpi-card .change.negative { color: #ef4444; }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-card h3 {
            color: #fff;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .dcf-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dcf-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 10px;
        }

        .control-group label {
            display: block;
            color: #888;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-group .value-display {
            color: #00d4ff;
            font-weight: 600;
        }

        .dcf-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .dcf-result-card {
            background: rgba(124, 58, 237, 0.1);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(124, 58, 237, 0.3);
        }

        .dcf-result-card.highlight {
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.3);
        }

        .dcf-result-card .label {
            color: #888;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }

        .dcf-result-card .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
        }

        .dcf-result-card .value.upside { color: #10b981; }
        .dcf-result-card .value.downside { color: #ef4444; }

        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .scenario-tab {
            padding: 10px 25px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
        }

        .scenario-tab.active {
            background: rgba(124, 58, 237, 0.3);
            border-color: #7c3aed;
            color: #fff;
        }

        .sensitivity-matrix {
            overflow-x: auto;
            margin-top: 20px;
        }

        .sensitivity-matrix table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .sensitivity-matrix th, .sensitivity-matrix td {
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sensitivity-matrix th {
            background: rgba(124, 58, 237, 0.2);
            color: #fff;
        }

        .sensitivity-matrix td {
            background: rgba(255, 255, 255, 0.02);
        }

        .sensitivity-matrix .upside { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .sensitivity-matrix .downside { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .sensitivity-matrix .current { background: rgba(0, 212, 255, 0.2); color: #00d4ff; font-weight: bold; }

        .bull-bear-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .bull-bear-section {
                grid-template-columns: 1fr;
            }
        }

        .case-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .case-card.bull {
            border-left: 4px solid #10b981;
        }

        .case-card.bear {
            border-left: 4px solid #ef4444;
        }

        .case-card h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .case-card.bull h3 { color: #10b981; }
        .case-card.bear h3 { color: #ef4444; }

        .case-card p {
            color: #aaa;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .case-card ul {
            list-style: none;
            padding: 0;
        }

        .case-card li {
            padding: 8px 0;
            color: #ccc;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .risks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .risk-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .risk-card h4 {
            color: #f59e0b;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .risk-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .risk-severity {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .risk-severity.high { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .risk-severity.moderate { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .risk-severity.low { background: rgba(16, 185, 129, 0.2); color: #10b981; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-content h3 {
            color: #00d4ff;
            margin-bottom: 15px;
        }

        .modal-content p {
            color: #ccc;
            line-height: 1.6;
        }

        .modal-close {
            float: right;
            background: none;
            border: none;
            color: #888;
            font-size: 1.5rem;
            cursor: pointer;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.85rem;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PNG.V - Kraken Robotics Inc.</h1>
            <div class="subtitle">Marine Technology | TSXV | Last Updated: January 21, 2026</div>
            <div class="price-info">
                C$8.00 <span class="change positive">+285% YTD</span>
            </div>
        </header>

        <!-- Investment Overview Section -->
        <h2 class="section-title">Investment Overview</h2>
        <div class="overview-section">
            <p id="company-overview"></p>
            <div class="overview-grid">
                <div class="overview-card">
                    <h4>Business Model</h4>
                    <ul id="business-model-list"></ul>
                </div>
                <div class="overview-card">
                    <h4>Key Products</h4>
                    <ul id="products-list"></ul>
                </div>
                <div class="overview-card">
                    <h4>Growth Drivers</h4>
                    <ul id="growth-drivers-list"></ul>
                </div>
                <div class="overview-card">
                    <h4>Competitive Position</h4>
                    <ul id="moat-list"></ul>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <h2 class="section-title">Key Performance Indicators (LTM / Q3 2025)</h2>
        <div class="kpi-grid">
            <div class="kpi-card">
                <button class="help-btn" onclick="showHelp('revenue')">?</button>
                <div class="label">Revenue (LTM)</div>
                <div class="value">C$109.6M</div>
                <div class="change positive">+37% YoY</div>
            </div>
            <div class="kpi-card">
                <button class="help-btn" onclick="showHelp('grossMargin')">?</button>
                <div class="label">Gross Margin</div>
                <div class="value">59%</div>
                <div class="change positive">+7pp YoY</div>
            </div>
            <div class="kpi-card">
                <button class="help-btn" onclick="showHelp('ebitda')">?</button>
                <div class="label">Adj. EBITDA (LTM)</div>
                <div class="value">C$22.5M</div>
                <div class="change positive">+60% YoY</div>
            </div>
            <div class="kpi-card">
                <button class="help-btn" onclick="showHelp('ebitdaMargin')">?</button>
                <div class="label">EBITDA Margin</div>
                <div class="value">20.5%</div>
                <div class="change positive">+3pp YoY</div>
            </div>
            <div class="kpi-card">
                <button class="help-btn" onclick="showHelp('netIncome')">?</button>
                <div class="label">Net Income (LTM)</div>
                <div class="value">C$16.5M</div>
                <div class="change positive">+145% YoY</div>
            </div>
            <div class="kpi-card">
                <button class="help-btn" onclick="showHelp('cash')">?</button>
                <div class="label">Cash Position</div>
                <div class="value">C$126.6M</div>
                <div class="change positive">+749% YoY</div>
            </div>
            <div class="kpi-card">
                <button class="help-btn" onclick="showHelp('productRevenue')">?</button>
                <div class="label">Product Revenue</div>
                <div class="value">C$44.0M</div>
                <div class="change negative">-8% YoY</div>
            </div>
            <div class="kpi-card">
                <button class="help-btn" onclick="showHelp('serviceRevenue')">?</button>
                <div class="label">Service Revenue</div>
                <div class="value">C$29.9M</div>
                <div class="change positive">+93% YoY</div>
            </div>
            <div class="kpi-card">
                <button class="help-btn" onclick="showHelp('employees')">?</button>
                <div class="label">Employees</div>
                <div class="value">421</div>
                <div class="change positive">+55% YoY</div>
            </div>
        </div>

        <!-- Charts Section -->
        <h2 class="section-title">Financial Performance</h2>
        <div class="charts-grid">
            <div class="chart-card">
                <h3>Revenue Growth (Annual)</h3>
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>Revenue Mix: Products vs Services</h3>
                <div class="chart-container">
                    <canvas id="revenueMixChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>Profitability Trend</h3>
                <div class="chart-container">
                    <canvas id="profitChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>Margin Expansion</h3>
                <div class="chart-container">
                    <canvas id="marginChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Bull/Bear Cases -->
        <h2 class="section-title">Investment Thesis</h2>
        <div class="bull-bear-section">
            <div class="case-card bull">
                <h3>üêÇ Bull Case</h3>
                <p id="bull-summary"></p>
                <ul id="bull-points"></ul>
            </div>
            <div class="case-card bear">
                <h3>üêª Bear Case</h3>
                <p id="bear-summary"></p>
                <ul id="bear-points"></ul>
            </div>
        </div>

        <!-- Key Risks -->
        <h2 class="section-title">Key Risks</h2>
        <div class="risks-grid" id="risks-container"></div>

        <!-- DCF Valuation Section -->
        <h2 class="section-title">DCF Valuation Model</h2>
        <div class="dcf-section">
            <div class="scenario-tabs">
                <button class="scenario-tab" onclick="setScenario('bear')">Bear</button>
                <button class="scenario-tab active" onclick="setScenario('base')">Base</button>
                <button class="scenario-tab" onclick="setScenario('bull')">Bull</button>
            </div>

            <div class="dcf-controls">
                <div class="control-group">
                    <label>Revenue Growth Year 1 (%)</label>
                    <input type="range" id="growthRate" min="10" max="50" value="35" oninput="updateDCF()">
                    <span class="value-display" id="growthDisplay">35%</span>
                </div>
                <div class="control-group">
                    <label>WACC (%)</label>
                    <input type="range" id="wacc" min="8" max="16" value="12" step="0.5" oninput="updateDCF()">
                    <span class="value-display" id="waccDisplay">12%</span>
                </div>
                <div class="control-group">
                    <label>Terminal Growth (%)</label>
                    <input type="range" id="terminalGrowth" min="1" max="5" value="3" step="0.5" oninput="updateDCF()">
                    <span class="value-display" id="terminalDisplay">3%</span>
                </div>
                <div class="control-group">
                    <label>Terminal FCF Margin (%)</label>
                    <input type="range" id="fcfMargin" min="5" max="20" value="14" oninput="updateDCF()">
                    <span class="value-display" id="fcfDisplay">14%</span>
                </div>
            </div>

            <div class="dcf-results">
                <div class="dcf-result-card">
                    <div class="label">Current Price</div>
                    <div class="value">C$8.00</div>
                </div>
                <div class="dcf-result-card highlight">
                    <div class="label">Intrinsic Value</div>
                    <div class="value" id="intrinsicValue">C$7.85</div>
                </div>
                <div class="dcf-result-card">
                    <div class="label">Upside/Downside</div>
                    <div class="value" id="upsideValue">-1.9%</div>
                </div>
                <div class="dcf-result-card">
                    <div class="label">Entry Price (15% IRR)</div>
                    <div class="value" id="entryPrice">C$3.90</div>
                </div>
            </div>

            <h3 style="color: #fff; margin: 25px 0 15px 0;">Sensitivity Analysis</h3>
            <div class="sensitivity-matrix">
                <table>
                    <thead>
                        <tr>
                            <th>WACC \ Terminal Growth</th>
                            <th>2.0%</th>
                            <th>2.5%</th>
                            <th>3.0%</th>
                            <th>3.5%</th>
                            <th>4.0%</th>
                        </tr>
                    </thead>
                    <tbody id="sensitivityBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Metrics to Watch -->
        <h2 class="section-title">Key Metrics to Watch</h2>
        <div class="overview-section">
            <ul id="metrics-to-watch" style="list-style: none; padding: 0; columns: 2; column-gap: 40px;"></ul>
        </div>

        <footer>
            Dashboard generated on January 21, 2026 | Data from Kraken Robotics MD&A filings | Not investment advice
        </footer>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeHelp()">&times;</button>
            <h3 id="helpTitle"></h3>
            <p id="helpText"></p>
        </div>
    </div>

    <script>
        // Embedded CSV Data
        const csvData = `Period,Revenue,ProductRevenue,ServiceRevenue,CostOfSales,GrossProfit,GrossMargin,AdminExpenses,RDExpenses,DepreciationAmortization,ShareBasedComp,OperatingIncome,NetIncome,AdjustedEBITDA,AdjustedEBITDAMargin,EPS,TotalAssets,TotalCurrentAssets,TotalCurrentLiabilities,TotalLiabilities,ShareholdersEquity,Cash,WorkingCapital,Employees
FY2020,12275,,,6452,5823,47.4,7963,1203,1104,653,-4451,-5212,-2694,,,-0.03,34820,25115,14696,18809,16011,12925,10419,132
FY2021,25629,22151,3478,14310,11319,44.2,8271,2310,2914,433,-2015,-3537,2148,8.4,-0.02,65465,31724,25360,37863,27602,6754,6364,225
FY2022,40908,24900,16008,23871,17037,41.6,12364,1262,4781,797,-1533,-4243,5292,12.9,-0.02,71365,37827,39862,47710,23655,8265,-2035,211
FY2023,69581,52618,16963,35625,33956,48.8,17528,4487,4940,378,4887,5546,14094,20.3,0.03,76419,44075,40461,44360,32059,5173,3614,244
FY2024,91292,66313,24979,46600,44692,48.9,20037,6233,5726,948,13815,20089,20711,22.7,0.09,162613,117772,23356,40878,121735,58518,94416,283
Q3 2025,31298,18258,13040,12719,18579,59.4,9142,2367,2404,646,4290,3290,7979,25.5,0.01,301543,213041,29164,65692,235851,126626,183877,421`;

        // Embedded Analysis Data
        const analysisData = {
            "overview": "Kraken Robotics is a marine technology company providing ultra-high-resolution sensors, subsea power systems, and underwater robotics equipment and services for defense and commercial markets. The company specializes in Synthetic Aperture Sonar (SAS) technology, SeaPower subsea batteries for unmanned underwater vehicles (UUVs), and Robotics-as-a-Service offerings including sub-seabed imaging solutions. Kraken operates globally with facilities in Canada, US, UK, Germany, Denmark, and Brazil, serving government defense agencies and offshore energy customers.",
            "business_model": [
                "Products (60% rev): SeaPower batteries, SAS sensors, KATFISH systems, RMDS",
                "Services (40% rev): Robotics-as-a-Service - Sub-Bottom Imager, LiDAR surveys",
                "Dual revenue model with high-margin RaaS growing fastest"
            ],
            "products": [
                "SeaPower subsea batteries (200% energy density advantage)",
                "Synthetic Aperture Sonar (SAS) sensors",
                "KATFISH towed sonar systems",
                "Sub-Bottom Imager & Acoustic Corer",
                "3D at Depth LiDAR systems"
            ],
            "growth_drivers": [
                "UUV market growth: $3.77B (2025) to $46.62B by 2035",
                "SeaPower battery demand surge - $35M orders Jan 2026",
                "NATO defense spending increases driving procurement",
                "3D at Depth acquisition expanding LiDAR services",
                "Nova Scotia manufacturing facility opening Q1 2026"
            ],
            "moat_factors": [
                "Proprietary battery tech: 200% greater energy density",
                "US Navy/NATO compliance certifications",
                "Integrated sensor + power + RaaS solutions",
                "First-mover in UUV battery market",
                "Established defense relationships"
            ],
            "bull_case": {
                "summary": "Kraken is exceptionally well-positioned in the rapidly growing UUV/subsea battery market with proprietary technology and defense relationships. $35M battery order validates technology leadership and demonstrates demand inflection point.",
                "points": [
                    "Massive TAM expansion - UUV market 25% CAGR to $46.62B by 2035",
                    "Battery tech leadership with 200% energy density advantage",
                    "$35M battery orders in single announcement exceeds Q3 revenue",
                    "59% gross margin with 25% EBITDA margin improving",
                    "Strong cash position ($126.6M) funds growth without dilution"
                ]
            },
            "bear_case": {
                "summary": "Valuation has run ahead of fundamentals with $2.67B market cap on just $91M revenue. Extreme customer concentration, government contract dependency, and competitive threats present significant downside risks.",
                "points": [
                    "Trading at ~29x FY2024 revenue - reflects substantial growth optimism",
                    "65% of receivables from just 2 customers - concentration risk",
                    "9M 2025 net income only $2.8M vs $6.4M prior year despite growth",
                    "Competing against defense giants (Teledyne, Kongsberg, Northrop)",
                    "Execution risk on manufacturing scale-up and integration"
                ]
            },
            "risks": [
                {"category": "Business", "risk": "Customer concentration - 65% from 2 customers", "severity": "high"},
                {"category": "Business", "risk": "Government contract dependency and termination risk", "severity": "high"},
                {"category": "Business", "risk": "Competitive bidding uncertainty vs larger contractors", "severity": "moderate"},
                {"category": "Financial", "risk": "Profitability volatility - losses in Q1/Q2 2025", "severity": "moderate"},
                {"category": "Financial", "risk": "Dilution from equity raises ($187M in 2024-25)", "severity": "moderate"},
                {"category": "Execution", "risk": "Manufacturing scale-up for Nova Scotia facility", "severity": "moderate"},
                {"category": "Execution", "risk": "3D at Depth acquisition integration", "severity": "moderate"},
                {"category": "Macro", "risk": "Defense budget shifts if geopolitical tensions ease", "severity": "moderate"}
            ],
            "metrics_to_watch": [
                "SeaPower battery order flow and backlog",
                "Gross margin trend (product mix indicator)",
                "Customer concentration (% from top 2)",
                "Services revenue growth and margin",
                "Operating cash flow conversion",
                "Adjusted EBITDA margin (target 23-25%)",
                "Employee count and productivity",
                "Manufacturing capacity utilization",
                "Large defense contract wins",
                "R&D spend as % of revenue"
            ]
        };

        // Embedded DCF Data
        const dcfData = {
            "current_price": 8.00,
            "shares_outstanding": 306500000,
            "ltm_revenue": 109.6,
            "scenarios": {
                "base": {
                    "growth": 35,
                    "wacc": 12,
                    "terminal": 3,
                    "fcfMargin": 14,
                    "intrinsic": 7.85,
                    "entry": 3.90
                },
                "bull": {
                    "growth": 45,
                    "wacc": 11,
                    "terminal": 3.5,
                    "fcfMargin": 16,
                    "intrinsic": 14.52,
                    "entry": 7.22
                },
                "bear": {
                    "growth": 25,
                    "wacc": 13,
                    "terminal": 2.5,
                    "fcfMargin": 10,
                    "intrinsic": 3.21,
                    "entry": 1.60
                }
            },
            "sensitivity": [
                [10.24, 10.92, 11.89, 12.92, 14.12],
                [8.56, 9.06, 9.72, 10.43, 11.26],
                [7.21, 7.58, 8.02, 8.51, 9.08],
                [6.12, 6.38, 6.69, 7.02, 7.42],
                [5.21, 5.40, 5.61, 5.84, 6.12]
            ]
        };

        // Parse CSV
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const row = {};
                headers.forEach((h, j) => {
                    row[h] = values[j] === '' ? null : isNaN(values[j]) ? values[j] : parseFloat(values[j]);
                });
                data.push(row);
            }
            return data;
        }

        const financialData = parseCSV(csvData);
        const annualData = financialData.filter(d => d.Period.startsWith('FY'));

        // Populate Investment Overview
        document.getElementById('company-overview').textContent = analysisData.overview;

        function populateList(elementId, items) {
            const ul = document.getElementById(elementId);
            items.forEach(item => {
                const li = document.createElement('li');
                li.textContent = typeof item === 'string' ? item : item.text;
                ul.appendChild(li);
            });
        }

        populateList('business-model-list', analysisData.business_model);
        populateList('products-list', analysisData.products);
        populateList('growth-drivers-list', analysisData.growth_drivers);
        populateList('moat-list', analysisData.moat_factors);

        // Bull/Bear Cases
        document.getElementById('bull-summary').textContent = analysisData.bull_case.summary;
        document.getElementById('bear-summary').textContent = analysisData.bear_case.summary;
        populateList('bull-points', analysisData.bull_case.points);
        populateList('bear-points', analysisData.bear_case.points);

        // Risks
        const risksContainer = document.getElementById('risks-container');
        const riskCategories = {};
        analysisData.risks.forEach(r => {
            if (!riskCategories[r.category]) riskCategories[r.category] = [];
            riskCategories[r.category].push(r);
        });

        Object.entries(riskCategories).forEach(([category, risks]) => {
            const card = document.createElement('div');
            card.className = 'risk-card';
            card.innerHTML = `<h4>${category} Risks</h4>`;
            risks.forEach(r => {
                const item = document.createElement('div');
                item.className = 'risk-item';
                item.innerHTML = `<span class="risk-severity ${r.severity}">${r.severity}</span><span>${r.risk}</span>`;
                card.appendChild(item);
            });
            risksContainer.appendChild(card);
        });

        // Metrics to Watch
        const metricsUl = document.getElementById('metrics-to-watch');
        analysisData.metrics_to_watch.forEach(m => {
            const li = document.createElement('li');
            li.innerHTML = `<span style="color: #00d4ff;">‚Ä¢</span> ${m}`;
            li.style.padding = '8px 0';
            li.style.borderBottom = '1px solid rgba(255,255,255,0.05)';
            metricsUl.appendChild(li);
        });

        // Chart Configuration
        Chart.defaults.color = '#888';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';

        // Revenue Chart
        new Chart(document.getElementById('revenueChart'), {
            type: 'bar',
            data: {
                labels: annualData.map(d => d.Period.replace('FY', '')),
                datasets: [{
                    label: 'Revenue (C$M)',
                    data: annualData.map(d => d.Revenue / 1000),
                    backgroundColor: 'rgba(0, 212, 255, 0.7)',
                    borderColor: '#00d4ff',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { callback: v => '$' + v + 'M' }
                    }
                }
            }
        });

        // Revenue Mix Chart
        new Chart(document.getElementById('revenueMixChart'), {
            type: 'bar',
            data: {
                labels: ['2021', '2022', '2023', '2024', '9M 2025'],
                datasets: [
                    {
                        label: 'Product Revenue',
                        data: [22.2, 24.9, 52.6, 66.3, 44.0],
                        backgroundColor: 'rgba(124, 58, 237, 0.7)'
                    },
                    {
                        label: 'Service Revenue',
                        data: [3.5, 16.0, 17.0, 25.0, 29.9],
                        backgroundColor: 'rgba(0, 212, 255, 0.7)'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { stacked: true },
                    y: { stacked: true, ticks: { callback: v => '$' + v + 'M' } }
                }
            }
        });

        // Profitability Chart
        new Chart(document.getElementById('profitChart'), {
            type: 'line',
            data: {
                labels: annualData.map(d => d.Period.replace('FY', '')),
                datasets: [
                    {
                        label: 'Adj. EBITDA',
                        data: annualData.map(d => d.AdjustedEBITDA / 1000),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Net Income',
                        data: annualData.map(d => d.NetIncome / 1000),
                        borderColor: '#7c3aed',
                        backgroundColor: 'rgba(124, 58, 237, 0.1)',
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { ticks: { callback: v => '$' + v + 'M' } }
                }
            }
        });

        // Margin Chart
        new Chart(document.getElementById('marginChart'), {
            type: 'line',
            data: {
                labels: annualData.map(d => d.Period.replace('FY', '')),
                datasets: [
                    {
                        label: 'Gross Margin',
                        data: annualData.map(d => d.GrossMargin),
                        borderColor: '#00d4ff',
                        tension: 0.4
                    },
                    {
                        label: 'EBITDA Margin',
                        data: annualData.map(d => d.AdjustedEBITDAMargin || 0),
                        borderColor: '#10b981',
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        min: 0,
                        max: 60,
                        ticks: { callback: v => v + '%' }
                    }
                }
            }
        });

        // DCF Functions
        let currentScenario = 'base';

        function setScenario(scenario) {
            currentScenario = scenario;
            document.querySelectorAll('.scenario-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            const s = dcfData.scenarios[scenario];
            document.getElementById('growthRate').value = s.growth;
            document.getElementById('wacc').value = s.wacc;
            document.getElementById('terminalGrowth').value = s.terminal;
            document.getElementById('fcfMargin').value = s.fcfMargin;
            updateDCF();
        }

        function updateDCF() {
            const growth = parseFloat(document.getElementById('growthRate').value);
            const wacc = parseFloat(document.getElementById('wacc').value);
            const terminal = parseFloat(document.getElementById('terminalGrowth').value);
            const fcfMargin = parseFloat(document.getElementById('fcfMargin').value);

            document.getElementById('growthDisplay').textContent = growth + '%';
            document.getElementById('waccDisplay').textContent = wacc + '%';
            document.getElementById('terminalDisplay').textContent = terminal + '%';
            document.getElementById('fcfDisplay').textContent = fcfMargin + '%';

            // Simplified DCF calculation
            let revenues = [dcfData.ltm_revenue];
            let growthRates = [growth, growth * 0.85, growth * 0.7, growth * 0.55, growth * 0.4];
            let margins = [fcfMargin * 0.35, fcfMargin * 0.55, fcfMargin * 0.7, fcfMargin * 0.85, fcfMargin];

            for (let i = 0; i < 5; i++) {
                revenues.push(revenues[i] * (1 + growthRates[i] / 100));
            }

            let fcfs = revenues.slice(1).map((r, i) => r * margins[i] / 100);
            let pvFcfs = fcfs.map((f, i) => f / Math.pow(1 + wacc / 100, i + 1));
            let totalPvFcf = pvFcfs.reduce((a, b) => a + b, 0);

            let terminalFcf = fcfs[4] * (1 + terminal / 100);
            let terminalValue = terminalFcf / ((wacc - terminal) / 100);
            let pvTerminal = terminalValue / Math.pow(1 + wacc / 100, 5);

            let enterpriseValue = (totalPvFcf + pvTerminal) * 1000000;
            let netCash = 126600000;
            let equityValue = enterpriseValue + netCash;
            let intrinsicValue = equityValue / dcfData.shares_outstanding;

            let upside = ((intrinsicValue - dcfData.current_price) / dcfData.current_price * 100);
            let entryPrice = intrinsicValue / Math.pow(1.15, 5);

            document.getElementById('intrinsicValue').textContent = 'C$' + intrinsicValue.toFixed(2);
            document.getElementById('upsideValue').textContent = (upside >= 0 ? '+' : '') + upside.toFixed(1) + '%';
            document.getElementById('upsideValue').className = 'value ' + (upside >= 0 ? 'upside' : 'downside');
            document.getElementById('entryPrice').textContent = 'C$' + entryPrice.toFixed(2);
        }

        // Sensitivity Table
        function buildSensitivityTable() {
            const tbody = document.getElementById('sensitivityBody');
            const waccValues = [10, 11, 12, 13, 14];
            const currentPrice = dcfData.current_price;

            waccValues.forEach((wacc, i) => {
                const row = document.createElement('tr');
                row.innerHTML = `<td><strong>${wacc}%</strong></td>`;
                dcfData.sensitivity[i].forEach((val, j) => {
                    const pct = ((val - currentPrice) / currentPrice * 100).toFixed(0);
                    let cls = val > currentPrice ? 'upside' : 'downside';
                    if (wacc === 12 && j === 2) cls = 'current';
                    row.innerHTML += `<td class="${cls}">$${val.toFixed(2)} (${pct > 0 ? '+' : ''}${pct}%)</td>`;
                });
                tbody.appendChild(row);
            });
        }

        buildSensitivityTable();
        updateDCF();

        // Help Modal
        const helpContent = {
            revenue: { title: 'Revenue', text: 'Total revenue from Products (sensors, batteries, systems) and Services (RaaS surveys and imaging). LTM = Last Twelve Months ending Q3 2025.' },
            grossMargin: { title: 'Gross Margin', text: 'Revenue minus Cost of Sales, divided by Revenue. Kraken\'s improving gross margin reflects shift toward higher-margin products (batteries) and services.' },
            ebitda: { title: 'Adjusted EBITDA', text: 'Earnings Before Interest, Taxes, Depreciation, and Amortization, adjusted for non-recurring items. Key profitability metric for growth companies.' },
            ebitdaMargin: { title: 'EBITDA Margin', text: 'Adjusted EBITDA as percentage of Revenue. Target range is 23-25% at scale.' },
            netIncome: { title: 'Net Income', text: 'Bottom-line profit after all expenses, taxes, and interest. Can be volatile due to working capital timing and one-time items.' },
            cash: { title: 'Cash Position', text: 'Cash and cash equivalents. Strong position ($126.6M) following July 2025 equity raise funds growth without near-term dilution needs.' },
            productRevenue: { title: 'Product Revenue', text: 'Revenue from sales of SeaPower batteries, SAS sensors, KATFISH systems, and RMDS. YTD 2025 down vs prior year due to RMDS completion timing.' },
            serviceRevenue: { title: 'Service Revenue', text: 'Revenue from Robotics-as-a-Service: Sub-Bottom Imager, Acoustic Corer, LiDAR surveys. Fastest growing segment at 93% YoY, driven by 3D at Depth acquisition.' },
            employees: { title: 'Employees', text: 'Total headcount increased 55% YoY to 421 employees as of Q3 2025, driven by 3D at Depth acquisition and organic growth.' }
        };

        function showHelp(metric) {
            const content = helpContent[metric];
            document.getElementById('helpTitle').textContent = content.title;
            document.getElementById('helpText').textContent = content.text;
            document.getElementById('helpModal').classList.add('active');
        }

        function closeHelp() {
            document.getElementById('helpModal').classList.remove('active');
        }

        document.getElementById('helpModal').addEventListener('click', function(e) {
            if (e.target === this) closeHelp();
        });
    </script>
</body>
</html>
