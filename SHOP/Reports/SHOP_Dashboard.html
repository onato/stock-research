<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopify Inc. (SHOP) Financial Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4aa, #00b894);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .header p {
            color: #888;
            font-size: 1.1rem;
        }

        /* Investment Overview Section */
        .overview-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .overview-toggle {
            width: 100%;
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid rgba(0, 212, 170, 0.3);
            border-radius: 12px;
            padding: 16px 24px;
            color: #00d4aa;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        .overview-toggle:hover {
            background: rgba(0, 212, 170, 0.2);
        }
        .overview-toggle .arrow {
            transition: transform 0.3s ease;
        }
        .overview-toggle.active .arrow {
            transform: rotate(180deg);
        }
        .overview-content {
            display: none;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            margin-top: -12px;
        }
        .overview-content.active {
            display: block;
        }
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        .overview-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .overview-card h3 {
            color: #00d4aa;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .overview-card p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        .overview-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .overview-card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            line-height: 1.5;
        }
        .overview-card li:last-child {
            border-bottom: none;
        }
        .overview-card.bull h3 { color: #00d4aa; }
        .overview-card.bear h3 { color: #ff6b6b; }
        .overview-card.risks h3 { color: #fdcb6e; }
        .risk-high { color: #ff6b6b; }
        .risk-moderate { color: #fdcb6e; }
        .risk-low { color: #00d4aa; }
        .revenue-stream {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .revenue-stream .percent {
            color: #00d4aa;
            font-weight: 600;
        }
        .trend-growing { color: #00d4aa; }
        .trend-stable { color: #888; }
        .trend-declining { color: #ff6b6b; }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        .kpi-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 170, 0.2);
        }
        .kpi-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 5px;
        }
        .kpi-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .kpi-change {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .kpi-change.positive { color: #00d4aa; }
        .kpi-change.negative { color: #ff6b6b; }

        /* Guidance Section */
        .guidance-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .guidance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .guidance-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .guidance-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .guidance-meta {
            font-size: 0.85rem;
            color: #888;
        }
        .guidance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .guidance-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease;
        }
        .guidance-card:hover {
            transform: translateY(-2px);
        }
        .guidance-metric {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .guidance-target {
            font-size: 1.4rem;
            font-weight: 600;
            color: #00d4aa;
            margin-bottom: 6px;
        }
        .guidance-period {
            font-size: 0.85rem;
            color: #e0e0e0;
            margin-bottom: 8px;
        }
        .guidance-vs-prior {
            display: inline-block;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        .guidance-vs-prior.raised {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
        }
        .guidance-vs-prior.lowered {
            background: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
        }
        .guidance-vs-prior.maintained {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }
        .guidance-vs-prior.conservative {
            background: rgba(253, 203, 110, 0.15);
            color: #fdcb6e;
        }
        .guidance-vs-prior.improved {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
        }
        .guidance-notes {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }
        .guidance-commentary {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 16px 20px;
            border-left: 3px solid #00d4aa;
            font-style: italic;
            color: #b0b0b0;
            line-height: 1.6;
        }
        .guidance-commentary::before {
            content: '"';
            font-size: 1.5rem;
            color: #00d4aa;
            margin-right: 4px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #fff;
            margin: 40px auto 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0, 212, 170, 0.3);
            max-width: 1400px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .chart-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .help-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(0, 212, 170, 0.2);
            border: 1px solid #00d4aa;
            color: #00d4aa;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .help-btn:hover {
            background: #00d4aa;
            color: #1a1a2e;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: linear-gradient(135deg, #1e2a4a 0%, #16213e 100%);
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 212, 170, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 {
            color: #00d4aa;
            font-size: 1.4rem;
            margin: 0;
        }
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: #ff6b6b;
            color: #fff;
        }
        .modal-body {
            padding: 25px;
            line-height: 1.7;
        }
        .modal-body p { margin-bottom: 15px; }
        .modal-body strong { color: #00d4aa; }
        .modal-body ul { margin: 15px 0; padding-left: 20px; }
        .modal-body li { margin-bottom: 8px; }
        .metric-highlight {
            background: rgba(0, 212, 170, 0.1);
            border-left: 3px solid #00d4aa;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        /* DCF Valuation Section */
        .dcf-section {
            max-width: 1400px;
            margin: 0 auto 40px;
        }
        .dcf-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dcf-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }
        .dcf-card:hover {
            transform: translateY(-3px);
        }
        .dcf-card.highlight {
            background: rgba(0, 212, 170, 0.1);
            border-color: rgba(0, 212, 170, 0.3);
        }
        .dcf-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .dcf-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #00d4aa;
        }
        .dcf-card:not(.highlight) .dcf-value {
            color: #fff;
        }
        .dcf-change {
            font-size: 1rem;
            margin-top: 8px;
            font-weight: 600;
        }
        .dcf-change.positive { color: #00d4aa; }
        .dcf-change.negative { color: #ff6b6b; }
        .dcf-sublabel {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
        }
        .dcf-warning {
            background: rgba(253, 203, 110, 0.15);
            border: 1px solid rgba(253, 203, 110, 0.4);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fdcb6e;
        }
        .warning-icon {
            font-size: 1.2rem;
        }
        .dcf-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .slider-group label {
            font-size: 0.95rem;
            color: #e0e0e0;
            display: flex;
            justify-content: space-between;
        }
        .slider-group label span {
            color: #00d4aa;
            font-weight: 600;
        }
        .slider-group input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        .slider-group input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            border: none;
        }
        .slider-hint {
            font-size: 0.8rem;
            color: #666;
        }
        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .scenario-tab {
            padding: 10px 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: #888;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .scenario-tab:hover {
            border-color: rgba(0, 212, 170, 0.5);
            color: #e0e0e0;
        }
        .scenario-tab.active {
            background: rgba(0, 212, 170, 0.15);
            border-color: #00d4aa;
            color: #00d4aa;
        }
        .scenario-details {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .scenario-details h4 {
            color: #00d4aa;
            margin-bottom: 15px;
        }
        .assumption-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .assumption-item {
            text-align: center;
        }
        .assumption-item .label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
        }
        .assumption-item .value {
            font-size: 1.1rem;
            color: #e0e0e0;
            font-weight: 500;
        }
        .sensitivity-section {
            margin-bottom: 30px;
        }
        .sensitivity-section h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .sensitivity-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            overflow: hidden;
        }
        .sensitivity-table th,
        .sensitivity-table td {
            padding: 12px 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .sensitivity-table th {
            background: rgba(0, 212, 170, 0.1);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td {
            color: #e0e0e0;
        }
        .sensitivity-table td.highlight {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td.below-current {
            color: #ff6b6b;
        }
        .sensitivity-table td.above-current {
            color: #00d4aa;
        }
        .historical-growth {
            margin-bottom: 30px;
        }
        .historical-growth h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .growth-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }
        .growth-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .growth-item .metric {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 6px;
        }
        .growth-item .rate {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .growth-item .rate.positive { color: #00d4aa; }
        .growth-item .rate.negative { color: #ff6b6b; }
        .growth-item.selected {
            border-color: #00d4aa;
            background: rgba(0, 212, 170, 0.1);
        }

        @media (max-width: 768px) {
            .charts-container { grid-template-columns: 1fr; }
            .overview-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Shopify Inc. (SHOP)</h1>
        <p>E-Commerce Platform & Merchant Services | Updated January 2026</p>
    </div>

    <!-- Investment Overview Section -->
    <div class="overview-section">
        <button class="overview-toggle" onclick="toggleOverview()">
            <span>Investment Overview & Analysis</span>
            <span class="arrow">â–¼</span>
        </button>
        <div class="overview-content" id="overviewContent">
            <div class="overview-grid">
                <!-- Company Overview -->
                <div class="overview-card">
                    <h3>Company Overview</h3>
                    <p>Shopify is a leading global e-commerce platform company headquartered in Ottawa, Canada, providing SaaS tools and services for merchants to start, run, and grow their online and offline businesses. The company serves over 5 million active merchants globally across 175+ countries, processing nearly $300 billion in GMV in 2024.</p>
                </div>

                <!-- Business Model -->
                <div class="overview-card">
                    <h3>Business Model</h3>
                    <p>Shopify operates an asset-light, high-margin SaaS model with recurring subscription revenue complemented by transaction-based merchant services. The company completed its transformation in 2023 by divesting its capital-intensive logistics business, resulting in improved profitability.</p>
                    <ul>
                        <li class="revenue-stream">
                            <span>Merchant Solutions (Payments, Shipping, Capital)</span>
                            <span class="percent">75%</span>
                        </li>
                        <li class="revenue-stream">
                            <span>Subscription Solutions (Platform Fees, Shopify Plus)</span>
                            <span class="percent">25%</span>
                        </li>
                    </ul>
                    <p style="margin-top: 12px;"><strong>Key Metrics:</strong> 5M+ merchants, $300B GMV (24% YoY), $8.88B revenue (26% YoY), ~50% gross margin, 12% operating margin (Q4: 17%), 18% FCF margin (Q4: 22%)</p>
                </div>

                <!-- Competitive Position -->
                <div class="overview-card">
                    <h3>Competitive Position</h3>
                    <p><strong>Market Position:</strong> Leader in US e-commerce platforms with 29% market share; 4th globally with 10.3% share (behind WooCommerce); fastest-growing among major platforms</p>
                    <p><strong>Competitors:</strong> WooCommerce (WordPress), BigCommerce, Adobe Commerce (Magento), Squarespace, Wix, Amazon</p>
                    <p><strong>Moat Factors:</strong></p>
                    <ul>
                        <li><strong>Ecosystem lock-in:</strong> 16,000+ apps, integrated payments/shipping/capital, 200M Shop Pay users create network effects</li>
                        <li><strong>Scale advantages:</strong> 5M+ merchants provide data advantages for AI, fraud detection, negotiating leverage</li>
                        <li><strong>Cost leadership:</strong> 33% better TCO vs competitors, 2-2.4x faster site performance</li>
                        <li><strong>Innovation:</strong> First-mover in AI commerce (ChatGPT, Google, Microsoft integrations)</li>
                    </ul>
                </div>

                <!-- Growth Drivers -->
                <div class="overview-card">
                    <h3>Growth Drivers</h3>
                    <ul>
                        <li><strong>B2B commerce expansion:</strong> 109% GMV growth Q1 2025 - $12T global market opportunity</li>
                        <li><strong>Shop Pay acceleration:</strong> 50% YoY GMV growth, 200M+ users, 41% of gross payments volume</li>
                        <li><strong>AI-powered commerce:</strong> Universal Commerce Protocol enables selling in ChatGPT, Google Gemini, Microsoft Copilot</li>
                        <li><strong>Enterprise migration:</strong> Shopify Plus - brands switching from Adobe/Salesforce for 33% lower TCO</li>
                        <li><strong>International expansion:</strong> 50% of merchants outside North America, significant runway</li>
                        <li><strong>Market share gains:</strong> Growing 26-32% vs 11% industry rate</li>
                    </ul>
                </div>

                <!-- Key Risks -->
                <div class="overview-card risks">
                    <h3>Key Risks</h3>
                    <ul>
                        <li><span class="risk-high">High:</span> SMB merchant churn and economic sensitivity - 75% revenue from transaction-based services vulnerable to recessions</li>
                        <li><span class="risk-high">High:</span> Valuation premium pressure - trading at elevated multiples requires sustained execution</li>
                        <li><span class="risk-high">High:</span> Payment processing regulations - scrutiny over merchant vetting, liability for illegal products</li>
                        <li><span class="risk-moderate">Moderate-High:</span> Competition from WooCommerce (39% global share), Adobe, Salesforce, Amazon</li>
                        <li><span class="risk-moderate">Moderate-High:</span> Consumer spending slowdown impacts merchant GMV disproportionately</li>
                        <li><span class="risk-moderate">Moderate:</span> Shopify Capital credit losses - increased 155% YoY to $148M</li>
                        <li><span class="risk-moderate">Moderate:</span> E-commerce growth normalization post-pandemic</li>
                    </ul>
                </div>

                <!-- Bull Case -->
                <div class="overview-card bull">
                    <h3>Bull Case</h3>
                    <ul>
                        <li>Market share gains accelerating - US share >12%, long runway to 20%+</li>
                        <li>B2B massive opportunity - 109% growth from small base, $12T market 4x larger than B2C</li>
                        <li>AI commerce first-mover - Universal Commerce Protocol positions as infrastructure layer</li>
                        <li>Profitability inflection - Operating margin 17% Q4 vs historical losses; 20%+ steady-state achievable</li>
                        <li>Shop Pay network effects - 200M users growing 50%+ creating flywheel; could rival PayPal</li>
                        <li>Enterprise migration tailwind - 33% better TCO driving Fortune 500 wins</li>
                        <li>Asset-light model - Logistics divestiture completed transformation; incremental margins attractive</li>
                    </ul>
                </div>

                <!-- Bear Case -->
                <div class="overview-card bear">
                    <h3>Bear Case</h3>
                    <ul>
                        <li>Valuation extreme - pricing in perfection; any miss could trigger 30-50% correction</li>
                        <li>SMB model economically fragile - Unlike enterprise SaaS, depends on small business survival rates</li>
                        <li>Regulatory risks mounting - California privacy lawsuit, payment scrutiny, compliance costs eroding margins</li>
                        <li>Shopify Capital deteriorating - 155% YoY increase in loan losses signals SMB stress; recession could spike defaults</li>
                        <li>Competition intensifying - WooCommerce dominates globally; Adobe/Salesforce cutting prices; TikTok Shop emerging</li>
                        <li>E-commerce normalization - Industry growing 11% vs Shopify's 26-32%; maintaining outperformance difficult at scale</li>
                        <li>AI adoption uncertain - Heavy investment assumes consumers will shop via AI; ROI may disappoint</li>
                        <li>Margin guidance disappointing - FCF margin flat-to-down; prioritizing growth over profitability frustrates investors</li>
                    </ul>
                </div>

                <!-- Recent Developments -->
                <div class="overview-card">
                    <h3>Recent Developments</h3>
                    <ul>
                        <li><strong>2025-Q3:</strong> Revenue $2.84B (+32% YoY), Operating Income $343M (12.1% margin), FCF $507M (18% margin)</li>
                        <li><strong>2025-Q1:</strong> Moving stock listing from NYSE to Nasdaq effective March 31, 2025</li>
                        <li><strong>2024-Q4:</strong> Record profitability - Operating income $465M (16.5% margin), FCF $611M (22% margin)</li>
                        <li><strong>2024-FY:</strong> Revenue $8.88B (+26%), Operating Income $1.08B (12%), FCF $1.6B (18%)</li>
                        <li><strong>2024-Q4:</strong> Shop Pay reached 200M users, $27B GMV (50% YoY), 41% of gross payments volume</li>
                        <li><strong>2024-Winter:</strong> Launched Universal Commerce Protocol with Google - sell in ChatGPT, Gemini, Copilot</li>
                        <li><strong>2024-Q4:</strong> Major enterprise wins - Crocs and GameStop adopted Shop Pay</li>
                        <li><strong>2025-Jan:</strong> California court ruled Shopify can be sued for data collection without consent</li>
                        <li><strong>2024:</strong> Shopify Capital losses increased 155% YoY to $148M amid SMB credit stress</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid" id="kpiGrid"></div>

    <!-- Management Guidance Section -->
    <div class="guidance-section" id="guidanceSection">
        <div class="guidance-header">
            <h3>Management Guidance</h3>
            <span class="guidance-meta">As of <span id="guidanceAsOf">Q4 2024 Earnings</span> | <span id="guidanceFY">FY2025</span></span>
        </div>
        <div class="guidance-grid" id="guidanceGrid"></div>
        <div class="guidance-commentary" id="guidanceCommentary"></div>
    </div>

    <!-- Revenue & Profitability Charts -->
    <h2 class="section-title">Revenue & Profitability</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Revenue by Segment (Quarterly)</h3>
                <button class="help-btn" onclick="openModal('revenue_segments')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="revenueSegmentsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Total Revenue Trend</h3>
                <button class="help-btn" onclick="openModal('revenue')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Gross Profit Margin</h3>
                <button class="help-btn" onclick="openModal('gross_margin')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="grossMarginChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Operating Income & Margin</h3>
                <button class="help-btn" onclick="openModal('operating_income')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="operatingIncomeChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Cash Flow & Balance Sheet -->
    <h2 class="section-title">Cash Flow & Balance Sheet</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Free Cash Flow</h3>
                <button class="help-btn" onclick="openModal('fcf')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="fcfChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Shareholders' Equity</h3>
                <button class="help-btn" onclick="openModal('equity')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="equityChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Net Income & Margin</h3>
                <button class="help-btn" onclick="openModal('net_income')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="netIncomeChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Diluted EPS</h3>
                <button class="help-btn" onclick="openModal('eps')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="epsChart"></canvas>
            </div>
        </div>
    </div>

    <!-- DCF Valuation Section -->
    <h2 class="section-title">DCF Valuation</h2>
    <div class="dcf-section">
        <!-- Valuation Summary Cards -->
        <div class="dcf-summary">
            <div class="dcf-card highlight">
                <div class="dcf-label">Intrinsic Value (Base)</div>
                <div class="dcf-value" id="dcfIV">$45</div>
                <div class="dcf-change negative" id="dcfUpside">-71% downside</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Entry Price (15% CAGR)</div>
                <div class="dcf-value" id="dcfEntry">$28</div>
                <div class="dcf-sublabel">Buy below for 15% annual return</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Current Price</div>
                <div class="dcf-value" id="dcfCurrent">$155</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Prob-Weighted IV</div>
                <div class="dcf-value" id="dcfWeighted">$47</div>
                <div class="dcf-sublabel">20% Bull / 60% Base / 20% Bear</div>
            </div>
        </div>

        <!-- Growth Rate Warning -->
        <div class="dcf-warning" id="growthWarning">
            <span class="warning-icon">&#9888;</span>
            <span id="warningText">Trading at ~100x P/FCF despite strong FCF growth. Revenue growth consistent at 26-31% in recent quarters.</span>
        </div>

        <!-- Interactive Sliders -->
        <div class="dcf-controls">
            <div class="slider-group">
                <label>Growth Rate: <span id="growthValue">20%</span></label>
                <input type="range" id="growthSlider" min="0" max="40" value="20" step="1">
                <div class="slider-hint" id="growthHint">Based on revenue 2yr CAGR moderated</div>
            </div>
            <div class="slider-group">
                <label>WACC: <span id="waccValue">10.0%</span></label>
                <input type="range" id="waccSlider" min="6" max="18" value="10" step="0.5">
            </div>
            <div class="slider-group">
                <label>Terminal Growth: <span id="terminalValue">3.5%</span></label>
                <input type="range" id="terminalSlider" min="0" max="5" value="3.5" step="0.5">
            </div>
        </div>

        <!-- Scenario Tabs -->
        <div class="scenario-tabs">
            <button class="scenario-tab active" data-scenario="base" onclick="switchScenario('base')">Base Case</button>
            <button class="scenario-tab" data-scenario="bull" onclick="switchScenario('bull')">Bull Case</button>
            <button class="scenario-tab" data-scenario="bear" onclick="switchScenario('bear')">Bear Case</button>
        </div>

        <!-- Scenario Details -->
        <div class="scenario-details" id="scenarioDetails">
            <div class="scenario-assumptions">
                <h4>Assumptions</h4>
                <div class="assumption-grid" id="assumptionGrid"></div>
            </div>
        </div>

        <!-- Sensitivity Table -->
        <div class="sensitivity-section">
            <h4>Sensitivity Analysis: Intrinsic Value by WACC & Terminal Growth</h4>
            <table class="sensitivity-table" id="sensitivityMatrix"></table>
        </div>

        <!-- Historical Growth Rates -->
        <div class="historical-growth">
            <h4>Historical Growth Rates (CAGR)</h4>
            <div class="growth-grid" id="growthGrid"></div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // EMBEDDED CSV DATA - Updated with 2025 data
        const csvData = `Period,Revenue,SubscriptionSolutions,MerchantSolutions,GrossProfit,GrossMargin,OperatingIncome,OperatingMargin,NetIncome,NetMargin,EPS_Diluted,FreeCashFlow,ShareholdersEquity,TotalDebt,CashAndEquivalents,SharesOutstanding
Q1 2020,470.0,187.6,282.4,257.0,54.7,-73.2,-15.6,-31.4,-6.7,-0.27,,3040.9,,969.4,116.8
Q1 2021,988.6,320.7,668.0,558.7,56.5,118.9,12.0,1258.4,127.3,9.94,135.7,9141.9,909.2,2785.6,126.7
Q2 2021,1119.4,334.2,785.2,620.9,55.5,139.4,12.5,879.1,78.5,6.90,,10120.5,909.8,2364.7,127.5
Q1 2023,1508.0,382.0,1126.0,717.0,47.5,-193.0,-12.8,68.0,4.5,0.05,100.0,8457.0,911.0,1738.0,1291.7
Q2 2023,1694.0,444.0,1250.0,835.0,49.3,-1636.0,-96.6,-1311.0,-77.4,-1.02,118.0,7463.0,912.0,1611.0,1295.8
Q3 2023,1714.0,486.0,1228.0,901.0,52.6,122.0,7.1,718.0,41.9,0.55,278.0,8284.0,912.0,1287.0,1295.8
Q4 2023,2144.0,525.0,1619.0,1062.0,49.5,289.0,13.5,657.0,30.6,0.51,446.0,9066.0,916.0,1413.0,1288.0
Q1 2024,1861.0,511.0,1350.0,957.0,51.4,86.0,4.6,-273.0,-14.7,-0.21,232.0,8893.0,916.0,1623.0,1287.4
Q2 2024,2045.0,563.0,1482.0,1045.0,51.1,241.0,11.8,171.0,8.4,0.13,340.0,9172.0,917.0,1541.0,1299.9
Q3 2024,2162.0,610.0,1552.0,1118.0,51.7,283.0,13.1,828.0,38.3,0.64,421.0,10118.0,917.0,1507.0,1301.6
Q4 2024,2812.0,666.0,2146.0,1352.0,48.1,465.0,16.5,1293.0,46.0,1.00,611.0,11558.0,918.0,1498.0,1295.0
Q1 2025,2360.0,620.0,1740.0,1169.0,49.5,203.0,8.6,-682.0,-28.9,-0.53,363.0,11051.0,919.0,1309.0,1296.0
Q2 2025,2680.0,656.0,2024.0,1302.0,48.6,291.0,10.9,906.0,33.8,0.70,422.0,12124.0,919.0,1542.0,1298.0
Q3 2025,2844.0,699.0,2145.0,1391.0,48.9,343.0,12.1,264.0,9.3,0.20,507.0,12511.0,920.0,2414.0,1300.0`;

        // EMBEDDED ANALYSIS JSON
        const analysis = {
            "ticker": "SHOP",
            "company_name": "Shopify Inc.",
            "guidance": {
                "as_of": "Q4 2024 Earnings (February 11, 2025)",
                "fiscal_year": "FY2025",
                "items": [
                    {
                        "metric": "Revenue Growth",
                        "target": "Mid-twenties percent YoY",
                        "period": "FY2025",
                        "vs_prior": "maintained",
                        "notes": "Implies ~$11.0-11.5B revenue; Q1 2025 guidance calls for mid-20s% growth"
                    },
                    {
                        "metric": "Gross Profit Growth",
                        "target": "Low-twenties percent YoY",
                        "period": "FY2025",
                        "vs_prior": "maintained",
                        "notes": "Implies slight gross margin compression as mix shifts to Merchant Solutions"
                    },
                    {
                        "metric": "Free Cash Flow Margin",
                        "target": "Mid-teens percent",
                        "period": "FY2025",
                        "vs_prior": "conservative",
                        "notes": "Down from 18% in FY2024; management prioritizing reinvestment for long-term growth over margin expansion"
                    },
                    {
                        "metric": "Operating Expenses",
                        "target": "32-33% of revenue",
                        "period": "Q4 2024 achieved",
                        "vs_prior": "improved",
                        "notes": "Continued operating leverage as company scales; target to maintain disciplined spending"
                    },
                    {
                        "metric": "GMV Growth",
                        "target": "Low-to-mid twenties percent",
                        "period": "FY2025 implied",
                        "vs_prior": "maintained",
                        "notes": "Consistent with 24% growth in FY2024; Shop Pay and B2B driving acceleration"
                    }
                ],
                "management_commentary": "CEO Harley Finkelstein emphasized that Shopify is becoming the go-to platform for merchants of all sizes, with unified commerce resonating globally. CFO Jeff Hoffmeister noted strong operational leverage with OpEx declining to 32-33% of revenue. Management explicitly stated they will prioritize top-line reinvestment to sustain long-term growth over aggressive free cash flow margin expansion. President highlighted that while B2B is still small portion of GMV, 109% growth shows vast opportunities ahead. Management expressed confidence in maintaining 25%+ revenue growth and continuing to gain market share from legacy enterprise platforms."
            }
        };

        // EMBEDDED DCF JSON - Updated with $155 price and 2025 data
        const dcfData = {
            "ticker": "SHOP",
            "valuation_date": "2026-01-23",
            "current_price": 155.0,
            "inputs": {
                "shares_outstanding": 1300.0,
                "net_debt": -1494.0,
                "last_fcf": 1723.0,
                "cash": 2414.0,
                "debt": 920.0
            },
            "historical_growth": {
                "revenue_1yr_cagr": 26.0,
                "revenue_2yr_cagr": 25.8,
                "fcf_1yr_cagr": 76.5,
                "equity_1yr_cagr": 27.5,
                "selected_growth_rate": 20.0,
                "growth_rate_source": "revenue_2yr_cagr_moderated",
                "growth_divergence_warning": "Trading at ~100x P/FCF despite strong FCF growth. Revenue growth consistent at 26-31% in recent quarters."
            },
            "assumptions": {
                "base": {"growth_rates": [28, 25, 22, 18, 15], "fcf_margin": 18.0, "wacc": 10.0, "terminal_growth": 3.5},
                "bull": {"growth_rates": [35, 32, 28, 24, 20], "fcf_margin": 20.0, "wacc": 9.0, "terminal_growth": 4.0},
                "bear": {"growth_rates": [20, 17, 14, 10, 8], "fcf_margin": 15.0, "wacc": 12.0, "terminal_growth": 2.5}
            },
            "valuation": {
                "base": {"intrinsic_value": 45.36, "upside": -70.7},
                "bull": {"intrinsic_value": 73.52, "upside": -52.6},
                "bear": {"intrinsic_value": 23.91, "upside": -84.6}
            },
            "entry_price": {
                "base": {"entry_price": 28.48, "terminal_value_per_share": 57.28},
                "bull": {"entry_price": 46.16, "terminal_value_per_share": 92.86},
                "bear": {"entry_price": 15.01, "terminal_value_per_share": 30.19}
            },
            "sensitivity": {
                "wacc_range": [8, 9, 10, 11, 12],
                "terminal_growth_range": [2.5, 3.0, 3.5, 4.0, 4.5],
                "matrix": [
                    [56.2, 61.1, 67.0, 74.4, 84.0],
                    [47.1, 50.4, 54.3, 59.0, 64.8],
                    [40.4, 42.8, 45.4, 48.5, 52.2],
                    [35.4, 37.1, 39.1, 41.4, 44.0],
                    [31.4, 32.7, 34.2, 35.9, 37.8]
                ]
            },
            "probability_weighted": {
                "weights": {"bull": 0.2, "base": 0.6, "bear": 0.2},
                "weighted_iv": 46.7
            }
        };

        // Parse CSV
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
                return obj;
            });
        }

        const data = parseCSV(csvData);

        // Sort chronologically (oldest first)
        data.sort((a, b) => {
            const parseDate = (p) => {
                const year = parseInt(p.match(/\d{4}/)?.[0] || '0');
                const isQ1 = p.includes('Q1');
                const isQ2 = p.includes('Q2');
                const isQ3 = p.includes('Q3');
                const isQ4 = p.includes('Q4');
                const isH1 = p.includes('H1');
                const isH2 = p.includes('H2');
                const isFY = p.startsWith('FY');
                const is9M = p.includes('9M');
                const subOrder = isQ1 ? 1 : isQ2 ? 2 : isH1 ? 3 : isQ3 ? 4 : is9M ? 5 : isQ4 ? 6 : isH2 ? 7 : isFY ? 8 : 0;
                return year * 10 + subOrder;
            };
            return parseDate(a.Period) - parseDate(b.Period);
        });

        // Filter datasets
        const quarterlyData = data.filter(d => d.Period.startsWith('Q'));

        // Helper functions
        function calcYoYChange(current, previous) {
            if (!previous || !current) return null;
            return ((parseFloat(current) - parseFloat(previous)) / Math.abs(parseFloat(previous)) * 100).toFixed(1);
        }

        function formatNumber(num, decimals = 0) {
            if (!num || isNaN(num)) return 'N/A';
            return parseFloat(num).toFixed(decimals);
        }

        function formatMoney(num) {
            if (!num || isNaN(num)) return '$0';
            const val = parseFloat(num);
            if (val >= 1000) return '$' + (val / 1000).toFixed(2) + 'B';
            return '$' + val.toFixed(0) + 'M';
        }

        // Toggle overview section
        function toggleOverview() {
            const btn = document.querySelector('.overview-toggle');
            const content = document.getElementById('overviewContent');
            btn.classList.toggle('active');
            content.classList.toggle('active');
        }

        // Render KPI cards - Updated for Q3 2025
        function renderKPIs() {
            const latest = quarterlyData[quarterlyData.length - 1]; // Q3 2025
            const prior = quarterlyData[quarterlyData.length - 5]; // Q3 2024 for YoY

            const kpis = [
                {
                    label: 'Revenue (Q3 2025)',
                    value: formatMoney(latest.Revenue),
                    change: calcYoYChange(latest.Revenue, prior?.Revenue)
                },
                {
                    label: 'Gross Margin',
                    value: formatNumber(latest.GrossMargin, 1) + '%',
                    change: null
                },
                {
                    label: 'Operating Margin',
                    value: formatNumber(latest.OperatingMargin, 1) + '%',
                    change: null
                },
                {
                    label: 'Free Cash Flow',
                    value: formatMoney(latest.FreeCashFlow),
                    change: calcYoYChange(latest.FreeCashFlow, prior?.FreeCashFlow)
                },
                {
                    label: 'FCF Margin',
                    value: formatNumber((parseFloat(latest.FreeCashFlow) / parseFloat(latest.Revenue) * 100), 1) + '%',
                    change: null
                },
                {
                    label: 'Diluted EPS',
                    value: '$' + formatNumber(latest.EPS_Diluted, 2),
                    change: null
                }
            ];

            const grid = document.getElementById('kpiGrid');
            grid.innerHTML = kpis.map(kpi => {
                const changeHtml = kpi.change !== null ?
                    `<div class="kpi-change ${parseFloat(kpi.change) >= 0 ? 'positive' : 'negative'}">
                        ${parseFloat(kpi.change) >= 0 ? '+' : ''}${kpi.change}% YoY
                    </div>` : '';
                return `
                    <div class="kpi-card">
                        <div class="kpi-value">${kpi.value}</div>
                        <div class="kpi-label">${kpi.label}</div>
                        ${changeHtml}
                    </div>
                `;
            }).join('');
        }

        // Render guidance section
        function renderGuidance() {
            if (!analysis.guidance || !analysis.guidance.items || analysis.guidance.items.length === 0) {
                document.getElementById('guidanceSection').style.display = 'none';
                return;
            }

            const guidance = analysis.guidance;
            document.getElementById('guidanceAsOf').textContent = guidance.as_of || '';
            document.getElementById('guidanceFY').textContent = guidance.fiscal_year || '';

            const grid = document.getElementById('guidanceGrid');
            grid.innerHTML = guidance.items.map(item => {
                const vsClass = item.vs_prior ? item.vs_prior.toLowerCase() : 'new';
                const vsLabel = item.vs_prior ? item.vs_prior.charAt(0).toUpperCase() + item.vs_prior.slice(1) : 'New';
                return `
                    <div class="guidance-card">
                        <div class="guidance-metric">${item.metric}</div>
                        <div class="guidance-target">${item.target}</div>
                        <div class="guidance-period">${item.period}</div>
                        <span class="guidance-vs-prior ${vsClass}">${vsLabel}</span>
                        ${item.notes ? `<div class="guidance-notes">${item.notes}</div>` : ''}
                    </div>
                `;
            }).join('');

            const commentary = document.getElementById('guidanceCommentary');
            if (guidance.management_commentary) {
                commentary.textContent = guidance.management_commentary;
                commentary.style.display = 'block';
            } else {
                commentary.style.display = 'none';
            }
        }

        // Chart defaults
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#e0e0e0', font: { size: 11 } } }
            },
            scales: {
                x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
        };

        const colors = {
            primary: '#00d4aa',
            secondary: '#00b894',
            tertiary: '#0984e3',
            quaternary: '#6c5ce7',
            warning: '#fdcb6e',
            danger: '#ff6b6b'
        };

        // Revenue by Segment Chart (Stacked)
        new Chart(document.getElementById('revenueSegmentsChart'), {
            type: 'bar',
            data: {
                labels: quarterlyData.map(d => d.Period),
                datasets: [
                    {
                        label: 'Subscription Solutions',
                        data: quarterlyData.map(d => parseFloat(d.SubscriptionSolutions) || 0),
                        backgroundColor: colors.tertiary,
                        stack: 'revenue'
                    },
                    {
                        label: 'Merchant Solutions',
                        data: quarterlyData.map(d => parseFloat(d.MerchantSolutions) || 0),
                        backgroundColor: colors.primary,
                        stack: 'revenue'
                    }
                ]
            },
            options: {
                ...chartDefaults,
                plugins: {
                    ...chartDefaults.plugins,
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': $' + context.parsed.y.toFixed(0) + 'M';
                            }
                        }
                    }
                }
            }
        });

        // Total Revenue Trend
        new Chart(document.getElementById('revenueChart'), {
            type: 'line',
            data: {
                labels: quarterlyData.map(d => d.Period),
                datasets: [{
                    label: 'Revenue',
                    data: quarterlyData.map(d => parseFloat(d.Revenue) || 0),
                    borderColor: colors.primary,
                    backgroundColor: 'rgba(0, 212, 170, 0.1)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: chartDefaults
        });

        // Gross Margin Trend
        new Chart(document.getElementById('grossMarginChart'), {
            type: 'line',
            data: {
                labels: quarterlyData.map(d => d.Period),
                datasets: [{
                    label: 'Gross Margin %',
                    data: quarterlyData.map(d => parseFloat(d.GrossMargin) || 0),
                    borderColor: colors.tertiary,
                    backgroundColor: 'rgba(9, 132, 227, 0.1)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                ...chartDefaults,
                scales: {
                    ...chartDefaults.scales,
                    y: {
                        ...chartDefaults.scales.y,
                        min: 40,
                        max: 60
                    }
                }
            }
        });

        // Operating Income & Margin (Dual Axis)
        new Chart(document.getElementById('operatingIncomeChart'), {
            type: 'bar',
            data: {
                labels: quarterlyData.map(d => d.Period),
                datasets: [
                    {
                        label: 'Operating Income ($M)',
                        data: quarterlyData.map(d => parseFloat(d.OperatingIncome) || 0),
                        backgroundColor: quarterlyData.map(d => parseFloat(d.OperatingIncome) >= 0 ? colors.primary : colors.danger),
                        yAxisID: 'y'
                    },
                    {
                        label: 'Operating Margin (%)',
                        data: quarterlyData.map(d => parseFloat(d.OperatingMargin) || 0),
                        borderColor: colors.warning,
                        backgroundColor: 'transparent',
                        type: 'line',
                        yAxisID: 'y1',
                        tension: 0.3
                    }
                ]
            },
            options: {
                ...chartDefaults,
                scales: {
                    x: chartDefaults.scales.x,
                    y: {
                        ...chartDefaults.scales.y,
                        position: 'left',
                        title: { display: true, text: 'Operating Income ($M)', color: '#888' }
                    },
                    y1: {
                        ...chartDefaults.scales.y,
                        position: 'right',
                        grid: { display: false },
                        title: { display: true, text: 'Operating Margin (%)', color: '#888' }
                    }
                }
            }
        });

        // Free Cash Flow
        const fcfData = quarterlyData.filter(d => d.FreeCashFlow && d.FreeCashFlow !== '');
        new Chart(document.getElementById('fcfChart'), {
            type: 'bar',
            data: {
                labels: fcfData.map(d => d.Period),
                datasets: [{
                    label: 'Free Cash Flow',
                    data: fcfData.map(d => parseFloat(d.FreeCashFlow) || 0),
                    backgroundColor: fcfData.map(d => parseFloat(d.FreeCashFlow) >= 0 ? colors.primary : colors.danger)
                }]
            },
            options: chartDefaults
        });

        // Shareholders' Equity
        new Chart(document.getElementById('equityChart'), {
            type: 'line',
            data: {
                labels: quarterlyData.map(d => d.Period),
                datasets: [{
                    label: 'Shareholders Equity',
                    data: quarterlyData.map(d => parseFloat(d.ShareholdersEquity) || 0),
                    borderColor: colors.quaternary,
                    backgroundColor: 'rgba(108, 92, 231, 0.1)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: chartDefaults
        });

        // Net Income & Margin
        new Chart(document.getElementById('netIncomeChart'), {
            type: 'bar',
            data: {
                labels: quarterlyData.map(d => d.Period),
                datasets: [
                    {
                        label: 'Net Income ($M)',
                        data: quarterlyData.map(d => parseFloat(d.NetIncome) || 0),
                        backgroundColor: quarterlyData.map(d => parseFloat(d.NetIncome) >= 0 ? colors.primary : colors.danger),
                        yAxisID: 'y'
                    },
                    {
                        label: 'Net Margin (%)',
                        data: quarterlyData.map(d => parseFloat(d.NetMargin) || 0),
                        borderColor: colors.warning,
                        backgroundColor: 'transparent',
                        type: 'line',
                        yAxisID: 'y1',
                        tension: 0.3
                    }
                ]
            },
            options: {
                ...chartDefaults,
                scales: {
                    x: chartDefaults.scales.x,
                    y: {
                        ...chartDefaults.scales.y,
                        position: 'left',
                        title: { display: true, text: 'Net Income ($M)', color: '#888' }
                    },
                    y1: {
                        ...chartDefaults.scales.y,
                        position: 'right',
                        grid: { display: false },
                        title: { display: true, text: 'Net Margin (%)', color: '#888' }
                    }
                }
            }
        });

        // Diluted EPS
        new Chart(document.getElementById('epsChart'), {
            type: 'bar',
            data: {
                labels: quarterlyData.map(d => d.Period),
                datasets: [{
                    label: 'Diluted EPS',
                    data: quarterlyData.map(d => parseFloat(d.EPS_Diluted) || 0),
                    backgroundColor: quarterlyData.map(d => parseFloat(d.EPS_Diluted) >= 0 ? colors.primary : colors.danger)
                }]
            },
            options: chartDefaults
        });

        // Metric descriptions
        const metricDescriptions = {
            revenue_segments: {
                title: "Revenue by Segment",
                content: `
                    <p><strong>Shopify's Two Revenue Streams:</strong></p>
                    <div class="metric-highlight">
                        <strong>Merchant Solutions (~75% of revenue):</strong> Transaction-based fees from Shopify Payments (58% penetration), Shop Pay, shipping services, Shopify Capital lending, and POS hardware. This segment grows with GMV and merchant adoption of these services.
                    </div>
                    <div class="metric-highlight">
                        <strong>Subscription Solutions (~25% of revenue):</strong> Recurring monthly platform fees from merchants. Includes Shopify Plus (enterprise tier with 10,000+ brands) and basic subscription plans. Provides stable, predictable revenue base.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Merchant Solutions growing faster than Subscriptions indicates successful penetration of payment processing and value-added services</li>
                        <li>Shopify Payments penetration rate (currently 58%) - higher penetration = better economics</li>
                        <li>Subscription revenue stability during economic downturns shows merchant retention</li>
                        <li>Mix shift toward Merchant Solutions can compress gross margins but signals growing GMV</li>
                    </ul>
                `
            },
            revenue: {
                title: "Total Revenue",
                content: `
                    <p><strong>Revenue</strong> is the total income from Shopify's platform subscriptions and merchant services.</p>
                    <div class="metric-highlight">
                        <strong>For Shopify:</strong> Revenue growth accelerated to 32% YoY in Q3 2025 (from 26% in FY2024), demonstrating strong market share gains vs 11% industry growth. The company has delivered 9+ consecutive quarters of 25%+ revenue growth since divesting logistics operations.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Revenue growth vs GMV growth - if GMV grows faster, it suggests merchants are getting larger but Shopify's take rate isn't increasing</li>
                        <li>25%+ growth rate sustainability - Q3 2025 showed 32% growth, exceeding management's "mid-twenties percent" guidance</li>
                        <li>Comparison to e-commerce industry growth (currently ~11%) - measures market share gains</li>
                        <li>Enterprise (Shopify Plus) contribution - higher-value merchants drive revenue quality</li>
                        <li>Geographic mix - international expansion is key growth driver (50% of merchants outside North America)</li>
                    </ul>
                `
            },
            gross_margin: {
                title: "Gross Margin",
                content: `
                    <p><strong>Gross Margin</strong> is the percentage of revenue remaining after direct costs (payment processing fees, infrastructure costs).</p>
                    <div class="metric-highlight">
                        <strong>For Shopify:</strong> Gross margin in Q3 2025 was 48.9%, slightly below the 51% achieved in 2024. The compression reflects the mix shift toward higher-growth Merchant Solutions (lower margin but higher absolute profit). The improvement from 47-49% during logistics expansion demonstrates the success of the asset-light transformation.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>48-52% range is healthy for SaaS + payment processing hybrid model</li>
                        <li>Merchant Solutions growth can compress margins slightly (payment processing has lower margins than pure SaaS)</li>
                        <li>Management guided gross profit growth in "low-twenties percent" for FY2025, implying continued slight margin compression</li>
                        <li>Shopify Payments penetration increasing helps margins (own payment processing is higher margin than third-party)</li>
                        <li>Any dip below 48% would signal pricing pressure or unfavorable revenue mix</li>
                    </ul>
                `
            },
            operating_income: {
                title: "Operating Income & Margin",
                content: `
                    <p><strong>Operating Income</strong> is profit after all operating expenses (R&D, sales & marketing, G&A). Operating Margin is the percentage of revenue.</p>
                    <div class="metric-highlight">
                        <strong>For Shopify:</strong> Operating margin in Q3 2025 was 12.1%, down from Q4 2024's record 16.5% but consistent with full-year 2024 of 12%. This is a dramatic turnaround from -20% in FY2023 and -55% in FY2022 (logistics writedowns). Operating expenses declined to 32-33% of revenue, showing strong operational leverage.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Path to 20%+ operating margins - Q4 seasonality suggests this is achievable at scale</li>
                        <li>Operating expense ratio (currently 32-33% of revenue) - continued leverage indicates efficiency gains</li>
                        <li>Management's guidance of "mid-teens" FCF margin for FY2025 suggests prioritizing growth investments over margin expansion</li>
                        <li>Comparison to pure SaaS companies (often 20-30% margins) vs payment processors (10-15%)</li>
                        <li>Q4 seasonality - operating margins spike in holiday quarter due to GMV surge</li>
                        <li>Any margin declines would signal increased competition or unsustainable spending</li>
                    </ul>
                `
            },
            fcf: {
                title: "Free Cash Flow",
                content: `
                    <p><strong>Free Cash Flow</strong> is cash from operations minus capital expenditures. It represents true cash generation available for reinvestment or shareholder returns.</p>
                    <div class="metric-highlight">
                        <strong>For Shopify:</strong> FCF in Q3 2025 was $507M (18% margin), consistent with FY2024's 18% full-year margin and Q4 2024's peak of 22%. 9M 2025 FCF totaled $1.29B. This represents massive improvement from historical losses and demonstrates the asset-light business model post-logistics divestiture.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>FCF margin expansion - Q4 2024's 22% shows potential; path to 20%+ would make Shopify comparable to best-in-class SaaS companies</li>
                        <li>Working capital dynamics - Shopify Capital lending affects timing of cash flows</li>
                        <li>Management's stated priority of growth reinvestment over margin expansion may constrain FCF growth in FY2025</li>
                        <li>Conversion of operating income to FCF - low capex needs mean most operating profit converts to cash</li>
                        <li>FCF growth rate vs revenue growth - if FCF grows faster, it signals improving efficiency</li>
                        <li>Current trading at ~100x P/FCF suggests market expects aggressive growth; any shortfall is high risk</li>
                    </ul>
                `
            },
            equity: {
                title: "Shareholders' Equity",
                content: `
                    <p><strong>Shareholders' Equity</strong> is the company's net worth (total assets minus total liabilities).</p>
                    <div class="metric-highlight">
                        <strong>For Shopify:</strong> Equity grew from $11.6B at end of FY2024 to $12.5B in Q3 2025, driven by profitable operations. Strong equity growth with minimal debt ($920M debt vs $2.4B cash = net cash position of $1.5B) demonstrates financial strength and self-funding capability.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Steady equity growth indicates retained earnings accumulation from profitable operations</li>
                        <li>Net cash position ($1.5B net cash) provides financial flexibility for acquisitions or investments</li>
                        <li>Return on equity (ROE) calculation - growing equity should translate to proportional profit growth</li>
                        <li>No dilution concerns - equity growing faster than shares outstanding means value creation for shareholders</li>
                        <li>Comparison to market cap (~$200B vs $12.5B equity) shows 16x price-to-book, reflecting growth premium</li>
                    </ul>
                `
            },
            net_income: {
                title: "Net Income & Margin",
                content: `
                    <p><strong>Net Income</strong> is bottom-line profit after all expenses, taxes, and one-time items. Net Margin is the percentage of revenue.</p>
                    <div class="metric-highlight">
                        <strong>For Shopify:</strong> Net income in Q3 2025 was $264M (9.3% margin), down from Q4 2024's exceptional $1.29B (46% margin) which included significant gains. Q1 2025 showed a loss of $682M due to one-time charges. Excluding one-timers, underlying profitability is strengthening as operating performance improves.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Normalization after one-time charges - look for sustainable 10-15% net margins</li>
                        <li>Tax rate impact - effective tax rates affect net income significantly</li>
                        <li>Stock-based compensation (included in operating expenses) is substantial for tech companies</li>
                        <li>One-time items volatility - focus on operating income for cleaner profitability picture</li>
                        <li>Net margin convergence toward operating margin indicates less non-operating noise</li>
                        <li>Quarterly volatility due to tax adjustments, FX impacts, and investment gains/losses</li>
                    </ul>
                `
            },
            eps: {
                title: "Diluted Earnings Per Share",
                content: `
                    <p><strong>Diluted EPS</strong> is net income divided by fully diluted shares outstanding (including stock options and convertible securities).</p>
                    <div class="metric-highlight">
                        <strong>For Shopify:</strong> EPS in Q3 2025 was $0.20, with Q2 2025 at $0.70 and Q1 2025 at -$0.53 (one-time charges). FY2024 delivered $1.56 EPS. Trading at ~$155 per share with TTM EPS run-rate suggests elevated P/E ratio, indicating market expectations for rapid profit growth.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Normalized EPS trajectory - excluding one-timers, path to $3-4 EPS would help justify current valuation</li>
                        <li>Share count dilution - currently 1.3B shares, stock-based comp adds ~2-3% annually</li>
                        <li>Valuation premium requires 30-40% EPS growth for several years to justify multiples</li>
                        <li>EPS leverage - as operating margin expands, EPS should grow faster than revenue</li>
                        <li>Comparison to SaaS peers - elevated multiples suggest market pricing in aggressive growth expectations</li>
                        <li>Any EPS miss vs consensus would trigger significant multiple compression given premium valuation</li>
                    </ul>
                `
            }
        };

        // Modal functions
        function openModal(key) {
            document.getElementById('modalTitle').textContent = metricDescriptions[key].title;
            document.getElementById('modalBody').innerHTML = metricDescriptions[key].content;
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay')) return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // DCF Functions
        let currentScenario = 'base';

        function initDCF() {
            if (!dcfData || !dcfData.valuation) return;

            document.getElementById('dcfCurrent').textContent = '$' + dcfData.current_price.toFixed(0);

            if (dcfData.historical_growth.growth_divergence_warning) {
                document.getElementById('growthWarning').style.display = 'flex';
                document.getElementById('warningText').textContent = dcfData.historical_growth.growth_divergence_warning;
            }

            const base = dcfData.assumptions.base;
            document.getElementById('growthSlider').value = dcfData.historical_growth.selected_growth_rate;
            document.getElementById('waccSlider').value = base.wacc;
            document.getElementById('terminalSlider').value = base.terminal_growth;

            document.getElementById('growthValue').textContent = dcfData.historical_growth.selected_growth_rate + '%';
            document.getElementById('waccValue').textContent = base.wacc + '%';
            document.getElementById('terminalValue').textContent = base.terminal_growth + '%';

            document.getElementById('growthHint').textContent =
                'Based on ' + dcfData.historical_growth.growth_rate_source.replace(/_/g, ' ');

            renderHistoricalGrowth();
            renderSensitivityMatrix();
            updateDCFDisplay();
            switchScenario('base');
        }

        function calculateDCF(growthRate, wacc, terminalGrowth) {
            const years = 5;
            const fcf = dcfData.inputs.last_fcf;
            let pvFCF = 0;
            let projectedFCF = fcf;

            for (let i = 0; i < years; i++) {
                projectedFCF *= (1 + growthRate / 100);
                pvFCF += projectedFCF / Math.pow(1 + wacc/100, i + 1);
            }

            const terminalFCF = projectedFCF * (1 + terminalGrowth/100);
            const terminalValue = terminalFCF / (wacc/100 - terminalGrowth/100);
            const pvTerminal = terminalValue / Math.pow(1 + wacc/100, years);

            const enterpriseValue = pvFCF + pvTerminal;
            const equityValue = enterpriseValue - dcfData.inputs.net_debt;
            const iv = equityValue / dcfData.inputs.shares_outstanding;

            const terminalPerShare = terminalValue / dcfData.inputs.shares_outstanding;
            const entryPrice = terminalPerShare / Math.pow(1.15, years);

            return {
                iv: iv,
                entryPrice: entryPrice,
                terminalPerShare: terminalPerShare,
                pvFCF: pvFCF,
                pvTerminal: pvTerminal,
                enterpriseValue: enterpriseValue
            };
        }

        window.updateDCFDisplay = function() {
            const growth = parseFloat(document.getElementById('growthSlider').value);
            const wacc = parseFloat(document.getElementById('waccSlider').value);
            const terminal = parseFloat(document.getElementById('terminalSlider').value);

            document.getElementById('growthValue').textContent = growth + '%';
            document.getElementById('waccValue').textContent = wacc + '%';
            document.getElementById('terminalValue').textContent = terminal + '%';

            const result = calculateDCF(growth, wacc, terminal);

            document.getElementById('dcfIV').textContent = '$' + result.iv.toFixed(0);
            document.getElementById('dcfEntry').textContent = '$' + result.entryPrice.toFixed(0);

            const upside = ((result.iv - dcfData.current_price) / dcfData.current_price * 100);
            const upsideEl = document.getElementById('dcfUpside');
            upsideEl.textContent = (upside >= 0 ? '+' : '') + upside.toFixed(0) + '% ' + (upside >= 0 ? 'upside' : 'downside');
            upsideEl.className = 'dcf-change ' + (upside >= 0 ? 'positive' : 'negative');

            document.getElementById('dcfWeighted').textContent = '$' + dcfData.probability_weighted.weighted_iv.toFixed(0);

            const grid = document.getElementById('assumptionGrid');
            if (grid) {
                grid.innerHTML = `
                    <div class="assumption-item">
                        <div class="label">Growth Rate</div>
                        <div class="value">${growth}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">WACC</div>
                        <div class="value">${wacc}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Terminal Growth</div>
                        <div class="value">${terminal}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Intrinsic Value</div>
                        <div class="value" style="color: #00d4aa;">$${result.iv.toFixed(0)}</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Entry Price</div>
                        <div class="value" style="color: #00d4aa;">$${result.entryPrice.toFixed(0)}</div>
                    </div>
                `;
            }
        };

        window.switchScenario = function(scenario) {
            currentScenario = scenario;

            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === scenario);
            });

            const assumptions = dcfData.assumptions[scenario];
            const valuation = dcfData.valuation[scenario];

            document.getElementById('growthSlider').value = assumptions.growth_rates[0];
            document.getElementById('waccSlider').value = assumptions.wacc;
            document.getElementById('terminalSlider').value = assumptions.terminal_growth;

            const grid = document.getElementById('assumptionGrid');
            grid.innerHTML = `
                <div class="assumption-item">
                    <div class="label">Year 1 Growth</div>
                    <div class="value">${assumptions.growth_rates[0]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Year 5 Growth</div>
                    <div class="value">${assumptions.growth_rates[4]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">FCF Margin</div>
                    <div class="value">${assumptions.fcf_margin}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">WACC</div>
                    <div class="value">${assumptions.wacc}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Terminal Growth</div>
                    <div class="value">${assumptions.terminal_growth}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Intrinsic Value</div>
                    <div class="value" style="color: #00d4aa;">$${valuation.intrinsic_value.toFixed(0)}</div>
                </div>
            `;

            updateDCFDisplay();
        };

        function renderHistoricalGrowth() {
            const growth = dcfData.historical_growth;
            const selectedSource = growth.growth_rate_source;
            const grid = document.getElementById('growthGrid');

            const metrics = [
                { key: 'revenue_1yr_cagr', label: 'Revenue 1Y' },
                { key: 'revenue_2yr_cagr', label: 'Revenue 2Y' },
                { key: 'fcf_1yr_cagr', label: 'FCF 1Y' },
                { key: 'equity_1yr_cagr', label: 'Equity 1Y' }
            ];

            grid.innerHTML = metrics.filter(m => growth[m.key] !== null && growth[m.key] !== undefined).map(m => {
                const rate = growth[m.key];
                const isSelected = m.key === selectedSource || selectedSource.includes(m.key);
                const colorClass = rate >= 0 ? 'positive' : 'negative';
                return `
                    <div class="growth-item ${isSelected ? 'selected' : ''}">
                        <div class="metric">${m.label}</div>
                        <div class="rate ${colorClass}">${rate >= 0 ? '+' : ''}${rate.toFixed(1)}%</div>
                    </div>
                `;
            }).join('');
        }

        function renderSensitivityMatrix() {
            const sens = dcfData.sensitivity;
            const table = document.getElementById('sensitivityMatrix');
            const currentPrice = dcfData.current_price;

            let html = '<tr><th>WACC \\ Term G</th>';
            sens.terminal_growth_range.forEach(tg => {
                html += `<th>${tg}%</th>`;
            });
            html += '</tr>';

            sens.wacc_range.forEach((wacc, i) => {
                html += `<tr><th>${wacc}%</th>`;
                sens.matrix[i].forEach((val, j) => {
                    const isHighlight = wacc === dcfData.assumptions.base.wacc &&
                                       sens.terminal_growth_range[j] === dcfData.assumptions.base.terminal_growth;
                    const colorClass = val >= currentPrice ? 'above-current' : 'below-current';
                    html += `<td class="${isHighlight ? 'highlight' : colorClass}">$${val}</td>`;
                });
                html += '</tr>';
            });

            table.innerHTML = html;
        }

        // Initialize
        renderKPIs();
        renderGuidance();
        initDCF();

        // Bind slider events
        (function() {
            var growthSlider = document.getElementById('growthSlider');
            var waccSlider = document.getElementById('waccSlider');
            var terminalSlider = document.getElementById('terminalSlider');

            if (growthSlider) {
                growthSlider.oninput = window.updateDCFDisplay;
                growthSlider.onchange = window.updateDCFDisplay;
            }
            if (waccSlider) {
                waccSlider.oninput = window.updateDCFDisplay;
                waccSlider.onchange = window.updateDCFDisplay;
            }
            if (terminalSlider) {
                terminalSlider.oninput = window.updateDCFDisplay;
                terminalSlider.onchange = window.updateDCFDisplay;
            }
        })();
    </script>
</body>
</html>
