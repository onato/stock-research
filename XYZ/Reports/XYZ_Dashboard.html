<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block, Inc. (XYZ) Financial Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4aa, #00b894);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .header p {
            color: #888;
            font-size: 1.1rem;
        }

        /* Investment Overview Section */
        .overview-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .overview-toggle {
            width: 100%;
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid rgba(0, 212, 170, 0.3);
            border-radius: 12px;
            padding: 16px 24px;
            color: #00d4aa;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        .overview-toggle:hover {
            background: rgba(0, 212, 170, 0.2);
        }
        .overview-toggle .arrow {
            transition: transform 0.3s ease;
        }
        .overview-toggle.active .arrow {
            transform: rotate(180deg);
        }
        .overview-content {
            display: none;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            margin-top: -12px;
        }
        .overview-content.active {
            display: block;
        }
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        .overview-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .overview-card h3 {
            color: #00d4aa;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .overview-card p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        .overview-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .overview-card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            line-height: 1.5;
        }
        .overview-card li:last-child {
            border-bottom: none;
        }
        .overview-card.bull h3 { color: #00d4aa; }
        .overview-card.bear h3 { color: #ff6b6b; }
        .overview-card.risks h3 { color: #fdcb6e; }
        .risk-high { color: #ff6b6b; }
        .risk-moderate { color: #fdcb6e; }
        .risk-low { color: #00d4aa; }
        .revenue-stream {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .revenue-stream .percent {
            color: #00d4aa;
            font-weight: 600;
        }
        .trend-growing { color: #00d4aa; }
        .trend-stable { color: #888; }
        .trend-declining { color: #ff6b6b; }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        .kpi-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 170, 0.2);
        }
        .kpi-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 5px;
        }
        .kpi-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .kpi-change {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .kpi-change.positive { color: #00d4aa; }
        .kpi-change.negative { color: #ff6b6b; }

        /* Guidance Section */
        .guidance-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .guidance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .guidance-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .guidance-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .guidance-meta {
            font-size: 0.85rem;
            color: #888;
        }
        .guidance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .guidance-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease;
        }
        .guidance-card:hover {
            transform: translateY(-2px);
        }
        .guidance-metric {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .guidance-target {
            font-size: 1.4rem;
            font-weight: 600;
            color: #00d4aa;
            margin-bottom: 6px;
        }
        .guidance-period {
            font-size: 0.85rem;
            color: #e0e0e0;
            margin-bottom: 8px;
        }
        .guidance-vs-prior {
            display: inline-block;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        .guidance-vs-prior.raised {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
        }
        .guidance-vs-prior.lowered {
            background: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
        }
        .guidance-vs-prior.maintained {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }
        .guidance-vs-prior.new {
            background: rgba(99, 102, 241, 0.15);
            color: #818cf8;
        }
        .guidance-notes {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }
        .guidance-commentary {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 16px 20px;
            border-left: 3px solid #00d4aa;
            font-style: italic;
            color: #b0b0b0;
            line-height: 1.6;
        }
        .guidance-commentary::before {
            content: '"';
            font-size: 1.5rem;
            color: #00d4aa;
            margin-right: 4px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #fff;
            margin: 40px auto 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0, 212, 170, 0.3);
            max-width: 1400px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .chart-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .help-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(0, 212, 170, 0.2);
            border: 1px solid #00d4aa;
            color: #00d4aa;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .help-btn:hover {
            background: #00d4aa;
            color: #1a1a2e;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: linear-gradient(135deg, #1e2a4a 0%, #16213e 100%);
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 212, 170, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 {
            color: #00d4aa;
            font-size: 1.4rem;
            margin: 0;
        }
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: #ff6b6b;
            color: #fff;
        }
        .modal-body {
            padding: 25px;
            line-height: 1.7;
        }
        .modal-body p { margin-bottom: 15px; }
        .modal-body strong { color: #00d4aa; }
        .modal-body ul { margin: 15px 0; padding-left: 20px; }
        .modal-body li { margin-bottom: 8px; }
        .metric-highlight {
            background: rgba(0, 212, 170, 0.1);
            border-left: 3px solid #00d4aa;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        /* DCF Valuation Section */
        .dcf-section {
            max-width: 1400px;
            margin: 0 auto 40px;
        }
        .dcf-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dcf-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }
        .dcf-card:hover {
            transform: translateY(-3px);
        }
        .dcf-card.highlight {
            background: rgba(0, 212, 170, 0.1);
            border-color: rgba(0, 212, 170, 0.3);
        }
        .dcf-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .dcf-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #00d4aa;
        }
        .dcf-card:not(.highlight) .dcf-value {
            color: #fff;
        }
        .dcf-change {
            font-size: 1rem;
            margin-top: 8px;
            font-weight: 600;
        }
        .dcf-change.positive { color: #00d4aa; }
        .dcf-change.negative { color: #ff6b6b; }
        .dcf-sublabel {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
        }
        .dcf-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .slider-group label {
            font-size: 0.95rem;
            color: #e0e0e0;
            display: flex;
            justify-content: space-between;
        }
        .slider-group label span {
            color: #00d4aa;
            font-weight: 600;
        }
        .slider-group input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        .slider-group input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            border: none;
        }
        .slider-hint {
            font-size: 0.8rem;
            color: #666;
        }
        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .scenario-tab {
            padding: 10px 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: #888;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .scenario-tab:hover {
            border-color: rgba(0, 212, 170, 0.5);
            color: #e0e0e0;
        }
        .scenario-tab.active {
            background: rgba(0, 212, 170, 0.15);
            border-color: #00d4aa;
            color: #00d4aa;
        }
        .scenario-details {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .scenario-details h4 {
            color: #00d4aa;
            margin-bottom: 15px;
        }
        .assumption-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .assumption-item {
            text-align: center;
        }
        .assumption-item .label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
        }
        .assumption-item .value {
            font-size: 1.1rem;
            color: #e0e0e0;
            font-weight: 500;
        }
        .sensitivity-section {
            margin-bottom: 30px;
        }
        .sensitivity-section h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .sensitivity-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            overflow: hidden;
        }
        .sensitivity-table th,
        .sensitivity-table td {
            padding: 12px 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .sensitivity-table th {
            background: rgba(0, 212, 170, 0.1);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td {
            color: #e0e0e0;
        }
        .sensitivity-table td.highlight {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td.below-current {
            color: #ff6b6b;
        }
        .sensitivity-table td.above-current {
            color: #00d4aa;
        }
        .historical-growth {
            margin-bottom: 30px;
        }
        .historical-growth h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .growth-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }
        .growth-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .growth-item .metric {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 6px;
        }
        .growth-item .rate {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .growth-item .rate.positive { color: #00d4aa; }
        .growth-item .rate.negative { color: #ff6b6b; }
        .growth-item.selected {
            border-color: #00d4aa;
            background: rgba(0, 212, 170, 0.1);
        }

        @media (max-width: 768px) {
            .charts-container { grid-template-columns: 1fr; }
            .overview-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Block, Inc. (XYZ)</h1>
        <p>Dual-Ecosystem Fintech: Square + Cash App | Last Updated: January 22, 2026</p>
    </div>

    <!-- Investment Overview Section -->
    <div class="overview-section">
        <button class="overview-toggle" onclick="toggleOverview()">
            <span>Investment Overview & Analysis</span>
            <span class="arrow">â–¼</span>
        </button>
        <div class="overview-content" id="overviewContent">
            <div class="overview-grid">
                <!-- Company Overview -->
                <div class="overview-card">
                    <h3>Company Overview</h3>
                    <p>Block, Inc. (formerly Square) is a dual-ecosystem fintech company operating Square, a payment processing and business software platform serving 4 million merchants, and Cash App, a consumer financial services super-app with 58 million monthly active users. The company has expanded into buy-now-pay-later (Afterpay acquired 2022 for $29B), Bitcoin products (mining, payments, development), and music streaming (TIDAL), though recent restructuring has scaled back non-core initiatives to focus on its core Square and Cash App businesses.</p>
                </div>

                <!-- Business Model -->
                <div class="overview-card">
                    <h3>Business Model</h3>
                    <p>Dual-platform model with Square monetizing merchant payment processing, software subscriptions, and lending, while Cash App generates revenue from peer-to-peer transaction fees, Bitcoin trading (51% of Cash App revenue), Cash Card interchange, stock trading, and lending products. Total gross payment volume of $241B in 2024 across both ecosystems.</p>
                    <ul>
                        <li class="revenue-stream"><span>Cash App</span><span class="percent">59% <span class="trend-growing">(growing)</span></span></li>
                        <li class="revenue-stream"><span>Square</span><span class="percent">41% <span class="trend-stable">(stable)</span></span></li>
                        <li>Customer Type: Square (B2B - SMB to mid-market merchants); Cash App (B2C - 57M monthly users)</li>
                        <li>Geographic Mix: Primarily U.S.-focused with growing international presence</li>
                    </ul>
                </div>

                <!-- Competitive Position -->
                <div class="overview-card">
                    <h3>Competitive Position</h3>
                    <p><strong>Main Competitors:</strong> PayPal/Venmo, Stripe, Toast, Fiserv/Clover, Shopify, Affirm/Klarna, Traditional banks, Apple Pay/Google Pay</p>
                    <p><strong>Market Position:</strong> U.S. market leader in SMB point-of-sale systems; Cash App ranks top-3 U.S. consumer money apps by monthly actives; 35% of U.S. small business owners used Square (2022)</p>
                    <p><strong>Moat Factors:</strong></p>
                    <ul>
                        <li><strong>Ecosystem lock-in (Strong):</strong> Nearly 50% of Square merchants use Block's banking products; cross-selling creates switching costs</li>
                        <li><strong>Network effects (Moderate):</strong> Cash App's 58M users create value for P2P transactions</li>
                        <li><strong>Brand recognition (Moderate):</strong> Strong brand in SMB segment and among younger consumers</li>
                    </ul>
                    <p><strong>Weaknesses:</strong> Intense competition, limited differentiation outside Bitcoin, Square GPV growth slowing, high Bitcoin exposure, CFPB enforcement issues</p>
                </div>

                <!-- Growth Drivers -->
                <div class="overview-card">
                    <h3>Growth Drivers</h3>
                    <ul>
                        <li>Cash App monetization expansion: ARPU growing with lending, subscriptions, investing; 24% YoY growth Q3 2025</li>
                        <li>Square moving upmarket: Mid-market merchants (over $500K annual GPV) now 41% of Square GPV</li>
                        <li>Afterpay-Cash App integration: Rebranded March 2025; rollout to 20 states; BNPL market growing to $911B by 2030</li>
                        <li>Bitcoin payments ecosystem: Lightning Network payments launched; full rollout expected by end of 2026</li>
                        <li>International expansion: Square international GPV accelerated to 25% YoY growth Q2 2025</li>
                        <li>Aggressive share buyback: $5B buyback authorization added November 2025</li>
                    </ul>
                </div>

                <!-- Key Risks -->
                <div class="overview-card risks">
                    <h3>Key Risks</h3>
                    <ul>
                        <li><span class="risk-high">HIGH:</span> Intense competition across all segments (Toast, Stripe, PayPal, Apple/Google)</li>
                        <li><span class="risk-high">HIGH:</span> Square growth deceleration vs competitors; U.S. near-flat in 2024</li>
                        <li><span class="risk-high">HIGH:</span> Bitcoin revenue volatility (51% of Cash App revenue); BTC price exposure</li>
                        <li><span class="risk-high">HIGH:</span> CFPB enforcement $175M + $80M state penalties for fraud/AML failures</li>
                        <li><span class="risk-high">HIGH:</span> Fintech regulation (CFPB digital wallet oversight, crypto regulation)</li>
                        <li><span class="risk-high">HIGH:</span> Consumer spending and SMB failure rates in downturn</li>
                        <li><span class="risk-moderate">MODERATE:</span> Customer concentration in vulnerable SMB segment</li>
                        <li><span class="risk-moderate">MODERATE:</span> Execution risk on Bitcoin payments rollout and Afterpay integration</li>
                    </ul>
                </div>

                <!-- Bull Case -->
                <div class="overview-card bull">
                    <h3>Bull Case</h3>
                    <ul>
                        <li>Strong multi-year guidance: 2026 targets $11.98B GP (17% YoY), $2.70B adj OI (30%+ YoY), $3.20 EPS; 2028 targets $15.8B GP, $4.6B OI, $5.50 EPS</li>
                        <li>Aggressive capital return: $5B buyback authorization; $2.40B FCF expected in 2026 (20% of GP)</li>
                        <li>Cash App monetization accelerating: 24% GP growth Q3 2025; ARPU growing; 57M monthly users with runway</li>
                        <li>Bitcoin strategic differentiation: Only major fintech fully committed to Bitcoin payments; waiving fees to drive adoption</li>
                        <li>Afterpay integration: Cash App Afterpay launched Feb 2025; BNPL market growing to $911B by 2030</li>
                        <li>Dual ecosystem network effects strengthening: 58M Cash App + 4M Square merchants with increasing integration</li>
                        <li>Analyst price targets: Average $79.74-$86.65; high targets $105-$108; TD Cowen 'Best Idea 2026' at $91</li>
                    </ul>
                </div>

                <!-- Bear Case -->
                <div class="overview-card bear">
                    <h3>Bear Case</h3>
                    <ul>
                        <li>Major regulatory enforcement: $255M total penalties (CFPB + states) for fraud/AML failures; reputational damage; increased compliance costs</li>
                        <li>Slowing Square growth: GPV decelerating; losing restaurant share to Toast; U.S. near-flat 2024; intense competition</li>
                        <li>Bitcoin strategy creates volatility: 51% of Cash App revenue from Bitcoin trading; payments rollout unproven; regulatory uncertainty</li>
                        <li>Cash App monetization limited: Lower-income customer base restricts revenue potential vs PayPal/Venmo</li>
                        <li>Macro vulnerability: SMB merchants + consumer spending both procyclical; BNPL/lending amplify credit risk in downturn</li>
                        <li>High marketing costs: 20%+ YoY increases; CAC rising due to competition; margin expansion at risk</li>
                        <li>Afterpay integration risk: $29B acquisition must deliver; early rollout (only 20 states); prior acquisitions failed (TIDAL, TBD)</li>
                        <li>Valuation risk: Trading on ambitious 2026 guidance; any miss would be punished; requires flawless execution</li>
                    </ul>
                </div>

                <!-- Recent Developments -->
                <div class="overview-card">
                    <h3>Recent Developments</h3>
                    <ul>
                        <li><strong>2026-Jan:</strong> Next earnings Feb 19, 2026; Q4 2025 consensus EPS $0.26; expected GP $2.755B (19%+ YoY)</li>
                        <li><strong>2025-Nov-19:</strong> Investor Day: $5B buyback increase; 2026 guidance $11.98B GP, $2.70B adj OI, $3.20 EPS</li>
                        <li><strong>2025-Nov-10:</strong> Bitcoin payments rolled out globally via Lightning Network</li>
                        <li><strong>2025-Q3:</strong> Q3 beat: EPS $0.54 vs $0.50; GP $2.66B (+18% YoY); raised FY2025 guidance</li>
                        <li><strong>2025-May:</strong> Bitcoin Lightning pilot launched in Las Vegas</li>
                        <li><strong>2025-Mar:</strong> Afterpay rebranded to Cash App Afterpay; 1,000 employee layoffs</li>
                        <li><strong>2025-Feb-18:</strong> Cash App Afterpay launched on Cash App debit cards in 20 states</li>
                        <li><strong>2025-Jan-16:</strong> CFPB $175M penalty ($120M consumer redress + $55M fine) for fraud failures</li>
                        <li><strong>2025-Jan-15:</strong> 48 states issued $80M penalty for BSA/AML violations</li>
                        <li><strong>2024-July:</strong> Block joined S&P 500 index</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid" id="kpiGrid">
        <!-- Populated by JavaScript -->
    </div>

    <!-- Management Guidance Section -->
    <div class="guidance-section" id="guidanceSection">
        <div class="guidance-header">
            <h3>Management Guidance</h3>
            <span class="guidance-meta">As of <span id="guidanceAsOf"></span> | <span id="guidanceFY"></span></span>
        </div>
        <div class="guidance-grid" id="guidanceGrid">
            <!-- Populated by JavaScript -->
        </div>
        <div class="guidance-commentary" id="guidanceCommentary">
            <!-- Management commentary -->
        </div>
    </div>

    <!-- Charts Section -->
    <h2 class="section-title">Financial Performance</h2>
    <div class="charts-container" id="chartsContainer">
        <!-- Charts populated by JavaScript -->
    </div>

    <h2 class="section-title">Profitability & Cash Flow</h2>
    <div class="charts-container" id="profitabilityContainer">
        <!-- Charts populated by JavaScript -->
    </div>

    <h2 class="section-title">Balance Sheet & Valuation</h2>
    <div class="charts-container" id="balanceSheetContainer">
        <!-- Charts populated by JavaScript -->
    </div>

    <!-- DCF Valuation Section -->
    <h2 class="section-title">DCF Valuation</h2>
    <div class="dcf-section">
        <div class="dcf-summary">
            <div class="dcf-card highlight">
                <div class="dcf-label">Intrinsic Value</div>
                <div class="dcf-value" id="dcfIV">$52</div>
                <div class="dcf-change" id="dcfUpside">-19% downside</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Entry Price (15% CAGR)</div>
                <div class="dcf-value" id="dcfEntry">$30</div>
                <div class="dcf-sublabel">Buy below for 15% annual return</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Current Price</div>
                <div class="dcf-value" id="dcfCurrent">$64</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Prob-Weighted IV</div>
                <div class="dcf-value" id="dcfWeighted">$55</div>
                <div class="dcf-sublabel">25% Bull / 50% Base / 25% Bear</div>
            </div>
        </div>

        <!-- Interactive Sliders -->
        <div class="dcf-controls">
            <div class="slider-group">
                <label>Growth Rate: <span id="growthValue">15%</span></label>
                <input type="range" id="growthSlider" min="0" max="30" value="15" step="1">
                <div class="slider-hint" id="growthHint">Based on management guidance</div>
            </div>
            <div class="slider-group">
                <label>WACC: <span id="waccValue">10%</span></label>
                <input type="range" id="waccSlider" min="6" max="18" value="10" step="0.5">
            </div>
            <div class="slider-group">
                <label>Terminal Growth: <span id="terminalValue">3%</span></label>
                <input type="range" id="terminalSlider" min="0" max="5" value="3" step="0.5">
            </div>
        </div>

        <!-- Scenario Tabs -->
        <div class="scenario-tabs">
            <button class="scenario-tab active" data-scenario="base" onclick="switchScenario('base')">Base Case</button>
            <button class="scenario-tab" data-scenario="bull" onclick="switchScenario('bull')">Bull Case</button>
            <button class="scenario-tab" data-scenario="bear" onclick="switchScenario('bear')">Bear Case</button>
        </div>

        <!-- Scenario Details -->
        <div class="scenario-details" id="scenarioDetails">
            <div class="scenario-assumptions">
                <h4>Assumptions</h4>
                <div class="assumption-grid" id="assumptionGrid">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Sensitivity Table -->
        <div class="sensitivity-section">
            <h4>Sensitivity Analysis: Intrinsic Value by WACC & Terminal Growth</h4>
            <table class="sensitivity-table" id="sensitivityMatrix">
                <!-- Populated by JavaScript -->
            </table>
        </div>

        <!-- Historical Growth Rates -->
        <div class="historical-growth">
            <h4>Historical Growth Rates (CAGR)</h4>
            <div class="growth-grid" id="growthGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Metric</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // EMBEDDED CSV DATA
        const csvData = `Period,Revenue,GrossProfit,GrossMargin,OperatingIncome,OperatingMargin,NetIncome,NetMargin,EPS,OperatingCashFlow,CapitalExpenditures,FreeCashFlow,ShareholdersEquity,TotalDebt,CashAndEquivalents,SharesOutstanding
FY2019,4713.5,1889.7,40.1,54.2,1.1,375.4,8.0,0.81,465.7,62.5,403.2,2223.7,938.8,1047.1,466.1
FY2020,9497.6,2733.4,28.8,36.6,0.4,375.4,4.0,0.81,465.7,138.4,327.3,2955.5,2586.9,3158.1,482.2
FY2021,17661.2,4419.8,25.0,161.1,0.9,375.4,2.1,0.81,847.8,138.4,709.4,3317.3,4559.2,4443.7,501.8
FY2022,17661.2,5991.9,33.9,624.5,3.5,540.7,3.1,0.93,847.8,170.8,677.0,18314.7,4559.2,4544.2,578.9
FY2023,21915.6,7504.9,34.2,624.5,2.8,540.7,2.5,0.93,847.8,170.8,677.0,19602.0,4570.2,4996.5,614.0
FY2024,24121.1,8889.0,36.9,892.3,3.7,2903.3,12.0,4.56,1707.3,170.8,1536.5,21267.9,6105.4,8075.2,636.4
FY2025E,24300.0,10243.0,42.1,2100.0,8.6,1900.0,7.8,3.00,2500.0,175.0,2325.0,23000.0,7300.0,8500.0,635.0`;

        // EMBEDDED ANALYSIS JSON
        const analysis = {
            "ticker": "XYZ",
            "company_name": "Block, Inc.",
            "guidance": {
                "as_of": "Investor Day November 19, 2025 (updated from Q3 2025 earnings)",
                "fiscal_year": "FY2026 and three-year outlook through 2028",
                "items": [
                    {
                        "metric": "Gross Profit",
                        "target": "$11.98B",
                        "period": "FY2026",
                        "vs_prior": "new",
                        "notes": "Implies 17% YoY growth from expected $10.243B in FY2025"
                    },
                    {
                        "metric": "Adjusted Operating Income",
                        "target": "$2.70B",
                        "period": "FY2026",
                        "vs_prior": "new",
                        "notes": "Over 30% YoY growth from expected $2.1B in FY2025"
                    },
                    {
                        "metric": "Adjusted EPS",
                        "target": "$3.20",
                        "period": "FY2026",
                        "vs_prior": "new",
                        "notes": "Over 30% YoY growth; benefits from share buyback"
                    },
                    {
                        "metric": "Non-GAAP Free Cash Flow",
                        "target": "$2.40B (20% of gross profit)",
                        "period": "FY2026",
                        "vs_prior": "new",
                        "notes": "Strong cash generation supporting buyback"
                    },
                    {
                        "metric": "Q4 2025 Gross Profit",
                        "target": "$2.755B",
                        "period": "Q4 2025",
                        "vs_prior": "raised",
                        "notes": "Implies 19%+ YoY growth"
                    },
                    {
                        "metric": "FY2025 Gross Profit",
                        "target": "$10.243B",
                        "period": "FY2025",
                        "vs_prior": "raised",
                        "notes": "Raised from $10.17B; implies 15%+ YoY growth from $8.89B in FY2024"
                    },
                    {
                        "metric": "2028 Gross Profit",
                        "target": "~$15.8B",
                        "period": "FY2028",
                        "vs_prior": "new",
                        "notes": "Mid-teens annual growth through 2028"
                    },
                    {
                        "metric": "2028 Adj Operating Income",
                        "target": "$4.6B",
                        "period": "FY2028",
                        "vs_prior": "new",
                        "notes": "~30% annual growth through 2028"
                    },
                    {
                        "metric": "2028 Adj EPS",
                        "target": "$5.50",
                        "period": "FY2028",
                        "vs_prior": "new",
                        "notes": "Low 30% annual growth through 2028"
                    },
                    {
                        "metric": "Bitcoin Payments Rollout",
                        "target": "All eligible Square sellers by end of 2026",
                        "period": "2026",
                        "vs_prior": "new",
                        "notes": "Subject to regulatory approvals"
                    }
                ],
                "management_commentary": "CEO Jack Dorsey emphasized Block's ambition to become the payments platform for Bitcoin globally while scaling Cash App and Square ecosystems. At November 2025 Investor Day, management expressed confidence in sustained mid-teens gross profit growth through 2028 with operating leverage driving 30% annual growth in operating income and EPS. CFO Amrita Ahuja highlighted strong profitability trajectory with margin expansion despite heavy marketing investment. Management committed to returning capital via $5B buyback program increase. Bitcoin payments rollout represents strategic differentiation; CFPB enforcement requires remediation investments but management confident in long-term trajectory. Afterpay integration into Cash App progressing with multi-phase rollout through 2026."
            }
        };

        // EMBEDDED DCF JSON
        const dcfData = {
            "ticker": "XYZ",
            "company_name": "Block, Inc.",
            "current_price": 64.0,
            "inputs": {
                "shares_outstanding": 635.4,
                "net_debt": -1050.4,
                "last_fcf": 1536.5
            },
            "historical_growth": {
                "revenue_3yr_cagr": 10.95,
                "revenue_5yr_cagr": 38.62,
                "eps_3yr_cagr": 77.89,
                "eps_5yr_cagr": 41.28,
                "equity_3yr_cagr": 85.77,
                "equity_5yr_cagr": 57.08,
                "fcf_3yr_cagr": 29.38,
                "fcf_5yr_cagr": 30.68,
                "selected_growth_rate": 15.0,
                "growth_rate_source": "Blended: Management guidance (15%+ GP growth) with FCF 3Y CAGR (29.4%)",
                "growth_divergence_warning": null
            },
            "assumptions": {
                "base": {
                    "description": "Management guidance of 15%+ gross profit growth with margin expansion to 21%",
                    "growth_rates": [15.0, 13.0, 11.0, 9.0, 7.0],
                    "fcf_margin": 6.5,
                    "wacc": 10.0,
                    "terminal_growth": 3.0
                },
                "bull": {
                    "description": "Cash App monetization accelerates, Afterpay drives BNPL leadership, Bitcoin payments gain traction",
                    "growth_rates": [22.0, 20.0, 17.0, 14.0, 11.0],
                    "fcf_margin": 7.5,
                    "wacc": 9.0,
                    "terminal_growth": 3.5
                },
                "bear": {
                    "description": "Competition intensifies, Square loses share, Bitcoin volatility hurts, macro headwinds",
                    "growth_rates": [8.0, 6.0, 5.0, 4.0, 3.0],
                    "fcf_margin": 5.5,
                    "wacc": 11.0,
                    "terminal_growth": 2.5
                }
            },
            "valuation": {
                "base": {
                    "intrinsic_value": 51.69,
                    "upside": -19.2
                },
                "bull": {
                    "intrinsic_value": 81.39,
                    "upside": 27.2
                },
                "bear": {
                    "intrinsic_value": 34.5,
                    "upside": -46.1
                }
            },
            "entry_price": {
                "base": {
                    "terminal_value_per_share": 59.86,
                    "entry_price": 29.76
                }
            },
            "sensitivity": {
                "wacc_range": [8.0, 9.0, 10.0, 11.0, 12.0],
                "terminal_growth_range": [2.0, 2.5, 3.0, 3.5, 4.0],
                "matrix": [
                    [62.32, 66.85, 72.29, 78.93, 87.24],
                    [53.41, 56.57, 60.27, 64.64, 69.88],
                    [46.73, 49.04, 51.69, 54.74, 58.31],
                    [41.54, 43.29, 45.26, 47.49, 50.05],
                    [37.39, 38.75, 40.27, 41.96, 43.86]
                ]
            },
            "probability_weighted": {
                "weighted_iv": 54.82
            }
        };

        // Parse CSV
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
                return obj;
            });
        }

        const data = parseCSV(csvData);

        // Sort chronologically (oldest first)
        data.sort((a, b) => {
            const parseDate = (p) => {
                const year = parseInt(p.match(/\d{4}/)?.[0] || '0');
                const isQ1 = p.includes('Q1');
                const isQ2 = p.includes('Q2');
                const isQ3 = p.includes('Q3');
                const isQ4 = p.includes('Q4');
                const isFY = p.startsWith('FY');
                const isE = p.includes('E');
                const subOrder = isQ1 ? 1 : isQ2 ? 2 : isQ3 ? 3 : isQ4 ? 4 : isFY ? (isE ? 6 : 5) : 0;
                return year * 10 + subOrder;
            };
            return parseDate(a.Period) - parseDate(b.Period);
        });

        // Filter for annual data
        const fyData = data.filter(d => d.Period.startsWith('FY'));

        // Color palette
        const colors = {
            primary: '#00d4aa',
            secondary: '#00b894',
            tertiary: '#0984e3',
            quaternary: '#6c5ce7',
            warning: '#fdcb6e',
            danger: '#ff6b6b'
        };

        // Chart defaults
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#e0e0e0', font: { size: 11 } } }
            },
            scales: {
                x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
        };

        // Calculate YoY change
        function calcYoYChange(current, previous) {
            if (!previous || !current || previous === '' || current === '') return null;
            const curr = parseFloat(current);
            const prev = parseFloat(previous);
            if (isNaN(curr) || isNaN(prev) || prev === 0) return null;
            return ((curr - prev) / Math.abs(prev) * 100).toFixed(1);
        }

        // Render KPI cards
        function renderKPIs() {
            const latest = fyData[fyData.length - 1];
            const previous = fyData[fyData.length - 2];

            const kpis = [
                { label: 'Revenue (FY2025E)', value: '$' + (parseFloat(latest.Revenue) / 1000).toFixed(1) + 'B', field: 'Revenue' },
                { label: 'Gross Profit (FY2025E)', value: '$' + (parseFloat(latest.GrossProfit) / 1000).toFixed(2) + 'B', field: 'GrossProfit' },
                { label: 'Gross Margin', value: parseFloat(latest.GrossMargin).toFixed(1) + '%', field: 'GrossMargin' },
                { label: 'Operating Income', value: '$' + (parseFloat(latest.OperatingIncome) / 1000).toFixed(2) + 'B', field: 'OperatingIncome' },
                { label: 'Operating Margin', value: parseFloat(latest.OperatingMargin).toFixed(1) + '%', field: 'OperatingMargin' },
                { label: 'EPS (FY2025E)', value: '$' + parseFloat(latest.EPS).toFixed(2), field: 'EPS' },
                { label: 'Free Cash Flow', value: '$' + (parseFloat(latest.FreeCashFlow) / 1000).toFixed(2) + 'B', field: 'FreeCashFlow' },
                { label: 'Net Cash Position', value: '$' + ((parseFloat(latest.CashAndEquivalents) - parseFloat(latest.TotalDebt)) / 1000).toFixed(2) + 'B', field: null }
            ];

            const grid = document.getElementById('kpiGrid');
            grid.innerHTML = kpis.map(kpi => {
                const change = kpi.field ? calcYoYChange(latest[kpi.field], previous[kpi.field]) : null;
                const changeHtml = change ? `<div class="kpi-change ${parseFloat(change) >= 0 ? 'positive' : 'negative'}">${parseFloat(change) >= 0 ? '+' : ''}${change}% YoY</div>` : '';
                return `
                    <div class="kpi-card">
                        <div class="kpi-value">${kpi.value}</div>
                        <div class="kpi-label">${kpi.label}</div>
                        ${changeHtml}
                    </div>
                `;
            }).join('');
        }

        // Render guidance section
        function renderGuidance() {
            if (!analysis.guidance || !analysis.guidance.items || analysis.guidance.items.length === 0) {
                document.getElementById('guidanceSection').style.display = 'none';
                return;
            }

            const guidance = analysis.guidance;
            document.getElementById('guidanceAsOf').textContent = guidance.as_of || '';
            document.getElementById('guidanceFY').textContent = guidance.fiscal_year || '';

            const grid = document.getElementById('guidanceGrid');
            grid.innerHTML = guidance.items.map(item => {
                const vsClass = item.vs_prior ? item.vs_prior.toLowerCase().replace(/\s+/g, '-') : 'new';
                const vsLabel = item.vs_prior ? item.vs_prior.charAt(0).toUpperCase() + item.vs_prior.slice(1) : 'New';
                return `
                    <div class="guidance-card">
                        <div class="guidance-metric">${item.metric}</div>
                        <div class="guidance-target">${item.target}</div>
                        <div class="guidance-period">${item.period}</div>
                        <span class="guidance-vs-prior ${vsClass}">${vsLabel}</span>
                        ${item.notes ? `<div class="guidance-notes">${item.notes}</div>` : ''}
                    </div>
                `;
            }).join('');

            const commentary = document.getElementById('guidanceCommentary');
            if (guidance.management_commentary) {
                commentary.textContent = guidance.management_commentary;
                commentary.style.display = 'block';
            } else {
                commentary.style.display = 'none';
            }
        }

        // Create chart helper
        function createChart(containerId, title, helpKey) {
            const container = document.getElementById(containerId);
            const chartId = 'chart_' + Math.random().toString(36).substr(2, 9);
            const html = `
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>${title}</h3>
                        <button class="help-btn" onclick="openModal('${helpKey}')">?</button>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="${chartId}"></canvas>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            return chartId;
        }

        // Render all charts
        function renderCharts() {
            // Revenue & Gross Profit
            const revenueId = createChart('chartsContainer', 'Revenue & Gross Profit', 'revenue');
            new Chart(document.getElementById(revenueId), {
                type: 'bar',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [
                        {
                            label: 'Revenue',
                            data: fyData.map(d => parseFloat(d.Revenue) / 1000),
                            backgroundColor: colors.primary + '80',
                            borderColor: colors.primary,
                            borderWidth: 2
                        },
                        {
                            label: 'Gross Profit',
                            data: fyData.map(d => parseFloat(d.GrossProfit) / 1000),
                            backgroundColor: colors.tertiary + '80',
                            borderColor: colors.tertiary,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, title: { display: true, text: 'Billions ($)', color: '#888' } }
                    }
                }
            });

            // Gross Margin Trend
            const marginId = createChart('chartsContainer', 'Gross Margin Trend', 'grossMargin');
            new Chart(document.getElementById(marginId), {
                type: 'line',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [{
                        label: 'Gross Margin %',
                        data: fyData.map(d => parseFloat(d.GrossMargin)),
                        borderColor: colors.primary,
                        backgroundColor: colors.primary + '20',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, title: { display: true, text: 'Margin %', color: '#888' } }
                    }
                }
            });

            // Operating Income & Margin
            const opIncomeId = createChart('profitabilityContainer', 'Operating Income & Margin', 'operatingIncome');
            new Chart(document.getElementById(opIncomeId), {
                type: 'bar',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [
                        {
                            label: 'Operating Income ($B)',
                            data: fyData.map(d => parseFloat(d.OperatingIncome) / 1000),
                            backgroundColor: colors.quaternary + '80',
                            borderColor: colors.quaternary,
                            borderWidth: 2,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Operating Margin %',
                            data: fyData.map(d => parseFloat(d.OperatingMargin)),
                            type: 'line',
                            borderColor: colors.warning,
                            backgroundColor: colors.warning + '20',
                            borderWidth: 3,
                            yAxisID: 'y1',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, title: { display: true, text: 'Billions ($)', color: '#888' }, position: 'left' },
                        y1: { ...chartDefaults.scales.y, title: { display: true, text: 'Margin %', color: '#888' }, position: 'right', grid: { display: false } }
                    }
                }
            });

            // EPS Growth
            const epsId = createChart('profitabilityContainer', 'Earnings Per Share (EPS)', 'eps');
            new Chart(document.getElementById(epsId), {
                type: 'bar',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [{
                        label: 'EPS ($)',
                        data: fyData.map(d => parseFloat(d.EPS)),
                        backgroundColor: colors.primary + '80',
                        borderColor: colors.primary,
                        borderWidth: 2
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, title: { display: true, text: 'EPS ($)', color: '#888' } }
                    }
                }
            });

            // Free Cash Flow
            const fcfId = createChart('profitabilityContainer', 'Free Cash Flow', 'fcf');
            new Chart(document.getElementById(fcfId), {
                type: 'bar',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [{
                        label: 'Free Cash Flow ($B)',
                        data: fyData.map(d => parseFloat(d.FreeCashFlow) / 1000),
                        backgroundColor: colors.secondary + '80',
                        borderColor: colors.secondary,
                        borderWidth: 2
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, title: { display: true, text: 'Billions ($)', color: '#888' } }
                    }
                }
            });

            // Operating Cash Flow vs CapEx
            const cashFlowId = createChart('profitabilityContainer', 'Operating Cash Flow vs Capital Expenditures', 'cashFlow');
            new Chart(document.getElementById(cashFlowId), {
                type: 'bar',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [
                        {
                            label: 'Operating Cash Flow',
                            data: fyData.map(d => parseFloat(d.OperatingCashFlow) / 1000),
                            backgroundColor: colors.primary + '80',
                            borderColor: colors.primary,
                            borderWidth: 2
                        },
                        {
                            label: 'Capital Expenditures',
                            data: fyData.map(d => parseFloat(d.CapitalExpenditures) / 1000),
                            backgroundColor: colors.danger + '80',
                            borderColor: colors.danger,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, title: { display: true, text: 'Billions ($)', color: '#888' } }
                    }
                }
            });

            // Shareholders Equity
            const equityId = createChart('balanceSheetContainer', 'Shareholders Equity', 'equity');
            new Chart(document.getElementById(equityId), {
                type: 'line',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [{
                        label: 'Shareholders Equity ($B)',
                        data: fyData.map(d => parseFloat(d.ShareholdersEquity) / 1000),
                        borderColor: colors.primary,
                        backgroundColor: colors.primary + '20',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, title: { display: true, text: 'Billions ($)', color: '#888' } }
                    }
                }
            });

            // Debt vs Cash
            const debtId = createChart('balanceSheetContainer', 'Total Debt vs Cash & Equivalents', 'debt');
            new Chart(document.getElementById(debtId), {
                type: 'bar',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [
                        {
                            label: 'Total Debt',
                            data: fyData.map(d => parseFloat(d.TotalDebt) / 1000),
                            backgroundColor: colors.danger + '80',
                            borderColor: colors.danger,
                            borderWidth: 2
                        },
                        {
                            label: 'Cash & Equivalents',
                            data: fyData.map(d => parseFloat(d.CashAndEquivalents) / 1000),
                            backgroundColor: colors.primary + '80',
                            borderColor: colors.primary,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, title: { display: true, text: 'Billions ($)', color: '#888' } }
                    }
                }
            });
        }

        // Metric descriptions for modals
        const metricDescriptions = {
            revenue: {
                title: "Revenue",
                content: `
                    <p><strong>Revenue</strong> is Block's total income from its Square and Cash App ecosystems.</p>
                    <div class="metric-highlight">
                        <strong>For Block:</strong> Revenue includes transaction-based fees (payment processing), subscription fees (Square software), Bitcoin trading (51% of Cash App revenue, highly volatile), Cash App P2P fees, Cash Card interchange, and hardware sales. Bitcoin revenue creates significant volatility but carries low margins; gross profit is a better indicator of core business health.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Revenue growth accelerating in FY2025E to $24.3B (+0.7% YoY) but focus on gross profit growth (15%+ per guidance)</li>
                        <li>Bitcoin price swings can materially impact reported revenue without affecting profitability</li>
                        <li>Cash App vs Square revenue mix: Cash App growing faster (24% YoY GP growth Q3 2025)</li>
                    </ul>
                `
            },
            grossMargin: {
                title: "Gross Margin",
                content: `
                    <p><strong>Gross Margin</strong> is gross profit divided by revenue, showing profitability after direct costs.</p>
                    <div class="metric-highlight">
                        <strong>For Block:</strong> Gross margin has dramatically improved from 28.8% (FY2020) to 42.1% (FY2025E) as the company shifts focus from low-margin Bitcoin revenue to high-margin services. Management targets continued margin expansion through Cash App monetization (lending, subscriptions), Square software upsell, and operational efficiency.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Target: 40%+ gross margin sustained in FY2025E and beyond</li>
                        <li>Bitcoin revenue swings can mask underlying margin trends - watch gross profit absolute growth instead</li>
                        <li>Cash App ARPU (average revenue per user) growth drives margin expansion</li>
                        <li>Square software and subscription revenue are higher-margin than payment processing</li>
                    </ul>
                `
            },
            operatingIncome: {
                title: "Operating Income & Margin",
                content: `
                    <p><strong>Operating Income</strong> is profit after all operating expenses (marketing, R&D, G&A). Operating margin shows this as a percentage of revenue.</p>
                    <div class="metric-highlight">
                        <strong>For Block:</strong> Operating margin has inflected dramatically from 0.4% (FY2020) to 8.6% (FY2025E) as Block achieves scale economies. Management guides to continued expansion toward 21% operating margin by FY2026, driven by gross profit leverage and controlled marketing spend (despite 20%+ YoY increases).
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>FY2026 guidance: $2.70B operating income (30%+ YoY growth) on $11.98B gross profit = 22.5% margin</li>
                        <li>Marketing efficiency: Can Block maintain growth while controlling CAC (customer acquisition cost)?</li>
                        <li>CFPB enforcement remediation costs ($175M penalty + 24-hour live support requirement) create near-term headwind</li>
                        <li>Operating leverage is key investment thesis: GP growing faster than opex</li>
                    </ul>
                `
            },
            eps: {
                title: "Earnings Per Share (EPS)",
                content: `
                    <p><strong>EPS</strong> is net income divided by shares outstanding, showing per-share profitability.</p>
                    <div class="metric-highlight">
                        <strong>For Block:</strong> EPS reached $4.56 in FY2024 (exceptional due to one-time tax benefit) and normalizing to $3.00 in FY2025E. Management guides aggressive growth: $3.20 in FY2026 (30%+ YoY) accelerating to $5.50 by FY2028 (low 30% annual growth). This reflects both operating leverage and $5B share buyback program initiated November 2025.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>FY2024 EPS of $4.56 included one-time benefit - focus on FY2025E normalized $3.00 as baseline</li>
                        <li>Share buyback impact: $5B authorization (on top of $1.1B remaining) will reduce share count, boosting EPS</li>
                        <li>Tax rate normalization after FY2024 benefit creates headwind to EPS growth in FY2025</li>
                        <li>Consensus expects aggressive EPS growth driven by operating margin expansion</li>
                    </ul>
                `
            },
            fcf: {
                title: "Free Cash Flow",
                content: `
                    <p><strong>Free Cash Flow</strong> is operating cash flow minus capital expenditures, showing cash available for shareholders.</p>
                    <div class="metric-highlight">
                        <strong>For Block:</strong> FCF has grown dramatically from $327M (FY2020) to $2.325B (FY2025E), representing 29.4% 3-year CAGR. Management targets $2.40B in FY2026 (20% of gross profit), funding $5B share buyback program while maintaining strategic flexibility. Low capex intensity (under $200M annually) creates high cash conversion.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>FCF margin target: 20% of gross profit = $2.40B on $11.98B GP in FY2026</li>
                        <li>Capital allocation: $5B buyback announced November 2025 signals confidence and shareholder returns</li>
                        <li>Cash App lending and Square Capital create working capital swings - watch operating cash flow trends</li>
                        <li>Net cash position of $1.3B (cash minus debt) provides balance sheet strength</li>
                    </ul>
                `
            },
            cashFlow: {
                title: "Operating Cash Flow vs Capital Expenditures",
                content: `
                    <p><strong>Operating Cash Flow</strong> is cash generated from operations. <strong>Capital Expenditures</strong> are investments in fixed assets.</p>
                    <div class="metric-highlight">
                        <strong>For Block:</strong> Operating cash flow reached $2.5B in FY2025E while capex remains modest at $175M, demonstrating Block's asset-light business model. Software, payment processing, and financial services require minimal physical infrastructure, creating high cash conversion rates and funding aggressive share buybacks.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Low capex intensity (under 1% of revenue) sustains high FCF conversion</li>
                        <li>Operating cash flow growth accelerating as operating margins expand</li>
                        <li>Working capital from lending businesses (Cash App Borrow, Square Capital) can create timing swings</li>
                    </ul>
                `
            },
            equity: {
                title: "Shareholders Equity",
                content: `
                    <p><strong>Shareholders Equity</strong> is the book value of the company (assets minus liabilities).</p>
                    <div class="metric-highlight">
                        <strong>For Block:</strong> Equity has grown from $3.0B (FY2020) to $23.0B (FY2025E), representing 85.8% 3-year CAGR. This reflects massive profitability inflection in FY2024 and cumulative retained earnings. However, $5B share buyback program will reduce equity but increase per-share value through accretion.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Rapid equity growth demonstrates profitability transformation (FY2024 net income $2.9B)</li>
                        <li>Share buybacks will reduce absolute equity but increase book value per share</li>
                        <li>Strong balance sheet supports strategic flexibility and growth investments</li>
                    </ul>
                `
            },
            debt: {
                title: "Total Debt vs Cash & Equivalents",
                content: `
                    <p><strong>Total Debt</strong> is all borrowings. <strong>Cash & Equivalents</strong> are liquid assets immediately available.</p>
                    <div class="metric-highlight">
                        <strong>For Block:</strong> Block maintains net cash position of $1.2B (FY2025E: $8.5B cash vs $7.3B debt). Total debt of $7.3B carries manageable interest coverage of 9.2x. Strong balance sheet provides strategic optionality for M&A, buybacks, and Bitcoin investments while maintaining financial flexibility.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Net cash position provides downside protection in economic downturns</li>
                        <li>Debt serviceability strong with 9.2x interest coverage ratio</li>
                        <li>Balance sheet also includes 8,692 BTC (over $1B value) - mark-to-market exposure to crypto volatility</li>
                        <li>Management commits 10% of Bitcoin gross profit to monthly BTC purchases, increasing crypto exposure</li>
                    </ul>
                `
            }
        };

        // Modal functions
        function openModal(key) {
            document.getElementById('modalTitle').textContent = metricDescriptions[key].title;
            document.getElementById('modalBody').innerHTML = metricDescriptions[key].content;
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay')) return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // Toggle overview
        function toggleOverview() {
            const btn = document.querySelector('.overview-toggle');
            const content = document.getElementById('overviewContent');
            btn.classList.toggle('active');
            content.classList.toggle('active');
        }

        // DCF Functions
        let currentScenario = 'base';

        function calculateDCF(growthRate, wacc, terminalGrowth) {
            const years = 5;
            const fcf = dcfData.inputs.last_fcf;
            let pvFCF = 0;
            let projectedFCF = fcf;

            for (let i = 0; i < years; i++) {
                projectedFCF *= (1 + growthRate / 100);
                pvFCF += projectedFCF / Math.pow(1 + wacc/100, i + 1);
            }

            const terminalFCF = projectedFCF * (1 + terminalGrowth/100);
            const terminalValue = terminalFCF / (wacc/100 - terminalGrowth/100);
            const pvTerminal = terminalValue / Math.pow(1 + wacc/100, years);

            const enterpriseValue = pvFCF + pvTerminal;
            const equityValue = enterpriseValue - dcfData.inputs.net_debt;
            const iv = equityValue / dcfData.inputs.shares_outstanding;

            const terminalPerShare = terminalValue / dcfData.inputs.shares_outstanding;
            const entryPrice = terminalPerShare / Math.pow(1.15, years);

            return {
                iv: iv,
                entryPrice: entryPrice,
                terminalPerShare: terminalPerShare,
                pvFCF: pvFCF,
                pvTerminal: pvTerminal,
                enterpriseValue: enterpriseValue
            };
        }

        function updateDCFDisplay() {
            const growth = parseFloat(document.getElementById('growthSlider').value);
            const wacc = parseFloat(document.getElementById('waccSlider').value);
            const terminal = parseFloat(document.getElementById('terminalSlider').value);

            document.getElementById('growthValue').textContent = growth + '%';
            document.getElementById('waccValue').textContent = wacc + '%';
            document.getElementById('terminalValue').textContent = terminal + '%';

            const result = calculateDCF(growth, wacc, terminal);

            document.getElementById('dcfIV').textContent = '$' + result.iv.toFixed(0);
            document.getElementById('dcfEntry').textContent = '$' + result.entryPrice.toFixed(0);

            const upside = ((result.iv - dcfData.current_price) / dcfData.current_price * 100);
            const upsideEl = document.getElementById('dcfUpside');
            upsideEl.textContent = (upside >= 0 ? '+' : '') + upside.toFixed(0) + '% ' + (upside >= 0 ? 'upside' : 'downside');
            upsideEl.className = 'dcf-change ' + (upside >= 0 ? 'positive' : 'negative');

            document.getElementById('dcfWeighted').textContent = '$' + dcfData.probability_weighted.weighted_iv.toFixed(0);

            const grid = document.getElementById('assumptionGrid');
            if (grid) {
                grid.innerHTML = `
                    <div class="assumption-item">
                        <div class="label">Growth Rate</div>
                        <div class="value">${growth}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">WACC</div>
                        <div class="value">${wacc}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Terminal Growth</div>
                        <div class="value">${terminal}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Intrinsic Value</div>
                        <div class="value" style="color: #00d4aa;">$${result.iv.toFixed(0)}</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Entry Price</div>
                        <div class="value" style="color: #00d4aa;">$${result.entryPrice.toFixed(0)}</div>
                    </div>
                `;
            }
        }

        function switchScenario(scenario) {
            currentScenario = scenario;

            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === scenario);
            });

            const assumptions = dcfData.assumptions[scenario];
            const valuation = dcfData.valuation[scenario];

            document.getElementById('growthSlider').value = assumptions.growth_rates[0];
            document.getElementById('waccSlider').value = assumptions.wacc;
            document.getElementById('terminalSlider').value = assumptions.terminal_growth;

            const grid = document.getElementById('assumptionGrid');
            grid.innerHTML = `
                <div class="assumption-item">
                    <div class="label">Year 1 Growth</div>
                    <div class="value">${assumptions.growth_rates[0]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Year 5 Growth</div>
                    <div class="value">${assumptions.growth_rates[4]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">FCF Margin</div>
                    <div class="value">${assumptions.fcf_margin}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">WACC</div>
                    <div class="value">${assumptions.wacc}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Terminal Growth</div>
                    <div class="value">${assumptions.terminal_growth}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Intrinsic Value</div>
                    <div class="value" style="color: #00d4aa;">$${valuation.intrinsic_value.toFixed(0)}</div>
                </div>
            `;

            updateDCFDisplay();
        }

        function renderHistoricalGrowth() {
            const growth = dcfData.historical_growth;
            const selectedSource = growth.growth_rate_source;
            const grid = document.getElementById('growthGrid');

            const metrics = [
                { key: 'revenue_3yr_cagr', label: 'Revenue 3Y' },
                { key: 'revenue_5yr_cagr', label: 'Revenue 5Y' },
                { key: 'eps_3yr_cagr', label: 'EPS 3Y' },
                { key: 'eps_5yr_cagr', label: 'EPS 5Y' },
                { key: 'equity_3yr_cagr', label: 'Equity 3Y' },
                { key: 'equity_5yr_cagr', label: 'Equity 5Y' },
                { key: 'fcf_3yr_cagr', label: 'FCF 3Y' },
                { key: 'fcf_5yr_cagr', label: 'FCF 5Y' }
            ];

            grid.innerHTML = metrics.map(m => {
                const rate = growth[m.key];
                const isSelected = selectedSource.toLowerCase().includes(m.label.toLowerCase().replace(/\s/g, ''));
                const colorClass = rate >= 0 ? 'positive' : 'negative';
                return `
                    <div class="growth-item ${isSelected ? 'selected' : ''}">
                        <div class="metric">${m.label}</div>
                        <div class="rate ${colorClass}">${rate >= 0 ? '+' : ''}${rate.toFixed(1)}%</div>
                    </div>
                `;
            }).join('');
        }

        function renderSensitivityMatrix() {
            const sens = dcfData.sensitivity;
            const table = document.getElementById('sensitivityMatrix');
            const currentPrice = dcfData.current_price;

            let html = '<tr><th>WACC \\ Term G</th>';
            sens.terminal_growth_range.forEach(tg => {
                html += `<th>${tg}%</th>`;
            });
            html += '</tr>';

            sens.wacc_range.forEach((wacc, i) => {
                html += `<tr><th>${wacc}%</th>`;
                sens.matrix[i].forEach((val, j) => {
                    const isHighlight = wacc === dcfData.assumptions.base.wacc &&
                                       sens.terminal_growth_range[j] === dcfData.assumptions.base.terminal_growth;
                    const colorClass = val >= currentPrice ? 'above-current' : 'below-current';
                    html += `<td class="${isHighlight ? 'highlight' : colorClass}">$${val}</td>`;
                });
                html += '</tr>';
            });

            table.innerHTML = html;
        }

        function initDCF() {
            if (!dcfData || !dcfData.valuation) return;

            document.getElementById('dcfCurrent').textContent = '$' + dcfData.current_price.toFixed(0);

            const base = dcfData.assumptions.base;
            document.getElementById('growthSlider').value = dcfData.historical_growth.selected_growth_rate;
            document.getElementById('waccSlider').value = base.wacc;
            document.getElementById('terminalSlider').value = base.terminal_growth;

            document.getElementById('growthValue').textContent = dcfData.historical_growth.selected_growth_rate + '%';
            document.getElementById('waccValue').textContent = base.wacc + '%';
            document.getElementById('terminalValue').textContent = base.terminal_growth + '%';

            document.getElementById('growthHint').textContent = 'Based on management guidance';

            renderHistoricalGrowth();
            renderSensitivityMatrix();
            updateDCFDisplay();
            switchScenario('base');
        }

        // Initialize dashboard
        renderKPIs();
        renderGuidance();
        renderCharts();
        initDCF();

        // Bind slider events
        document.getElementById('growthSlider').oninput = updateDCFDisplay;
        document.getElementById('waccSlider').oninput = updateDCFDisplay;
        document.getElementById('terminalSlider').oninput = updateDCFDisplay;
    </script>
</body>
</html>
