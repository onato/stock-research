<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Technology S.A. (SPOT) Financial Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: #e0e0e0;
    min-height: 100vh;
    padding: 20px;
}
.header {
    text-align: center;
    margin-bottom: 30px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    backdrop-filter: blur(10px);
}
.header h1 {
    font-size: 2.5rem;
    background: linear-gradient(90deg, #00d4aa, #00b894);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
}
.header p {
    color: #888;
    font-size: 1.1rem;
}
/* Investment Overview Section */
.overview-section {
    max-width: 1400px;
    margin: 0 auto 30px;
}
.overview-toggle {
    width: 100%;
    background: rgba(0, 212, 170, 0.1);
    border: 1px solid rgba(0, 212, 170, 0.3);
    border-radius: 12px;
    padding: 16px 24px;
    color: #00d4aa;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.2s ease;
}
.overview-toggle:hover {
    background: rgba(0, 212, 170, 0.2);
}
.overview-toggle .arrow {
    transition: transform 0.3s ease;
}
.overview-toggle.active .arrow {
    transform: rotate(180deg);
}
.overview-content {
    display: none;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-top: none;
    border-radius: 0 0 12px 12px;
    padding: 30px;
    margin-top: -12px;
}
.overview-content.active {
    display: block;
}
.overview-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 25px;
}
.overview-card {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.overview-card h3 {
    color: #00d4aa;
    font-size: 1.1rem;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.overview-card p {
    margin-bottom: 12px;
    line-height: 1.6;
}
.overview-card ul {
    list-style: none;
    padding: 0;
    margin: 0;
}
.overview-card li {
    padding: 8px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    line-height: 1.5;
}
.overview-card li:last-child {
    border-bottom: none;
}
.overview-card.bull h3 { color: #00d4aa; }
.overview-card.bear h3 { color: #ff6b6b; }
.overview-card.risks h3 { color: #fdcb6e; }
.risk-high { color: #ff6b6b; }
.risk-moderate { color: #fdcb6e; }
.risk-low { color: #00d4aa; }
.revenue-stream {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.revenue-stream .percent {
    color: #00d4aa;
    font-weight: 600;
}
.trend-growing { color: #00d4aa; }
.trend-stable { color: #888; }
.trend-declining { color: #ff6b6b; }
.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 30px;
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
}
.kpi-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.kpi-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 212, 170, 0.2);
}
.kpi-value {
    font-size: 1.8rem;
    font-weight: bold;
    color: #00d4aa;
    margin-bottom: 5px;
}
.kpi-label {
    font-size: 0.85rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 1px;
}
.kpi-change {
    font-size: 0.9rem;
    margin-top: 5px;
}
.kpi-change.positive { color: #00d4aa; }
.kpi-change.negative { color: #ff6b6b; }
/* Guidance Section */
.guidance-section {
    max-width: 1400px;
    margin: 0 auto 30px;
}
.guidance-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}
.guidance-header h3 {
    color: #fff;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 10px;
}
.guidance-header h3::before {
    content: '';
    display: inline-block;
    width: 4px;
    height: 20px;
    background: linear-gradient(180deg, #00d4aa, #00b894);
    border-radius: 2px;
}
.guidance-meta {
    font-size: 0.85rem;
    color: #888;
}
.guidance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}
.guidance-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 18px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: transform 0.2s ease;
}
.guidance-card:hover {
    transform: translateY(-2px);
}
.guidance-metric {
    font-size: 0.8rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 6px;
}
.guidance-target {
    font-size: 1.4rem;
    font-weight: 600;
    color: #00d4aa;
    margin-bottom: 6px;
}
.guidance-period {
    font-size: 0.85rem;
    color: #e0e0e0;
    margin-bottom: 8px;
}
.guidance-vs-prior {
    display: inline-block;
    font-size: 0.75rem;
    padding: 3px 8px;
    border-radius: 4px;
    font-weight: 500;
}
.guidance-vs-prior.raised {
    background: rgba(0, 212, 170, 0.15);
    color: #00d4aa;
}
.guidance-vs-prior.lowered {
    background: rgba(255, 107, 107, 0.15);
    color: #ff6b6b;
}
.guidance-vs-prior.maintained {
    background: rgba(255, 255, 255, 0.1);
    color: #888;
}
.guidance-vs-prior.new {
    background: rgba(99, 102, 241, 0.15);
    color: #818cf8;
}
.guidance-notes {
    font-size: 0.8rem;
    color: #666;
    margin-top: 8px;
    line-height: 1.4;
}
.guidance-commentary {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    padding: 16px 20px;
    border-left: 3px solid #00d4aa;
    font-style: italic;
    color: #b0b0b0;
    line-height: 1.6;
}
.guidance-commentary::before {
    content: '"';
    font-size: 1.5rem;
    color: #00d4aa;
    margin-right: 4px;
}
.section-title {
    font-size: 1.5rem;
    color: #fff;
    margin: 40px auto 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid rgba(0, 212, 170, 0.3);
    max-width: 1400px;
}
.charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 25px;
    max-width: 1400px;
    margin: 0 auto;
}
.chart-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 25px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}
.chart-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
}
.chart-header h3 {
    color: #fff;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 10px;
}
.chart-header h3::before {
    content: '';
    display: inline-block;
    width: 4px;
    height: 20px;
    background: linear-gradient(180deg, #00d4aa, #00b894);
    border-radius: 2px;
}
.help-btn {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: rgba(0, 212, 170, 0.2);
    border: 1px solid #00d4aa;
    color: #00d4aa;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}
.help-btn:hover {
    background: #00d4aa;
    color: #1a1a2e;
}
.chart-wrapper {
    position: relative;
    height: 300px;
}
.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    padding: 20px;
}
.modal-overlay.active { display: flex; }
.modal {
    background: linear-gradient(135deg, #1e2a4a 0%, #16213e 100%);
    border-radius: 16px;
    max-width: 600px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
    border: 1px solid rgba(0, 212, 170, 0.3);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}
.modal-header {
    padding: 20px 25px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.modal-header h3 {
    color: #00d4aa;
    font-size: 1.4rem;
    margin: 0;
}
.modal-close {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(255, 107, 107, 0.2);
    border: 1px solid #ff6b6b;
    color: #ff6b6b;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}
.modal-close:hover {
    background: #ff6b6b;
    color: #fff;
}
.modal-body {
    padding: 25px;
    line-height: 1.7;
}
.modal-body p { margin-bottom: 15px; }
.modal-body strong { color: #00d4aa; }
.modal-body ul { margin: 15px 0; padding-left: 20px; }
.modal-body li { margin-bottom: 8px; }
.metric-highlight {
    background: rgba(0, 212, 170, 0.1);
    border-left: 3px solid #00d4aa;
    padding: 12px 15px;
    margin: 15px 0;
    border-radius: 0 8px 8px 0;
}
/* DCF Valuation Section */
.dcf-section {
    max-width: 1400px;
    margin: 0 auto 40px;
}
.dcf-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}
.dcf-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 24px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: transform 0.3s ease;
}
.dcf-card:hover {
    transform: translateY(-3px);
}
.dcf-card.highlight {
    background: rgba(0, 212, 170, 0.1);
    border-color: rgba(0, 212, 170, 0.3);
}
.dcf-label {
    font-size: 0.85rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}
.dcf-value {
    font-size: 2.2rem;
    font-weight: bold;
    color: #00d4aa;
}
.dcf-card:not(.highlight) .dcf-value {
    color: #fff;
}
.dcf-change {
    font-size: 1rem;
    margin-top: 8px;
    font-weight: 600;
}
.dcf-change.positive { color: #00d4aa; }
.dcf-change.negative { color: #ff6b6b; }
.dcf-sublabel {
    font-size: 0.8rem;
    color: #666;
    margin-top: 8px;
}
.dcf-warning {
    background: rgba(253, 203, 110, 0.15);
    border: 1px solid rgba(253, 203, 110, 0.4);
    border-radius: 8px;
    padding: 12px 16px;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 10px;
    color: #fdcb6e;
}
.warning-icon {
    font-size: 1.2rem;
}
.dcf-inputs {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.dcf-inputs h4 {
    color: #e0e0e0;
    margin-bottom: 15px;
    font-size: 1rem;
}
.dcf-inputs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}
.dcf-input-card {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    padding: 12px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.05);
}
.dcf-input-label {
    font-size: 0.75rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
}
.dcf-input-value {
    font-size: 1.3rem;
    font-weight: 600;
    color: #00d4aa;
}
.dcf-input-note {
    font-size: 0.7rem;
    color: #666;
    margin-top: 4px;
}
.fcf-projections h5 {
    color: #b0b0b0;
    font-size: 0.9rem;
    margin-bottom: 10px;
}
.fcf-projection-table {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 8px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 12px;
}
.fcf-projection-item {
    text-align: center;
}
.fcf-projection-item.header {
    font-size: 0.75rem;
    color: #888;
    font-weight: 600;
}
.fcf-projection-item .year {
    font-size: 0.75rem;
    color: #888;
    margin-bottom: 2px;
}
.fcf-projection-item .fcf-value {
    font-size: 1rem;
    color: #e0e0e0;
    font-weight: 500;
}
.fcf-projection-item .growth-rate {
    font-size: 0.75rem;
    color: #00d4aa;
    margin-top: 2px;
}
.dcf-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
    padding: 25px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.slider-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.slider-group label {
    font-size: 0.95rem;
    color: #e0e0e0;
    display: flex;
    justify-content: space-between;
}
.slider-group label span {
    color: #00d4aa;
    font-weight: 600;
}
.slider-group input[type="range"] {
    -webkit-appearance: none;
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: rgba(255, 255, 255, 0.1);
    outline: none;
}
.slider-group input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #00d4aa;
    cursor: pointer;
    transition: transform 0.2s;
}
.slider-group input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
}
.slider-group input[type="range"]::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #00d4aa;
    cursor: pointer;
    border: none;
}
.slider-hint {
    font-size: 0.8rem;
    color: #666;
}
.scenario-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}
.scenario-tab {
    padding: 10px 24px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    background: transparent;
    color: #888;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.95rem;
    transition: all 0.2s;
}
.scenario-tab:hover {
    border-color: rgba(0, 212, 170, 0.5);
    color: #e0e0e0;
}
.scenario-tab.active {
    background: rgba(0, 212, 170, 0.15);
    border-color: #00d4aa;
    color: #00d4aa;
}
.scenario-details {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 30px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.scenario-details h4 {
    color: #00d4aa;
    margin-bottom: 15px;
}
.assumption-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}
.assumption-item {
    text-align: center;
}
.assumption-item .label {
    font-size: 0.8rem;
    color: #888;
    margin-bottom: 4px;
}
.assumption-item .value {
    font-size: 1.1rem;
    color: #e0e0e0;
    font-weight: 500;
}
.sensitivity-section {
    margin-bottom: 30px;
}
.sensitivity-section h4 {
    color: #e0e0e0;
    margin-bottom: 15px;
}
.sensitivity-table {
    width: 100%;
    border-collapse: collapse;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    overflow: hidden;
}
.sensitivity-table th,
.sensitivity-table td {
    padding: 12px 16px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.sensitivity-table th {
    background: rgba(0, 212, 170, 0.1);
    color: #00d4aa;
    font-weight: 600;
}
.sensitivity-table td {
    color: #e0e0e0;
}
.sensitivity-table td.highlight {
    background: rgba(0, 212, 170, 0.15);
    color: #00d4aa;
    font-weight: 600;
}
.sensitivity-table td.below-current {
    color: #ff6b6b;
}
.sensitivity-table td.above-current {
    color: #00d4aa;
}
.historical-growth {
    margin-bottom: 30px;
}
.historical-growth h4 {
    color: #e0e0e0;
    margin-bottom: 15px;
}
.growth-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 15px;
}
.growth-item {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.growth-item .metric {
    font-size: 0.8rem;
    color: #888;
    margin-bottom: 6px;
}
.growth-item .rate {
    font-size: 1.2rem;
    font-weight: 600;
}
.growth-item .rate.positive { color: #00d4aa; }
.growth-item .rate.negative { color: #ff6b6b; }
.growth-item.selected {
    border-color: #00d4aa;
    background: rgba(0, 212, 170, 0.1);
}
@media (max-width: 768px) {
    .charts-container { grid-template-columns: 1fr; }
    .overview-grid { grid-template-columns: 1fr; }
    .header h1 { font-size: 1.8rem; }
}
    </style>
</head>
<body>
    <div class="header">
        <h1>Spotify Technology S.A. (SPOT)</h1>
        <p>Global Audio Streaming Platform | Financial Dashboard</p>
    </div>

    <!-- Investment Overview Section -->
    <div class="overview-section">
        <button class="overview-toggle" onclick="toggleOverview()">
            <span>Investment Overview & Analysis</span>
            <span class="arrow">▼</span>
        </button>
        <div class="overview-content" id="overviewContent">
            <div class="overview-grid">
                <!-- Company Overview -->
                <div class="overview-card">
                    <h3>Company Overview</h3>
                    <p>Spotify is the world's largest audio streaming subscription service with 713 million monthly active users (MAUs) and 281 million Premium subscribers across 184 countries and territories as of Q3 2025. The company has transformed from a music-only platform into a multi-format audio ecosystem offering music (100+ million tracks), podcasts (6.5+ million titles), and audiobooks (500,000+ titles in select markets), generating revenue through Premium subscriptions and advertising.</p>
                </div>

                <!-- Business Model -->
                <div class="overview-card">
                    <h3>Business Model</h3>
                    <p><strong>Summary:</strong> Dual-revenue model consisting of Premium subscriptions (~90% of revenue) and Ad-Supported revenue (~10%), with transition from transaction-based music ownership to access-based streaming. Recent expansion into podcasts and audiobooks diversifying content offerings beyond music.</p>
                    <ul>
                        <li>
                            <div class="revenue-stream">
                                <span>Premium Subscriptions <span class="trend-growing">↑ Growing</span></span>
                                <span class="percent">90%</span>
                            </div>
                        </li>
                        <li>
                            <div class="revenue-stream">
                                <span>Ad-Supported <span class="trend-stable">→ Stable to declining</span></span>
                                <span class="percent">10%</span>
                            </div>
                        </li>
                    </ul>
                    <p style="margin-top: 12px;"><strong>Customer Type:</strong> B2C, primarily individual consumers with family and student plans available</p>
                    <p><strong>Geographic Mix:</strong> Global presence across 184 markets with strong concentration in Europe (31% of streaming market), North America (39% of streaming market), and growing presence in Latin America and Asia-Pacific</p>
                </div>

                <!-- Competitive Position -->
                <div class="overview-card">
                    <h3>Competitive Position</h3>
                    <p><strong>Market Leader:</strong> Global market leader with 31.5% share of music streaming subscribers, significantly ahead of Apple Music (20%) and Amazon Music (15%)</p>
                    <p><strong>Key Competitors:</strong> Apple Music, Amazon Music, YouTube Music, Tencent Music, SiriusXM</p>
                    <p><strong>Moat Factors:</strong></p>
                    <ul>
                        <li><strong>Scale and Network Effects (Strong):</strong> 713M MAUs create unmatched data for personalization algorithms</li>
                        <li><strong>Personalization and Discovery (Strong):</strong> Industry-leading AI/ML-powered recommendation engine (Discover Weekly, Daily Mix)</li>
                        <li><strong>Platform Ubiquity (Moderate):</strong> Spotify Connect works across 379+ devices</li>
                        <li><strong>Two-Sided Platform (Moderate):</strong> Large user base attracts artists/podcasters and advertisers</li>
                    </ul>
                    <p style="margin-top: 12px;"><strong>Key Weaknesses:</strong></p>
                    <ul>
                        <li>Limited pricing power due to music label royalty structures (70%+ of revenue paid to rights holders)</li>
                        <li>Platform dependency on Apple App Store and Google Play Store with 15-30% fees</li>
                        <li>Competitors control operating systems, devices, and can pre-install competing services</li>
                        <li>Ad-Supported revenue declining (-6% Y/Y in Q3 2025)</li>
                    </ul>
                </div>

                <!-- Growth Drivers -->
                <div class="overview-card">
                    <h3>Growth Drivers</h3>
                    <ul>
                        <li>Geographic expansion into emerging markets (India, Southeast Asia, Africa)</li>
                        <li>Price increases and ARPU expansion through tiered pricing - demonstrated pricing power in 2023-2024</li>
                        <li>Audiobook monetization and adoption - 36% listener growth in year two, bundled with Premium</li>
                        <li>Podcast advertising growth - podcast ad revenue topped $2B in 2025 and expected to reach $6B by 2026</li>
                        <li>Margin expansion through improved content cost management (gross margin improved from 28% to 32%)</li>
                        <li>AI-driven features for discovery, personalization, and content creation (DJ feature, AI playlist generation)</li>
                        <li>Video podcast growth and new monetization programs (Spotify Partner Program for creators)</li>
                    </ul>
                </div>

                <!-- Key Risks -->
                <div class="overview-card risks">
                    <h3>Key Risks</h3>
                    <ul>
                        <li><span class="risk-high">HIGH:</span> Music label negotiating leverage - Three major labels control ~70% of music and can dictate royalty rates</li>
                        <li><span class="risk-high">HIGH:</span> Limited pricing power vs content costs - Pay 70%+ of revenue to rights holders, limiting margin expansion</li>
                        <li><span class="risk-high">HIGH:</span> Platform fees and restrictions - Apple/Google charge 15-30% on in-app purchases</li>
                        <li><span class="risk-high">HIGH:</span> Competition intensification - Apple, Amazon, YouTube have massive financial resources</li>
                        <li><span class="risk-moderate">MODERATE:</span> Ad-Supported revenue challenges - Ad revenue declined -6% Y/Y in Q3 2025</li>
                        <li><span class="risk-moderate">MODERATE:</span> Podcast profitability uncertainty - Heavy investment not yet proven to drive meaningful subscriber growth</li>
                        <li><span class="risk-moderate">MODERATE:</span> Social charges volatility - €291M in 2024 vs €71M in 2023 due to stock price movements</li>
                        <li><span class="risk-moderate">MODERATE:</span> Currency exposure - Reports in EUR but generates significant USD revenue</li>
                    </ul>
                </div>

                <!-- Bull Case -->
                <div class="overview-card bull">
                    <h3>Bull Case</h3>
                    <ul>
                        <li><strong>Margin expansion runway:</strong> Gross margin improved from 28% to 32%+ with path to mid-30s% through pricing power and mix shift</li>
                        <li><strong>Dominant market position creating flywheel:</strong> 31.5% global market share with 713M MAUs provides unmatched scale for personalization</li>
                        <li><strong>Free cash flow inflection:</strong> Generated record €2.9B LTM FCF (Q3 2025) vs historical losses. Already repurchased $410M shares YTD</li>
                        <li><strong>Multiple growth vectors:</strong> Geographic expansion, audiobook adoption, podcast advertising, price increases, free-to-paid conversion</li>
                        <li><strong>First-mover advantage in audio super-app:</strong> Only platform combining music, podcasts, audiobooks at scale</li>
                        <li><strong>AI capabilities driving engagement:</strong> Industry-leading recommendation algorithms improve personalization and reduce churn</li>
                    </ul>
                </div>

                <!-- Bear Case -->
                <div class="overview-card bear">
                    <h3>Bear Case</h3>
                    <ul>
                        <li><strong>Structurally low margins:</strong> Paying 70%+ of revenue to music labels limits margin expansion. Gross margins only ~32% vs 60%+ for SaaS</li>
                        <li><strong>Platform risk from Big Tech:</strong> Apple, Amazon, Google control OS, app stores, and devices. Can pre-install competing services</li>
                        <li><strong>Ad-Supported revenue declining:</strong> Down -6% Y/Y, facing pricing pressure and inventory optimization challenges</li>
                        <li><strong>Profitability sustainability concerns:</strong> First profitable year in 2024 after 15+ years. May need to reinvest in content to compete</li>
                        <li><strong>Competition intensifying:</strong> Apple Music, Amazon Music can subsidize losses with hardware/cloud profits. Superior audio quality at lower price</li>
                        <li><strong>Podcast/audiobook ROI uncertain:</strong> Heavy investments haven't driven meaningful subscriber growth. Unclear if diversification worth the cost</li>
                        <li><strong>Valuation stretched:</strong> Stock up 167% in 2024. Trading at premium multiples requiring sustained margin expansion</li>
                        <li><strong>Market maturing:</strong> Developed markets approaching saturation. Emerging markets have lower ARPU and payment challenges</li>
                    </ul>
                </div>

                <!-- Recent Developments -->
                <div class="overview-card">
                    <h3>Recent Developments</h3>
                    <ul>
                        <li><strong>Q3 2025:</strong> Record Q3 free cash flow of €806M, bringing LTM FCF to €2.9B. Operating income of €582M exceeded guidance by €97M</li>
                        <li><strong>Q3 2025:</strong> Launched Spotify in ChatGPT integration for AI-powered music/podcast recommendations</li>
                        <li><strong>Q3 2025:</strong> Announced DSP partnerships with Amazon and Yahoo, expanding programmatic advertising access</li>
                        <li><strong>Oct 2025:</strong> Celebrated 2-year audiobook anniversary with 36% listener growth Y/Y, catalog expanded to 500K+ titles</li>
                        <li><strong>Q3 2025:</strong> Launched lossless audio (24-bit/44.1kHz FLAC) to Premium users in 50+ markets</li>
                        <li><strong>Q2 2025:</strong> Launched Spotify Ad Exchange in April 2025, with advertiser participation growing 142% since</li>
                        <li><strong>2025:</strong> Direct licensing deals signed with Universal Music Group, Sony Music, Warner Music, Kobalt, and BMG</li>
                        <li><strong>FY2024:</strong> First-ever full year of profitability with €1,365M operating income and €2,285M free cash flow</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-value" id="kpiRevenue">€15.7B</div>
            <div class="kpi-label">Revenue (FY2024)</div>
            <div class="kpi-change positive" id="kpiRevenueChange">+18.3% YoY</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiMAU">713M</div>
            <div class="kpi-label">Monthly Active Users</div>
            <div class="kpi-change positive" id="kpiMAUChange">+11.3% YoY</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiPremium">282M</div>
            <div class="kpi-label">Premium Subscribers</div>
            <div class="kpi-change positive" id="kpiPremiumChange">+12.4% YoY</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiARPU">€4.89</div>
            <div class="kpi-label">ARPU (Q3 2025)</div>
            <div class="kpi-change positive" id="kpiARPUChange">+3.2% YoY</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiGrossMargin">31.6%</div>
            <div class="kpi-label">Gross Margin (Q3 2025)</div>
            <div class="kpi-change positive" id="kpiGrossMarginChange">+518 bps YoY</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiOpIncome">€582M</div>
            <div class="kpi-label">Operating Income (Q3 2025)</div>
            <div class="kpi-change positive" id="kpiOpIncomeChange">From -€462M YoY</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiFCF">€2.9B</div>
            <div class="kpi-label">Free Cash Flow (LTM)</div>
            <div class="kpi-change positive" id="kpiFCFChange">From €678M in FY2023</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiCash">€5.5B</div>
            <div class="kpi-label">Cash & Equivalents</div>
            <div class="kpi-change positive" id="kpiCashChange">Net Cash Position</div>
        </div>
    </div>

    <!-- Management Guidance Section -->
    <div class="guidance-section" id="guidanceSection">
        <div class="guidance-header">
            <h3>Management Guidance</h3>
            <span class="guidance-meta">As of <span id="guidanceAsOf">Q3 2025 Earnings (November 4, 2025)</span> | <span id="guidanceFY">Q4 2025</span></span>
        </div>
        <div class="guidance-grid" id="guidanceGrid">
            <!-- Populated by JavaScript -->
        </div>
        <div class="guidance-commentary" id="guidanceCommentary">
            <!-- Management commentary -->
        </div>
    </div>

    <!-- Charts -->
    <h2 class="section-title">Revenue & Profitability</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Revenue Trend</h3>
                <button class="help-btn" onclick="openModal('revenue')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Revenue Growth Rate</h3>
                <button class="help-btn" onclick="openModal('revenueGrowth')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="revenueGrowthChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Gross Profit & Margin</h3>
                <button class="help-btn" onclick="openModal('grossMargin')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="grossMarginChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Operating Income & Margin</h3>
                <button class="help-btn" onclick="openModal('operatingIncome')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="operatingIncomeChart"></canvas>
            </div>
        </div>
    </div>

    <h2 class="section-title">User Metrics</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Monthly Active Users (MAU)</h3>
                <button class="help-btn" onclick="openModal('mau')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="mauChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Premium Subscribers</h3>
                <button class="help-btn" onclick="openModal('premium')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="premiumChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>ARPU (Average Revenue Per User)</h3>
                <button class="help-btn" onclick="openModal('arpu')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="arpuChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Free-to-Paid Conversion Rate</h3>
                <button class="help-btn" onclick="openModal('conversion')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="conversionChart"></canvas>
            </div>
        </div>
    </div>

    <h2 class="section-title">Cash Flow & Financial Health</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Free Cash Flow</h3>
                <button class="help-btn" onclick="openModal('fcf')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="fcfChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Cash & Equivalents</h3>
                <button class="help-btn" onclick="openModal('cash')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="cashChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Net Income</h3>
                <button class="help-btn" onclick="openModal('netIncome')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="netIncomeChart"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <h3>Shareholders' Equity</h3>
                <button class="help-btn" onclick="openModal('equity')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="equityChart"></canvas>
            </div>
        </div>
    </div>

    <!-- DCF Valuation Section -->
    <h2 class="section-title">DCF Valuation</h2>
    <div class="dcf-section">
        <!-- Valuation Summary Cards -->
        <div class="dcf-summary">
            <div class="dcf-card highlight">
                <div class="dcf-label">Intrinsic Value (Base)</div>
                <div class="dcf-value" id="dcfIV">$338</div>
                <div class="dcf-change negative" id="dcfUpside">-46% downside</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Entry Price (15% CAGR)</div>
                <div class="dcf-value" id="dcfEntry">$192</div>
                <div class="dcf-sublabel">Buy below for 15% annual return</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Current Price</div>
                <div class="dcf-value" id="dcfCurrent">$626</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Prob-Weighted IV</div>
                <div class="dcf-value" id="dcfWeighted">$346</div>
                <div class="dcf-sublabel">30% Bull / 45% Base / 25% Bear</div>
            </div>
        </div>

        <!-- Growth Rate Warning -->
        <div class="dcf-warning" id="growthWarning">
            <span class="warning-icon">&#9888;</span>
            <span id="warningText">Spotify experienced a profitability inflection in 2024 (first full-year profit after 15 years). Equity CAGR of 30-38% reflects balance sheet growth but may not be sustainable. Revenue CAGR of 18% provides downside anchor. Selected 25% growth rate reflects strong momentum from margin expansion (GM 32%+), FCF generation (€2.9B LTM), and multiple growth drivers.</span>
        </div>

        <!-- DCF Inputs Display -->
        <div class="dcf-inputs">
            <h4>DCF Model Inputs</h4>
            <div class="dcf-inputs-grid">
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Base Year FCF</div>
                    <div class="dcf-input-value" id="baseFCF">€2,285M</div>
                    <div class="dcf-input-note">FY2024 Starting Point</div>
                </div>
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Shares Outstanding</div>
                    <div class="dcf-input-value" id="sharesOut">213.8M</div>
                </div>
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Net Debt</div>
                    <div class="dcf-input-value" id="netDebt">-€3.7B</div>
                    <div class="dcf-input-note">Negative = net cash</div>
                </div>
            </div>
            <div class="fcf-projections">
                <h5>Projected FCF (5-Year Base Case)</h5>
                <div class="fcf-projection-table" id="fcfProjectionTable">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Interactive Sliders -->
        <div class="dcf-controls">
            <div class="slider-group">
                <label>Growth Rate: <span id="growthValue">22%</span></label>
                <input type="range" id="growthSlider" min="0" max="35" value="22" step="1">
                <div class="slider-hint" id="growthHint">Based on profitability turnaround and margin expansion</div>
            </div>
            <div class="slider-group">
                <label>WACC: <span id="waccValue">10.0%</span></label>
                <input type="range" id="waccSlider" min="6" max="18" value="10" step="0.5">
            </div>
            <div class="slider-group">
                <label>Terminal Growth: <span id="terminalValue">3.0%</span></label>
                <input type="range" id="terminalSlider" min="0" max="5" value="3" step="0.5">
            </div>
        </div>

        <!-- Scenario Tabs -->
        <div class="scenario-tabs">
            <button class="scenario-tab active" data-scenario="base" onclick="switchScenario('base')">Base Case</button>
            <button class="scenario-tab" data-scenario="bull" onclick="switchScenario('bull')">Bull Case</button>
            <button class="scenario-tab" data-scenario="bear" onclick="switchScenario('bear')">Bear Case</button>
        </div>

        <!-- Scenario Details -->
        <div class="scenario-details" id="scenarioDetails">
            <div class="scenario-assumptions">
                <h4>Assumptions</h4>
                <div class="assumption-grid" id="assumptionGrid">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Sensitivity Table -->
        <div class="sensitivity-section">
            <h4>Sensitivity Analysis: Intrinsic Value by WACC & Terminal Growth</h4>
            <table class="sensitivity-table" id="sensitivityMatrix">
                <!-- Populated by JavaScript -->
            </table>
        </div>

        <!-- Historical Growth Rates -->
        <div class="historical-growth">
            <h4>Historical Growth Rates (CAGR)</h4>
            <div class="growth-grid" id="growthGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Metric Title</h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // DATA EMBEDDED DIRECTLY
        const csvData = `Period,Revenue,GrossProfit,GrossMargin,OperatingIncome,OperatingMargin,NetIncome,NetMargin,EPS,FreeCashFlow,MAU,PremiumSubscribers,ARPU,ShareholdersEquity,TotalDebt,CashAndEquivalents,SharesOutstanding
FY2017,4090.0,849.0,20.8,-378.0,-9.2,-1235.0,-30.2,-8.14,,,,,,,,151.7
FY2018,5259.0,1353.0,25.7,-43.0,-0.8,-78.0,-1.5,-0.51,,,,,,,,181.2
FY2019,6764.0,1722.0,25.5,-73.0,-1.1,-186.0,-2.7,-1.03,,271.0,138.0,,,,,180.9
FY2020,7880.0,2015.0,25.6,-293.0,-3.7,-581.0,-7.4,-3.10,,345.0,155.0,,,,,187.6
FY2021,9668.0,2591.0,26.8,94.0,1.0,-34.0,-0.4,-1.03,,406.0,180.0,,,2119.0,1202.0,2744.0,193.9
FY2022,11727.0,2926.0,24.9,-659.0,-5.6,-430.0,-3.7,-2.93,21.0,489.0,205.0,4.52,2401.0,1128.0,2483.0,195.8
FY2023,13247.0,3397.0,25.6,-446.0,-3.4,-532.0,-4.0,-2.73,678.0,602.0,236.0,4.39,2523.0,1203.0,3114.0,194.7
FY2024,15673.0,4724.0,30.1,1365.0,8.7,1138.0,7.3,5.50,2285.0,675.0,263.0,4.69,5525.0,1539.0,4781.0,207.0
Q3 2020,1977.0,532.0,26.9,-29.0,-1.5,-101.0,-5.1,,,320.0,144.0,,,,,
Q1 2021,2147.0,574.0,26.7,40.0,1.9,-39.0,-1.8,,,356.0,158.0,,,,,
Q2 2021,2331.0,622.0,26.7,54.0,2.3,-10.0,-0.4,,,365.0,165.0,,,,,
Q3 2021,2501.0,645.0,25.8,-4.0,-0.2,-6.0,-0.2,,,381.0,172.0,,,,,
Q4 2021,2689.0,750.0,27.9,4.0,0.1,21.0,0.8,,,406.0,180.0,4.40,,,
Q1 2022,2661.0,706.0,26.5,-6.0,-0.2,-19.0,-0.7,,,422.0,182.0,4.38,,,
Q2 2022,2901.0,675.0,23.3,-247.0,-8.5,-197.0,-6.8,,,433.0,188.0,4.51,,,
Q3 2022,3036.0,745.0,24.5,-228.0,-7.5,-166.0,-5.5,,,456.0,195.0,4.63,,,
Q4 2022,3168.0,800.0,25.3,-231.0,-7.3,-125.0,-3.9,,,489.0,205.0,4.55,,,
Q1 2023,3042.0,766.0,25.2,-156.0,-5.1,-225.0,-7.4,,,515.0,210.0,4.15,,,
Q2 2023,3166.0,854.0,27.0,-247.0,-7.8,-302.0,-9.5,,,551.0,220.0,4.33,,,
Q3 2023,3359.0,888.0,26.4,-462.0,-13.8,-462.0,-13.8,,,574.0,226.0,4.44,,,
Q4 2023,3671.0,980.0,26.7,-75.0,-2.0,70.0,1.9,,,602.0,236.0,4.60,,,
Q1 2024,3636.0,1004.0,27.6,168.0,4.6,197.0,5.4,0.97,207.0,615.0,239.0,4.43,,,203.8
Q2 2024,3807.0,1112.0,29.2,266.0,7.0,274.0,7.2,1.33,,626.0,246.0,4.58,,,206.1
Q3 2024,3988.0,1240.0,31.1,454.0,11.4,300.0,7.5,1.45,,640.0,252.0,4.74,,,207.4
Q4 2024,4242.0,1368.0,32.3,477.0,11.2,367.0,8.7,1.76,,675.0,263.0,4.85,,,209.0
Q1 2025,4190.0,1326.0,31.6,509.0,12.1,225.0,5.4,1.07,534.0,678.0,268.0,4.82,,,210.2
Q2 2025,4193.0,1320.0,31.5,406.0,9.7,-86.0,-2.1,-0.42,700.0,696.0,276.0,4.79,,,205.4
Q3 2025,4272.0,1351.0,31.6,582.0,13.6,899.0,21.0,3.28,,711.0,282.0,4.89,7779.0,1741.0,5456.0,213.8`;

        const analysis = {
  "ticker": "SPOT",
  "company_name": "Spotify Technology S.A.",
  "analysis_date": "2026-01-23",
  "overview": "Spotify is the world's largest audio streaming subscription service with 713 million monthly active users (MAUs) and 281 million Premium subscribers across 184 countries and territories as of Q3 2025. The company has transformed from a music-only platform into a multi-format audio ecosystem offering music (100+ million tracks), podcasts (6.5+ million titles), and audiobooks (500,000+ titles in select markets), generating revenue through Premium subscriptions and advertising.",
  "business_model": {
    "summary": "Dual-revenue model consisting of Premium subscriptions (~90% of revenue) and Ad-Supported revenue (~10%), with transition from transaction-based music ownership to access-based streaming. Recent expansion into podcasts and audiobooks diversifying content offerings beyond music.",
    "revenue_streams": [
      {"name": "Premium Subscriptions", "percent": 90, "trend": "growing"},
      {"name": "Ad-Supported", "percent": 10, "trend": "stable to declining"}
    ],
    "customer_type": "B2C, primarily individual consumers with family and student plans available",
    "geographic_mix": "Global presence across 184 markets with strong concentration in Europe (31% of streaming market), North America (39% of streaming market), and growing presence in Latin America and Asia-Pacific"
  },
  "guidance": {
    "as_of": "Q3 2025 Earnings (November 4, 2025)",
    "fiscal_year": "Q4 2025",
    "items": [
      {
        "metric": "Monthly Active Users (MAUs)",
        "target": "745 million",
        "period": "Q4 2025",
        "vs_prior": "maintained",
        "notes": "Implies +32M net adds in Q4 2025, up from 17M in Q3 2025"
      },
      {
        "metric": "Premium Subscribers",
        "target": "289 million",
        "period": "Q4 2025",
        "vs_prior": "maintained",
        "notes": "Implies +8M net adds in Q4 2025 vs 5M in Q3 2025"
      },
      {
        "metric": "Total Revenue",
        "target": "€4.5 billion",
        "period": "Q4 2025",
        "vs_prior": "maintained",
        "notes": "Assumes ~620 bps FX headwind Y/Y. Implies ~13% constant currency growth"
      },
      {
        "metric": "Gross Margin",
        "target": "32.9%",
        "period": "Q4 2025",
        "vs_prior": "raised",
        "notes": "Up from 32.2% in Q4 2024, driven by Y/Y favorability in Ad-Supported segment and Premium mix"
      },
      {
        "metric": "Operating Income",
        "target": "€620 million",
        "period": "Q4 2025",
        "vs_prior": "raised",
        "notes": "Incorporates €17M in social charges based on Q3 close share price of $698. Up from €477M in Q4 2024"
      },
      {
        "metric": "Premium ARPU",
        "target": "flat Y/Y constant currency",
        "period": "Q3 2025 actual",
        "vs_prior": "n/a",
        "notes": "€4.53 ARPU driven by price increases offset by product/market mix"
      }
    ],
    "management_commentary": "CEO Daniel Ek: 'Very excited about 2025 and feel really good about where we are as both a product and as a business. We will continue to place bets that will drive long-term impact, increasing our speed while maintaining the levels of efficiency we achieved last year. We're gonna double down on music in 2025.' Management views business as well positioned to deliver growth and improving margins in 2025 as they reinvest to support long-term potential. Q3 2025 beat across all metrics with MAUs +3M vs guidance, revenue above guidance, gross margin 50 bps above guidance, and operating income €97M above guidance."
  }
};

        const dcfData = {
  "ticker": "SPOT",
  "valuation_date": "2026-01-23",
  "current_price": 626.00,
  "inputs": {
    "shares_outstanding": 213.8,
    "net_debt": -3715,
    "last_fcf": 2285,
    "currency": "EUR",
    "units": "millions"
  },
  "historical_growth": {
    "revenue_3yr_cagr": 17.6,
    "revenue_5yr_cagr": 18.3,
    "eps_3yr_cagr": null,
    "eps_5yr_cagr": null,
    "equity_3yr_cagr": 37.6,
    "equity_5yr_cagr": 30.4,
    "fcf_3yr_cagr": null,
    "fcf_5yr_cagr": null,
    "selected_growth_rate": 25.0,
    "growth_rate_source": "adjusted_equity_and_profitability_turnaround"
  },
  "assumptions": {
    "base": {
      "description": "Conservative case assuming margin expansion continues but growth moderates as Spotify matures. Music label costs remain high (70%+). Platform risks persist but manageable. FCF margin improves modestly.",
      "growth_rates": [22, 18, 15, 12, 10],
      "fcf_margin": 16.0,
      "wacc": 10.0,
      "terminal_growth": 3.0
    },
    "bull": {
      "description": "Margin expansion accelerates toward 35%+ gross margin and 20%+ operating margin as scale advantages compound. Audiobook and podcast monetization successful. Pricing power demonstrated. Free-to-paid conversion improves. Market share gains continue.",
      "growth_rates": [28, 24, 20, 16, 13],
      "fcf_margin": 20.0,
      "wacc": 9.0,
      "terminal_growth": 3.5
    },
    "bear": {
      "description": "Profitability proves unsustainable as music labels demand higher royalties. Platform fees from Apple/Google increase. Competition from Apple Music/Amazon intensifies. Ad-Supported revenue continues declining. Macro weakness reduces consumer spending. Reinvestment needs pressure margins.",
      "growth_rates": [15, 12, 8, 6, 5],
      "fcf_margin": 12.0,
      "wacc": 12.0,
      "terminal_growth": 2.5
    }
  },
  "valuation": {
    "base": {
      "intrinsic_value_usd": 338.00,
      "upside": -46.0
    },
    "bull": {
      "intrinsic_value_usd": 613.62,
      "upside": -2.0
    },
    "bear": {
      "intrinsic_value_usd": 154.33,
      "upside": -75.3
    }
  },
  "entry_price": {
    "base": {
      "entry_price_usd": 192.45,
      "entry_discount_from_current": -69.3
    },
    "bull": {
      "entry_price_usd": 368.25,
      "entry_discount_from_current": -41.2
    },
    "bear": {
      "entry_price_usd": 78.35,
      "entry_discount_from_current": -87.5
    }
  },
  "sensitivity": {
    "wacc_range": [8.0, 9.0, 10.0, 11.0, 12.0],
    "terminal_growth_range": [2.0, 2.5, 3.0, 3.5, 4.0],
    "matrix_usd": [
      [445.0, 484.6, 534.3, 597.1, 680.4],
      [383.1, 413.3, 450.1, 495.9, 553.8],
      [335.0, 358.3, 386.6, 421.1, 463.9],
      [296.1, 314.3, 336.3, 362.7, 394.7],
      [264.0, 278.1, 294.8, 314.6, 338.2]
    ]
  },
  "probability_weighted": {
    "weights": {
      "bull": 0.30,
      "base": 0.45,
      "bear": 0.25
    },
    "weighted_iv_usd": 346.31,
    "weighted_upside": -44.7
  }
};

        // Parse CSV
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
                return obj;
            });
        }

        const data = parseCSV(csvData);

        // Sort data chronologically
        data.sort((a, b) => {
            const parseDate = (p) => {
                const year = parseInt(p.match(/\d{4}/)?.[0] || '0');
                const isQ1 = p.includes('Q1');
                const isQ2 = p.includes('Q2');
                const isQ3 = p.includes('Q3');
                const isQ4 = p.includes('Q4');
                const isH1 = p.includes('H1');
                const isH2 = p.includes('H2');
                const isFY = p.startsWith('FY');
                const subOrder = isQ1 ? 1 : isQ2 ? 2 : isH1 ? 3 : isQ3 ? 4 : isQ4 ? 5 : isH2 ? 6 : isFY ? 7 : 0;
                return year * 10 + subOrder;
            };
            return parseDate(a.Period) - parseDate(b.Period);
        });

        // Filter for annual data
        const fyData = data.filter(d => d.Period.startsWith('FY'));

        // Chart defaults
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#e0e0e0', font: { size: 11 } } }
            },
            scales: {
                x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
        };

        const colors = {
            primary: '#00d4aa',
            secondary: '#00b894',
            tertiary: '#0984e3',
            quaternary: '#6c5ce7',
            warning: '#fdcb6e',
            danger: '#ff6b6b'
        };

        // Toggle overview
        function toggleOverview() {
            const btn = document.querySelector('.overview-toggle');
            const content = document.getElementById('overviewContent');
            btn.classList.toggle('active');
            content.classList.toggle('active');
        }

        // Render guidance section
        function renderGuidance() {
            if (!analysis.guidance || !analysis.guidance.items || analysis.guidance.items.length === 0) {
                document.getElementById('guidanceSection').style.display = 'none';
                return;
            }

            const guidance = analysis.guidance;
            document.getElementById('guidanceAsOf').textContent = guidance.as_of || '';
            document.getElementById('guidanceFY').textContent = guidance.fiscal_year || '';

            const grid = document.getElementById('guidanceGrid');
            grid.innerHTML = guidance.items.map(item => {
                let vsClass = 'maintained';
                let vsLabel = 'Maintained';

                if (item.vs_prior) {
                    const vsp = item.vs_prior.toLowerCase();
                    if (vsp.includes('raised') || vsp.includes('increas')) {
                        vsClass = 'raised';
                        vsLabel = 'Raised';
                    } else if (vsp.includes('lowered') || vsp.includes('decreas')) {
                        vsClass = 'lowered';
                        vsLabel = 'Lowered';
                    } else if (vsp.includes('new')) {
                        vsClass = 'new';
                        vsLabel = 'New';
                    } else {
                        vsLabel = item.vs_prior;
                    }
                }

                return `
                    <div class="guidance-card">
                        <div class="guidance-metric">${item.metric}</div>
                        <div class="guidance-target">${item.target}</div>
                        <div class="guidance-period">${item.period}</div>
                        <span class="guidance-vs-prior ${vsClass}">${vsLabel}</span>
                        ${item.notes ? `<div class="guidance-notes">${item.notes}</div>` : ''}
                    </div>
                `;
            }).join('');

            const commentary = document.getElementById('guidanceCommentary');
            if (guidance.management_commentary) {
                commentary.textContent = guidance.management_commentary;
                commentary.style.display = 'block';
            } else {
                commentary.style.display = 'none';
            }
        }

        renderGuidance();

        // Create charts
        // Revenue Trend
        new Chart(document.getElementById('revenueChart'), {
            type: 'line',
            data: {
                labels: fyData.map(d => d.Period),
                datasets: [{
                    label: 'Revenue (€M)',
                    data: fyData.map(d => parseFloat(d.Revenue)),
                    borderColor: colors.primary,
                    backgroundColor: 'rgba(0, 212, 170, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: chartDefaults
        });

        // Revenue Growth Rate
        const revenueGrowth = fyData.map((d, i) => {
            if (i === 0) return null;
            const current = parseFloat(d.Revenue);
            const previous = parseFloat(fyData[i-1].Revenue);
            return ((current - previous) / previous * 100).toFixed(1);
        });
        new Chart(document.getElementById('revenueGrowthChart'), {
            type: 'bar',
            data: {
                labels: fyData.slice(1).map(d => d.Period),
                datasets: [{
                    label: 'YoY Growth (%)',
                    data: revenueGrowth.slice(1),
                    backgroundColor: colors.tertiary
                }]
            },
            options: chartDefaults
        });

        // Gross Profit & Margin
        new Chart(document.getElementById('grossMarginChart'), {
            type: 'line',
            data: {
                labels: fyData.map(d => d.Period),
                datasets: [
                    {
                        label: 'Gross Profit (€M)',
                        data: fyData.map(d => parseFloat(d.GrossProfit)),
                        borderColor: colors.primary,
                        backgroundColor: 'rgba(0, 212, 170, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Gross Margin (%)',
                        data: fyData.map(d => parseFloat(d.GrossMargin)),
                        borderColor: colors.warning,
                        borderDash: [5, 5],
                        tension: 0.4,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                ...chartDefaults,
                scales: {
                    x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        ticks: { color: '#888' },
                        grid: { color: 'rgba(255,255,255,0.05)' }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        ticks: { color: '#888' },
                        grid: { drawOnChartArea: false }
                    }
                }
            }
        });

        // Operating Income & Margin
        new Chart(document.getElementById('operatingIncomeChart'), {
            type: 'bar',
            data: {
                labels: fyData.map(d => d.Period),
                datasets: [
                    {
                        label: 'Operating Income (€M)',
                        data: fyData.map(d => parseFloat(d.OperatingIncome)),
                        backgroundColor: fyData.map(d => parseFloat(d.OperatingIncome) >= 0 ? colors.primary : colors.danger),
                        yAxisID: 'y'
                    },
                    {
                        label: 'Operating Margin (%)',
                        data: fyData.map(d => parseFloat(d.OperatingMargin)),
                        type: 'line',
                        borderColor: colors.warning,
                        borderDash: [5, 5],
                        tension: 0.4,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                ...chartDefaults,
                scales: {
                    x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        ticks: { color: '#888' },
                        grid: { color: 'rgba(255,255,255,0.05)' }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        ticks: { color: '#888' },
                        grid: { drawOnChartArea: false }
                    }
                }
            }
        });

        // MAU
        const mauData = data.filter(d => d.MAU && parseFloat(d.MAU) > 0);
        new Chart(document.getElementById('mauChart'), {
            type: 'line',
            data: {
                labels: mauData.map(d => d.Period),
                datasets: [{
                    label: 'MAU (Millions)',
                    data: mauData.map(d => parseFloat(d.MAU)),
                    borderColor: colors.primary,
                    backgroundColor: 'rgba(0, 212, 170, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: chartDefaults
        });

        // Premium Subscribers
        const premiumData = data.filter(d => d.PremiumSubscribers && parseFloat(d.PremiumSubscribers) > 0);
        new Chart(document.getElementById('premiumChart'), {
            type: 'line',
            data: {
                labels: premiumData.map(d => d.Period),
                datasets: [{
                    label: 'Premium Subscribers (Millions)',
                    data: premiumData.map(d => parseFloat(d.PremiumSubscribers)),
                    borderColor: colors.tertiary,
                    backgroundColor: 'rgba(9, 132, 227, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: chartDefaults
        });

        // ARPU
        const arpuData = data.filter(d => d.ARPU && parseFloat(d.ARPU) > 0);
        new Chart(document.getElementById('arpuChart'), {
            type: 'line',
            data: {
                labels: arpuData.map(d => d.Period),
                datasets: [{
                    label: 'ARPU (€)',
                    data: arpuData.map(d => parseFloat(d.ARPU)),
                    borderColor: colors.quaternary,
                    backgroundColor: 'rgba(108, 92, 231, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: chartDefaults
        });

        // Conversion Rate (Premium / MAU)
        const conversionData = data.filter(d => d.MAU && d.PremiumSubscribers && parseFloat(d.MAU) > 0 && parseFloat(d.PremiumSubscribers) > 0)
            .map(d => ({
                period: d.Period,
                rate: (parseFloat(d.PremiumSubscribers) / parseFloat(d.MAU) * 100).toFixed(1)
            }));
        new Chart(document.getElementById('conversionChart'), {
            type: 'line',
            data: {
                labels: conversionData.map(d => d.period),
                datasets: [{
                    label: 'Free-to-Paid Conversion (%)',
                    data: conversionData.map(d => d.rate),
                    borderColor: colors.warning,
                    backgroundColor: 'rgba(253, 203, 110, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: chartDefaults
        });

        // Free Cash Flow
        const fcfData = data.filter(d => d.FreeCashFlow && d.FreeCashFlow !== '');
        new Chart(document.getElementById('fcfChart'), {
            type: 'bar',
            data: {
                labels: fcfData.map(d => d.Period),
                datasets: [{
                    label: 'Free Cash Flow (€M)',
                    data: fcfData.map(d => parseFloat(d.FreeCashFlow)),
                    backgroundColor: fcfData.map(d => parseFloat(d.FreeCashFlow) >= 0 ? colors.primary : colors.danger)
                }]
            },
            options: chartDefaults
        });

        // Cash & Equivalents
        const cashData = data.filter(d => d.CashAndEquivalents && d.CashAndEquivalents !== '');
        new Chart(document.getElementById('cashChart'), {
            type: 'line',
            data: {
                labels: cashData.map(d => d.Period),
                datasets: [{
                    label: 'Cash & Equivalents (€M)',
                    data: cashData.map(d => parseFloat(d.CashAndEquivalents)),
                    borderColor: colors.primary,
                    backgroundColor: 'rgba(0, 212, 170, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: chartDefaults
        });

        // Net Income
        new Chart(document.getElementById('netIncomeChart'), {
            type: 'bar',
            data: {
                labels: fyData.map(d => d.Period),
                datasets: [{
                    label: 'Net Income (€M)',
                    data: fyData.map(d => parseFloat(d.NetIncome)),
                    backgroundColor: fyData.map(d => parseFloat(d.NetIncome) >= 0 ? colors.primary : colors.danger)
                }]
            },
            options: chartDefaults
        });

        // Shareholders' Equity
        const equityData = data.filter(d => d.ShareholdersEquity && d.ShareholdersEquity !== '');
        new Chart(document.getElementById('equityChart'), {
            type: 'line',
            data: {
                labels: equityData.map(d => d.Period),
                datasets: [{
                    label: "Shareholders' Equity (€M)",
                    data: equityData.map(d => parseFloat(d.ShareholdersEquity)),
                    borderColor: colors.tertiary,
                    backgroundColor: 'rgba(9, 132, 227, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: chartDefaults
        });

        // DCF Functions
        let currentScenario = 'base';

        function initDCF() {
            if (!dcfData || !dcfData.valuation) return;

            document.getElementById('dcfCurrent').textContent = '$' + dcfData.current_price.toFixed(0);

            const base = dcfData.assumptions.base;
            document.getElementById('growthSlider').value = base.growth_rates[0];
            document.getElementById('waccSlider').value = base.wacc;
            document.getElementById('terminalSlider').value = base.terminal_growth;

            document.getElementById('growthValue').textContent = base.growth_rates[0] + '%';
            document.getElementById('waccValue').textContent = base.wacc + '%';
            document.getElementById('terminalValue').textContent = base.terminal_growth + '%';

            renderDCFInputs();
            renderHistoricalGrowth();
            renderSensitivityMatrix();
            updateDCFDisplay();
            switchScenario('base');
        }

        function renderDCFInputs() {
            const inputs = dcfData.inputs;
            document.getElementById('baseFCF').textContent = '€' + inputs.last_fcf.toLocaleString() + 'M';
            document.getElementById('sharesOut').textContent = inputs.shares_outstanding.toFixed(1) + 'M';
            const netDebt = inputs.net_debt;
            const netDebtEl = document.getElementById('netDebt');
            netDebtEl.textContent = (netDebt < 0 ? '-€' : '€') + Math.abs(netDebt).toLocaleString() + 'M';
            if (netDebt < 0) netDebtEl.style.color = '#00d4aa';

            renderFCFProjections();
        }

        function renderFCFProjections() {
            const growth = parseFloat(document.getElementById('growthSlider')?.value || dcfData.historical_growth.selected_growth_rate);
            const baseFCF = dcfData.inputs.last_fcf;
            const growthRates = dcfData.assumptions[currentScenario]?.growth_rates || [22, 18, 15, 12, 10];

            let html = `
                <div class="fcf-projection-item header">Base</div>
                <div class="fcf-projection-item header">Year 1</div>
                <div class="fcf-projection-item header">Year 2</div>
                <div class="fcf-projection-item header">Year 3</div>
                <div class="fcf-projection-item header">Year 4</div>
                <div class="fcf-projection-item header">Year 5</div>
            `;

            let fcf = baseFCF;
            const fcfValues = [baseFCF];

            for (let i = 0; i < 5; i++) {
                fcf = fcf * (1 + growthRates[i] / 100);
                fcfValues.push(fcf);
            }

            html += `<div class="fcf-projection-item">
                <div class="fcf-value">€${fcfValues[0].toLocaleString()}M</div>
                <div class="growth-rate">-</div>
            </div>`;

            for (let i = 1; i <= 5; i++) {
                html += `<div class="fcf-projection-item">
                    <div class="fcf-value">€${Math.round(fcfValues[i]).toLocaleString()}M</div>
                    <div class="growth-rate">+${growthRates[i-1]}%</div>
                </div>`;
            }

            document.getElementById('fcfProjectionTable').innerHTML = html;
        }

        function calculateDCF(growthRate, wacc, terminalGrowth) {
            const years = 5;
            const fcf = dcfData.inputs.last_fcf;
            let pvFCF = 0;
            let projectedFCF = fcf;

            for (let i = 0; i < years; i++) {
                projectedFCF *= (1 + growthRate / 100);
                pvFCF += projectedFCF / Math.pow(1 + wacc/100, i + 1);
            }

            const terminalFCF = projectedFCF * (1 + terminalGrowth/100);
            const terminalValue = terminalFCF / (wacc/100 - terminalGrowth/100);
            const pvTerminal = terminalValue / Math.pow(1 + wacc/100, years);

            const enterpriseValue = pvFCF + pvTerminal;
            const equityValue = enterpriseValue - dcfData.inputs.net_debt;
            const iv = equityValue / dcfData.inputs.shares_outstanding;
            const ivUSD = iv * 1.10;

            const terminalPerShare = terminalValue / dcfData.inputs.shares_outstanding;
            const entryPrice = terminalPerShare / Math.pow(1.15, years);
            const entryPriceUSD = entryPrice * 1.10;

            return {
                iv: ivUSD,
                entryPrice: entryPriceUSD,
                terminalPerShare: terminalPerShare,
                pvFCF: pvFCF,
                pvTerminal: pvTerminal,
                enterpriseValue: enterpriseValue
            };
        }

        window.updateDCFDisplay = function() {
            const growth = parseFloat(document.getElementById('growthSlider').value);
            const wacc = parseFloat(document.getElementById('waccSlider').value);
            const terminal = parseFloat(document.getElementById('terminalSlider').value);

            document.getElementById('growthValue').textContent = growth + '%';
            document.getElementById('waccValue').textContent = wacc + '%';
            document.getElementById('terminalValue').textContent = terminal + '%';

            const result = calculateDCF(growth, wacc, terminal);

            document.getElementById('dcfIV').textContent = '$' + result.iv.toFixed(0);
            document.getElementById('dcfEntry').textContent = '$' + result.entryPrice.toFixed(0);

            const upside = ((result.iv - dcfData.current_price) / dcfData.current_price * 100);
            const upsideEl = document.getElementById('dcfUpside');
            upsideEl.textContent = (upside >= 0 ? '+' : '') + upside.toFixed(0) + '% ' + (upside >= 0 ? 'upside' : 'downside');
            upsideEl.className = 'dcf-change ' + (upside >= 0 ? 'positive' : 'negative');

            document.getElementById('dcfWeighted').textContent = '$' + dcfData.probability_weighted.weighted_iv_usd.toFixed(0);

            const grid = document.getElementById('assumptionGrid');
            if (grid) {
                grid.innerHTML = `
                    <div class="assumption-item">
                        <div class="label">Growth Rate</div>
                        <div class="value">${growth}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">WACC</div>
                        <div class="value">${wacc}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Terminal Growth</div>
                        <div class="value">${terminal}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Intrinsic Value</div>
                        <div class="value" style="color: #00d4aa;">$${result.iv.toFixed(0)}</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Entry Price</div>
                        <div class="value" style="color: #00d4aa;">$${result.entryPrice.toFixed(0)}</div>
                    </div>
                `;
            }

            renderFCFProjections();
        };

        window.switchScenario = function(scenario) {
            currentScenario = scenario;

            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === scenario);
            });

            const assumptions = dcfData.assumptions[scenario];
            const valuation = dcfData.valuation[scenario];

            document.getElementById('growthSlider').value = assumptions.growth_rates[0];
            document.getElementById('waccSlider').value = assumptions.wacc;
            document.getElementById('terminalSlider').value = assumptions.terminal_growth;

            const grid = document.getElementById('assumptionGrid');
            grid.innerHTML = `
                <div class="assumption-item">
                    <div class="label">Year 1 Growth</div>
                    <div class="value">${assumptions.growth_rates[0]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Year 5 Growth</div>
                    <div class="value">${assumptions.growth_rates[4]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">FCF Margin</div>
                    <div class="value">${assumptions.fcf_margin}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">WACC</div>
                    <div class="value">${assumptions.wacc}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Terminal Growth</div>
                    <div class="value">${assumptions.terminal_growth}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Intrinsic Value</div>
                    <div class="value" style="color: #00d4aa;">$${valuation.intrinsic_value_usd.toFixed(0)}</div>
                </div>
            `;

            updateDCFDisplay();
        };

        function renderHistoricalGrowth() {
            const growth = dcfData.historical_growth;
            const selectedSource = growth.growth_rate_source;
            const grid = document.getElementById('growthGrid');

            const metrics = [
                { key: 'revenue_3yr_cagr', label: 'Revenue 3Y', source: 'revenue_3yr_cagr' },
                { key: 'revenue_5yr_cagr', label: 'Revenue 5Y', source: 'revenue_5yr_cagr' },
                { key: 'equity_3yr_cagr', label: 'Equity 3Y', source: 'equity_3yr_cagr' },
                { key: 'equity_5yr_cagr', label: 'Equity 5Y', source: 'equity_5yr_cagr' }
            ];

            grid.innerHTML = metrics.map(m => {
                const rate = growth[m.key];
                if (rate === null) return '';
                const isSelected = m.source === selectedSource || selectedSource.includes(m.key.split('_')[0]);
                const colorClass = rate >= 0 ? 'positive' : 'negative';
                return `
                    <div class="growth-item ${isSelected ? 'selected' : ''}">
                        <div class="metric">${m.label}</div>
                        <div class="rate ${colorClass}">${rate >= 0 ? '+' : ''}${rate.toFixed(1)}%</div>
                    </div>
                `;
            }).join('');
        }

        function renderSensitivityMatrix() {
            const sens = dcfData.sensitivity;
            const table = document.getElementById('sensitivityMatrix');
            const currentPrice = dcfData.current_price;

            let html = '<tr><th>WACC \\ Term G</th>';
            sens.terminal_growth_range.forEach(tg => {
                html += `<th>${tg}%</th>`;
            });
            html += '</tr>';

            sens.wacc_range.forEach((wacc, i) => {
                html += `<tr><th>${wacc}%</th>`;
                sens.matrix_usd[i].forEach((val, j) => {
                    const isHighlight = wacc === dcfData.assumptions.base.wacc &&
                                       sens.terminal_growth_range[j] === dcfData.assumptions.base.terminal_growth;
                    const colorClass = val >= currentPrice ? 'above-current' : 'below-current';
                    html += `<td class="${isHighlight ? 'highlight' : colorClass}">$${val.toFixed(0)}</td>`;
                });
                html += '</tr>';
            });

            table.innerHTML = html;
        }

        initDCF();

        // Modal functions
        const metricDescriptions = {
            revenue: {
                title: "Revenue",
                content: `
                    <p><strong>Revenue</strong> is Spotify's total income from Premium subscriptions (~90%) and Ad-Supported streaming (~10%), reported in Euros (€).</p>
                    <div class="metric-highlight">
                        <strong>For Spotify:</strong> Revenue growth has been consistently strong at 18% CAGR over 5 years, driven by subscriber growth (282M Premium subs) and price increases implemented in 2023-2024.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Premium subscriber net additions (8M expected Q4 2025)</li>
                        <li>ARPU trends - pricing power vs geographic/product mix</li>
                        <li>Ad-Supported revenue stability (currently declining -6% Y/Y)</li>
                        <li>Currency headwinds (FX reduced Q3 2025 growth by 450 bps)</li>
                    </ul>
                `
            },
            revenueGrowth: {
                title: "Revenue Growth Rate",
                content: `
                    <p><strong>Revenue Growth Rate</strong> measures year-over-year percentage change in total revenue.</p>
                    <div class="metric-highlight">
                        <strong>For Spotify:</strong> Growth has remained strong in the 15-20% range despite maturing markets. FY2024 revenue grew 18.3% to €15.7B.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Constant currency growth rates (removes FX volatility)</li>
                        <li>Geographic expansion into emerging markets (lower ARPU but high volume potential)</li>
                        <li>Price increase cadence and consumer acceptance</li>
                        <li>Audiobook/podcast monetization contribution to growth</li>
                    </ul>
                `
            },
            grossMargin: {
                title: "Gross Profit & Margin",
                content: `
                    <p><strong>Gross Margin</strong> is revenue minus direct content costs (music royalties, podcast costs, bandwidth). Critical profitability indicator for Spotify.</p>
                    <div class="metric-highlight">
                        <strong>For Spotify:</strong> Gross margin improved from 25-26% historically to 30.1% in FY2024 and 31.6% in Q3 2025. This is THE key metric as Spotify pays ~70% of revenue to music rights holders.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Target is mid-30s% gross margin - track progress toward this goal</li>
                        <li>Premium vs Ad-Supported mix (Ad-Supported has lower margins)</li>
                        <li>Music label negotiation outcomes and royalty rate changes</li>
                        <li>Podcast content strategy (exclusive deals vs open catalog)</li>
                        <li>Audiobook bundling economics and royalty structures</li>
                    </ul>
                `
            },
            operatingIncome: {
                title: "Operating Income & Margin",
                content: `
                    <p><strong>Operating Income</strong> is gross profit minus operating expenses (R&D, sales & marketing, G&A). Shows core business profitability.</p>
                    <div class="metric-highlight">
                        <strong>For Spotify:</strong> Achieved first full-year operating profit in FY2024 (€1,365M, 8.7% margin) after 15 years of losses. Q3 2025 operating margin reached 13.6%.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Operating leverage improving as revenue grows faster than expenses</li>
                        <li>Social charges volatility (€291M in 2024 vs €71M in 2023 due to stock price)</li>
                        <li>R&D spending on AI features, audiobooks, video podcasts</li>
                        <li>Marketing efficiency - CAC trends and free-to-paid conversion</li>
                        <li>Sustainability of profitability - will Spotify need to reinvest heavily to compete?</li>
                    </ul>
                `
            },
            mau: {
                title: "Monthly Active Users (MAU)",
                content: `
                    <p><strong>MAU</strong> is the total number of users (free and Premium) who engage with Spotify at least once per month.</p>
                    <div class="metric-highlight">
                        <strong>For Spotify:</strong> Reached 713M MAU in Q3 2025, up 11% Y/Y. Q4 guidance expects 745M (34M net adds largest Q4 ever).
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Net adds vs expectations (Q4 guide: 32M net adds)</li>
                        <li>Geographic growth - emerging markets (India, LatAm, SEA) vs mature markets</li>
                        <li>Free tier as funnel for Premium conversions</li>
                        <li>Engagement metrics - time spent listening, session frequency</li>
                        <li>Competitive threats from YouTube Music, Apple Music pre-installs</li>
                    </ul>
                `
            },
            premium: {
                title: "Premium Subscribers",
                content: `
                    <p><strong>Premium Subscribers</strong> are paying subscribers who access ad-free listening, offline playback, higher quality audio, and audiobooks (in bundled markets).</p>
                    <div class="metric-highlight">
                        <strong>For Spotify:</strong> Reached 282M Premium subs in Q3 2025, up 12% Y/Y. Premium subscriptions drive ~90% of total revenue.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Net adds vs guidance (Q4 guide: 7M net adds)</li>
                        <li>Churn rate trends (not disclosed but implied by net adds vs gross adds)</li>
                        <li>Family/Duo plan adoption (lower ARPU but stickier)</li>
                        <li>Student plan penetration (discounted pricing)</li>
                        <li>Geographic mix - developed markets (higher ARPU) vs emerging (lower ARPU)</li>
                    </ul>
                `
            },
            arpu: {
                title: "ARPU (Average Revenue Per User)",
                content: `
                    <p><strong>ARPU</strong> is Premium subscription revenue divided by average Premium subscribers. Measures pricing power and revenue quality.</p>
                    <div class="metric-highlight">
                        <strong>For Spotify:</strong> ARPU reached €4.89 in Q3 2025, up 3% Y/Y. Management demonstrated pricing power with price increases in 2023-2024.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Price increase implementation and customer acceptance</li>
                        <li>Product mix impact (Individual vs Family/Duo/Student plans)</li>
                        <li>Geographic mix shift - emerging markets have lower ARPU</li>
                        <li>Audiobook bundling value perception driving willingness to pay</li>
                        <li>Constant currency ARPU removes FX noise (management guidance: flat Y/Y)</li>
                    </ul>
                `
            },
            conversion: {
                title: "Free-to-Paid Conversion Rate",
                content: `
                    <p><strong>Free-to-Paid Conversion Rate</strong> is the percentage of MAU who are Premium subscribers (Premium Subs / MAU).</p>
                    <div class="metric-highlight">
                        <strong>For Spotify:</strong> Conversion rate has been relatively stable around 39-40%, showing the free tier successfully converts users to Premium at scale.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Improving conversion through product features (audiobooks, lossless audio, AI DJ)</li>
                        <li>Ad-load balance on free tier - too many ads push to Premium, but also drives Ad revenue</li>
                        <li>Geographic differences - mature markets convert better than emerging</li>
                        <li>Cohort analysis - how quickly new free users convert to Premium</li>
                        <li>Competitive pressure - Apple Music/Amazon bundling with other services</li>
                    </ul>
                `
            },
            fcf: {
                title: "Free Cash Flow",
                content: `
                    <p><strong>Free Cash Flow</strong> is operating cash flow minus capital expenditures. Measures cash generation ability and capital allocation flexibility.</p>
                    <div class="metric-highlight">
                        <strong>For Spotify:</strong> Achieved record FCF inflection - €2.3B in FY2024 (first profitable year) and €2.9B LTM through Q3 2025. Q3 2025 alone generated €806M FCF.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>FCF margin expansion - reached 16-17% LTM, target mid-teens to 20%</li>
                        <li>Capital returns - already repurchased $410M shares YTD 2025</li>
                        <li>Working capital fluctuations (royalty payment timing)</li>
                        <li>CapEx trends - infrastructure for audiobooks, video podcasts</li>
                        <li>Sustainability of FCF - will reinvestment needs pressure margins?</li>
                    </ul>
                `
            },
            cash: {
                title: "Cash & Equivalents",
                content: `
                    <p><strong>Cash & Equivalents</strong> is liquid assets available for operations, investments, and shareholder returns.</p>
                    <div class="metric-highlight">
                        <strong>For Spotify:</strong> Strong cash position of €5.5B (Q3 2025) with net cash of €3.7B (cash minus debt). Provides financial flexibility and downside protection.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Net cash position (Spotify has more cash than debt)</li>
                        <li>Share buyback activity ($410M YTD 2025)</li>
                        <li>M&A potential - content deals, technology acquisitions</li>
                        <li>€1.5B Exchangeable Notes due 2026 (will reclassify to current liability)</li>
                        <li>Buffer against music label payment obligations and platform fees</li>
                    </ul>
                `
            },
            netIncome: {
                title: "Net Income",
                content: `
                    <p><strong>Net Income</strong> is bottom-line profitability after all expenses, interest, taxes, and charges.</p>
                    <div class="metric-highlight">
                        <strong>For Spotify:</strong> First profitable full year in FY2024 with €1,138M net income (7.3% margin) after 15 years of losses. Q3 2025 net income €899M boosted by one-time gains.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Normalized profitability excluding one-time items and social charges</li>
                        <li>Social charges volatility (based on stock price movements)</li>
                        <li>Tax rate trends - OECD Pillar Two minimum tax impact</li>
                        <li>Interest income on cash balance</li>
                        <li>Sustainability - is 2024 profitability the new normal or peak margin?</li>
                    </ul>
                `
            },
            equity: {
                title: "Shareholders' Equity",
                content: `
                    <p><strong>Shareholders' Equity</strong> is total assets minus liabilities. Measures book value and financial health.</p>
                    <div class="metric-highlight">
                        <strong>For Spotify:</strong> Equity surged to €7.8B in Q3 2025 from €5.5B in FY2024, driven by strong profitability. Historical equity CAGR of 30-38% reflects the profitability turnaround.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Book value per share growth</li>
                        <li>Return on Equity (ROE) as profitability sustains</li>
                        <li>Retained earnings accumulation vs capital returns</li>
                        <li>Balance sheet strength to weather music label negotiations</li>
                        <li>Equity growth divergence from revenue/EPS (see DCF warning)</li>
                    </ul>
                `
            }
        };

        function openModal(key) {
            document.getElementById('modalTitle').textContent = metricDescriptions[key].title;
            document.getElementById('modalBody').innerHTML = metricDescriptions[key].content;
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay') && event.target.className !== 'modal-close') return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }

        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // Bind slider events
        (function() {
            var growthSlider = document.getElementById('growthSlider');
            var waccSlider = document.getElementById('waccSlider');
            var terminalSlider = document.getElementById('terminalSlider');

            if (growthSlider) {
                growthSlider.oninput = window.updateDCFDisplay;
                growthSlider.onchange = window.updateDCFDisplay;
            }
            if (waccSlider) {
                waccSlider.oninput = window.updateDCFDisplay;
                waccSlider.onchange = window.updateDCFDisplay;
            }
            if (terminalSlider) {
                terminalSlider.oninput = window.updateDCFDisplay;
                terminalSlider.onchange = window.updateDCFDisplay;
            }
        })();
    </script>
</body>
</html>