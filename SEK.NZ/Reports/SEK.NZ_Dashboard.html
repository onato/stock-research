<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seeka Limited (SEK.NZ) Financial Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4aa, #00b894);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .header p {
            color: #888;
            font-size: 1.1rem;
        }

        /* Investment Overview Section */
        .overview-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .overview-toggle {
            width: 100%;
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid rgba(0, 212, 170, 0.3);
            border-radius: 12px;
            padding: 16px 24px;
            color: #00d4aa;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        .overview-toggle:hover {
            background: rgba(0, 212, 170, 0.2);
        }
        .overview-toggle .arrow {
            transition: transform 0.3s ease;
        }
        .overview-toggle.active .arrow {
            transform: rotate(180deg);
        }
        .overview-content {
            display: none;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            margin-top: -12px;
        }
        .overview-content.active {
            display: block;
        }
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        .overview-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .overview-card h3 {
            color: #00d4aa;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .overview-card p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        .overview-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .overview-card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            line-height: 1.5;
        }
        .overview-card li:last-child {
            border-bottom: none;
        }
        .overview-card.bull h3 { color: #00d4aa; }
        .overview-card.bear h3 { color: #ff6b6b; }
        .overview-card.risks h3 { color: #fdcb6e; }
        .risk-high { color: #ff6b6b; font-weight: 600; }
        .risk-moderate { color: #fdcb6e; font-weight: 600; }
        .risk-low { color: #00d4aa; font-weight: 600; }
        .revenue-stream {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .revenue-stream .percent {
            color: #00d4aa;
            font-weight: 600;
        }
        .trend-growing { color: #00d4aa; }
        .trend-stable { color: #888; }
        .trend-declining { color: #ff6b6b; }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        .kpi-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 170, 0.2);
        }
        .kpi-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 5px;
        }
        .kpi-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .kpi-change {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .kpi-change.positive { color: #00d4aa; }
        .kpi-change.negative { color: #ff6b6b; }
        .section-title {
            font-size: 1.5rem;
            color: #fff;
            margin: 40px auto 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0, 212, 170, 0.3);
            max-width: 1400px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .chart-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .help-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(0, 212, 170, 0.2);
            border: 1px solid #00d4aa;
            color: #00d4aa;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .help-btn:hover {
            background: #00d4aa;
            color: #1a1a2e;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: linear-gradient(135deg, #1e2a4a 0%, #16213e 100%);
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 212, 170, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 {
            color: #00d4aa;
            font-size: 1.4rem;
            margin: 0;
        }
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: #ff6b6b;
            color: #fff;
        }
        .modal-body {
            padding: 25px;
            line-height: 1.7;
        }
        .modal-body p { margin-bottom: 15px; }
        .modal-body strong { color: #00d4aa; }
        .modal-body ul { margin: 15px 0; padding-left: 20px; }
        .modal-body li { margin-bottom: 8px; }
        .metric-highlight {
            background: rgba(0, 212, 170, 0.1);
            border-left: 3px solid #00d4aa;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        /* DCF Valuation Section */
        .dcf-section {
            max-width: 1400px;
            margin: 0 auto 40px;
        }
        .dcf-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dcf-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }
        .dcf-card:hover {
            transform: translateY(-3px);
        }
        .dcf-card.highlight {
            background: rgba(0, 212, 170, 0.1);
            border-color: rgba(0, 212, 170, 0.3);
        }
        .dcf-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .dcf-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #00d4aa;
        }
        .dcf-card:not(.highlight) .dcf-value {
            color: #fff;
        }
        .dcf-change {
            font-size: 1rem;
            margin-top: 8px;
            font-weight: 600;
        }
        .dcf-change.positive { color: #00d4aa; }
        .dcf-change.negative { color: #ff6b6b; }
        .dcf-sublabel {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
        }
        .dcf-warning {
            background: rgba(253, 203, 110, 0.15);
            border: 1px solid rgba(253, 203, 110, 0.4);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fdcb6e;
        }
        .warning-icon {
            font-size: 1.2rem;
        }
        .dcf-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .slider-group label {
            font-size: 0.95rem;
            color: #e0e0e0;
            display: flex;
            justify-content: space-between;
        }
        .slider-group label span {
            color: #00d4aa;
            font-weight: 600;
        }
        .slider-group input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        .slider-group input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            border: none;
        }
        .slider-hint {
            font-size: 0.8rem;
            color: #666;
        }
        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .scenario-tab {
            padding: 10px 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: #888;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .scenario-tab:hover {
            border-color: rgba(0, 212, 170, 0.5);
            color: #e0e0e0;
        }
        .scenario-tab.active {
            background: rgba(0, 212, 170, 0.15);
            border-color: #00d4aa;
            color: #00d4aa;
        }
        .scenario-details {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .scenario-details h4 {
            color: #00d4aa;
            margin-bottom: 15px;
        }
        .assumption-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .assumption-item {
            text-align: center;
        }
        .assumption-item .label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
        }
        .assumption-item .value {
            font-size: 1.1rem;
            color: #e0e0e0;
            font-weight: 500;
        }
        .sensitivity-section {
            margin-bottom: 30px;
        }
        .sensitivity-section h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .sensitivity-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            overflow: hidden;
        }
        .sensitivity-table th,
        .sensitivity-table td {
            padding: 12px 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .sensitivity-table th {
            background: rgba(0, 212, 170, 0.1);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td {
            color: #e0e0e0;
        }
        .sensitivity-table td.highlight {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td.below-current {
            color: #ff6b6b;
        }
        .sensitivity-table td.above-current {
            color: #00d4aa;
        }
        .historical-growth {
            margin-bottom: 30px;
        }
        .historical-growth h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .growth-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }
        .growth-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .growth-item .metric {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 6px;
        }
        .growth-item .rate {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .growth-item .rate.positive { color: #00d4aa; }
        .growth-item .rate.negative { color: #ff6b6b; }
        .growth-item.selected {
            border-color: #00d4aa;
            background: rgba(0, 212, 170, 0.1);
        }

        @media (max-width: 768px) {
            .charts-container { grid-template-columns: 1fr; }
            .overview-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Seeka Limited (SEK.NZ)</h1>
        <p>New Zealand's Largest Kiwifruit Post-Harvest Operator</p>
    </div>

    <!-- Investment Overview Section -->
    <div class="overview-section">
        <button class="overview-toggle" onclick="toggleOverview()">
            <span>Investment Overview & Analysis</span>
            <span class="arrow">▼</span>
        </button>
        <div class="overview-content" id="overviewContent">
            <div class="overview-grid">
                <!-- Company Overview -->
                <div class="overview-card">
                    <h3>Company Overview</h3>
                    <p>Seeka Limited is New Zealand's largest kiwifruit post-harvest operator, providing integrated orcharding, post-harvest (packing and coolstorage), and retail services to the fresh produce industry. The company services approximately 2,800 growers, handles about 20% of the national kiwifruit crop, and supplies global marketer Zespri along with retail customers in Australia, Asia, and New Zealand.</p>
                </div>

                <!-- Business Model -->
                <div class="overview-card">
                    <h3>Business Model</h3>
                    <p>Integrated horticultural services spanning orchard to market. Revenue generated through service fees per unit handled.</p>
                    <ul>
                        <li class="revenue-stream">
                            <span>Post-harvest Operations (packing/coolstorage)</span>
                            <span class="percent">60%</span>
                        </li>
                        <li class="revenue-stream">
                            <span>Orcharding Operations (management/leasing)</span>
                            <span class="percent">25%</span>
                        </li>
                        <li class="revenue-stream">
                            <span>SeekaFresh Retail Services</span>
                            <span class="percent">8%</span>
                        </li>
                        <li class="revenue-stream">
                            <span>Australian Operations</span>
                            <span class="percent trend-growing">5% (growing)</span>
                        </li>
                    </ul>
                    <p style="margin-top: 15px;"><strong>Seasonality:</strong> Highly seasonal - NZ harvest March-July, Australia January-March</p>
                </div>

                <!-- Competitive Position -->
                <div class="overview-card">
                    <h3>Competitive Position</h3>
                    <p><strong>Market Position:</strong> 20% national market share, 12 facilities with 50m+ tray capacity</p>
                    <p><strong>Main Competitors:</strong> EastPack (15-20%), Mount Pack & Cool (15%), ~39 regional operators</p>
                    <p><strong>Moat Factors:</strong></p>
                    <ul>
                        <li>Scale and regional diversification (12 facilities, $388m PP&E)</li>
                        <li>Strong grower relationships with 2,800 clients</li>
                        <li>Automation delivering 19% cost-per-tray reduction</li>
                        <li>Integrated supply chain from orchard to retail</li>
                        <li>Captive insurance structure (cost advantage)</li>
                    </ul>
                </div>

                <!-- Growth Drivers -->
                <div class="overview-card">
                    <h3>Growth Drivers</h3>
                    <ul>
                        <li><strong>Industry volume growth:</strong> Zespri forecasting record 205-215m trays 2025/26 season (vs ~190m 2024/25)</li>
                        <li><strong>Market share gains:</strong> Industry consolidation favors scale operators</li>
                        <li><strong>Automation efficiency:</strong> New Kerikeri facility commissioning 2025</li>
                        <li><strong>Australian expansion:</strong> $17.2m invested, kiwifruit production +166% in FY2024</li>
                        <li><strong>Diversification:</strong> Contract packing citrus (14.0m kg), persimmon, avocado</li>
                    </ul>
                </div>

                <!-- Key Risks -->
                <div class="overview-card risks">
                    <h3>Key Risks</h3>
                    <ul>
                        <li><span class="risk-high">HIGH:</span> Zespri customer concentration (~60% of revenue)</li>
                        <li><span class="risk-high">HIGH:</span> Volume volatility from weather (FY2023 cyclone: $21m loss)</li>
                        <li><span class="risk-moderate">MODERATE:</span> Psa disease and biosecurity threats</li>
                        <li><span class="risk-moderate">MODERATE:</span> Debt levels ($137m net debt, 51% of equity)</li>
                        <li><span class="risk-moderate">MODERATE:</span> Labor availability and cost inflation</li>
                        <li><span class="risk-moderate">MODERATE:</span> Climate change exposure (cyclones, water stress)</li>
                    </ul>
                </div>

                <!-- Bull Case -->
                <div class="overview-card bull">
                    <h3>Bull Case</h3>
                    <ul>
                        <li>Record Zespri season (205-215m trays) drives volume growth</li>
                        <li>Operational leverage: 44% volume increase drove $50.7m profit swing in FY2024</li>
                        <li>Automation reducing cost per tray (-19%), improving margins</li>
                        <li>Australian expansion accelerating (production +166%)</li>
                        <li>Balance sheet repair enables shareholder returns (dividend restarted)</li>
                        <li>Trading at 78% discount to probability-weighted intrinsic value</li>
                        <li>Consolidation opportunities in fragmented industry</li>
                    </ul>
                </div>

                <!-- Bear Case -->
                <div class="overview-card bear">
                    <h3>Bear Case</h3>
                    <ul>
                        <li>Volume volatility creates binary outcomes (29.8m trays = loss, 43m = profit)</li>
                        <li>Zespri customer concentration limits negotiating power</li>
                        <li>Automation lag vs competitors (MPac: 600k fruit/hour)</li>
                        <li>Debt overhang ($137m) constrains flexibility and growth</li>
                        <li>Mature NZ kiwifruit industry with limited growth beyond current trajectory</li>
                        <li>Australian expansion execution risk ($17.2m capex)</li>
                        <li>Climate and biosecurity existential threats (cyclones, Psa disease)</li>
                    </ul>
                </div>

                <!-- Recent Developments -->
                <div class="overview-card">
                    <h3>Recent Developments</h3>
                    <ul>
                        <li><strong>H1-2025:</strong> Record profit after tax $37.8m, volumes 47.1m trays</li>
                        <li><strong>FY2024:</strong> NPBT $29.7m (vs $21m loss FY2023), revenue $411m (+37%)</li>
                        <li><strong>FY2024:</strong> Net debt reduced $35.1m to $137.3m, dividend restarted (15c)</li>
                        <li><strong>2025:</strong> Board changes - Dewdney and Gourley appointed</li>
                        <li><strong>2025:</strong> Warakirri partnership for Australian expansion</li>
                        <li><strong>2025:</strong> Capital raise approved ($2.59m with 88% support)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-value" id="kpiRevenue">$411.4m</div>
            <div class="kpi-label">Revenue (FY2024)</div>
            <div class="kpi-change positive" id="kpiRevenueChange">+36.7%</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiEBITDA">$76.1m</div>
            <div class="kpi-label">EBITDA (FY2024)</div>
            <div class="kpi-change positive" id="kpiEBITDAChange">+193.0%</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiNetProfit">$8.8m</div>
            <div class="kpi-label">Net Profit (FY2024)</div>
            <div class="kpi-change positive" id="kpiNetProfitChange">+160.5%</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiTrays">43.0m</div>
            <div class="kpi-label">Kiwifruit Trays (FY2024)</div>
            <div class="kpi-change positive" id="kpiTraysChange">+44.3%</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiEPS">$0.21</div>
            <div class="kpi-label">EPS (FY2024)</div>
            <div class="kpi-change positive" id="kpiEPSChange">+160.0%</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiOCF">$66.0m</div>
            <div class="kpi-label">Operating Cash Flow</div>
            <div class="kpi-change positive" id="kpiOCFChange">+147.2%</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiNetDebt">$136.9m</div>
            <div class="kpi-label">Net Debt</div>
            <div class="kpi-change positive" id="kpiNetDebtChange">-20.4%</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpiDividend">15.0c</div>
            <div class="kpi-label">Dividend (FY2024)</div>
            <div class="kpi-change positive">Restarted</div>
        </div>
    </div>

    <!-- Charts Section -->
    <h2 class="section-title">Financial Performance</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Revenue & EBITDA</h3>
                <button class="help-btn" onclick="openModal('revenue')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Kiwifruit Trays Packed</h3>
                <button class="help-btn" onclick="openModal('trays')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="traysChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Net Profit & EPS</h3>
                <button class="help-btn" onclick="openModal('netProfit')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="profitChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Gross Margin %</h3>
                <button class="help-btn" onclick="openModal('margin')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="marginChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Operating Cash Flow</h3>
                <button class="help-btn" onclick="openModal('cashflow')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="cashflowChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Balance Sheet (Assets, Liabilities, Equity)</h3>
                <button class="help-btn" onclick="openModal('balance')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="balanceChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Net Debt Trend</h3>
                <button class="help-btn" onclick="openModal('debt')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="debtChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>EBITDA Margin %</h3>
                <button class="help-btn" onclick="openModal('ebitdaMargin')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="ebitdaMarginChart"></canvas>
            </div>
        </div>
    </div>

    <!-- DCF Valuation Section -->
    <h2 class="section-title">DCF Valuation</h2>
    <div class="dcf-section">
        <!-- Valuation Summary Cards -->
        <div class="dcf-summary">
            <div class="dcf-card highlight">
                <div class="dcf-label">Intrinsic Value</div>
                <div class="dcf-value" id="dcfIV">$20.88</div>
                <div class="dcf-change positive" id="dcfUpside">+349% upside</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Entry Price (15% CAGR)</div>
                <div class="dcf-value" id="dcfEntry">$13.91</div>
                <div class="dcf-sublabel">Buy below for 15% annual return</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Current Price</div>
                <div class="dcf-value" id="dcfCurrent">$4.65</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Prob-Weighted IV</div>
                <div class="dcf-value" id="dcfWeighted">$21.91</div>
                <div class="dcf-sublabel">25% Bull / 50% Base / 25% Bear</div>
            </div>
        </div>

        <!-- Growth Rate Warning -->
        <div class="dcf-warning" id="growthWarning">
            <span class="warning-icon">⚠</span>
            <span id="warningText">Revenue CAGR (13.1%) and FCF CAGR (20.2%) significantly exceed Equity CAGR (8.6%), driven by cyclical recovery from FY2023 cyclone impact.</span>
        </div>

        <!-- Interactive Sliders -->
        <div class="dcf-controls">
            <div class="slider-group">
                <label>Growth Rate: <span id="growthValue">8.6%</span></label>
                <input type="range" id="growthSlider" min="0" max="30" value="8.6" step="0.5" oninput="window.updateDCFDisplay()" onchange="window.updateDCFDisplay()">
                <div class="slider-hint" id="growthHint">Based on equity 5yr CAGR</div>
            </div>
            <div class="slider-group">
                <label>WACC: <span id="waccValue">11.0%</span></label>
                <input type="range" id="waccSlider" min="6" max="18" value="11.0" step="0.5" oninput="window.updateDCFDisplay()" onchange="window.updateDCFDisplay()">
            </div>
            <div class="slider-group">
                <label>Terminal Growth: <span id="terminalValue">2.5%</span></label>
                <input type="range" id="terminalSlider" min="0" max="5" value="2.5" step="0.5" oninput="window.updateDCFDisplay()" onchange="window.updateDCFDisplay()">
            </div>
        </div>

        <!-- Scenario Tabs -->
        <div class="scenario-tabs">
            <button class="scenario-tab active" data-scenario="base" onclick="switchScenario('base')">Base Case</button>
            <button class="scenario-tab" data-scenario="bull" onclick="switchScenario('bull')">Bull Case</button>
            <button class="scenario-tab" data-scenario="bear" onclick="switchScenario('bear')">Bear Case</button>
        </div>

        <!-- Scenario Details -->
        <div class="scenario-details" id="scenarioDetails">
            <div class="scenario-assumptions">
                <h4>Assumptions</h4>
                <div class="assumption-grid" id="assumptionGrid">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Sensitivity Table -->
        <div class="sensitivity-section">
            <h4>Sensitivity Analysis: Intrinsic Value by WACC & Terminal Growth</h4>
            <table class="sensitivity-table" id="sensitivityMatrix">
                <!-- Populated by JavaScript -->
            </table>
        </div>

        <!-- Historical Growth Rates -->
        <div class="historical-growth">
            <h4>Historical Growth Rates (CAGR)</h4>
            <div class="growth-grid" id="growthGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Metric Explanation</h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // ==================== DATA EMBEDDED DIRECTLY ====================
        const csvData = `Period,Revenue,GrossProfit,GrossMargin,EBITDA,EBIT,NetProfitBeforeTax,NetProfit,NetMargin,EPS,OperatingCashFlow,TotalAssets,TotalLiabilities,TotalEquity,TotalDebt,NetDebt,CashAndEquivalents,SharesOutstanding,KiwifruitTraysNZ,DividendPerShare
FY2015,142112,23725,16.7,13925,7208,5246,4272,3.0,0.29,1804,,,70819,,,1192,14.7,,0.18
FY2016,186814,,,,,,,,,,,,,,,,,,
FY2017,203713,,,,,,,,,,,,,,,,,,
FY2018,203713,45757,22.5,33301,17326,9871,6651,3.3,0.33,,,95268,,,1340,20.2,,
FY2019,236868,47464,20.0,34519,17557,9863,6884,2.9,0.22,,,154944,,,2849,31.4,,
FY2020,251457,52676,20.9,42946,24318,16278,15151,6.0,0.52,26353,373748,197455,176293,83164,78000,5164,29.1,,0.24
FY2021,309569,73232,23.7,56790,32180,23488,14860,4.8,0.43,41584,482269,235778,246491,158861,146500,12361,35.2,39.2,0.26
FY2022,348387,68309,19.6,46079,19086,7593,6504,1.9,0.16,12128,547869,276926,270943,175554,172000,3554,41.3,42.0,
FY2023,300920,48726,16.2,25988,-4118,-20988,-14466,-4.8,-0.35,2671,548811,288862,259949,177583,172376,5207,41.6,29.8,
FY2024,411412,104927,25.5,76121,46816,29713,8751,2.1,0.21,66037,549862,283459,266403,139890,136907,2983,41.6,43.0,0.15
H1-2016,134012,,,,,,,,,,,,,,,,,,
H1-2017,134243,,,,,,,,,,,,,,,,,,
H1-2018,145436,,,,,,,,,,,,,,,,,,
H1-2019,169872,,,,,,,,,,,,,,,,,,
H1-2020,178681,,,,,,,,,,,,,,,,,,
H1-2021,224479,,,,,,,,,,,,,,,,,,
H1-2022,,,,,,,,,,,,,,,,,,,
H1-2023,,,,,,,,,,,,,,,,,,,
H1-2024,284196,79040,27.8,68384,54544,45006,17052,6.0,0.41,,,,,,,,,43.0,
H1-2025,307903,96813,31.4,83480,67302,59369,37769,12.3,0.90,,,,130600,,41.6,,47.1,`;

        const analysis = {
            "ticker": "SEK.NZ",
            "companyName": "Seeka Limited",
            "overview": "Seeka Limited is New Zealand's largest kiwifruit post-harvest operator, providing integrated orcharding, post-harvest (packing and coolstorage), and retail services to the fresh produce industry."
        };

        const dcfData = {
            "ticker": "SEK.NZ",
            "company_name": "Seeka Limited",
            "current_price": 4.65,
            "inputs": {
                "shares_outstanding": 41.6,
                "net_debt": 136.9,
                "last_fcf": 66.0
            },
            "historical_growth": {
                "revenue_3yr_cagr": 17.8,
                "revenue_5yr_cagr": 13.1,
                "eps_3yr_cagr": -15.2,
                "eps_5yr_cagr": -16.4,
                "equity_3yr_cagr": 5.6,
                "equity_5yr_cagr": 8.6,
                "fcf_3yr_cagr": 16.5,
                "fcf_5yr_cagr": 20.2,
                "selected_growth_rate": 8.6,
                "growth_rate_source": "equity_5yr_cagr",
                "growth_divergence_warning": "Revenue CAGR (13.1%) and FCF CAGR (20.2%) significantly exceed Equity CAGR (8.6%), driven by cyclical recovery from FY2023 cyclone impact."
            },
            "assumptions": {
                "base": {
                    "growth_rates": [12.0, 10.0, 8.0, 6.0, 4.0],
                    "fcf_margin": 16.0,
                    "wacc": 11.0,
                    "terminal_growth": 2.5
                },
                "bull": {
                    "growth_rates": [18.0, 15.0, 12.0, 10.0, 8.0],
                    "fcf_margin": 18.0,
                    "wacc": 10.0,
                    "terminal_growth": 3.0
                },
                "bear": {
                    "growth_rates": [5.0, 3.0, 2.0, 1.0, 0.0],
                    "fcf_margin": 14.0,
                    "wacc": 13.0,
                    "terminal_growth": 2.0
                }
            },
            "valuation": {
                "base": {
                    "intrinsic_value_per_share": 20.88,
                    "upside_percent": 348.9
                },
                "bull": {
                    "intrinsic_value_per_share": 36.07,
                    "upside_percent": 675.7
                },
                "bear": {
                    "intrinsic_value_per_share": 9.78,
                    "upside_percent": 110.3
                }
            },
            "entry_price_analysis": {
                "base": {
                    "entry_price": 13.91
                },
                "bull": {
                    "entry_price": 23.52
                },
                "bear": {
                    "entry_price": 7.12
                }
            },
            "sensitivity_analysis": {
                "base_case_matrix": {
                    "wacc_range": [9.0, 10.0, 11.0, 12.0, 13.0],
                    "terminal_growth_range": [1.5, 2.0, 2.5, 3.0, 3.5],
                    "intrinsic_value_matrix": [
                        [30.45, 33.12, 36.34, 40.34, 45.46],
                        [25.21, 27.19, 29.56, 32.45, 36.03],
                        [21.44, 22.94, 24.70, 26.80, 29.35],
                        [18.60, 19.76, 21.11, 22.69, 24.56],
                        [16.38, 17.31, 18.37, 19.57, 20.96]
                    ]
                }
            },
            "probability_weighted_valuation": {
                "probability_weighted_iv": 21.91
            }
        };

        // ==================== CSV PARSER ====================
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
                return obj;
            });
        }

        const data = parseCSV(csvData);

        // ==================== HELPER FUNCTIONS ====================
        function calcYoYChange(current, previous) {
            if (!previous || !current || previous === '' || current === '') return null;
            const curr = parseFloat(current);
            const prev = parseFloat(previous);
            if (prev === 0) return null;
            return ((curr - prev) / Math.abs(prev) * 100).toFixed(1);
        }

        function formatNumber(value, decimals = 0) {
            if (!value || value === '') return 'N/A';
            const num = parseFloat(value);
            return num.toFixed(decimals);
        }

        function formatCurrency(value, decimals = 0) {
            if (!value || value === '') return 'N/A';
            const num = parseFloat(value);
            if (num >= 1000) {
                return '$' + (num / 1000).toFixed(1) + 'b';
            }
            return '$' + num.toFixed(decimals) + 'm';
        }

        // ==================== UPDATE KPI CARDS ====================
        const fyData = data.filter(d => d.Period.startsWith('FY')).reverse();
        const fy2024 = fyData[0];
        const fy2023 = fyData[1];

        document.getElementById('kpiRevenue').textContent = formatCurrency(fy2024.Revenue);
        document.getElementById('kpiEBITDA').textContent = formatCurrency(fy2024.EBITDA);
        document.getElementById('kpiNetProfit').textContent = formatCurrency(fy2024.NetProfit);
        document.getElementById('kpiTrays').textContent = fy2024.KiwifruitTraysNZ ? fy2024.KiwifruitTraysNZ + 'm' : 'N/A';
        document.getElementById('kpiEPS').textContent = '$' + formatNumber(fy2024.EPS, 2);
        document.getElementById('kpiOCF').textContent = formatCurrency(fy2024.OperatingCashFlow);
        document.getElementById('kpiNetDebt').textContent = formatCurrency(fy2024.NetDebt);
        document.getElementById('kpiDividend').textContent = fy2024.DividendPerShare + 'c';

        const revChange = calcYoYChange(fy2024.Revenue, fy2023.Revenue);
        const ebitdaChange = calcYoYChange(fy2024.EBITDA, fy2023.EBITDA);
        const npChange = calcYoYChange(fy2024.NetProfit, fy2023.NetProfit);
        const traysChange = calcYoYChange(fy2024.KiwifruitTraysNZ, fy2023.KiwifruitTraysNZ);
        const epsChange = calcYoYChange(fy2024.EPS, fy2023.EPS);
        const ocfChange = calcYoYChange(fy2024.OperatingCashFlow, fy2023.OperatingCashFlow);
        const debtChange = calcYoYChange(fy2024.NetDebt, fy2023.NetDebt);

        if (revChange) {
            document.getElementById('kpiRevenueChange').textContent = (revChange >= 0 ? '+' : '') + revChange + '%';
            document.getElementById('kpiRevenueChange').className = 'kpi-change ' + (revChange >= 0 ? 'positive' : 'negative');
        }
        if (ebitdaChange) {
            document.getElementById('kpiEBITDAChange').textContent = (ebitdaChange >= 0 ? '+' : '') + ebitdaChange + '%';
            document.getElementById('kpiEBITDAChange').className = 'kpi-change ' + (ebitdaChange >= 0 ? 'positive' : 'negative');
        }
        if (npChange) {
            document.getElementById('kpiNetProfitChange').textContent = (npChange >= 0 ? '+' : '') + npChange + '%';
            document.getElementById('kpiNetProfitChange').className = 'kpi-change ' + (npChange >= 0 ? 'positive' : 'negative');
        }
        if (traysChange) {
            document.getElementById('kpiTraysChange').textContent = (traysChange >= 0 ? '+' : '') + traysChange + '%';
            document.getElementById('kpiTraysChange').className = 'kpi-change ' + (traysChange >= 0 ? 'positive' : 'negative');
        }
        if (epsChange) {
            document.getElementById('kpiEPSChange').textContent = (epsChange >= 0 ? '+' : '') + epsChange + '%';
            document.getElementById('kpiEPSChange').className = 'kpi-change ' + (epsChange >= 0 ? 'positive' : 'negative');
        }
        if (ocfChange) {
            document.getElementById('kpiOCFChange').textContent = (ocfChange >= 0 ? '+' : '') + ocfChange + '%';
            document.getElementById('kpiOCFChange').className = 'kpi-change ' + (ocfChange >= 0 ? 'positive' : 'negative');
        }
        if (debtChange) {
            document.getElementById('kpiNetDebtChange').textContent = (debtChange >= 0 ? '+' : '') + debtChange + '%';
            document.getElementById('kpiNetDebtChange').className = 'kpi-change ' + (debtChange < 0 ? 'positive' : 'negative');
        }

        // ==================== CHART DEFAULTS ====================
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#e0e0e0', font: { size: 11 } } }
            },
            scales: {
                x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
        };

        const colors = {
            primary: '#00d4aa',
            secondary: '#00b894',
            tertiary: '#0984e3',
            quaternary: '#6c5ce7',
            warning: '#fdcb6e',
            danger: '#ff6b6b'
        };

        // ==================== CREATE CHARTS ====================
        const fyChartData = fyData.slice(-10).reverse();
        const fyLabels = fyChartData.map(d => d.Period);

        // Revenue & EBITDA
        new Chart(document.getElementById('revenueChart'), {
            type: 'line',
            data: {
                labels: fyLabels,
                datasets: [{
                    label: 'Revenue (NZD thousands)',
                    data: fyChartData.map(d => d.Revenue),
                    borderColor: colors.primary,
                    backgroundColor: 'rgba(0, 212, 170, 0.1)',
                    tension: 0.3
                }, {
                    label: 'EBITDA (NZD thousands)',
                    data: fyChartData.map(d => d.EBITDA),
                    borderColor: colors.tertiary,
                    backgroundColor: 'rgba(9, 132, 227, 0.1)',
                    tension: 0.3
                }]
            },
            options: chartDefaults
        });

        // Kiwifruit Trays
        new Chart(document.getElementById('traysChart'), {
            type: 'bar',
            data: {
                labels: fyLabels,
                datasets: [{
                    label: 'Kiwifruit Trays (millions)',
                    data: fyChartData.map(d => d.KiwifruitTraysNZ),
                    backgroundColor: colors.primary,
                    borderColor: colors.secondary,
                    borderWidth: 2
                }]
            },
            options: chartDefaults
        });

        // Net Profit & EPS
        new Chart(document.getElementById('profitChart'), {
            type: 'line',
            data: {
                labels: fyLabels,
                datasets: [{
                    label: 'Net Profit (NZD thousands)',
                    data: fyChartData.map(d => d.NetProfit),
                    borderColor: colors.primary,
                    backgroundColor: 'rgba(0, 212, 170, 0.1)',
                    tension: 0.3,
                    yAxisID: 'y'
                }, {
                    label: 'EPS (NZD)',
                    data: fyChartData.map(d => d.EPS),
                    borderColor: colors.quaternary,
                    backgroundColor: 'rgba(108, 92, 231, 0.1)',
                    tension: 0.3,
                    yAxisID: 'y1'
                }]
            },
            options: {
                ...chartDefaults,
                scales: {
                    x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                    y: {
                        type: 'linear',
                        position: 'left',
                        ticks: { color: '#888' },
                        grid: { color: 'rgba(255,255,255,0.05)' },
                        title: { display: true, text: 'Net Profit', color: '#888' }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        ticks: { color: '#888' },
                        grid: { display: false },
                        title: { display: true, text: 'EPS', color: '#888' }
                    }
                }
            }
        });

        // Gross Margin
        new Chart(document.getElementById('marginChart'), {
            type: 'line',
            data: {
                labels: fyLabels,
                datasets: [{
                    label: 'Gross Margin %',
                    data: fyChartData.map(d => d.GrossMargin),
                    borderColor: colors.warning,
                    backgroundColor: 'rgba(253, 203, 110, 0.1)',
                    tension: 0.3
                }]
            },
            options: chartDefaults
        });

        // Operating Cash Flow
        new Chart(document.getElementById('cashflowChart'), {
            type: 'bar',
            data: {
                labels: fyLabels,
                datasets: [{
                    label: 'Operating Cash Flow (NZD thousands)',
                    data: fyChartData.map(d => d.OperatingCashFlow),
                    backgroundColor: colors.tertiary,
                    borderColor: colors.primary,
                    borderWidth: 2
                }]
            },
            options: chartDefaults
        });

        // Balance Sheet
        new Chart(document.getElementById('balanceChart'), {
            type: 'bar',
            data: {
                labels: fyLabels,
                datasets: [{
                    label: 'Total Assets',
                    data: fyChartData.map(d => d.TotalAssets),
                    backgroundColor: colors.primary
                }, {
                    label: 'Total Liabilities',
                    data: fyChartData.map(d => d.TotalLiabilities),
                    backgroundColor: colors.danger
                }, {
                    label: 'Total Equity',
                    data: fyChartData.map(d => d.TotalEquity),
                    backgroundColor: colors.tertiary
                }]
            },
            options: chartDefaults
        });

        // Net Debt
        new Chart(document.getElementById('debtChart'), {
            type: 'line',
            data: {
                labels: fyLabels,
                datasets: [{
                    label: 'Net Debt (NZD thousands)',
                    data: fyChartData.map(d => d.NetDebt),
                    borderColor: colors.danger,
                    backgroundColor: 'rgba(255, 107, 107, 0.1)',
                    tension: 0.3
                }]
            },
            options: chartDefaults
        });

        // EBITDA Margin
        const ebitdaMarginData = fyChartData.map(d => {
            if (d.EBITDA && d.Revenue) {
                return ((parseFloat(d.EBITDA) / parseFloat(d.Revenue)) * 100).toFixed(1);
            }
            return null;
        });

        new Chart(document.getElementById('ebitdaMarginChart'), {
            type: 'line',
            data: {
                labels: fyLabels,
                datasets: [{
                    label: 'EBITDA Margin %',
                    data: ebitdaMarginData,
                    borderColor: colors.primary,
                    backgroundColor: 'rgba(0, 212, 170, 0.1)',
                    tension: 0.3
                }]
            },
            options: chartDefaults
        });

        // ==================== MODAL DESCRIPTIONS ====================
        const metricDescriptions = {
            revenue: {
                title: "Revenue",
                content: `
                    <p><strong>Revenue</strong> is the total income Seeka generates from post-harvest services (packing and coolstorage), orchard management, retail services, and Australian operations.</p>
                    <div class="metric-highlight">
                        <strong>For Seeka:</strong> Revenue is heavily dependent on kiwifruit volumes handled. ~60% comes from post-harvest operations where Seeka earns per-tray fees for grading, packing, and coolstorage. FY2024 handled 43.0 million trays (up 44% from FY2023's cyclone-impacted 29.8m trays).
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Kiwifruit trays packed - the primary volume driver</li>
                        <li>Revenue per tray - indicates pricing power and service mix</li>
                        <li>Zespri season forecasts (2025/26: 205-215m trays nationally)</li>
                        <li>Weather impacts on volumes (FY2023 Cyclone Gabrielle demonstrated downside)</li>
                        <li>Australian operations growth (revenue +85% in FY2024)</li>
                    </ul>
                `
            },
            trays: {
                title: "Kiwifruit Trays Packed",
                content: `
                    <p><strong>Kiwifruit Trays</strong> measure the volume of Class 1 kiwifruit trays that Seeka packed in New Zealand operations.</p>
                    <div class="metric-highlight">
                        <strong>For Seeka:</strong> This is THE most important operational metric. Profitability is highly sensitive to volumes due to fixed cost base. FY2023's 29.8m trays resulted in $21m loss before tax, while FY2024's 43.0m trays generated $29.7m profit. Seeka has capacity for 50m+ trays with current infrastructure.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Target 45-50m trays to optimize profitability</li>
                        <li>Weather conditions during March-July NZ harvest season</li>
                        <li>Grower pre-season signups (strong for 2025 season)</li>
                        <li>Market share vs industry total (Seeka ~20% of national crop)</li>
                        <li>Capacity utilization - 43m/50m = 86% in FY2024</li>
                    </ul>
                `
            },
            netProfit: {
                title: "Net Profit & EPS",
                content: `
                    <p><strong>Net Profit</strong> is the bottom-line profit after all expenses, interest, and taxes. <strong>EPS</strong> divides this by shares outstanding (41.6m).</p>
                    <div class="metric-highlight">
                        <strong>For Seeka:</strong> FY2024 net profit of $8.8m included a one-time $12.5m deferred tax charge from building depreciation removal. Adjusted net profit was ~$21.2m, equivalent to ~$0.51 EPS. This demonstrates the earnings power when volumes normalize. Extreme cyclicality makes EPS volatile year-to-year.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Normalize for one-time items (deferred tax in FY2024)</li>
                        <li>Compare to EBITDA to assess tax and financing impact</li>
                        <li>Cyclical pattern: losses possible in low-volume years</li>
                        <li>Interest expense ($17.1m in FY2024) consuming ~23% of EBITDA</li>
                        <li>Dividend coverage: 15c dividend on 21c reported EPS or 51c adjusted</li>
                    </ul>
                `
            },
            margin: {
                title: "Gross Margin",
                content: `
                    <p><strong>Gross Margin</strong> measures gross profit as a percentage of revenue, indicating how much Seeka retains after direct costs of packing and orcharding.</p>
                    <div class="metric-highlight">
                        <strong>For Seeka:</strong> FY2024 gross margin of 25.5% was highest in 7 years, driven by volume leverage and automation efficiencies. Post-harvest operations achieved 34.3% EBITDA margin while orcharding was 6.0%. Cost per tray down 19% despite wage inflation thanks to automation investments.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Target: 23-26% gross margin in normal volume years</li>
                        <li>Operating leverage: margin expands dramatically with volume increases</li>
                        <li>Automation impact: new Kerikeri facility (2025) should improve margins</li>
                        <li>Labor cost inflation vs efficiency gains from automation</li>
                        <li>Mix shift: higher-margin post-harvest vs lower-margin orcharding</li>
                    </ul>
                `
            },
            cashflow: {
                title: "Operating Cash Flow",
                content: `
                    <p><strong>Operating Cash Flow</strong> measures actual cash generated from business operations, before investing and financing activities.</p>
                    <div class="metric-highlight">
                        <strong>For Seeka:</strong> FY2024 OCF of $66.0m was exceptional (+147% YoY), representing 16% of revenue. This enabled $35.1m debt reduction and dividend restart. Seeka uses OCF as proxy for Free Cash Flow given minimal growth capex requirements after completing major automation investments.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>FCF yield: $66m OCF / $193m market cap = 34% yield (extremely high)</li>
                        <li>Sustainability: FY2024 benefited from volume recovery, may not repeat</li>
                        <li>Working capital swings due to seasonal nature of business</li>
                        <li>Capital allocation: debt reduction vs growth investment vs dividends</li>
                        <li>Interest rates declining should improve cash retention</li>
                    </ul>
                `
            },
            balance: {
                title: "Balance Sheet",
                content: `
                    <p><strong>Balance Sheet</strong> shows Seeka's assets, liabilities, and equity. Assets include PP&E ($388m), receivables, and inventory. Liabilities include debt and payables.</p>
                    <div class="metric-highlight">
                        <strong>For Seeka:</strong> Total assets of $550m dominated by Property, Plant & Equipment (12 packing facilities with 16 graders, coolstorage, orchards). Net debt of $137m (51% of equity) has improved from $172m in FY2023 but remains elevated. Equity of $266m provides cushion but limited headroom for adverse scenarios.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Net debt trend: target to reduce below $100m for financial flexibility</li>
                        <li>Banking covenant compliance: restored in FY2024, headroom now $61m</li>
                        <li>Asset utilization: 43m trays / 50m capacity = 86%</li>
                        <li>Capital intensity: $388m PP&E requires ongoing maintenance capex</li>
                        <li>Cyclone/disaster risk: insurance critical given fixed asset concentration</li>
                    </ul>
                `
            },
            debt: {
                title: "Net Debt",
                content: `
                    <p><strong>Net Debt</strong> is total debt minus cash and equivalents. Measures actual debt burden that must be serviced with operating cash flow.</p>
                    <div class="metric-highlight">
                        <strong>For Seeka:</strong> FY2024 net debt of $137m reduced by $35m thanks to strong cash generation. However, at 51% of equity and 1.8x EBITDA, debt remains material. Interest expense of $17.1m consumed 23% of EBITDA. Declining interest rates from 2024 peaks will provide tailwind.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Target: Net debt below $100m for comfort, ideally below 1.0x EBITDA</li>
                        <li>Interest rate sensitivity: $137m at ~5-6% = $7-8m annual benefit from 2% rate drop</li>
                        <li>Covenant headroom: improved to $61m from $23m, but monitor closely</li>
                        <li>Capital allocation priority: debt reduction vs Australian expansion</li>
                        <li>Cyclical risk: low-volume year could stress covenant compliance</li>
                    </ul>
                `
            },
            ebitdaMargin: {
                title: "EBITDA Margin",
                content: `
                    <p><strong>EBITDA Margin</strong> measures EBITDA as percentage of revenue, showing operational profitability before interest, taxes, depreciation, and amortization.</p>
                    <div class="metric-highlight">
                        <strong>For Seeka:</strong> FY2024 EBITDA margin of 18.5% ($76.1m / $411.4m) recovered from FY2023's 8.6%. Post-harvest segment achieved 34.3% EBITDA margin while orcharding was 6.0%. Margin highly sensitive to volume due to fixed cost leverage.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Target: 18-22% EBITDA margin in normal volume years (40m+ trays)</li>
                        <li>Segment mix: Post-harvest (34% margin) vs Orcharding (6% margin)</li>
                        <li>Operating leverage: margin expansion at higher volumes</li>
                        <li>Automation benefits: cost per tray down 19% in FY2024</li>
                        <li>Compare to historical: FY2020-21 averaged 19.8% margin at 39-43m trays</li>
                    </ul>
                `
            }
        };

        // ==================== MODAL FUNCTIONS ====================
        function openModal(key) {
            document.getElementById('modalTitle').textContent = metricDescriptions[key].title;
            document.getElementById('modalBody').innerHTML = metricDescriptions[key].content;
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(event) {
            if (event && event.target.className !== 'modal-overlay active') return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }

        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // ==================== OVERVIEW TOGGLE ====================
        function toggleOverview() {
            const btn = document.querySelector('.overview-toggle');
            const content = document.getElementById('overviewContent');
            btn.classList.toggle('active');
            content.classList.toggle('active');
        }

        // ==================== DCF FUNCTIONS ====================
        let currentScenario = 'base';

        function calculateDCF(growthRate, wacc, terminalGrowth) {
            const years = 5;
            const fcf = dcfData.inputs.last_fcf;
            let pvFCF = 0;
            let projectedFCF = fcf;

            // Calculate PV of projected FCF
            // Growth rate applies uniformly for projection years (user controls via slider)
            for (let i = 0; i < years; i++) {
                projectedFCF *= (1 + growthRate / 100);
                pvFCF += projectedFCF / Math.pow(1 + wacc/100, i + 1);
            }

            // Terminal Value (Gordon Growth Model)
            // Terminal FCF grows at terminal growth rate in perpetuity
            const terminalFCF = projectedFCF * (1 + terminalGrowth/100);
            const terminalValue = terminalFCF / (wacc/100 - terminalGrowth/100);
            const pvTerminal = terminalValue / Math.pow(1 + wacc/100, years);

            // Enterprise Value to Equity Value
            const enterpriseValue = pvFCF + pvTerminal;
            const equityValue = enterpriseValue - dcfData.inputs.net_debt;
            const iv = equityValue / dcfData.inputs.shares_outstanding;

            // Entry Price for 15% CAGR
            const terminalPerShare = terminalValue / dcfData.inputs.shares_outstanding;
            const entryPrice = terminalPerShare / Math.pow(1.15, years);

            return {
                iv: iv,
                entryPrice: entryPrice,
                terminalPerShare: terminalPerShare,
                pvFCF: pvFCF,
                pvTerminal: pvTerminal,
                enterpriseValue: enterpriseValue
            };
        }

        window.updateDCFDisplay = function() {
            const growth = parseFloat(document.getElementById('growthSlider').value);
            const wacc = parseFloat(document.getElementById('waccSlider').value);
            const terminal = parseFloat(document.getElementById('terminalSlider').value);

            // Update slider labels
            document.getElementById('growthValue').textContent = growth + '%';
            document.getElementById('waccValue').textContent = wacc + '%';
            document.getElementById('terminalValue').textContent = terminal + '%';

            // Calculate new values
            const result = calculateDCF(growth, wacc, terminal);

            // Update IV display
            document.getElementById('dcfIV').textContent = '$' + result.iv.toFixed(2);
            document.getElementById('dcfEntry').textContent = '$' + result.entryPrice.toFixed(2);

            // Calculate and display upside
            const upside = ((result.iv - dcfData.current_price) / dcfData.current_price * 100);
            const upsideEl = document.getElementById('dcfUpside');
            upsideEl.textContent = (upside >= 0 ? '+' : '') + upside.toFixed(0) + '% ' + (upside >= 0 ? 'upside' : 'downside');
            upsideEl.className = 'dcf-change ' + (upside >= 0 ? 'positive' : 'negative');

            // Update assumptions grid to reflect current slider values
            const grid = document.getElementById('assumptionGrid');
            if (grid) {
                grid.innerHTML = `
                    <div class="assumption-item">
                        <div class="label">Growth Rate</div>
                        <div class="value">${growth}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">WACC</div>
                        <div class="value">${wacc}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Terminal Growth</div>
                        <div class="value">${terminal}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Intrinsic Value</div>
                        <div class="value" style="color: #00d4aa;">$${result.iv.toFixed(2)}</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Entry Price</div>
                        <div class="value" style="color: #00d4aa;">$${result.entryPrice.toFixed(2)}</div>
                    </div>
                `;
            }
        };

        window.switchScenario = function(scenario) {
            currentScenario = scenario;

            // Update tab styles
            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === scenario);
            });

            // Get scenario assumptions
            const assumptions = dcfData.assumptions[scenario];
            const valuation = dcfData.valuation[scenario];

            // Update sliders to scenario defaults
            document.getElementById('growthSlider').value = assumptions.growth_rates[0];
            document.getElementById('waccSlider').value = assumptions.wacc;
            document.getElementById('terminalSlider').value = assumptions.terminal_growth;

            // Render assumptions grid
            const grid = document.getElementById('assumptionGrid');
            grid.innerHTML = `
                <div class="assumption-item">
                    <div class="label">Year 1 Growth</div>
                    <div class="value">${assumptions.growth_rates[0]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Year 5 Growth</div>
                    <div class="value">${assumptions.growth_rates[4]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">FCF Margin</div>
                    <div class="value">${assumptions.fcf_margin}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">WACC</div>
                    <div class="value">${assumptions.wacc}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Terminal Growth</div>
                    <div class="value">${assumptions.terminal_growth}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Intrinsic Value</div>
                    <div class="value" style="color: #00d4aa;">$${valuation.intrinsic_value_per_share.toFixed(2)}</div>
                </div>
            `;

            updateDCFDisplay();
        };

        function renderHistoricalGrowth() {
            const growth = dcfData.historical_growth;
            const selectedSource = growth.growth_rate_source;
            const grid = document.getElementById('growthGrid');

            const metrics = [
                { key: 'revenue_3yr_cagr', label: 'Revenue 3Y' },
                { key: 'revenue_5yr_cagr', label: 'Revenue 5Y' },
                { key: 'eps_3yr_cagr', label: 'EPS 3Y' },
                { key: 'eps_5yr_cagr', label: 'EPS 5Y' },
                { key: 'equity_3yr_cagr', label: 'Equity 3Y' },
                { key: 'equity_5yr_cagr', label: 'Equity 5Y' },
                { key: 'fcf_3yr_cagr', label: 'FCF 3Y' },
                { key: 'fcf_5yr_cagr', label: 'FCF 5Y' }
            ];

            grid.innerHTML = metrics.map(m => {
                const rate = growth[m.key];
                const isSelected = m.key === selectedSource;
                const colorClass = rate >= 0 ? 'positive' : 'negative';
                return `
                    <div class="growth-item ${isSelected ? 'selected' : ''}">
                        <div class="metric">${m.label}</div>
                        <div class="rate ${colorClass}">${rate >= 0 ? '+' : ''}${rate.toFixed(1)}%</div>
                    </div>
                `;
            }).join('');
        }

        function renderSensitivityMatrix() {
            const sens = dcfData.sensitivity_analysis.base_case_matrix;
            const table = document.getElementById('sensitivityMatrix');
            const currentPrice = dcfData.current_price;

            let html = '<tr><th>WACC \\ Term G</th>';
            sens.terminal_growth_range.forEach(tg => {
                html += `<th>${tg}%</th>`;
            });
            html += '</tr>';

            sens.wacc_range.forEach((wacc, i) => {
                html += `<tr><th>${wacc}%</th>`;
                sens.intrinsic_value_matrix[i].forEach((val, j) => {
                    const isHighlight = wacc === dcfData.assumptions.base.wacc &&
                                       sens.terminal_growth_range[j] === dcfData.assumptions.base.terminal_growth;
                    const colorClass = val >= currentPrice ? 'above-current' : 'below-current';
                    html += `<td class="${isHighlight ? 'highlight' : colorClass}">$${val.toFixed(2)}</td>`;
                });
                html += '</tr>';
            });

            table.innerHTML = html;
        }

        function initDCF() {
            if (!dcfData || !dcfData.valuation) return;

            // Set current price
            document.getElementById('dcfCurrent').textContent = '$' + dcfData.current_price.toFixed(2);

            // Set slider defaults from base case
            const base = dcfData.assumptions.base;
            document.getElementById('growthSlider').value = dcfData.historical_growth.selected_growth_rate;
            document.getElementById('waccSlider').value = base.wacc;
            document.getElementById('terminalSlider').value = base.terminal_growth;

            // Update slider labels
            document.getElementById('growthValue').textContent = dcfData.historical_growth.selected_growth_rate + '%';
            document.getElementById('waccValue').textContent = base.wacc + '%';
            document.getElementById('terminalValue').textContent = base.terminal_growth + '%';

            // Set growth hint
            document.getElementById('growthHint').textContent =
                'Based on ' + dcfData.historical_growth.growth_rate_source.replace(/_/g, ' ');

            // Set probability-weighted IV
            document.getElementById('dcfWeighted').textContent = '$' + dcfData.probability_weighted_valuation.probability_weighted_iv.toFixed(2);

            // Render components
            renderHistoricalGrowth();
            renderSensitivityMatrix();
            updateDCFDisplay();
            switchScenario('base');
        }

        // Initialize DCF section immediately (script is at end of body, DOM is ready)
        initDCF();

        // Bind slider events directly after init
        (function() {
            var growthSlider = document.getElementById('growthSlider');
            var waccSlider = document.getElementById('waccSlider');
            var terminalSlider = document.getElementById('terminalSlider');

            if (growthSlider) {
                growthSlider.oninput = window.updateDCFDisplay;
                growthSlider.onchange = window.updateDCFDisplay;
            }
            if (waccSlider) {
                waccSlider.oninput = window.updateDCFDisplay;
                waccSlider.onchange = window.updateDCFDisplay;
            }
            if (terminalSlider) {
                terminalSlider.oninput = window.updateDCFDisplay;
                terminalSlider.onchange = window.updateDCFDisplay;
            }
        })();
    </script>
</body>
</html>