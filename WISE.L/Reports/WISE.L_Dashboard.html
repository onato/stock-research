<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wise plc (WISE.L) Financial Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4aa, #00b894);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .header p {
            color: #888;
            font-size: 1.1rem;
        }

        /* Investment Overview Section */
        .overview-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .overview-toggle {
            width: 100%;
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid rgba(0, 212, 170, 0.3);
            border-radius: 12px;
            padding: 16px 24px;
            color: #00d4aa;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        .overview-toggle:hover {
            background: rgba(0, 212, 170, 0.2);
        }
        .overview-toggle .arrow {
            transition: transform 0.3s ease;
        }
        .overview-toggle.active .arrow {
            transform: rotate(180deg);
        }
        .overview-content {
            display: none;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            margin-top: -12px;
        }
        .overview-content.active {
            display: block;
        }
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        .overview-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .overview-card h3 {
            color: #00d4aa;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .overview-card p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        .overview-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .overview-card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            line-height: 1.5;
        }
        .overview-card li:last-child {
            border-bottom: none;
        }
        .overview-card.bull h3 { color: #00d4aa; }
        .overview-card.bear h3 { color: #ff6b6b; }
        .overview-card.risks h3 { color: #fdcb6e; }
        .risk-high { color: #ff6b6b; font-weight: 600; }
        .risk-moderate { color: #fdcb6e; font-weight: 600; }
        .risk-low { color: #00d4aa; font-weight: 600; }
        .revenue-stream {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .revenue-stream .percent {
            color: #00d4aa;
            font-weight: 600;
        }
        .trend-growing { color: #00d4aa; }
        .trend-stable { color: #888; }
        .trend-declining { color: #ff6b6b; }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        .kpi-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 170, 0.2);
        }
        .kpi-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 5px;
        }
        .kpi-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .kpi-change {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .kpi-change.positive { color: #00d4aa; }
        .kpi-change.negative { color: #ff6b6b; }

        /* Guidance Section */
        .guidance-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .guidance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .guidance-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .guidance-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .guidance-meta {
            font-size: 0.85rem;
            color: #888;
        }
        .guidance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .guidance-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease;
        }
        .guidance-card:hover {
            transform: translateY(-2px);
        }
        .guidance-metric {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .guidance-target {
            font-size: 1.4rem;
            font-weight: 600;
            color: #00d4aa;
            margin-bottom: 6px;
        }
        .guidance-period {
            font-size: 0.85rem;
            color: #e0e0e0;
            margin-bottom: 8px;
        }
        .guidance-vs-prior {
            display: inline-block;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        .guidance-vs-prior.raised {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
        }
        .guidance-vs-prior.lowered {
            background: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
        }
        .guidance-vs-prior.maintained {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }
        .guidance-vs-prior.new {
            background: rgba(99, 102, 241, 0.15);
            color: #818cf8;
        }
        .guidance-notes {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }
        .guidance-commentary {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 16px 20px;
            border-left: 3px solid #00d4aa;
            font-style: italic;
            color: #b0b0b0;
            line-height: 1.6;
        }
        .guidance-commentary::before {
            content: '"';
            font-size: 1.5rem;
            color: #00d4aa;
            margin-right: 4px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #fff;
            margin: 40px auto 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0, 212, 170, 0.3);
            max-width: 1400px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .chart-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .help-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(0, 212, 170, 0.2);
            border: 1px solid #00d4aa;
            color: #00d4aa;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .help-btn:hover {
            background: #00d4aa;
            color: #1a1a2e;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: linear-gradient(135deg, #1e2a4a 0%, #16213e 100%);
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 212, 170, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 {
            color: #00d4aa;
            font-size: 1.4rem;
            margin: 0;
        }
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: #ff6b6b;
            color: #fff;
        }
        .modal-body {
            padding: 25px;
            line-height: 1.7;
        }
        .modal-body p { margin-bottom: 15px; }
        .modal-body strong { color: #00d4aa; }
        .modal-body ul { margin: 15px 0; padding-left: 20px; }
        .modal-body li { margin-bottom: 8px; }
        .metric-highlight {
            background: rgba(0, 212, 170, 0.1);
            border-left: 3px solid #00d4aa;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        /* DCF Valuation Section */
        .dcf-section {
            max-width: 1400px;
            margin: 0 auto 40px;
        }
        .dcf-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dcf-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }
        .dcf-card:hover {
            transform: translateY(-3px);
        }
        .dcf-card.highlight {
            background: rgba(0, 212, 170, 0.1);
            border-color: rgba(0, 212, 170, 0.3);
        }
        .dcf-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .dcf-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #00d4aa;
        }
        .dcf-card:not(.highlight) .dcf-value {
            color: #fff;
        }
        .dcf-change {
            font-size: 1rem;
            margin-top: 8px;
            font-weight: 600;
        }
        .dcf-change.positive { color: #00d4aa; }
        .dcf-change.negative { color: #ff6b6b; }
        .dcf-sublabel {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
        }
        .dcf-warning {
            background: rgba(253, 203, 110, 0.15);
            border: 1px solid rgba(253, 203, 110, 0.4);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fdcb6e;
        }
        .warning-icon {
            font-size: 1.2rem;
        }
        .dcf-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .slider-group label {
            font-size: 0.95rem;
            color: #e0e0e0;
            display: flex;
            justify-content: space-between;
        }
        .slider-group label span {
            color: #00d4aa;
            font-weight: 600;
        }
        .slider-group input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        .slider-group input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            border: none;
        }
        .slider-hint {
            font-size: 0.8rem;
            color: #666;
        }
        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .scenario-tab {
            padding: 10px 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: #888;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .scenario-tab:hover {
            border-color: rgba(0, 212, 170, 0.5);
            color: #e0e0e0;
        }
        .scenario-tab.active {
            background: rgba(0, 212, 170, 0.15);
            border-color: #00d4aa;
            color: #00d4aa;
        }
        .scenario-details {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .scenario-details h4 {
            color: #00d4aa;
            margin-bottom: 15px;
        }
        .assumption-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .assumption-item {
            text-align: center;
        }
        .assumption-item .label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
        }
        .assumption-item .value {
            font-size: 1.1rem;
            color: #e0e0e0;
            font-weight: 500;
        }
        .sensitivity-section {
            margin-bottom: 30px;
        }
        .sensitivity-section h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .sensitivity-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            overflow: hidden;
        }
        .sensitivity-table th,
        .sensitivity-table td {
            padding: 12px 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .sensitivity-table th {
            background: rgba(0, 212, 170, 0.1);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td {
            color: #e0e0e0;
        }
        .sensitivity-table td.highlight {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td.below-current {
            color: #ff6b6b;
        }
        .sensitivity-table td.above-current {
            color: #00d4aa;
        }
        .historical-growth {
            margin-bottom: 30px;
        }
        .historical-growth h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .growth-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }
        .growth-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .growth-item .metric {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 6px;
        }
        .growth-item .rate {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .growth-item .rate.positive { color: #00d4aa; }
        .growth-item .rate.negative { color: #ff6b6b; }
        .growth-item.selected {
            border-color: #00d4aa;
            background: rgba(0, 212, 170, 0.1);
        }

        @media (max-width: 768px) {
            .charts-container { grid-template-columns: 1fr; }
            .overview-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Wise plc (WISE.L)</h1>
        <p>Cross-Border Payment Infrastructure | Financial Dashboard</p>
    </div>

    <!-- Investment Overview Section -->
    <div class="overview-section">
        <button class="overview-toggle" onclick="toggleOverview()">
            <span>Investment Overview & Analysis</span>
            <span class="arrow">▼</span>
        </button>
        <div class="overview-content" id="overviewContent">
            <div class="overview-grid">
                <!-- Company Overview -->
                <div class="overview-card">
                    <h3>Company Overview</h3>
                    <p id="companyOverview"></p>
                </div>

                <!-- Business Model -->
                <div class="overview-card">
                    <h3>Business Model</h3>
                    <p id="businessModelSummary"></p>
                    <ul id="revenueStreams"></ul>
                </div>

                <!-- Competitive Position -->
                <div class="overview-card">
                    <h3>Competitive Position</h3>
                    <p id="marketPosition"></p>
                    <p><strong>Main Competitors:</strong> <span id="competitors"></span></p>
                    <p><strong>Key Moat Factors:</strong></p>
                    <ul id="moatFactors"></ul>
                </div>

                <!-- Growth Drivers -->
                <div class="overview-card">
                    <h3>Growth Drivers</h3>
                    <ul id="growthDrivers"></ul>
                </div>

                <!-- Key Risks -->
                <div class="overview-card risks">
                    <h3>Key Risks</h3>
                    <ul id="keyRisks"></ul>
                </div>

                <!-- Bull Case -->
                <div class="overview-card bull">
                    <h3>Bull Case</h3>
                    <ul id="bullCase"></ul>
                </div>

                <!-- Bear Case -->
                <div class="overview-card bear">
                    <h3>Bear Case</h3>
                    <ul id="bearCase"></ul>
                </div>

                <!-- Recent Developments -->
                <div class="overview-card">
                    <h3>Recent Developments</h3>
                    <ul id="recentDevelopments"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid" id="kpiGrid"></div>

    <!-- Management Guidance Section -->
    <div class="guidance-section" id="guidanceSection">
        <div class="guidance-header">
            <h3>Management Guidance</h3>
            <span class="guidance-meta">As of <span id="guidanceAsOf"></span> | <span id="guidanceFY"></span></span>
        </div>
        <div class="guidance-grid" id="guidanceGrid"></div>
        <div class="guidance-commentary" id="guidanceCommentary"></div>
    </div>

    <!-- Financial Charts -->
    <h2 class="section-title">Revenue & Profitability</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Underlying Income Growth</h3>
                <button class="help-btn" onclick="openModal('underlyingIncome')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="underlyingIncomeChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Profit Before Tax</h3>
                <button class="help-btn" onclick="openModal('pbt')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="pbtChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Underlying PBT Margin</h3>
                <button class="help-btn" onclick="openModal('pbtMargin')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="pbtMarginChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Free Cash Flow</h3>
                <button class="help-btn" onclick="openModal('fcf')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="fcfChart"></canvas>
            </div>
        </div>
    </div>

    <h2 class="section-title">Customer & Volume Metrics</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Active Customers</h3>
                <button class="help-btn" onclick="openModal('activeCustomers')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="activeCustomersChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Cross-Border Volume</h3>
                <button class="help-btn" onclick="openModal('volume')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="volumeChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Customer Holdings</h3>
                <button class="help-btn" onclick="openModal('holdings')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="holdingsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Take Rate Trend</h3>
                <button class="help-btn" onclick="openModal('takeRate')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="takeRateChart"></canvas>
            </div>
        </div>
    </div>

    <h2 class="section-title">Infrastructure Quality</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Instant Payments %</h3>
                <button class="help-btn" onclick="openModal('instantPayments')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="instantPaymentsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Total Equity Growth</h3>
                <button class="help-btn" onclick="openModal('equity')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="equityChart"></canvas>
            </div>
        </div>
    </div>

    <!-- DCF Valuation Section -->
    <h2 class="section-title">DCF Valuation</h2>

    <div class="dcf-section">
        <!-- Valuation Summary Cards -->
        <div class="dcf-summary">
            <div class="dcf-card highlight">
                <div class="dcf-label">Intrinsic Value (Base)</div>
                <div class="dcf-value" id="dcfIV">£8.17</div>
                <div class="dcf-change" id="dcfUpside">-22% vs current</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Entry Price (15% CAGR)</div>
                <div class="dcf-value" id="dcfEntry">£4.11</div>
                <div class="dcf-sublabel">Buy below for 15% annual return</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Current Price</div>
                <div class="dcf-value" id="dcfCurrent">£10.50</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Prob-Weighted IV</div>
                <div class="dcf-value" id="dcfWeighted">£7.96</div>
                <div class="dcf-sublabel">25% Bull / 50% Base / 25% Bear</div>
            </div>
        </div>

        <!-- Growth Rate Warning -->
        <div class="dcf-warning" id="growthWarning" style="display: none;">
            <span class="warning-icon">⚠</span>
            <span id="warningText"></span>
        </div>

        <!-- Interactive Sliders -->
        <div class="dcf-controls">
            <div class="slider-group">
                <label>Growth Rate: <span id="growthValue">15%</span></label>
                <input type="range" id="growthSlider" min="0" max="30" value="15" step="1">
                <div class="slider-hint" id="growthHint">Based on management guidance (15-20%)</div>
            </div>
            <div class="slider-group">
                <label>WACC: <span id="waccValue">10%</span></label>
                <input type="range" id="waccSlider" min="6" max="18" value="10" step="0.5">
            </div>
            <div class="slider-group">
                <label>Terminal Growth: <span id="terminalValue">3%</span></label>
                <input type="range" id="terminalSlider" min="0" max="5" value="3" step="0.5">
            </div>
        </div>

        <!-- Scenario Tabs -->
        <div class="scenario-tabs">
            <button class="scenario-tab active" data-scenario="base" onclick="switchScenario('base')">Base Case</button>
            <button class="scenario-tab" data-scenario="bull" onclick="switchScenario('bull')">Bull Case</button>
            <button class="scenario-tab" data-scenario="bear" onclick="switchScenario('bear')">Bear Case</button>
        </div>

        <!-- Scenario Details -->
        <div class="scenario-details" id="scenarioDetails">
            <div class="scenario-assumptions">
                <h4>Assumptions</h4>
                <div class="assumption-grid" id="assumptionGrid"></div>
            </div>
        </div>

        <!-- Sensitivity Table -->
        <div class="sensitivity-section">
            <h4>Sensitivity Analysis: Intrinsic Value by WACC & Terminal Growth (GBP per share)</h4>
            <table class="sensitivity-table" id="sensitivityMatrix"></table>
        </div>

        <!-- Historical Growth Rates -->
        <div class="historical-growth">
            <h4>Historical Growth Rates (CAGR)</h4>
            <div class="growth-grid" id="growthGrid"></div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // EMBEDDED DATA - CSV
        const csvData = `Period,Revenue,UnderlyingIncome,GrossProfit,UnderlyingGrossProfit,OperatingProfit,ProfitBeforeTax,UnderlyingPBT,NetIncome,EPSBasic,EPSDiluted,FreeCashFlow,ActiveCustomers,CrossBorderVolume,CustomerBalances,CustomerHoldings,TakeRate,InstantPayments,TotalEquity,TotalDebt,CashAndEquivalents,SharesOutstanding
H1 FY2023,255.8,336.8,256.7,256.7,87.0,47.8,47.8,32.8,3.15,3.11,56.0,7430.0,51.0,9.2,9.7,0.65,49,403.0,200.0,7200.0,1037.0
FY2023,846.1,892.0,638.2,566.0,159.7,146.5,74.3,114.0,11.02,10.86,156.0,9962.7,104.5,10.7,11.2,0.65,55,576.9,200.0,7679.4,1038.0
H1 FY2024,498.2,555.3,418.7,388.2,200.2,194.3,93.6,140.6,13.56,13.37,110.0,9120.0,57.4,12.3,12.8,0.67,58,680.0,200.0,9100.0,1037.0
FY2024,1052.0,1172.7,1092.4,852.8,501.9,481.4,241.8,354.6,34.20,33.73,486.6,12838.2,118.5,13.3,16.2,0.67,62,979.9,202.7,10479.2,1036.7
H1 FY2025,591.9,662.4,568.0,505.0,290.2,292.5,147.1,217.3,20.96,20.66,170.0,11367.0,68.4,14.7,17.6,0.62,63,1100.0,200.0,12000.0,1036.0
FY2025,1211.9,1362.3,1307.8,1025.1,579.6,564.8,282.1,416.7,40.37,39.73,332.7,15566.1,145.2,17.1,21.5,0.53,65,1386.2,99.4,13982.8,1032.2
H1 FY2026,658.0,749.5,614.0,571.2,165.3,254.6,122.0,187.2,18.11,17.84,150.0,13424.0,84.9,19.7,25.3,0.52,74,1500.0,100.0,15000.0,1033.0`;

        // EMBEDDED DATA - Analysis JSON
        const analysis = {
            "ticker": "WISE.L",
            "company_name": "Wise plc",
            "analysis_date": "2026-01-21",
            "overview": "Wise is a global fintech company building cross-border payment infrastructure and international financial accounts. Founded in 2011 (as TransferWise), Wise serves 15.6 million active customers through three products: Wise Account (personal international account), Wise Business (SMB multi-currency account), and Wise Platform (API infrastructure for banks and enterprises). The company operates with 70+ regulatory licenses globally, connects directly to 8 domestic payment systems, and processed £145.2 billion in cross-border volume in FY2025.",
            "business_model": {
                "summary": "Transaction-based revenue from cross-border payments (59% of underlying income) with growing account-based revenue from card fees, interest on balances, and subscription services. The company's infrastructure allows low-cost, instant cross-border transfers with 74% of payments completed in under 20 seconds.",
                "revenue_streams": [
                    {"name": "Cross-border transaction fees", "percent": 59, "trend": "growing but declining take rate", "description": "Take rate reduced from 0.67% to 0.52% as strategic pricing investment"},
                    {"name": "Card and other revenue", "percent": 28, "trend": "rapidly growing", "description": "Debit card usage, subscriptions, and other account features"},
                    {"name": "Interest income (first 1% yield)", "percent": 13, "trend": "growing with balances", "description": "Conservative interest earned on customer balances"}
                ],
                "customer_type": "B2C (82% personal), B2B (18% business), and B2B2C (Wise Platform partnerships with banks)",
                "geographic_mix": "Global with presence in 160+ countries; key markets include UK, Europe, US, Australia, Singapore, and expanding into Brazil, Japan, UAE, South Africa",
                "unit_economics": "Deliberately reducing pricing (take rate down 9bps in FY25) to drive long-term volume growth and customer acquisition. Over 70% of new customers come from word-of-mouth referrals."
            },
            "competitive_position": {
                "main_competitors": ["Revolut", "PayPal/Xoom", "Western Union", "MoneyGram", "OFX", "Remitly", "Traditional banks", "Airwallex", "Payoneer"],
                "market_position": "Market leader in transparent, low-cost cross-border payments with 5% share of personal cross-border market and 1% of SMB market. Estimated £32 trillion total addressable market across personal, SMB, and enterprise segments.",
                "moat_factors": [
                    {"factor": "Infrastructure network", "strength": "strong", "description": "14 years building direct integrations to 8 domestic payment systems (Pix, Zengin, InstaPay, etc.) creating speed and cost advantages competitors cannot easily replicate"},
                    {"factor": "Regulatory licenses", "strength": "strong", "description": "70+ licenses globally create significant barriers to entry and enable direct market access"},
                    {"factor": "Word-of-mouth growth", "strength": "strong", "description": "70%+ of new customers from referrals due to superior price/speed creates viral customer acquisition with low CAC"},
                    {"factor": "Customer balances", "strength": "moderate but growing", "description": "£21.5bn in customer holdings creates sticky relationships and switching costs; 50% personal and 60% business account adoption"},
                    {"factor": "Scale and learning curve", "strength": "moderate", "description": "15.6m active customers and £145bn annual volume enables continuous price reduction and service improvement"}
                ],
                "weaknesses": [
                    "Limited brand awareness compared to PayPal, Revolut requiring increased marketing investment",
                    "Regulatory compliance costs and risks across 70+ jurisdictions",
                    "Customer balances create interest rate sensitivity and banking-like risks",
                    "Enterprise/Wise Platform segment still nascent at 5% of volume"
                ]
            },
            "growth_drivers": [
                "Wise Platform expansion: Currently 5% of volume, targeting 10% medium-term and 50%+ long-term through partnerships with banks (Morgan Stanley, Standard Chartered, Nubank, Itau, UniCredit, Raiffeisen)",
                "Geographic expansion: New licenses in UAE, Brazil, South Africa, Japan expanding addressable market",
                "Product depth: Wise Assets (investment products) now in 30 countries, driving customer holdings growth of 37% YoY",
                "Infrastructure investments: 8 domestic payment system integrations (adding Brazil Pix and Japan Zengin) improve speed to 74% instant transfers and enable further price reductions",
                "Marketing investment: Tripling marketing spend to build brand awareness in key markets (UK, US, Canada, Australia, NZ)",
                "Cross-sell to existing customers: Account adoption at 50% personal and 60% business drives card revenue (+30% YoY) and customer retention",
                "Secular trends: Digital payments growth, globalization of work and business, regulatory pressure for transparent pricing"
            ],
            "risks": {
                "business": [
                    {"risk": "Competitive pressure from neobanks", "severity": "high", "description": "Revolut (60m users), traditional banks, and fintechs competing on price and features. Industry increasingly transparent which commoditizes product."},
                    {"risk": "Customer concentration", "severity": "moderate", "description": "Reliance on organic word-of-mouth growth; if NPS declines or customer experience deteriorates, growth engine fails."},
                    {"risk": "Platform partnerships execution", "severity": "moderate", "description": "Wise Platform growth depends on successfully onboarding and scaling large bank partnerships in competitive RFP processes."}
                ],
                "financial": [
                    {"risk": "Interest rate sensitivity", "severity": "moderate", "description": "£21.5bn customer holdings exposed to rate changes. Declining yields in H1 FY26 reduced interest income YoY. Company mitigates by focusing on 'underlying income' (first 1% yield only)."},
                    {"risk": "Foreign exchange volatility", "severity": "moderate", "description": "Revenue in multiple currencies creates translation risk. Reported growth can differ materially from constant currency growth."},
                    {"risk": "Customer balance safety", "severity": "moderate", "description": "£21.5bn customer balances create banking-like risks. Assets held in government securities but concentration risk exists."}
                ],
                "regulatory": [
                    {"risk": "Multi-jurisdictional compliance", "severity": "high", "description": "Operating with 70+ licenses globally. July 2025: $4.2m penalty from US regulators for AML/BSA compliance failures. Requires continuous investment in compliance infrastructure (~1/3 of staff dedicated to compliance and financial crime)."},
                    {"risk": "Regulatory changes", "severity": "moderate", "description": "Subject to evolving AML, data protection, payment system regulations across jurisdictions. EU Digital Operational Resilience Act (DORA) and changing US FinCEN requirements increase compliance burden."},
                    {"risk": "Banking regulation creep", "severity": "moderate", "description": "As customer balances grow, may face increased banking-style capital and liquidity requirements."}
                ],
                "macro": [
                    {"risk": "Economic slowdown impact on remittances", "severity": "moderate", "description": "Cross-border volume sensitive to global trade, migration patterns, and consumer/business spending. Recession could reduce volumes."},
                    {"risk": "Geopolitical tensions", "severity": "moderate", "description": "Operating globally exposes to sanctions, capital controls, political instability affecting cross-border flows."},
                    {"risk": "Currency volatility", "severity": "low", "description": "Extreme FX volatility could temporarily reduce customer demand for transfers, though Wise benefits from increased need to hedge."}
                ],
                "execution": [
                    {"risk": "Scaling challenges", "severity": "moderate", "description": "Headcount grew 1,000+ in H1 FY26. Rapid hiring in servicing, compliance, and tech could strain culture and execution."},
                    {"risk": "Technology infrastructure", "severity": "moderate", "description": "Core platform must scale to handle trillions in volume while maintaining instant settlement and security."},
                    {"risk": "Dual listing execution", "severity": "low-moderate", "description": "US listing planned Q2 2026 with ~£35m in costs. Execution risk and increased regulatory complexity under US rules."}
                ]
            },
            "macro_factors": {
                "industry_outlook": "Cross-border payments market growing from $194.6 trillion (2024) to $320 trillion (2032). Real-time payment systems expanding globally. ISO 20022 migration standardizing formats. Stablecoins emerging but regulatory framework still developing. G20 targets sub-1% retail payment costs by 2027.",
                "cyclicality": "Moderate - Cross-border volume tied to global trade, business activity, and migration. Personal remittances relatively resilient. Platform partnerships provide some counter-cyclical diversification.",
                "interest_rate_sensitivity": "Moderate - Company focused on 'underlying income' excluding interest above 1% to reduce dependence on rates. However, customer balances of £21.5bn create material sensitivity. Declining rates in H1 FY26 reduced reported profit.",
                "key_input_costs": ["Technology infrastructure and cloud services", "Compliance and regulatory staff (largest cost)", "Payment network fees and FX liquidity costs", "Customer servicing and support"],
                "regulatory_environment": "Increasing scrutiny globally. US regulators issued $4.2m fine (July 2025) for AML deficiencies. EU DORA compliance required (Jan 2025). FinCEN expanding BSA requirements to investment advisers (Jan 2026). Trend toward transparency benefits Wise's model long-term but increases near-term compliance costs."
            },
            "recent_developments": [
                {"date": "2026-01-20", "event": "Q3 FY26 Trading Update: Volume +26% YoY, customer holdings £27.5bn (+34% YoY), 74% instant transfers. Expects FY26 underlying PBT margin toward top of 13-16% range."},
                {"date": "2025-11-06", "event": "H1 FY26 Results: £749.5m underlying income (+13% YoY), 13.4m active customers (+18%), £25.3bn customer holdings (+37%). Underlying PBT margin 16.3%."},
                {"date": "2025-10", "event": "Secured regulatory approvals in UAE for Stored Value and Retail Payment Services. Launched Wise Assets in Brazil."},
                {"date": "2025-09", "event": "Launched direct integration to Brazil's Pix payment system (7th domestic payment system connection)."},
                {"date": "2025-07-28", "event": "Shareholders approved US dual listing (Q2 2026 target) and extension of CEO Class B supervoting shares despite governance concerns."},
                {"date": "2025-07", "event": "US state regulators (DFPI + 5 states) fined Wise US $4.2m for AML/BSA compliance failures. Required independent monitoring and quarterly reporting for 2 years."},
                {"date": "2025-06-05", "event": "Announced plan to dual-list on US exchange to access deeper capital markets and increase US profile."},
                {"date": "2025-04", "event": "First Owners Day: Outlined strategy to move trillions, target 10% Platform volume medium-term, double annual investment over medium-term."},
                {"date": "2024-10", "event": "Emmanuel Thomassin joined as CFO, replacing Matthew Briers. Fitch and S&P awarded BBB stable credit ratings."}
            ],
            "guidance": {
                "as_of": "Q3 FY26 Trading Update (20 January 2026)",
                "fiscal_year": "FY2026 (Year ending 31 March 2026)",
                "items": [
                    {
                        "metric": "Underlying Income Growth",
                        "target": "15-20%",
                        "period": "FY2026 and medium-term",
                        "vs_prior": "maintained",
                        "notes": "On constant currency basis. Q3 YTD at +17% constant currency, expected around middle of range for full year."
                    },
                    {
                        "metric": "Underlying PBT Margin",
                        "target": "~16% (towards top of 13-16% range)",
                        "period": "FY2026",
                        "vs_prior": "raised",
                        "notes": "Excluding ~£35m one-off dual listing costs. Q3 YTD delivered 16.3% in H1. Medium-term target remains 13-16%."
                    },
                    {
                        "metric": "Cross-border Take Rate",
                        "target": "Continued reduction",
                        "period": "Ongoing",
                        "vs_prior": "maintained",
                        "notes": "At 52bps in Q3 FY26 (down from 56bps prior year), flat quarter-over-quarter. Strategic pricing investment for long-term growth."
                    },
                    {
                        "metric": "Instant Transfers",
                        "target": "Continued improvement",
                        "period": "Ongoing",
                        "vs_prior": "maintained",
                        "notes": "74% in Q3 FY26 (up from 65% prior year). Driven by domestic payment system integrations."
                    },
                    {
                        "metric": "Administrative Expenses",
                        "target": "~£1 billion",
                        "period": "FY2026",
                        "vs_prior": "new",
                        "notes": "Includes ~£35m dual listing costs. Reflects investment in headcount (+1,000 in H1), marketing (tripling spend), and infrastructure."
                    },
                    {
                        "metric": "Wise Platform Volume Share",
                        "target": "~10% medium-term, 50%+ long-term",
                        "period": "Medium to long-term",
                        "vs_prior": "maintained",
                        "notes": "Currently at ~5% (up from 4% at Owners Day). Recent partnerships: UniCredit, Raiffeisen, Upwork, Morgan Stanley, Standard Chartered."
                    }
                ],
                "management_commentary": "CEO emphasized strong Q3 performance with 26% volume growth and continued infrastructure investment (Brazil Pix, Japan Zengin live). CFO noted financial performance allows investment at top of PBT margin range while maintaining profitability. Dual listing on track for H1 2026 to increase US profile and access to capital markets."
            },
            "bull_case": [
                "Massive TAM with low penetration: £32 trillion market with only 5% personal and 1% SMB share provides multi-decade growth runway",
                "Wise Platform inflection: Currently 5% of volume, scaling to 10%+ medium-term through blue-chip bank partnerships (Morgan Stanley, Standard Chartered, Nubank) validates infrastructure and creates B2B2C flywheel",
                "Infrastructure moat widening: 8 direct payment system integrations (adding Pix, Zengin) enable 74% instant transfers and continuous price reduction that competitors cannot match without equivalent 14-year investment",
                "Profitable growth with pricing power: 21% underlying PBT margin in FY25 gives room to invest in price reductions and marketing while maintaining profitability. Virtuous cycle of lower prices → more customers → higher volumes → lower unit costs",
                "Customer stickiness increasing: £21.5bn in customer holdings (5.7x growth in 4 years) and 50%+ account adoption creates switching costs and drives non-transfer revenue (card +30% YoY)",
                "Dual listing catalyst: US listing (Q2 2026) increases profile in largest market opportunity, improves liquidity, and attracts growth-oriented institutional investors",
                "Secular tailwinds: Digital payments adoption, remote work globalization, regulatory push for transparent pricing, and real-time payment infrastructure all favor Wise's model"
            ],
            "bear_case": [
                "Regulatory and compliance risks: $4.2m AML fine (July 2025) highlights ongoing challenges. Operating with 70+ licenses requires ~1/3 of staff on compliance. Future penalties or license restrictions could materially impact operations and reputation.",
                "Commoditization and margin pressure: As cross-border payments become transparent and competitive, take rates compress (0.67% to 0.52% in 2 years). Market may not support sustainable margins if competition intensifies from banks, neobanks, and stablecoin solutions.",
                "Interest rate dependency understated: Despite focusing on 'underlying income,' £21.5bn customer balances create material rate sensitivity. Sustained low rates reduce reported profits and capital generation.",
                "Execution risk on massive investment plan: Doubling annual investment, tripling marketing spend, and hiring 1,000+ employees in H1 alone could strain culture, dilute focus, and fail to generate expected ROI.",
                "Platform partnerships slower than expected: Wise Platform at 5% of volume vs. 50%+ long-term target. Bank partnerships are slow to onboard/scale, face competitive RFPs, and may build in-house solutions instead.",
                "Valuation risk from dual listing: US listing adds complexity, costs (£35m), and may not deliver expected valuation re-rating if US investors view as mature payments company rather than high-growth fintech.",
                "Neobank competition intensifying: Revolut (60m users), traditional banks improving digital offerings, and well-funded fintechs competing on same value proposition. Brand awareness gap requires sustained marketing spend with uncertain payback."
            ]
        };

        // EMBEDDED DATA - DCF JSON
        const dcfData = {
            "ticker": "WISE.L",
            "company_name": "Wise plc",
            "valuation_date": "2026-01-21",
            "current_price": 10.50,
            "inputs": {
                "shares_outstanding": 1032.2,
                "net_debt": -1330.8,
                "last_fcf": 332.7,
                "total_debt": 99.4,
                "corporate_cash": 1430.2,
                "currency": "GBP",
                "units": "millions",
                "notes": "Net debt calculated as Total Debt (£99.4m) - Corporate Cash (£1,430.2m), excluding customer funds. FY2025 ended March 31, 2025."
            },
            "historical_growth": {
                "revenue_3yr_cagr": 19.7,
                "revenue_5yr_cagr": null,
                "eps_3yr_cagr": 54.0,
                "eps_5yr_cagr": null,
                "equity_3yr_cagr": 33.9,
                "equity_5yr_cagr": null,
                "fcf_3yr_cagr": 28.6,
                "fcf_5yr_cagr": null,
                "selected_growth_rate": 15.0,
                "growth_rate_source": "management_guidance_adjusted",
                "growth_divergence_warning": "Equity CAGR (33.9%) significantly exceeds Revenue CAGR (19.7%) due to rapid margin expansion from 13.5% FCF margin in FY2023 to 27.5% in FY2025. Selected 15% growth rate based on management's 15-20% underlying income CAGR guidance, adjusted downward for conservatism given recent take rate compression and investment phase.",
                "calculation_notes": {
                    "revenue_3yr": "FY2023 £846.1m to FY2025 £1,211.9m = 19.7% CAGR",
                    "equity_3yr": "FY2023 £576.9m to FY2025 £1,386.2m = 33.9% CAGR",
                    "fcf_3yr": "FY2023 £156.0m to FY2025 £332.7m = 28.6% CAGR",
                    "eps_3yr": "FY2023 11.02p to FY2025 40.37p = 54.0% CAGR"
                }
            },
            "assumptions": {
                "base": {
                    "growth_rates": [15, 14, 12, 10, 8],
                    "fcf_margin": 27.5,
                    "fcf_margin_progression": [27.5, 28.0, 28.5, 29.0, 29.5],
                    "wacc": 10.0,
                    "terminal_growth": 3.0,
                    "rationale": "15% starting growth aligns with middle of management's 15-20% underlying income guidance. Deceleration reflects market maturation and competitive pressure. Margins improve slightly from infrastructure leverage offsetting marketing investment. WACC 10% reflects tech company risk with minimal leverage."
                },
                "bull": {
                    "growth_rates": [20, 18, 16, 14, 12],
                    "fcf_margin": 27.5,
                    "fcf_margin_progression": [27.5, 29.0, 30.0, 31.0, 32.0],
                    "wacc": 9.0,
                    "terminal_growth": 3.5,
                    "rationale": "20% growth achieves top of management guidance range. Wise Platform scales to 10%+ of volume driving acceleration. Infrastructure moat widens with 74%+ instant transfers. Marketing investments pay off with NPS-driven viral growth. Margins expand from scale and Platform mix. Lower WACC from reduced execution risk as Platform proves out."
                },
                "bear": {
                    "growth_rates": [10, 8, 6, 5, 4],
                    "fcf_margin": 27.5,
                    "fcf_margin_progression": [27.5, 26.0, 25.0, 24.0, 23.0],
                    "wacc": 11.0,
                    "terminal_growth": 2.5,
                    "rationale": "10% growth reflects competitive pressure from Revolut and neobanks, regulatory headwinds from AML compliance costs, and Wise Platform partnerships scaling slower than expected. Margins contract from aggressive pricing (take rate compression) and elevated compliance/marketing spend without commensurate volume growth. Higher WACC from execution and regulatory risk."
                }
            },
            "projections": {
                "base": {
                    "years": ["FY2026E", "FY2027E", "FY2028E", "FY2029E", "FY2030E"],
                    "growth_rates": [15.0, 14.0, 12.0, 10.0, 8.0],
                    "fcf": [382.6, 436.2, 488.0, 536.8, 580.1],
                    "fcf_margin": [27.5, 28.0, 28.5, 29.0, 29.5],
                    "discount_factors": [0.909, 0.826, 0.751, 0.683, 0.621],
                    "pv_fcf": [347.8, 360.3, 366.5, 366.7, 360.2],
                    "calculation_notes": "FY2026E FCF: £332.7m * 1.15 = £382.6m. Each subsequent year grows by stated rate with margin adjustment. Discount factor = 1/(1+WACC)^year."
                },
                "bull": {
                    "years": ["FY2026E", "FY2027E", "FY2028E", "FY2029E", "FY2030E"],
                    "growth_rates": [20.0, 18.0, 16.0, 14.0, 12.0],
                    "fcf": [399.2, 471.1, 546.5, 622.8, 697.5],
                    "fcf_margin": [27.5, 29.0, 30.0, 31.0, 32.0],
                    "discount_factors": [0.917, 0.842, 0.772, 0.708, 0.650],
                    "pv_fcf": [366.1, 396.7, 421.9, 441.0, 453.4],
                    "calculation_notes": "Higher growth rates and expanding margins from Platform scale and infrastructure leverage."
                },
                "bear": {
                    "years": ["FY2026E", "FY2027E", "FY2028E", "FY2029E", "FY2030E"],
                    "growth_rates": [10.0, 8.0, 6.0, 5.0, 4.0],
                    "fcf": [365.9, 395.2, 418.9, 439.8, 457.4],
                    "fcf_margin": [27.5, 26.0, 25.0, 24.0, 23.0],
                    "discount_factors": [0.901, 0.812, 0.731, 0.659, 0.593],
                    "pv_fcf": [329.7, 320.9, 306.2, 289.8, 271.3],
                    "calculation_notes": "Slower growth and margin compression from competitive pressure and regulatory costs."
                }
            },
            "valuation": {
                "base": {
                    "sum_pv_fcf": 1801.5,
                    "terminal_fcf": 596.9,
                    "terminal_value": 8527.9,
                    "pv_terminal": 5295.9,
                    "enterprise_value": 7097.4,
                    "equity_value": 8428.2,
                    "intrinsic_value_per_share": 8.17,
                    "upside_vs_current": -22.2,
                    "calculation_notes": {
                        "terminal_fcf": "FY2030E FCF £580.1m * (1 + 3.0%) = £596.9m",
                        "terminal_value": "£596.9m / (10.0% - 3.0%) = £8,527.9m",
                        "pv_terminal": "£8,527.9m * 0.621 = £5,295.9m",
                        "enterprise_value": "£1,801.5m + £5,295.9m = £7,097.4m",
                        "equity_value": "£7,097.4m - (-£1,330.8m net debt) = £8,428.2m",
                        "intrinsic_value": "£8,428.2m / 1,032.2m shares = £8.17/share"
                    }
                },
                "bull": {
                    "sum_pv_fcf": 2079.1,
                    "terminal_fcf": 722.2,
                    "terminal_value": 13130.0,
                    "pv_terminal": 8534.5,
                    "enterprise_value": 10613.6,
                    "equity_value": 11944.4,
                    "intrinsic_value_per_share": 11.57,
                    "upside_vs_current": 10.2,
                    "calculation_notes": {
                        "terminal_fcf": "FY2030E FCF £697.5m * (1 + 3.5%) = £722.2m",
                        "terminal_value": "£722.2m / (9.0% - 3.5%) = £13,130.0m",
                        "pv_terminal": "£13,130.0m * 0.650 = £8,534.5m"
                    }
                },
                "bear": {
                    "sum_pv_fcf": 1517.9,
                    "terminal_fcf": 468.8,
                    "terminal_value": 5515.3,
                    "pv_terminal": 3270.6,
                    "enterprise_value": 4788.5,
                    "equity_value": 6119.3,
                    "intrinsic_value_per_share": 5.93,
                    "upside_vs_current": -43.5,
                    "calculation_notes": {
                        "terminal_fcf": "FY2030E FCF £457.4m * (1 + 2.5%) = £468.8m",
                        "terminal_value": "£468.8m / (11.0% - 2.5%) = £5,515.3m",
                        "pv_terminal": "£5,515.3m * 0.593 = £3,270.6m"
                    }
                }
            },
            "entry_price": {
                "base": {
                    "terminal_value_per_share": 8.26,
                    "years_to_terminal": 5,
                    "target_cagr": 15.0,
                    "entry_price": 4.11,
                    "entry_discount_from_current": -60.9,
                    "calculation_notes": "Terminal Value per Share = £8,527.9m / 1,032.2m = £8.26. Entry Price = £8.26 / (1.15^5) = £4.11",
                    "interpretation": "To achieve 15% annual returns from current price to terminal value in 5 years, would need to buy at £4.11, representing 61% discount from current £10.50 price."
                },
                "bull": {
                    "terminal_value_per_share": 12.72,
                    "years_to_terminal": 5,
                    "target_cagr": 15.0,
                    "entry_price": 6.33,
                    "entry_discount_from_current": -39.7,
                    "calculation_notes": "Entry Price = £12.72 / (1.15^5) = £6.33"
                },
                "bear": {
                    "terminal_value_per_share": 5.34,
                    "years_to_terminal": 5,
                    "target_cagr": 15.0,
                    "entry_price": 2.66,
                    "entry_discount_from_current": -74.7,
                    "calculation_notes": "Entry Price = £5.34 / (1.15^5) = £2.66"
                }
            },
            "sensitivity": {
                "scenario": "base",
                "wacc_range": [8.0, 9.0, 10.0, 11.0, 12.0],
                "terminal_growth_range": [2.0, 2.5, 3.0, 3.5, 4.0],
                "matrix": [
                    [10.63, 11.38, 12.29, 13.42, 14.84],
                    [9.18, 9.77, 10.47, 11.32, 12.36],
                    [8.07, 8.55, 9.11, 9.76, 10.53],
                    [7.18, 7.58, 8.04, 8.56, 9.17],
                    [6.45, 6.79, 7.17, 7.60, 8.09]
                ],
                "current_price_location": "Current price £10.50 sits between WACC 8-9% at terminal growth 3-3.5%, suggesting market expects better-than-base execution.",
                "interpretation": "Valuation highly sensitive to WACC assumption. At WACC 9% (bull case) and terminal 3%, IV = £9.77. Market pricing implies either lower WACC (strong execution confidence) or expectations closer to bull case growth trajectory."
            },
            "probability_weighted": {
                "weights": {
                    "bull": 0.25,
                    "base": 0.50,
                    "bear": 0.25
                },
                "weighted_iv": 7.96,
                "calculation": "(0.25 * £11.57) + (0.50 * £8.17) + (0.25 * £5.93) = £7.96",
                "upside_vs_current": -24.2,
                "interpretation": "Probability-weighted intrinsic value of £7.96 suggests current price of £10.50 prices in significant growth optimism beyond base case. Market appears to assign higher probability to bull scenario or expects multiple expansion from US dual listing catalyst."
            },
            "key_risks_to_valuation": [
                "Regulatory: AML compliance failures could lead to license restrictions or material fines exceeding modeled expectations",
                "Competition: Take rate compression accelerates beyond modeled 52bps if Revolut or banks compete aggressively on price",
                "Platform execution: Wise Platform scaling to 10% volume takes longer than medium-term guidance, reducing growth trajectory",
                "Interest rates: Sustained low rates reduce capital generation and reported profitability despite 'underlying income' focus",
                "Dual listing: US listing fails to deliver valuation re-rating or creates unexpected regulatory/compliance costs",
                "Margin sustainability: FCF margins of 27-30% prove unsustainable if marketing and compliance costs remain elevated"
            ],
            "valuation_summary": {
                "current_assessment": "Current price of £10.50 appears optimistic relative to base case IV of £8.17. Market is pricing in successful Wise Platform scale, sustained high growth, and/or multiple expansion from US listing catalyst.",
                "fair_value_range": "£7.96-£9.77 (probability-weighted to sensitivity-adjusted base)",
                "buy_recommendation": "Entry price of £4.11 (base case) to £6.33 (bull case) offers margin of safety for 15% annual returns. Current price offers limited upside in base scenario.",
                "catalysts_for_upside": [
                    "Wise Platform volume reaching 10% ahead of schedule",
                    "US dual listing driving multiple expansion and institutional demand",
                    "Continued take rate reduction driving viral customer acquisition without margin deterioration",
                    "Geographic expansion (Brazil, Japan, UAE) delivering faster-than-expected volume growth"
                ],
                "watch_items": [
                    "FY2026 underlying PBT margin execution (guidance: toward top of 13-16% range)",
                    "Wise Platform volume share progression toward 10% target",
                    "Customer acquisition cost trends as marketing spend triples",
                    "Regulatory developments post-AML fine and during US listing process"
                ]
            }
        };

        // Parse CSV
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
                return obj;
            });
        }

        const data = parseCSV(csvData);

        // Calculate YoY change
        function calcYoYChange(current, previous) {
            if (!previous || !current) return null;
            return ((parseFloat(current) - parseFloat(previous)) / Math.abs(parseFloat(previous)) * 100).toFixed(1);
        }

        // Toggle overview
        function toggleOverview() {
            const btn = document.querySelector('.overview-toggle');
            const content = document.getElementById('overviewContent');
            btn.classList.toggle('active');
            content.classList.toggle('active');
        }

        // Render Investment Overview
        function renderOverview() {
            document.getElementById('companyOverview').textContent = analysis.overview;
            document.getElementById('businessModelSummary').textContent = analysis.business_model.summary;

            const revenueStreams = document.getElementById('revenueStreams');
            revenueStreams.innerHTML = analysis.business_model.revenue_streams.map(stream => `
                <li class="revenue-stream">
                    <span>${stream.name}: <em style="color: #888;">${stream.description}</em></span>
                    <span class="percent">${stream.percent}%</span>
                </li>
            `).join('');

            document.getElementById('marketPosition').textContent = analysis.competitive_position.market_position;
            document.getElementById('competitors').textContent = analysis.competitive_position.main_competitors.join(', ');

            const moatFactors = document.getElementById('moatFactors');
            moatFactors.innerHTML = analysis.competitive_position.moat_factors.map(m => `
                <li><strong>${m.factor}</strong> (${m.strength}): ${m.description}</li>
            `).join('');

            const growthDrivers = document.getElementById('growthDrivers');
            growthDrivers.innerHTML = analysis.growth_drivers.map(d => `<li>${d}</li>`).join('');

            const allRisks = [
                ...analysis.risks.business,
                ...analysis.risks.regulatory,
                ...analysis.risks.financial
            ].slice(0, 6);

            const keyRisks = document.getElementById('keyRisks');
            keyRisks.innerHTML = allRisks.map(r => {
                const severityClass = r.severity === 'high' ? 'risk-high' : r.severity === 'moderate' ? 'risk-moderate' : 'risk-low';
                return `<li><span class="${severityClass}">[${r.severity.toUpperCase()}]</span> <strong>${r.risk}:</strong> ${r.description}</li>`;
            }).join('');

            const bullCase = document.getElementById('bullCase');
            bullCase.innerHTML = analysis.bull_case.map(b => `<li>${b}</li>`).join('');

            const bearCase = document.getElementById('bearCase');
            bearCase.innerHTML = analysis.bear_case.map(b => `<li>${b}</li>`).join('');

            const recentDev = document.getElementById('recentDevelopments');
            recentDev.innerHTML = analysis.recent_developments.slice(0, 6).map(d => `
                <li><strong>${d.date}:</strong> ${d.event}</li>
            `).join('');
        }

        // Render KPIs
        function renderKPIs() {
            const latest = data[data.length - 1];
            const previous = data[data.length - 2];

            const kpis = [
                {
                    label: 'Active Customers',
                    value: parseFloat(latest.ActiveCustomers).toFixed(1) + 'M',
                    change: calcYoYChange(latest.ActiveCustomers, previous.ActiveCustomers)
                },
                {
                    label: 'Cross-Border Volume',
                    value: '£' + parseFloat(latest.CrossBorderVolume).toFixed(1) + 'bn',
                    change: calcYoYChange(latest.CrossBorderVolume, previous.CrossBorderVolume)
                },
                {
                    label: 'Underlying Income',
                    value: '£' + parseFloat(latest.UnderlyingIncome).toFixed(1) + 'm',
                    change: calcYoYChange(latest.UnderlyingIncome, previous.UnderlyingIncome)
                },
                {
                    label: 'Customer Holdings',
                    value: '£' + parseFloat(latest.CustomerHoldings).toFixed(1) + 'bn',
                    change: calcYoYChange(latest.CustomerHoldings, previous.CustomerHoldings)
                },
                {
                    label: 'Take Rate',
                    value: parseFloat(latest.TakeRate).toFixed(2) + '%',
                    change: calcYoYChange(latest.TakeRate, previous.TakeRate)
                },
                {
                    label: 'Instant Payments',
                    value: parseFloat(latest.InstantPayments).toFixed(0) + '%',
                    change: calcYoYChange(latest.InstantPayments, previous.InstantPayments)
                },
                {
                    label: 'Free Cash Flow',
                    value: '£' + parseFloat(latest.FreeCashFlow).toFixed(1) + 'm',
                    change: calcYoYChange(latest.FreeCashFlow, previous.FreeCashFlow)
                },
                {
                    label: 'Underlying PBT Margin',
                    value: (parseFloat(latest.UnderlyingPBT) / parseFloat(latest.UnderlyingIncome) * 100).toFixed(1) + '%',
                    change: calcYoYChange(
                        parseFloat(latest.UnderlyingPBT) / parseFloat(latest.UnderlyingIncome),
                        parseFloat(previous.UnderlyingPBT) / parseFloat(previous.UnderlyingIncome)
                    )
                }
            ];

            const grid = document.getElementById('kpiGrid');
            grid.innerHTML = kpis.map(kpi => {
                const changeClass = kpi.change && parseFloat(kpi.change) >= 0 ? 'positive' : 'negative';
                const changeText = kpi.change ? `${kpi.change >= 0 ? '+' : ''}${kpi.change}% YoY` : '';
                return `
                    <div class="kpi-card">
                        <div class="kpi-value">${kpi.value}</div>
                        <div class="kpi-label">${kpi.label}</div>
                        ${changeText ? `<div class="kpi-change ${changeClass}">${changeText}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Render Guidance
        function renderGuidance() {
            if (!analysis.guidance || !analysis.guidance.items || analysis.guidance.items.length === 0) {
                document.getElementById('guidanceSection').style.display = 'none';
                return;
            }

            const guidance = analysis.guidance;
            document.getElementById('guidanceAsOf').textContent = guidance.as_of || '';
            document.getElementById('guidanceFY').textContent = guidance.fiscal_year || '';

            const grid = document.getElementById('guidanceGrid');
            grid.innerHTML = guidance.items.map(item => {
                const vsClass = item.vs_prior ? item.vs_prior.toLowerCase() : 'new';
                const vsLabel = item.vs_prior ? item.vs_prior.charAt(0).toUpperCase() + item.vs_prior.slice(1) : 'New';
                return `
                    <div class="guidance-card">
                        <div class="guidance-metric">${item.metric}</div>
                        <div class="guidance-target">${item.target}</div>
                        <div class="guidance-period">${item.period}</div>
                        <span class="guidance-vs-prior ${vsClass}">${vsLabel}</span>
                        ${item.notes ? `<div class="guidance-notes">${item.notes}</div>` : ''}
                    </div>
                `;
            }).join('');

            const commentary = document.getElementById('guidanceCommentary');
            if (guidance.management_commentary) {
                commentary.textContent = guidance.management_commentary;
                commentary.style.display = 'block';
            } else {
                commentary.style.display = 'none';
            }
        }

        // Chart colors
        const colors = {
            primary: '#00d4aa',
            secondary: '#00b894',
            tertiary: '#0984e3',
            quaternary: '#6c5ce7',
            warning: '#fdcb6e',
            danger: '#ff6b6b'
        };

        // Chart defaults
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#e0e0e0', font: { size: 11 } } }
            },
            scales: {
                x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
        };

        // Filter to annual periods only
        const annualData = data.filter(d => d.Period.startsWith('FY'));
        const periods = annualData.map(d => d.Period);

        // Create charts
        new Chart(document.getElementById('underlyingIncomeChart'), {
            type: 'bar',
            data: {
                labels: periods,
                datasets: [{
                    label: 'Underlying Income (£m)',
                    data: annualData.map(d => parseFloat(d.UnderlyingIncome)),
                    backgroundColor: colors.primary,
                    borderColor: colors.primary,
                    borderWidth: 1
                }]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('pbtChart'), {
            type: 'line',
            data: {
                labels: periods,
                datasets: [
                    {
                        label: 'Underlying PBT (£m)',
                        data: annualData.map(d => parseFloat(d.UnderlyingPBT)),
                        backgroundColor: colors.primary,
                        borderColor: colors.primary,
                        borderWidth: 2,
                        fill: false
                    },
                    {
                        label: 'Net Income (£m)',
                        data: annualData.map(d => parseFloat(d.NetIncome)),
                        backgroundColor: colors.tertiary,
                        borderColor: colors.tertiary,
                        borderWidth: 2,
                        fill: false
                    }
                ]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('pbtMarginChart'), {
            type: 'line',
            data: {
                labels: periods,
                datasets: [{
                    label: 'Underlying PBT Margin (%)',
                    data: annualData.map(d => (parseFloat(d.UnderlyingPBT) / parseFloat(d.UnderlyingIncome) * 100).toFixed(1)),
                    backgroundColor: colors.warning,
                    borderColor: colors.warning,
                    borderWidth: 2,
                    fill: false
                }]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('fcfChart'), {
            type: 'bar',
            data: {
                labels: periods,
                datasets: [{
                    label: 'Free Cash Flow (£m)',
                    data: annualData.map(d => parseFloat(d.FreeCashFlow)),
                    backgroundColor: colors.secondary,
                    borderColor: colors.secondary,
                    borderWidth: 1
                }]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('activeCustomersChart'), {
            type: 'line',
            data: {
                labels: periods,
                datasets: [{
                    label: 'Active Customers (millions)',
                    data: annualData.map(d => parseFloat(d.ActiveCustomers)),
                    backgroundColor: colors.quaternary,
                    borderColor: colors.quaternary,
                    borderWidth: 2,
                    fill: true,
                    tension: 0.2
                }]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('volumeChart'), {
            type: 'bar',
            data: {
                labels: periods,
                datasets: [{
                    label: 'Cross-Border Volume (£bn)',
                    data: annualData.map(d => parseFloat(d.CrossBorderVolume)),
                    backgroundColor: colors.primary,
                    borderColor: colors.primary,
                    borderWidth: 1
                }]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('holdingsChart'), {
            type: 'line',
            data: {
                labels: periods,
                datasets: [{
                    label: 'Customer Holdings (£bn)',
                    data: annualData.map(d => parseFloat(d.CustomerHoldings)),
                    backgroundColor: colors.tertiary,
                    borderColor: colors.tertiary,
                    borderWidth: 2,
                    fill: true,
                    tension: 0.2
                }]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('takeRateChart'), {
            type: 'line',
            data: {
                labels: periods,
                datasets: [{
                    label: 'Take Rate (%)',
                    data: annualData.map(d => parseFloat(d.TakeRate)),
                    backgroundColor: colors.warning,
                    borderColor: colors.warning,
                    borderWidth: 2,
                    fill: false
                }]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('instantPaymentsChart'), {
            type: 'line',
            data: {
                labels: periods,
                datasets: [{
                    label: 'Instant Payments (%)',
                    data: annualData.map(d => parseFloat(d.InstantPayments)),
                    backgroundColor: colors.primary,
                    borderColor: colors.primary,
                    borderWidth: 2,
                    fill: true,
                    tension: 0.2
                }]
            },
            options: chartDefaults
        });

        new Chart(document.getElementById('equityChart'), {
            type: 'bar',
            data: {
                labels: periods,
                datasets: [{
                    label: 'Total Equity (£m)',
                    data: annualData.map(d => parseFloat(d.TotalEquity)),
                    backgroundColor: colors.secondary,
                    borderColor: colors.secondary,
                    borderWidth: 1
                }]
            },
            options: chartDefaults
        });

        // Metric descriptions
        const metricDescriptions = {
            underlyingIncome: {
                title: "Underlying Income",
                content: `
                    <p><strong>Underlying Income</strong> is Wise's primary revenue metric, representing total income from cross-border transactions, card fees, and interest on customer balances (limited to first 1% yield).</p>
                    <div class="metric-highlight">
                        <strong>For Wise:</strong> This metric excludes interest income above 1% yield to reduce sensitivity to interest rate fluctuations. It provides a cleaner view of the core payment infrastructure business performance.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Management targets 15-20% constant currency growth medium-term</li>
                        <li>Revenue mix shifting toward account-based (card, subscriptions) vs. transaction fees</li>
                        <li>Geographic diversification as new markets (Brazil, Japan, UAE) scale</li>
                    </ul>
                `
            },
            pbt: {
                title: "Profit Before Tax",
                content: `
                    <p><strong>Profit Before Tax (PBT)</strong> measures profitability after all operating expenses but before taxes.</p>
                    <div class="metric-highlight">
                        <strong>For Wise:</strong> The company focuses on "Underlying PBT" which excludes one-time items and excess interest income above 1%. Underlying PBT margin target is 13-16% medium-term, with FY26 expected toward the top of this range.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Margin progression as infrastructure investments scale</li>
                        <li>Impact of marketing spend (tripling) on near-term profitability</li>
                        <li>Compliance costs from 70+ regulatory licenses globally</li>
                        <li>One-off dual listing costs (~£35m in FY26)</li>
                    </ul>
                `
            },
            pbtMargin: {
                title: "Underlying PBT Margin",
                content: `
                    <p><strong>Underlying PBT Margin</strong> is Underlying PBT divided by Underlying Income, showing what percentage of revenue converts to profit.</p>
                    <div class="metric-highlight">
                        <strong>For Wise:</strong> Margin expanded from 8% in FY23 to 21% in FY25 due to operating leverage from infrastructure investments and scale. Management targets 13-16% medium-term as they reinvest in growth (marketing, pricing, platform expansion).
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Balance between reinvesting for growth vs. delivering profitability</li>
                        <li>Impact of strategic take rate reductions (pricing investment)</li>
                        <li>Platform mix shift (higher-margin B2B2C revenue)</li>
                    </ul>
                `
            },
            fcf: {
                title: "Free Cash Flow",
                content: `
                    <p><strong>Free Cash Flow (FCF)</strong> is cash from operations minus capital expenditures, showing cash available for shareholders.</p>
                    <div class="metric-highlight">
                        <strong>For Wise:</strong> FCF grew from £156m in FY23 to £333m in FY25 (28.6% CAGR). FCF margin improved from 13.5% to 27.5% as the business scaled. This high conversion rate enables reinvestment without diluting shareholders.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>FCF margin sustainability given increased marketing and compliance costs</li>
                        <li>Capital allocation: reinvestment vs. buybacks vs. dividends</li>
                        <li>Working capital impact from customer balance growth</li>
                    </ul>
                `
            },
            activeCustomers: {
                title: "Active Customers",
                content: `
                    <p><strong>Active Customers</strong> are individuals and businesses who used Wise at least once in the last 12 months.</p>
                    <div class="metric-highlight">
                        <strong>For Wise:</strong> Grew from 10.0m (FY23) to 15.6m (FY25), a 56% increase. Over 70% of new customers come from word-of-mouth referrals due to superior price and speed, creating viral growth with low customer acquisition cost.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Customer growth acceleration as marketing spend triples</li>
                        <li>Account adoption rate (currently 50% personal, 60% business)</li>
                        <li>Customer retention and repeat usage patterns</li>
                        <li>Geographic mix shift as new markets mature</li>
                    </ul>
                `
            },
            volume: {
                title: "Cross-Border Volume",
                content: `
                    <p><strong>Cross-Border Volume</strong> is the total value of international transfers processed through Wise's platform.</p>
                    <div class="metric-highlight">
                        <strong>For Wise:</strong> Processed £145.2bn in FY25, up from £104.5bn in FY23. Volume growth of 26% YoY (Q3 FY26) exceeds customer growth, indicating increased usage per customer. Revenue = Volume × Take Rate.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Volume growth vs. customer growth (usage intensity)</li>
                        <li>Wise Platform contribution (currently ~5%, targeting 10%+ medium-term)</li>
                        <li>Take rate compression offset by volume acceleration</li>
                        <li>Resilience during economic slowdowns (remittances are relatively stable)</li>
                    </ul>
                `
            },
            holdings: {
                title: "Customer Holdings",
                content: `
                    <p><strong>Customer Holdings</strong> are balances customers store in their Wise Accounts across multiple currencies.</p>
                    <div class="metric-highlight">
                        <strong>For Wise:</strong> Holdings grew from £11.2bn (FY23) to £21.5bn (FY25), up 92%. This creates customer stickiness (switching costs), drives card revenue, and generates interest income. 50% of personal and 60% of business customers now use the account feature.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Holdings growth vs. interest rate environment</li>
                        <li>Wise Assets expansion (investment products) in 30 countries</li>
                        <li>Card usage revenue growing 30%+ YoY as holdings increase</li>
                        <li>Regulatory risk: Banking-like capital requirements as balances grow</li>
                    </ul>
                `
            },
            takeRate: {
                title: "Take Rate",
                content: `
                    <p><strong>Take Rate</strong> is the average fee Wise charges as a percentage of cross-border volume processed.</p>
                    <div class="metric-highlight">
                        <strong>For Wise:</strong> Deliberately reduced from 0.67% (FY24) to 0.52% (Q3 FY26) as a strategic investment. Lower pricing drives word-of-mouth growth, expands market, and creates competitive moat through cost leadership. This is the opposite of most competitors who raise prices.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Take rate stabilization vs. continued reduction</li>
                        <li>Volume acceleration offsetting price cuts (elasticity)</li>
                        <li>Competitive response from Revolut, banks, and neobanks</li>
                        <li>Infrastructure improvements (instant payments) enabling further price cuts</li>
                    </ul>
                `
            },
            instantPayments: {
                title: "Instant Payments",
                content: `
                    <p><strong>Instant Payments %</strong> measures the percentage of transfers completed in under 20 seconds.</p>
                    <div class="metric-highlight">
                        <strong>For Wise:</strong> Improved from 55% (FY23) to 74% (Q3 FY26) through direct integrations with 8 domestic payment systems (Pix in Brazil, Zengin in Japan, InstaPay in Philippines, etc.). This is a key competitive advantage and moat factor.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Continued improvement toward 80%+ as more systems go live</li>
                        <li>Customer satisfaction (NPS) correlation with instant payment %</li>
                        <li>Cost savings from instant settlement vs. traditional correspondent banking</li>
                        <li>New payment system integrations (Japan, UAE, South Africa)</li>
                    </ul>
                `
            },
            equity: {
                title: "Total Equity",
                content: `
                    <p><strong>Total Equity</strong> represents shareholders' stake in the company (assets minus liabilities).</p>
                    <div class="metric-highlight">
                        <strong>For Wise:</strong> Equity grew from £577m (FY23) to £1,386m (FY25), a 33.9% CAGR. This rapid growth significantly exceeds revenue growth (19.7% CAGR) due to margin expansion from 13.5% to 27.5% FCF margin. Company carries minimal debt (£99m) and has £1.4bn corporate cash.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Return on equity (ROE) as margins stabilize</li>
                        <li>Capital allocation as cash builds (currently no dividends or buybacks)</li>
                        <li>Balance sheet strength for regulatory capital requirements</li>
                    </ul>
                `
            }
        };

        // Modal functions
        function openModal(key) {
            document.getElementById('modalTitle').textContent = metricDescriptions[key].title;
            document.getElementById('modalBody').innerHTML = metricDescriptions[key].content;
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay') && event.target !== document.querySelector('.modal-close')) return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }

        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // DCF Section JavaScript
        let currentScenario = 'base';

        // Initialize DCF section
        function initDCF() {
            if (!dcfData || !dcfData.valuation) return;

            // Set current price
            document.getElementById('dcfCurrent').textContent = '£' + dcfData.current_price.toFixed(2);

            // Show warning if growth diverges
            if (dcfData.historical_growth.growth_divergence_warning) {
                document.getElementById('growthWarning').style.display = 'flex';
                document.getElementById('warningText').textContent = dcfData.historical_growth.growth_divergence_warning;
            }

            // Set slider defaults from base case
            const base = dcfData.assumptions.base;
            document.getElementById('growthSlider').value = dcfData.historical_growth.selected_growth_rate;
            document.getElementById('waccSlider').value = base.wacc;
            document.getElementById('terminalSlider').value = base.terminal_growth;

            // Update slider labels
            document.getElementById('growthValue').textContent = dcfData.historical_growth.selected_growth_rate + '%';
            document.getElementById('waccValue').textContent = base.wacc + '%';
            document.getElementById('terminalValue').textContent = base.terminal_growth + '%';

            // Set growth hint
            document.getElementById('growthHint').textContent = 'Based on management guidance (15-20%)';

            // Render components
            renderHistoricalGrowth();
            renderSensitivityMatrix();
            updateDCFDisplay();
            switchScenario('base');
        }

        // Calculate DCF from slider inputs
        function calculateDCF(growthRate, wacc, terminalGrowth) {
            const years = 5;
            const fcf = dcfData.inputs.last_fcf;
            let pvFCF = 0;
            let projectedFCF = fcf;

            // Calculate PV of projected FCF
            for (let i = 0; i < years; i++) {
                projectedFCF *= (1 + growthRate / 100);
                pvFCF += projectedFCF / Math.pow(1 + wacc/100, i + 1);
            }

            // Terminal Value (Gordon Growth Model)
            const terminalFCF = projectedFCF * (1 + terminalGrowth/100);
            const terminalValue = terminalFCF / (wacc/100 - terminalGrowth/100);
            const pvTerminal = terminalValue / Math.pow(1 + wacc/100, years);

            // Enterprise Value to Equity Value
            const enterpriseValue = pvFCF + pvTerminal;
            const equityValue = enterpriseValue - dcfData.inputs.net_debt;
            const iv = equityValue / dcfData.inputs.shares_outstanding;

            // Entry Price for 15% CAGR
            const terminalPerShare = terminalValue / dcfData.inputs.shares_outstanding;
            const entryPrice = terminalPerShare / Math.pow(1.15, years);

            return {
                iv: iv,
                entryPrice: entryPrice,
                terminalPerShare: terminalPerShare,
                pvFCF: pvFCF,
                pvTerminal: pvTerminal,
                enterpriseValue: enterpriseValue
            };
        }

        // Update display when sliders change
        window.updateDCFDisplay = function() {
            const growth = parseFloat(document.getElementById('growthSlider').value);
            const wacc = parseFloat(document.getElementById('waccSlider').value);
            const terminal = parseFloat(document.getElementById('terminalSlider').value);

            // Update slider labels
            document.getElementById('growthValue').textContent = growth + '%';
            document.getElementById('waccValue').textContent = wacc + '%';
            document.getElementById('terminalValue').textContent = terminal + '%';

            // Calculate new values
            const result = calculateDCF(growth, wacc, terminal);

            // Update IV display
            document.getElementById('dcfIV').textContent = '£' + result.iv.toFixed(2);
            document.getElementById('dcfEntry').textContent = '£' + result.entryPrice.toFixed(2);

            // Calculate and display upside
            const upside = ((result.iv - dcfData.current_price) / dcfData.current_price * 100);
            const upsideEl = document.getElementById('dcfUpside');
            upsideEl.textContent = (upside >= 0 ? '+' : '') + upside.toFixed(0) + '% vs current';
            upsideEl.className = 'dcf-change ' + (upside >= 0 ? 'positive' : 'negative');

            // Update weighted IV
            document.getElementById('dcfWeighted').textContent = '£' + dcfData.probability_weighted.weighted_iv.toFixed(2);

            // Update assumptions grid to reflect current slider values
            const grid = document.getElementById('assumptionGrid');
            if (grid) {
                grid.innerHTML = `
                    <div class="assumption-item">
                        <div class="label">Growth Rate</div>
                        <div class="value">${growth}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">WACC</div>
                        <div class="value">${wacc}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Terminal Growth</div>
                        <div class="value">${terminal}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Intrinsic Value</div>
                        <div class="value" style="color: #00d4aa;">£${result.iv.toFixed(2)}</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Entry Price (15% CAGR)</div>
                        <div class="value" style="color: #00d4aa;">£${result.entryPrice.toFixed(2)}</div>
                    </div>
                `;
            }
        };

        // Switch between scenarios
        window.switchScenario = function(scenario) {
            currentScenario = scenario;

            // Update tab styles
            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === scenario);
            });

            // Get scenario assumptions
            const assumptions = dcfData.assumptions[scenario];
            const valuation = dcfData.valuation[scenario];

            // Update sliders to scenario defaults
            document.getElementById('growthSlider').value = assumptions.growth_rates[0];
            document.getElementById('waccSlider').value = assumptions.wacc;
            document.getElementById('terminalSlider').value = assumptions.terminal_growth;

            // Render assumptions grid
            const grid = document.getElementById('assumptionGrid');
            grid.innerHTML = `
                <div class="assumption-item">
                    <div class="label">Year 1 Growth</div>
                    <div class="value">${assumptions.growth_rates[0]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Year 5 Growth</div>
                    <div class="value">${assumptions.growth_rates[4]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">FCF Margin</div>
                    <div class="value">${assumptions.fcf_margin}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">WACC</div>
                    <div class="value">${assumptions.wacc}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Terminal Growth</div>
                    <div class="value">${assumptions.terminal_growth}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Intrinsic Value</div>
                    <div class="value" style="color: #00d4aa;">£${valuation.intrinsic_value_per_share.toFixed(2)}</div>
                </div>
            `;

            updateDCFDisplay();
        };

        // Render historical growth rates
        function renderHistoricalGrowth() {
            const growth = dcfData.historical_growth;
            const selectedSource = growth.growth_rate_source;
            const grid = document.getElementById('growthGrid');

            const metrics = [
                { key: 'revenue_3yr_cagr', label: 'Revenue 3Y' },
                { key: 'eps_3yr_cagr', label: 'EPS 3Y' },
                { key: 'equity_3yr_cagr', label: 'Equity 3Y' },
                { key: 'fcf_3yr_cagr', label: 'FCF 3Y' }
            ];

            grid.innerHTML = metrics.map(m => {
                const rate = growth[m.key];
                if (rate === null) return '';
                const isSelected = m.key === selectedSource;
                const colorClass = rate >= 0 ? 'positive' : 'negative';
                return `
                    <div class="growth-item ${isSelected ? 'selected' : ''}">
                        <div class="metric">${m.label}</div>
                        <div class="rate ${colorClass}">${rate >= 0 ? '+' : ''}${rate.toFixed(1)}%</div>
                    </div>
                `;
            }).filter(x => x).join('');
        }

        // Render sensitivity matrix
        function renderSensitivityMatrix() {
            const sens = dcfData.sensitivity;
            const table = document.getElementById('sensitivityMatrix');
            const currentPrice = dcfData.current_price;

            let html = '<tr><th>WACC \\ Term G</th>';
            sens.terminal_growth_range.forEach(tg => {
                html += `<th>${tg}%</th>`;
            });
            html += '</tr>';

            sens.wacc_range.forEach((wacc, i) => {
                html += `<tr><th>${wacc}%</th>`;
                sens.matrix[i].forEach((val, j) => {
                    const isHighlight = wacc === dcfData.assumptions.base.wacc &&
                                       sens.terminal_growth_range[j] === dcfData.assumptions.base.terminal_growth;
                    const colorClass = val >= currentPrice ? 'above-current' : 'below-current';
                    html += `<td class="${isHighlight ? 'highlight' : colorClass}">£${val.toFixed(2)}</td>`;
                });
                html += '</tr>';
            });

            table.innerHTML = html;
        }

        // Initialize everything
        renderOverview();
        renderKPIs();
        renderGuidance();
        initDCF();

        // Bind slider events
        document.getElementById('growthSlider').addEventListener('input', updateDCFDisplay);
        document.getElementById('waccSlider').addEventListener('input', updateDCFDisplay);
        document.getElementById('terminalSlider').addEventListener('input', updateDCFDisplay);
    </script>
</body>
</html>