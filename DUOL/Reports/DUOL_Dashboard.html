<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duolingo (DUOL) Financial Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4aa, #00b894);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .header p {
            color: #888;
            font-size: 1.1rem;
        }
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        .kpi-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 170, 0.2);
        }
        .kpi-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 5px;
        }
        .kpi-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .kpi-change {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .kpi-change.positive { color: #00d4aa; }
        .kpi-change.negative { color: #ff6b6b; }
        /* Guidance Section */
        .guidance-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .guidance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .guidance-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .guidance-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .guidance-meta {
            font-size: 0.85rem;
            color: #888;
        }
        .guidance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .guidance-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease;
        }
        .guidance-card:hover {
            transform: translateY(-2px);
        }
        .guidance-metric {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .guidance-target {
            font-size: 1.4rem;
            font-weight: 600;
            color: #00d4aa;
            margin-bottom: 6px;
        }
        .guidance-period {
            font-size: 0.85rem;
            color: #e0e0e0;
            margin-bottom: 8px;
        }
        .guidance-vs-prior {
            display: inline-block;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        .guidance-vs-prior.raised {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
        }
        .guidance-vs-prior.lowered, .guidance-vs-prior.decelerated {
            background: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
        }
        .guidance-vs-prior.maintained {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }
        .guidance-vs-prior.met\/exceeded {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
        }
        .guidance-notes {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }
        .guidance-commentary {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 16px 20px;
            border-left: 3px solid #00d4aa;
            font-style: italic;
            color: #b0b0b0;
            line-height: 1.6;
        }
        .guidance-commentary::before {
            content: '"';
            font-size: 1.5rem;
            color: #00d4aa;
            margin-right: 4px;
        }
        .section-title {
            font-size: 1.5rem;
            color: #fff;
            margin: 40px auto 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0, 212, 170, 0.3);
            max-width: 1400px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .chart-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .help-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(0, 212, 170, 0.2);
            border: 1px solid #00d4aa;
            color: #00d4aa;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .help-btn:hover {
            background: #00d4aa;
            color: #1a1a2e;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: linear-gradient(135deg, #1e2a4a 0%, #16213e 100%);
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 212, 170, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 {
            color: #00d4aa;
            font-size: 1.4rem;
            margin: 0;
        }
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: #ff6b6b;
            color: #fff;
        }
        .modal-body {
            padding: 25px;
            line-height: 1.7;
        }
        .modal-body p { margin-bottom: 15px; }
        .modal-body strong { color: #00d4aa; }
        .modal-body ul { margin: 15px 0; padding-left: 20px; }
        .modal-body li { margin-bottom: 8px; }
        .metric-highlight {
            background: rgba(0, 212, 170, 0.1);
            border-left: 3px solid #00d4aa;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        /* Investment Overview Section */
        .overview-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .overview-toggle {
            width: 100%;
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid rgba(0, 212, 170, 0.3);
            border-radius: 12px;
            padding: 16px 24px;
            color: #00d4aa;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        .overview-toggle:hover {
            background: rgba(0, 212, 170, 0.2);
        }
        .overview-toggle .arrow {
            transition: transform 0.3s ease;
        }
        .overview-toggle.active .arrow {
            transform: rotate(180deg);
        }
        .overview-content {
            display: none;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            margin-top: -12px;
        }
        .overview-content.active {
            display: block;
        }
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        .overview-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .overview-card h3 {
            color: #00d4aa;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .overview-card p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        .overview-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .overview-card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            line-height: 1.5;
        }
        .overview-card li:last-child {
            border-bottom: none;
        }
        .overview-card.bull h3 { color: #00d4aa; }
        .overview-card.bear h3 { color: #ff6b6b; }
        .overview-card.risks h3 { color: #fdcb6e; }
        .risk-high { color: #ff6b6b; }
        .risk-moderate { color: #fdcb6e; }
        .risk-low { color: #00d4aa; }
        .revenue-stream {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .revenue-stream .percent {
            color: #00d4aa;
            font-weight: 600;
        }
        .trend-growing { color: #00d4aa; }
        .trend-stable { color: #888; }
        .trend-declining { color: #ff6b6b; }

        /* DCF Valuation Section */
        .dcf-section {
            max-width: 1400px;
            margin: 0 auto 40px;
        }
        .dcf-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dcf-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }
        .dcf-card:hover {
            transform: translateY(-3px);
        }
        .dcf-card.highlight {
            background: rgba(0, 212, 170, 0.1);
            border-color: rgba(0, 212, 170, 0.3);
        }
        .dcf-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .dcf-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #00d4aa;
        }
        .dcf-card:not(.highlight) .dcf-value {
            color: #fff;
        }
        .dcf-change {
            font-size: 1rem;
            margin-top: 8px;
            font-weight: 600;
        }
        .dcf-change.positive { color: #00d4aa; }
        .dcf-change.negative { color: #ff6b6b; }
        .dcf-sublabel {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
        }
        .dcf-warning {
            background: rgba(253, 203, 110, 0.15);
            border: 1px solid rgba(253, 203, 110, 0.4);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fdcb6e;
        }
        .warning-icon {
            font-size: 1.2rem;
        }
        /* DCF Inputs Display */
        .dcf-inputs {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .dcf-inputs h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        .dcf-inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .dcf-input-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .dcf-input-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .dcf-input-value {
            font-size: 1.3rem;
            font-weight: 600;
            color: #00d4aa;
        }
        .dcf-input-note {
            font-size: 0.7rem;
            color: #666;
            margin-top: 4px;
        }
        .fcf-projections h5 {
            color: #b0b0b0;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .fcf-projection-table {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 12px;
        }
        .fcf-projection-item {
            text-align: center;
        }
        .fcf-projection-item.header {
            font-size: 0.75rem;
            color: #888;
            font-weight: 600;
        }
        .fcf-projection-item .year {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 2px;
        }
        .fcf-projection-item .fcf-value {
            font-size: 1rem;
            color: #e0e0e0;
            font-weight: 500;
        }
        .fcf-projection-item .growth-rate {
            font-size: 0.75rem;
            color: #00d4aa;
            margin-top: 2px;
        }
        .dcf-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .slider-group label {
            font-size: 0.95rem;
            color: #e0e0e0;
            display: flex;
            justify-content: space-between;
        }
        .slider-group label span {
            color: #00d4aa;
            font-weight: 600;
        }
        .slider-group input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        .slider-hint {
            font-size: 0.8rem;
            color: #666;
        }
        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .scenario-tab {
            padding: 10px 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: #888;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .scenario-tab:hover {
            border-color: rgba(0, 212, 170, 0.5);
            color: #e0e0e0;
        }
        .scenario-tab.active {
            background: rgba(0, 212, 170, 0.15);
            border-color: #00d4aa;
            color: #00d4aa;
        }
        .scenario-details {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .scenario-details h4 {
            color: #00d4aa;
            margin-bottom: 15px;
        }
        .assumption-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .assumption-item {
            text-align: center;
        }
        .assumption-item .label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
        }
        .assumption-item .value {
            font-size: 1.1rem;
            color: #e0e0e0;
            font-weight: 500;
        }
        .sensitivity-section {
            margin-bottom: 30px;
        }
        .sensitivity-section h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .sensitivity-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            overflow: hidden;
        }
        .sensitivity-table th,
        .sensitivity-table td {
            padding: 12px 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .sensitivity-table th {
            background: rgba(0, 212, 170, 0.1);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td {
            color: #e0e0e0;
        }
        .sensitivity-table td.highlight {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td.below-current {
            color: #ff6b6b;
        }
        .sensitivity-table td.above-current {
            color: #00d4aa;
        }
        .historical-growth {
            margin-bottom: 30px;
        }
        .historical-growth h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .growth-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }
        .growth-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .growth-item .metric {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 6px;
        }
        .growth-item .rate {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .growth-item .rate.positive { color: #00d4aa; }
        .growth-item .rate.negative { color: #ff6b6b; }
        .growth-item.selected {
            border-color: #00d4aa;
            background: rgba(0, 212, 170, 0.1);
        }
        .dcf-download {
            text-align: center;
            margin-top: 30px;
        }
        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            background: rgba(0, 212, 170, 0.15);
            border: 1px solid #00d4aa;
            border-radius: 8px;
            color: #00d4aa;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
        }
        .download-btn:hover {
            background: #00d4aa;
            color: #1a1a2e;
        }
        .download-icon {
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .charts-container { grid-template-columns: 1fr; }
            .overview-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Duolingo, Inc. (DUOL)</h1>
        <p>Language Learning Platform | Current Price: $132.16 | Data through Q3 2025 (Q4 2025E estimated)</p>
    </div>

    <!-- Investment Overview Section -->
    <div class="overview-section">
        <button class="overview-toggle" onclick="toggleOverview()">
            <span>Investment Overview & Analysis</span>
            <span class="arrow">â–¼</span>
        </button>
        <div class="overview-content" id="overviewContent">
            <div class="overview-grid" id="overviewGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid" id="kpiGrid">
        <!-- Populated by JavaScript -->
    </div>

    <!-- Management Guidance Section -->
    <div class="guidance-section" id="guidanceSection">
        <div class="guidance-header">
            <h3>Management Guidance</h3>
            <span class="guidance-meta">As of <span id="guidanceAsOf"></span> | <span id="guidanceFY"></span></span>
        </div>
        <div class="guidance-grid" id="guidanceGrid">
            <!-- Populated by JavaScript -->
        </div>
        <div class="guidance-commentary" id="guidanceCommentary">
            <!-- Populated by JavaScript -->
        </div>
    </div>

    <!-- Financial Performance Section -->
    <h2 class="section-title">Financial Performance</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Revenue Growth</h3>
                <button class="help-btn" onclick="openModal('revenue')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Profitability Trend</h3>
                <button class="help-btn" onclick="openModal('profitability')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="profitabilityChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Free Cash Flow</h3>
                <button class="help-btn" onclick="openModal('fcf')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="fcfChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Profit Margins</h3>
                <button class="help-btn" onclick="openModal('margins')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="marginsChart"></canvas>
            </div>
        </div>
    </div>

    <!-- User Growth & Engagement Section -->
    <h2 class="section-title">User Growth & Engagement</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Daily Active Users (DAU)</h3>
                <button class="help-btn" onclick="openModal('dau')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="dauChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Monthly Active Users (MAU)</h3>
                <button class="help-btn" onclick="openModal('mau')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="mauChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Paid Subscribers</h3>
                <button class="help-btn" onclick="openModal('subscribers')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="subscribersChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>DAU/MAU Engagement Ratio</h3>
                <button class="help-btn" onclick="openModal('engagement')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="engagementChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Monetization Metrics Section -->
    <h2 class="section-title">Monetization Metrics</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Bookings Growth</h3>
                <button class="help-btn" onclick="openModal('bookings')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="bookingsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Subscription Bookings</h3>
                <button class="help-btn" onclick="openModal('subBookings')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="subBookingsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Quarterly ARPU</h3>
                <button class="help-btn" onclick="openModal('arpu')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="arpuChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Subscriber Conversion Rate</h3>
                <button class="help-btn" onclick="openModal('conversion')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="conversionChart"></canvas>
            </div>
        </div>
    </div>

    <!-- DCF Valuation Section -->
    <h2 class="section-title">DCF Valuation</h2>
    <div class="dcf-section">
        <div class="dcf-summary">
            <div class="dcf-card highlight">
                <div class="dcf-label">Intrinsic Value</div>
                <div class="dcf-value" id="dcfIV">$219</div>
                <div class="dcf-change positive" id="dcfUpside">+44% upside</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Entry Price (15% CAGR)</div>
                <div class="dcf-value" id="dcfEntry">$124</div>
                <div class="dcf-sublabel">Buy below for 15% annual return</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Current Price</div>
                <div class="dcf-value" id="dcfCurrent">$152.64</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Prob-Weighted IV</div>
                <div class="dcf-value" id="dcfWeighted">$222</div>
                <div class="dcf-sublabel">25% Bull / 50% Base / 25% Bear</div>
            </div>
        </div>

        <div class="dcf-warning" id="growthWarning" style="display: none;">
            <span class="warning-icon">&#9888;</span>
            <span id="warningText"></span>
        </div>

        <div class="dcf-inputs">
            <h4>DCF Model Inputs</h4>
            <div class="dcf-inputs-grid">
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Base Year FCF</div>
                    <div class="dcf-input-value" id="baseFCF">$290M</div>
                    <div class="dcf-input-note">TTM Free Cash Flow</div>
                </div>
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Shares Outstanding</div>
                    <div class="dcf-input-value" id="sharesOut">49.1M</div>
                </div>
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Net Debt</div>
                    <div class="dcf-input-value" id="netDebt">-$960M</div>
                    <div class="dcf-input-note">Negative = net cash</div>
                </div>
            </div>
            <div class="fcf-projections">
                <h5>Projected FCF (5-Year)</h5>
                <div class="fcf-projection-table" id="fcfProjectionTable">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="dcf-controls">
            <div class="slider-group">
                <label>Growth Rate: <span id="growthValue">42%</span></label>
                <input type="range" id="growthSlider" min="0" max="60" value="42" step="1">
                <div class="slider-hint" id="growthHint">Based on revenue 3yr CAGR</div>
            </div>
            <div class="slider-group">
                <label>WACC: <span id="waccValue">10.0%</span></label>
                <input type="range" id="waccSlider" min="6" max="18" value="10" step="0.5">
            </div>
            <div class="slider-group">
                <label>Terminal Growth: <span id="terminalValue">3.0%</span></label>
                <input type="range" id="terminalSlider" min="0" max="5" value="3" step="0.5">
            </div>
        </div>

        <div class="scenario-tabs">
            <button class="scenario-tab active" data-scenario="base" onclick="switchScenario('base')">Base Case</button>
            <button class="scenario-tab" data-scenario="bull" onclick="switchScenario('bull')">Bull Case</button>
            <button class="scenario-tab" data-scenario="bear" onclick="switchScenario('bear')">Bear Case</button>
        </div>

        <div class="scenario-details" id="scenarioDetails">
            <div class="scenario-assumptions">
                <h4>Assumptions</h4>
                <div class="assumption-grid" id="assumptionGrid">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="sensitivity-section">
            <h4>Sensitivity Analysis: Intrinsic Value by WACC & Terminal Growth</h4>
            <table class="sensitivity-table" id="sensitivityMatrix">
                <!-- Populated by JavaScript -->
            </table>
        </div>

        <div class="historical-growth">
            <h4>Historical Growth Rates (CAGR)</h4>
            <div class="growth-grid" id="growthGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // EMBEDDED CSV DATA
        const csvData = `Period,Revenue,GrossProfit,GrossMargin,OperatingIncome,OperatingMargin,EBITDA,NetIncome,NetMargin,EPSDiluted,OperatingCashFlow,CapEx,FreeCashFlow,ShareholdersEquity,TotalDebt,CashAndEquivalents,SharesOutstanding,DAU,MAU,Bookings,Subscribers,SubscriptionBookings
Q4 2021,73.0,54.0,74.0,-12.5,-17.1,4.6,-15.8,-21.6,,,12.5,,,,,10.1,42.4,83.7,2.5,62.9
Q1 2022,81.3,59.7,73.5,-8.3,-10.2,9.7,1.0,1.2,,-12.2,,16.9,,,,,12.5,49.2,93.8,2.9,72.9
Q2 2022,88.4,65.0,73.5,-4.5,-5.1,9.9,-4.4,-5.0,-0.10,,,18.2,,,,,13.3,52.3,104.8,3.3,82.4
Q3 2022,92.1,67.8,73.6,-5.3,-5.8,8.9,-5.3,-5.8,-0.12,,,15.9,,,,,14.9,54.8,106.1,3.7,90.8
Q4 2022,107.7,78.8,73.2,8.0,7.4,15.9,-5.0,-4.6,-0.11,,,22.7,,,,,16.3,60.7,133.3,4.2,103.9
FY2022,369.5,271.3,73.4,-10.1,-2.7,39.3,1.6,0.4,-0.04,60.8,9.5,73.3,,,,,14.9,54.8,438.0,4.2,350.0
Q1 2023,115.7,84.2,72.8,-8.5,-7.3,21.5,-2.6,-2.2,-0.06,,,24.9,,,,,20.3,72.6,138.5,4.8,114.7
Q2 2023,126.8,93.1,73.4,-4.9,-3.8,24.9,3.8,3.0,0.08,,,31.3,,,,,21.4,74.1,146.5,5.2,124.7
Q3 2023,137.6,101.4,73.7,-4.7,-3.4,31.2,2.8,2.0,0.06,,,38.9,,,,,24.2,83.1,159.8,5.8,133.9
Q4 2023,151.0,110.4,73.1,4.8,3.2,42.0,12.4,8.2,0.26,49.2,1.5,57.9,584.8,,747.6,44.8,26.9,88.4,191.0,6.6,152.1
FY2023,531.1,389.0,73.3,-13.3,-2.5,93.7,16.1,3.0,0.35,153.6,13.6,142.2,584.8,,747.6,44.8,24.2,83.1,635.8,6.6,525.4
Q1 2024,167.6,122.4,73.0,16.4,9.8,46.8,27.0,16.1,0.59,29.6,3.3,38.4,711.1,,747.6,45.4,31.4,97.6,196.8,7.4,168.6
Q2 2024,178.3,131.0,73.5,18.7,10.5,49.1,24.4,13.7,0.54,38.4,2.7,40.5,766.9,,747.6,45.4,34.1,103.6,206.3,8.0,180.3
Q3 2024,192.6,140.4,72.9,13.6,7.1,54.9,23.4,12.1,0.49,56.3,5.1,51.2,791.6,,787.6,45.4,37.2,113.1,223.6,8.6,189.9
Q4 2024,209.6,150.6,71.9,13.9,6.6,64.5,13.9,6.6,0.29,83.3,3.5,87.8,882.0,,838.6,46.0,40.5,116.7,271.6,9.5,213.9
FY2024,748.0,544.4,72.8,62.6,8.4,215.3,88.6,11.8,1.91,207.6,14.6,218.0,882.0,,838.6,46.0,40.5,116.7,898.3,9.5,752.7
Q1 2025,230.7,164.1,71.1,23.6,10.2,64.7,35.1,15.2,0.74,50.5,3.5,53.9,893.8,,877.6,46.0,46.0,126.6,267.7,10.4,232.7
Q2 2025,251.7,182.6,72.6,33.4,13.3,72.1,44.8,17.8,0.94,67.6,2.9,70.5,977.0,,1068.1,47.6,49.5,131.2,289.1,11.0,251.6
Q3 2025,271.7,196.9,72.5,35.2,13.0,80.3,292.2,107.5,5.95,84.2,6.8,77.4,1307.5,,1121.5,49.1,50.5,135.3,313.6,11.5,268.9
Q4 2025E,275.0,196.6,71.5,17.0,6.2,77.0,30.0,10.9,0.60,,,,,,,52.7,,335.0,12.3,
FY2025E,1029.1,740.2,71.9,109.2,10.6,294.1,402.1,39.1,8.23,,,,1307.5,,1121.5,49.1,52.7,135.3,1206.3,12.3,`;

        // EMBEDDED ANALYSIS JSON
        const analysis = {
    "ticker": "DUOL",
    "company_name": "Duolingo, Inc.",
    "analysis_date": "2026-02-03",
    "overview": "Duolingo is the leading mobile learning platform globally, offering language learning courses alongside Math, Music, and Chess. The company operates a freemium business model with a free ad-supported tier and paid subscriptions (Super and Max). With over 50 million daily active users and 11.5+ million paid subscribers, Duolingo has become the top-grossing app in the Education category on both Google Play and Apple App Store.",
    "business_model": {
        "summary": "Freemium model with ~81% of revenue from subscriptions, supplemented by advertising, Duolingo English Test, and in-app purchases. Strong margin profile (29% Adjusted EBITDA margin in FY2025) with improving profitability trajectory.",
        "revenue_streams": [
            {
                "name": "Subscriptions",
                "percent": 81,
                "trend": "growing"
            },
            {
                "name": "Advertising",
                "percent": 9,
                "trend": "stable"
            },
            {
                "name": "Duolingo English Test",
                "percent": 7,
                "trend": "growing"
            },
            {
                "name": "In-App Purchases",
                "percent": 3,
                "trend": "stable"
            }
        ],
        "customer_type": "B2C (individual learners), with institutional use via Duolingo for Schools",
        "geographic_mix": "North and Latin America ~55%, Europe/Middle East/Africa ~32%, Asia-Pacific ~13% (based on Q4 2023 IAP revenue data)"
    },
    "competitive_position": {
        "main_competitors": [
            "Babbel",
            "Rosetta Stone",
            "Busuu",
            "Memrise",
            "ChatGPT and AI language tools"
        ],
        "market_position": "Dominant leader in language learning apps with $748M revenue (2024) vs. Babbel's $270M. Most popular app by user count and brand recognition.",
        "moat_factors": [
            {
                "factor": "Network effects and social features",
                "strength": "strong",
                "description": "Friend Streaks, leaderboards, and social engagement create sticky user base. Over 10M users have streaks of 1+ years."
            },
            {
                "factor": "Brand and viral marketing",
                "strength": "strong",
                "description": "Iconic owl mascot and 'unhinged' marketing named Marketer of the Year by AdAge. Massive social media presence (430%+ growth on YouTube Shorts, 450%+ on Instagram Reels YoY)."
            },
            {
                "factor": "Data and AI advantage",
                "strength": "moderate",
                "description": "Massive user data from billions of learning sessions powers AI personalization and product improvements. Proprietary 'Green Machine' A/B testing process."
            },
            {
                "factor": "Free tier as acquisition funnel",
                "strength": "strong",
                "description": "Free tier with ads attracts massive user base (135M MAUs) creating conversion funnel to paid tiers. Freemium model difficult for competitors to replicate at scale."
            }
        ],
        "weaknesses": [
            "DAU growth decelerating (54% Q3 2024 -> 36% Q3 2025 -> 30% Q4 2025)",
            "Effectiveness debate - critics argue app doesn't deliver fluency compared to immersive learning",
            "Dependency on third-party platforms (Apple, Google) for distribution and payments",
            "Rising AI costs pressuring gross margins (declined 80bps in FY2025)"
        ]
    },
    "growth_drivers": [
        "Duolingo Max tier expansion (5% of subscribers, premium AI features including Video Call)",
        "AI-powered features driving engagement and monetization (Video Call, Roleplay, Explain My Answer)",
        "Chess course becoming fastest-growing subject (1M+ DAUs in first months, now on Android)",
        "International expansion, particularly English learners in Asia (China, India, Japan, Korea)",
        "Duolingo English Test acceptance growing (5,500+ universities in 100+ countries)",
        "New product features like Energy system showing promise (increased DAUs, time spent, and conversion)"
    ],
    "risks": {
        "business": [
            {
                "risk": "DAU growth deceleration",
                "severity": "high",
                "description": "User growth slowing from 54% to 30% YoY. Company shifting focus from monetization to user growth, accepting margin pressure."
            },
            {
                "risk": "AI competition",
                "severity": "high",
                "description": "ChatGPT and other generative AI tools provide free language learning alternatives. Market concerns about AI disruption despite strong fundamentals."
            },
            {
                "risk": "Effectiveness perception",
                "severity": "moderate",
                "description": "Debate over whether gamified app delivers real fluency. Could limit conversion or retention if users don't achieve goals."
            },
            {
                "risk": "Platform dependency",
                "severity": "moderate",
                "description": "Reliance on Apple and Google app stores for distribution and in-app purchase processing. Subject to platform policy changes and fee structures."
            }
        ],
        "financial": [
            {
                "risk": "Currency exposure",
                "severity": "moderate",
                "description": "Over 50% of bookings from outside US. Every 1% change in dollar vs. currency basket = ~$1M quarterly bookings impact."
            },
            {
                "risk": "Gross margin pressure from AI costs",
                "severity": "moderate",
                "description": "Generative AI costs (particularly Video Call feature) caused 80bps gross margin decline in FY2025. Variable costs scale with Max adoption."
            }
        ],
        "regulatory": [
            {
                "risk": "Data privacy compliance",
                "severity": "moderate",
                "description": "Collects extensive user data including voice/biometric data. Subject to GDPR, CCPA, and evolving global privacy regulations. 2023 data breach affected 2.6M users."
            },
            {
                "risk": "China regulatory uncertainty",
                "severity": "moderate",
                "description": "Targeting English learners in China but subject to unpredictable regulatory approvals and data localization requirements."
            },
            {
                "risk": "Educational compliance",
                "severity": "low",
                "description": "Schools version must comply with COPPA, FERPA, and various educational privacy standards."
            }
        ],
        "macro": [
            {
                "risk": "Consumer spending sensitivity",
                "severity": "low",
                "description": "Premium subscriptions are discretionary spending. Recession could impact conversion rates, though education is relatively resilient."
            },
            {
                "risk": "Content moderation and brand safety",
                "severity": "low",
                "description": "User-generated content and viral marketing approach carries brand reputation risk."
            }
        ],
        "execution": [
            {
                "risk": "CFO transition",
                "severity": "moderate",
                "description": "Matt Skaruppa (CFO since 2020, led IPO) resigned Jan 2026. Replacement Gillian Munson (ex-Vimeo CFO) starts Feb 23. Transition risk during critical growth phase."
            },
            {
                "risk": "Strategic shift execution",
                "severity": "moderate",
                "description": "Deliberately prioritizing user growth over monetization in 2025. Success depends on converting future users to paid subscribers."
            },
            {
                "risk": "New subject expansion",
                "severity": "low",
                "description": "Chess, Math, Music are early-stage. Unclear if company can replicate language learning success in other subjects."
            }
        ]
    },
    "macro_factors": {
        "industry_outlook": "Online language learning market valued at $21.95B in 2026, projected to reach $94.2B by 2035 (18.1% CAGR). AI integration and personalization driving rapid growth.",
        "cyclicality": "Low cyclicality. Education is resilient, though premium tier conversions may be moderately affected by economic downturns.",
        "interest_rate_sensitivity": "Low direct sensitivity. Growth stock valuation affected by rate changes (P/E compressed from peak to 22.3 in Jan 2026).",
        "key_input_costs": [
            "Cloud computing (AWS/Google Cloud)",
            "Generative AI API costs (OpenAI GPT-4)",
            "Content creation",
            "Marketing"
        ]
    },
    "recent_developments": [
        {
            "date": "2026-01-12",
            "event": "CFO Matt Skaruppa announced resignation after 6 years. Gillian Munson (board member, ex-Vimeo CFO) named replacement effective Feb 23. Stock fell ~8%."
        },
        {
            "date": "2026-01-12",
            "event": "Preliminary Q4 2025 results: DAU ~52.7M (+30% YoY), Bookings at or above high end of $329.5M-$335.5M guidance."
        },
        {
            "date": "2025-11",
            "event": "Q3 2025 results: DAUs 50.5M (+36% YoY), Revenue $271.7M (+41% YoY), Adjusted EBITDA margin 29.5%. Announced shift toward user growth over near-term monetization."
        },
        {
            "date": "2025-09",
            "event": "Duocon 2025: Announced Video Call improvements, Energy system rollout showing positive results on DAUs/engagement/conversion."
        },
        {
            "date": "2025-09",
            "event": "Released valuation allowance on deferred tax assets, resulting in $222.7M one-time tax benefit in Q3."
        },
        {
            "date": "2025-06",
            "event": "Chess course launched on iOS (English only), became fastest-growing subject with 1M+ DAUs by Q2 end."
        },
        {
            "date": "2025-05",
            "event": "Stock peaked at all-time high of $544.93 on May 14, 2025 (+67% YTD)."
        },
        {
            "date": "2025-01",
            "event": "Video Call expanded to Android and 5 additional languages (total 8-9 supported languages)."
        },
        {
            "date": "2024-12",
            "event": "Record Q4: 40.5M DAUs (+51% YoY), 9.5M paid subscribers (+43% YoY). Duolingo Max reached 5% of paid subscribers."
        }
    ],
    "guidance": {
        "as_of": "Q3 2025 Shareholder Letter (Nov 5, 2025) + Q4 2025 Preliminary (Jan 12, 2026)",
        "fiscal_year": "FY2025",
        "items": [
            {
                "metric": "Bookings",
                "target": "$1,151M - $1,157M",
                "period": "FY2025",
                "vs_prior": "raised at midpoint from $1,149M-$1,157M",
                "notes": "33% YoY growth (32% constant currency). Q4 guidance: $329.5M-$335.5M (+22% YoY, +19% constant currency)"
            },
            {
                "metric": "Revenue",
                "target": "$1,027.5M - $1,031.5M",
                "period": "FY2025",
                "vs_prior": "maintained",
                "notes": "38% YoY growth (both reported and constant currency). Q4 guidance: $273M-$277M (+31% YoY, +29% constant currency)"
            },
            {
                "metric": "Adjusted EBITDA Margin",
                "target": "28.9% - 29.1%",
                "period": "FY2025",
                "vs_prior": "raised 25bps at midpoint",
                "notes": "~330bps YoY expansion. Q4 guidance: 27.6%-28.4% (reflects reinvestment in AI and marketing)"
            },
            {
                "metric": "Gross Margin",
                "target": "down ~80bps YoY",
                "period": "FY2025",
                "vs_prior": "improved 20bps from prior guidance",
                "notes": "Better than expected due to lower-than-expected AI costs. Duolingo Max adoption increasing variable costs"
            },
            {
                "metric": "Share Count",
                "target": "+1% dilution",
                "period": "FY2025",
                "vs_prior": "maintained",
                "notes": "Assuming Q3 quarter-end share price. ~49.9M diluted shares outstanding"
            },
            {
                "metric": "DAU Growth",
                "target": "~30% YoY (Q4 2025 preliminary)",
                "period": "Q4 2025",
                "vs_prior": "decelerated from 36% in Q3",
                "notes": "~52.7M DAUs in Q4 2025. Deceleration trend from 54% (Q3 2024) to 36% (Q3 2025) to 30% (Q4 2025)"
            }
        ],
        "management_commentary": "CEO Luis von Ahn emphasized strategic shift in Q3 letter: 'investing proportionally more in teaching better, and prioritizing user growth over monetization.' Guidance reflects measured margin expansion due to investments in AI, Video Call variable costs, and marketing to drive user growth. Management sees 'tremendous growth opportunity ahead' and believes strategic investments now will drive sustained long-term success. Full Q4/FY2025 earnings expected Feb 26, 2026."
    },
    "bull_case": [
        "Dominant market position with strong brand and network effects. Revenue 2.8x larger than nearest competitor (Babbel).",
        "AI-powered features (Video Call, Max tier) driving differentiation and ARPU expansion (7% YoY subscription ARPU growth in Q3 2025).",
        "Massive untapped market in English learners globally, particularly in Asia (China, India). English learners are majority of global market but underrepresented in revenue.",
        "Proven ability to scale profitably - Adjusted EBITDA margin expanded 800bps from 17.6% (2023) to 25.7% (2024) to ~29% (2025), with 37.9% incremental margin.",
        "Multiple growth vectors: Max tier expansion, Chess and new subjects, Duolingo English Test, international markets, AI feature development.",
        "Stock trading at attractive valuation after 67% decline from peak - P/E of 22.3 and P/FCF of 26 for company growing revenue 38% with improving margins. Analyst average price target of $252-$281 suggests 55-87% upside.",
        "Sticky user base with strong engagement - over 10M users have 1+ year streaks, DAU/MAU ratio 34.7% and growing."
    ],
    "bear_case": [
        "Decelerating user growth trajectory (54% -> 36% -> 30% YoY) suggests market saturation or increased competition. Management deliberately deprioritizing monetization.",
        "Existential risk from generative AI - ChatGPT and similar tools offer free, potentially more effective language learning. Stock sold off 67% from peak partly on these fears.",
        "Gross margin pressure from AI costs - 80bps decline in FY2025 despite lower-than-expected costs. Video Call has variable cost structure that scales with Max adoption.",
        "CFO transition during critical period - Matt Skaruppa (6 years, led IPO and profitability shift) departing. Creates execution risk in 2026.",
        "Effectiveness concerns - critics argue gamified approach doesn't deliver fluency. Could limit long-term retention and word-of-mouth growth.",
        "Platform concentration risk - Apple and Google control distribution and take 15-30% of subscription revenue. Subject to policy changes.",
        "Valuation still not cheap on absolute basis - trading at 22x earnings and 4.5x sales despite 67% decline. Requires sustained 30%+ growth to justify multiple.",
        "Geographic concentration - North/Latin America ~55% of revenue. International expansion faces regulatory hurdles (China) and execution challenges."
    ],
    "sources": {
        "company_filings": [
            "DUOL Q3 2025 Shareholder Letter (November 5, 2025)",
            "DUOL Q2 2025 Shareholder Letter (August 6, 2025)",
            "DUOL Q4/FY 2024 Shareholder Letter (February 27, 2025)"
        ],
        "news_and_analysis": [
            "https://www.globenewswire.com/news-release/2026/01/12/3216671/0/en/Duolingo-Announces-CFO-Transition.html",
            "https://www.classcentral.com/report/duolingo-cfo-resignation-q4-2025-results/",
            "https://www.tipranks.com/news/duolingo-stock-duol-crashes-on-cfo-exit-whats-next",
            "https://www.fool.com/investing/2026/01/14/why-duolingo-stock-lost-46-in-2025-and-whats-next/",
            "https://www.fool.com/investing/2026/01/12/1-growth-stock-down-67-buying-dip-2026-wall-street/",
            "https://seekingalpha.com/article/4858505-duolingo-my-top-pick-for-2026"
        ],
        "market_research": [
            "https://www.businessresearchinsights.com/market-reports/online-language-learning-market-101287",
            "https://www.businessofapps.com/data/language-learning-app-market/",
            "https://abblino.com/language-learning-trends-2026/"
        ],
        "product_information": [
            "https://blog.duolingo.com/duolingo-max/",
            "https://investors.duolingo.com/news-releases/news-release-details/duolingo-launches-ai-powered-video-call-android",
            "https://blog.duolingo.com/chess-course/",
            "https://blog.duolingo.com/product-highlights/"
        ],
        "privacy_and_risks": [
            "https://medium.com/@chloehopman/learning-languages-losing-privacy-what-duolingo-teaches-us-about-data-ethics-4d2bc6e14664",
            "https://privacy.commonsense.org/evaluation/duolingo",
            "https://www.itgovernance.eu/blog/en/targeted-phishing-risk-for-2-6-million-duolingo-users"
        ]
    }
};

        // EMBEDDED DCF JSON
        const dcfData = {
    "ticker": "DUOL",
    "company_name": "Duolingo, Inc.",
    "valuation_date": "2026-02-03",
    "current_price": 132.16,
    "inputs": {
        "shares_outstanding": 49.1,
        "net_debt": -1121.5,
        "last_fcf": 218.0,
        "cash_and_equivalents": 1121.5,
        "total_debt": 0.0,
        "currency": "USD",
        "units": "millions"
    },
    "historical_growth": {
        "revenue_3yr_cagr": 40.7,
        "revenue_2yr_cagr": 42.1,
        "eps_2yr_cagr": null,
        "eps_3yr_cagr": null,
        "equity_1yr_cagr": 50.8,
        "equity_annualized_cagr": 57.5,
        "fcf_2yr_cagr": 73.4,
        "fcf_3yr_cagr": 58.0,
        "selected_growth_rate": 42.0,
        "growth_rate_source": "revenue_2yr_cagr",
        "growth_divergence_warning": "High-growth company with FCF growing faster than revenue due to margin expansion. Equity CAGR elevated due to profitability inflection. Using revenue as primary anchor given business stage.",
        "notes": "Company recently inflected to consistent profitability (FY2024+), so historical equity/EPS less relevant. Revenue and FCF growth rates more reliable for projections. DAU growth decelerating from 54% (2023) to 36% (Q3 2025) to 30% (Q4 2025E)."
    },
    "assumptions": {
        "base": {
            "name": "Base Case - Moderate Growth Deceleration",
            "description": "Revenue growth decelerates from ~35% to ~15% over 5 years as DAU growth continues slowing but ARPU expansion and Max tier adoption provide support. FCF margin expands from 29% to 32% as company scales and AI costs moderate.",
            "growth_rates": [
                35.0,
                28.0,
                22.0,
                18.0,
                15.0
            ],
            "revenue_yr5": 2383.8,
            "fcf_margin": 32.0,
            "fcf_yr5": 762.8,
            "wacc": 10.0,
            "terminal_growth": 3.0,
            "reasoning": "Assumes continued DAU deceleration but successful monetization improvements (Max adoption, ARPU growth). Margins benefit from operating leverage and AI cost efficiencies. Terminal growth of 3% reflects mature EdTech company above GDP growth."
        },
        "bull": {
            "name": "Bull Case - AI-Powered Reacceleration",
            "description": "Video Call and Max features drive competitive differentiation, reaccelerating user growth and driving faster conversion. International expansion and new subjects (Chess, Math, Music) broaden TAM. FCF margin reaches 35%+ as AI features prove highly profitable.",
            "growth_rates": [
                40.0,
                35.0,
                30.0,
                25.0,
                22.0
            ],
            "revenue_yr5": 3214.9,
            "fcf_margin": 35.0,
            "fcf_yr5": 1125.2,
            "wacc": 9.0,
            "terminal_growth": 4.0,
            "reasoning": "Video Call becomes must-have feature, driving Max tier to 20%+ of subscribers. AI automation and operating leverage drive 35%+ FCF margins. Chess/Math/Music successfully expand TAM beyond language learners. Lower WACC reflects reduced execution risk."
        },
        "bear": {
            "name": "Bear Case - AI Disintermediation & Growth Stall",
            "description": "Free LLMs and AI-native competitors commoditize language learning, causing DAU growth to stall and churn to increase. Low conversion rate persists. AI costs compress margins. Growth decelerates sharply to low teens.",
            "growth_rates": [
                25.0,
                18.0,
                12.0,
                8.0,
                6.0
            ],
            "revenue_yr5": 1724.0,
            "fcf_margin": 28.0,
            "fcf_yr5": 482.7,
            "wacc": 11.5,
            "terminal_growth": 2.0,
            "reasoning": "ChatGPT and AI tutors erode Duolingo's value proposition. DAU growth turns negative or flat. Conversion rate stays <10%. Video Call fails to differentiate. Margins compress from AI costs and increased marketing spend to defend position. Higher WACC reflects elevated execution and competitive risk."
        }
    },
    "projections": {
        "base": {
            "years": [
                "Y1",
                "Y2",
                "Y3",
                "Y4",
                "Y5"
            ],
            "revenue": [
                1010.0,
                1292.8,
                1577.2,
                1861.3,
                2140.5
            ],
            "fcf": [
                303.0,
                387.8,
                473.2,
                558.4,
                642.2
            ],
            "fcf_margin": [
                30.0,
                30.0,
                30.0,
                30.0,
                30.0
            ],
            "discount_factors": [
                0.909,
                0.826,
                0.751,
                0.683,
                0.621
            ],
            "pv_fcf": [
                275.4,
                320.4,
                355.3,
                381.3,
                398.8
            ]
        },
        "bull": {
            "years": [
                "Y1",
                "Y2",
                "Y3",
                "Y4",
                "Y5"
            ],
            "revenue": [
                1047.2,
                1413.7,
                1837.8,
                2297.3,
                2802.7
            ],
            "fcf": [
                345.6,
                466.5,
                606.5,
                758.1,
                924.9
            ],
            "fcf_margin": [
                33.0,
                33.0,
                33.0,
                33.0,
                33.0
            ],
            "discount_factors": [
                0.917,
                0.842,
                0.772,
                0.708,
                0.65
            ],
            "pv_fcf": [
                317.0,
                392.7,
                468.2,
                536.7,
                601.2
            ]
        },
        "bear": {
            "years": [
                "Y1",
                "Y2",
                "Y3",
                "Y4",
                "Y5"
            ],
            "revenue": [
                935.0,
                1103.3,
                1235.7,
                1334.6,
                1414.7
            ],
            "fcf": [
                243.1,
                286.9,
                321.3,
                347.0,
                367.8
            ],
            "fcf_margin": [
                26.0,
                26.0,
                26.0,
                26.0,
                26.0
            ],
            "discount_factors": [
                0.897,
                0.804,
                0.721,
                0.647,
                0.58
            ],
            "pv_fcf": [
                218.0,
                230.7,
                231.7,
                224.5,
                213.3
            ]
        }
    },
    "valuation": {
        "base": {
            "sum_pv_fcf": 1731.2,
            "terminal_fcf": 661.5,
            "terminal_value": 9450.0,
            "pv_terminal": 5868.5,
            "enterprise_value": 7599.7,
            "equity_value": 8721.2,
            "intrinsic_value": 177.62,
            "upside": 34.4,
            "margin_of_safety": 25.6
        },
        "bull": {
            "sum_pv_fcf": 2315.8,
            "terminal_fcf": 961.9,
            "terminal_value": 19238.0,
            "pv_terminal": 12504.7,
            "enterprise_value": 14820.5,
            "equity_value": 15942.0,
            "intrinsic_value": 324.71,
            "upside": 145.7,
            "margin_of_safety": 59.3
        },
        "bear": {
            "sum_pv_fcf": 1118.2,
            "terminal_fcf": 375.1,
            "terminal_value": 3948.9,
            "pv_terminal": 2290.4,
            "enterprise_value": 3408.6,
            "equity_value": 4530.1,
            "intrinsic_value": 92.26,
            "upside": -30.2,
            "margin_of_safety": -30.2
        }
    },
    "entry_price": {
        "base": {
            "terminal_value_per_share": 192.49,
            "years_to_terminal": 5,
            "target_cagr": 15.0,
            "entry_price": 95.71,
            "entry_discount_from_current": -27.6,
            "notes": "Entry price to achieve 15% CAGR to terminal value is $95.71, about 28% below current price. Suggests current price offers attractive returns if base case materializes."
        },
        "bull": {
            "terminal_value_per_share": 391.82,
            "years_to_terminal": 5,
            "target_cagr": 15.0,
            "entry_price": 194.83,
            "entry_discount_from_current": 47.4,
            "notes": "In bull case, current price offers significant upside even with 15% CAGR target. Would need to pay 47% premium to current price for 15% return."
        },
        "bear": {
            "terminal_value_per_share": 80.43,
            "years_to_terminal": 5,
            "target_cagr": 15.0,
            "entry_price": 39.99,
            "entry_discount_from_current": -69.7,
            "notes": "In bear case, current price implies significant downside risk if AI disruption and growth deceleration materialize. Would need 70% discount for 15% return."
        }
    },
    "sensitivity": {
        "wacc_range": [
            8.0,
            9.0,
            10.0,
            11.0,
            12.0
        ],
        "terminal_growth_range": [
            2.0,
            2.5,
            3.0,
            3.5,
            4.0
        ],
        "matrix": [
            [
                226.61,
                244.46,
                266.45,
                293.81,
                328.9
            ],
            [
                196.84,
                210.13,
                226.15,
                245.73,
                270.0
            ],
            [
                173.49,
                184.06,
                196.68,
                211.92,
                230.56
            ],
            [
                155.11,
                163.68,
                173.73,
                185.68,
                200.09
            ],
            [
                140.49,
                147.61,
                155.76,
                165.23,
                176.35
            ]
        ],
        "notes": "Base case WACC = 10%, Terminal Growth = 3%. Matrix shows intrinsic value per share. Current price $132.16 is below base case fair value across most scenarios except very high WACC or very low terminal growth."
    },
    "probability_weighted": {
        "weights": {
            "bull": 0.3,
            "base": 0.5,
            "bear": 0.2
        },
        "weighted_iv": 204.21,
        "weighted_upside": 54.5,
        "reasoning": "30% bull weight reflects strong AI differentiation potential and monetization runway, but tempered by execution risk. 50% base weight reflects most likely scenario of moderate deceleration with margin expansion. 20% bear weight reflects meaningful AI disruption risk and CFO transition concerns, but company's strong brand and cash position provide downside protection."
    },
    "key_assumptions_summary": {
        "revenue_growth": "Base case assumes deceleration from 35% to 15% over 5 years as DAU growth slows but ARPU expands",
        "fcf_margin": "Base case 30% FCF margins (vs 29% FY2024) driven by operating leverage, with downside risk from AI costs",
        "wacc": "Base 10% reflects profitable growth stage with execution risk; Bull 9% if AI differentiation succeeds; Bear 11.5% if competitive threats materialize",
        "terminal_growth": "Base 3% assumes mature EdTech leader above GDP growth; Bull 4% if TAM expansion succeeds; Bear 2% if commoditized",
        "key_risks": "DAU growth deceleration (30% in Q4 vs 54% in 2023), AI disruption from ChatGPT/Claude, low 8.8% conversion rate, CFO transition",
        "key_opportunities": "Max tier adoption (5% of subs, growing), international expansion (50%+ of revenue), new subjects (Chess growing fast), 91% penetration runway, operating leverage"
    },
    "scenario_comparison": {
        "base_vs_current": {
            "upside": 34.4,
            "implied_forward_pe": 20.9,
            "implied_ev_sales": 7.4,
            "notes": "Base case implies current valuation underestimates growth durability and margin expansion potential"
        },
        "bull_vs_current": {
            "upside": 145.7,
            "implied_forward_pe": 38.2,
            "implied_ev_sales": 14.4,
            "notes": "Bull case requires strong execution on AI differentiation, reacceleration of DAU growth, and margin expansion beyond guidance"
        },
        "bear_vs_current": {
            "downside": -30.2,
            "implied_forward_pe": 10.9,
            "implied_ev_sales": 3.3,
            "notes": "Bear case implies material downside if AI disruption accelerates. However, strong cash position ($1.1B) and no debt provide downside support."
        }
    },
    "valuation_context": {
        "current_market_cap": 6489,
        "current_ev": 5367,
        "current_ev_revenue_ttm": 5.2,
        "current_ev_revenue_fy2025e": 5.2,
        "current_price_to_iv_base": 0.74,
        "current_price_to_iv_weighted": 0.65,
        "notes": "Stock trading at ~5.2x forward sales, down from peak of ~20x in 2024. Base case IV of $178 implies 34% upside. Probability-weighted IV of $204 implies 55% upside, suggesting current price offers attractive entry for long-term investors with conviction in AI differentiation thesis."
    },
    "investment_recommendation": {
        "rating": "BUY",
        "confidence": "MODERATE",
        "time_horizon": "3-5 years",
        "rationale": "Duolingo is trading at a meaningful discount to its probability-weighted intrinsic value ($204 vs $132 current price), offering 55% potential upside. The company has a clear path to sustained high growth (25-35%) with margin expansion, driven by Max tier adoption, international expansion, and operating leverage. Strong balance sheet ($1.1B cash, no debt) provides downside protection. However, meaningful risks exist: DAU growth is decelerating significantly (30% in Q4 2025 vs 54% in 2023), AI disruption from ChatGPT/Claude is real, and the recent CFO departure raises execution concerns. The low 8.8% conversion rate suggests monetization challenges. For investors with 3-5 year horizon who believe in AI-powered differentiation and management's ability to navigate competitive threats, current valuation offers attractive risk/reward. Not suitable for investors concerned about near-term growth deceleration or AI disruption risk.",
        "entry_targets": {
            "aggressive": 145.0,
            "moderate": 125.0,
            "conservative": 100.0
        },
        "price_targets": {
            "12_month": 160.0,
            "24_month": 190.0,
            "36_month": 205.0
        },
        "stop_loss": {
            "level": 95.0,
            "trigger": "DAU growth turns negative, or AI disruption accelerates with subscriber churn"
        }
    }
};

        // Parse CSV
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
                return obj;
            });
        }

        const data = parseCSV(csvData);

        // Sort data chronologically (oldest first)
        data.sort((a, b) => {
            const parseDate = (p) => {
                const year = parseInt(p.match(/\d{4}/)?.[0] || '0');
                const isQ1 = p.includes('Q1');
                const isQ2 = p.includes('Q2');
                const isQ3 = p.includes('Q3');
                const isQ4 = p.includes('Q4');
                const isFY = p.startsWith('FY');
                const subOrder = isQ1 ? 1 : isQ2 ? 2 : isQ3 ? 4 : isQ4 ? 5 : isFY ? 7 : 0;
                return year * 10 + subOrder;
            };
            return parseDate(a.Period) - parseDate(b.Period);
        });

        // Filter for annual data
        const fyData = data.filter(d => d.Period.startsWith('FY'));

        // Color palette
        const colors = {
            primary: '#00d4aa',
            secondary: '#00b894',
            tertiary: '#0984e3',
            quaternary: '#6c5ce7',
            warning: '#fdcb6e',
            danger: '#ff6b6b'
        };

        // Chart defaults
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#e0e0e0', font: { size: 11 } } }
            },
            scales: {
                x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
        };

        // Toggle overview
        function toggleOverview() {
            const btn = document.querySelector('.overview-toggle');
            const content = document.getElementById('overviewContent');
            btn.classList.toggle('active');
            content.classList.toggle('active');
        }

        // Modal functions
        function openModal(key) {
            document.getElementById('modalTitle').textContent = metricDescriptions[key].title;
            document.getElementById('modalBody').innerHTML = metricDescriptions[key].content;
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay')) return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // Format numbers
        function formatNumber(num, decimals = 0) {
            if (!num || num === '' || isNaN(num)) return 'N/A';
            return parseFloat(num).toFixed(decimals);
        }

        function formatCurrency(num, decimals = 0) {
            if (!num || num === '' || isNaN(num)) return 'N/A';
            return '$' + parseFloat(num).toFixed(decimals) + 'M';
        }

        function calcYoYChange(current, previous) {
            if (!previous || !current || previous === '' || current === '') return null;
            return ((parseFloat(current) - parseFloat(previous)) / Math.abs(parseFloat(previous)) * 100).toFixed(1);
        }

        // Render Investment Overview
        function renderOverview() {
            const grid = document.getElementById('overviewGrid');

            // Company Overview
            let html = `<div class="overview-card">
                <h3>Company Overview</h3>
                <p>${analysis.overview}</p>
            </div>`;

            // Business Model
            html += `<div class="overview-card">
                <h3>Business Model</h3>
                <p>${analysis.business_model.summary}</p>
                <ul>
                    ${analysis.business_model.revenue_streams.map(s =>
                        `<li class="revenue-stream">
                            <span>${s.name}</span>
                            <span class="percent">${s.percent}%</span>
                        </li>`
                    ).join('')}
                </ul>
            </div>`;

            // Competitive Position
            html += `<div class="overview-card">
                <h3>Competitive Position</h3>
                <p><strong>Market Position:</strong> ${analysis.competitive_position.market_position}</p>
                <p><strong>Main Competitors:</strong> ${analysis.competitive_position.main_competitors.join(', ')}</p>
                <p><strong>Key Moat Factors:</strong></p>
                <ul>
                    ${analysis.competitive_position.moat_factors.map(m =>
                        `<li><strong>${m.factor}</strong> (${m.strength}): ${m.description}</li>`
                    ).join('')}
                </ul>
            </div>`;

            // Growth Drivers
            html += `<div class="overview-card">
                <h3>Growth Drivers</h3>
                <ul>
                    ${analysis.growth_drivers.map(d => `<li>${d}</li>`).join('')}
                </ul>
            </div>`;

            // Key Risks
            const allRisks = [
                ...(analysis.risks.business || []).map(r => ({...r, category: 'Business'})),
                ...(analysis.risks.financial || []).map(r => ({...r, category: 'Financial'})),
                ...(analysis.risks.regulatory || []).map(r => ({...r, category: 'Regulatory'})),
                ...(analysis.risks.macro || []).map(r => ({...r, category: 'Macro'})),
                ...(analysis.risks.execution || []).map(r => ({...r, category: 'Execution'}))
            ];
            html += `<div class="overview-card risks">
                <h3>Key Risks</h3>
                <ul>
                    ${allRisks.map(r =>
                        `<li>
                            <span class="risk-${r.severity.toLowerCase()}">[${r.severity.toUpperCase()}]</span>
                            <strong>${r.risk}</strong>: ${r.description}
                        </li>`
                    ).join('')}
                </ul>
            </div>`;

            // Bull Case
            html += `<div class="overview-card bull">
                <h3>Bull Case</h3>
                <ul>
                    ${analysis.bull_case.map(b => `<li>${b}</li>`).join('')}
                </ul>
            </div>`;

            // Bear Case
            html += `<div class="overview-card bear">
                <h3>Bear Case</h3>
                <ul>
                    ${analysis.bear_case.map(b => `<li>${b}</li>`).join('')}
                </ul>
            </div>`;

            // Recent Developments
            html += `<div class="overview-card">
                <h3>Recent Developments</h3>
                <ul>
                    ${analysis.recent_developments.map(d =>
                        `<li><strong>${d.date}:</strong> ${d.event}</li>`
                    ).join('')}
                </ul>
            </div>`;

            grid.innerHTML = html;
        }

        // Render KPI Cards
        function renderKPIs() {
            const latest = data[data.length - 1];
            const previous = data[data.length - 5] || data[data.length - 2];

            const kpis = [
                {
                    label: 'Q3 2025 Revenue',
                    value: formatCurrency(latest.Revenue),
                    change: calcYoYChange(latest.Revenue, previous.Revenue)
                },
                {
                    label: 'Daily Active Users',
                    value: latest.DAU + 'M',
                    change: calcYoYChange(latest.DAU, previous.DAU)
                },
                {
                    label: 'Paid Subscribers',
                    value: latest.Subscribers + 'M',
                    change: calcYoYChange(latest.Subscribers, previous.Subscribers)
                },
                {
                    label: 'Free Cash Flow',
                    value: formatCurrency(latest.FreeCashFlow),
                    change: calcYoYChange(latest.FreeCashFlow, previous.FreeCashFlow)
                },
                {
                    label: 'Gross Margin',
                    value: formatNumber(latest.GrossMargin, 1) + '%',
                    change: (parseFloat(latest.GrossMargin) - parseFloat(previous.GrossMargin)).toFixed(1)
                },
                {
                    label: 'Operating Margin',
                    value: formatNumber(latest.OperatingMargin, 1) + '%',
                    change: (parseFloat(latest.OperatingMargin) - parseFloat(previous.OperatingMargin)).toFixed(1)
                },
                {
                    label: 'Subscriber Penetration',
                    value: (parseFloat(latest.Subscribers) / parseFloat(latest.MAU) * 100).toFixed(1) + '%',
                    change: ((parseFloat(latest.Subscribers) / parseFloat(latest.MAU) * 100) -
                             (parseFloat(previous.Subscribers) / parseFloat(previous.MAU) * 100)).toFixed(1)
                },
                {
                    label: 'DAU/MAU Ratio',
                    value: (parseFloat(latest.DAU) / parseFloat(latest.MAU) * 100).toFixed(1) + '%',
                    change: ((parseFloat(latest.DAU) / parseFloat(latest.MAU) * 100) -
                             (parseFloat(previous.DAU) / parseFloat(previous.MAU) * 100)).toFixed(1)
                }
            ];

            const grid = document.getElementById('kpiGrid');
            grid.innerHTML = kpis.map(kpi => {
                const changeClass = kpi.change > 0 ? 'positive' : kpi.change < 0 ? 'negative' : '';
                const changeSymbol = kpi.change > 0 ? '+' : '';
                return `
                    <div class="kpi-card">
                        <div class="kpi-value">${kpi.value}</div>
                        <div class="kpi-label">${kpi.label}</div>
                        ${kpi.change !== null ? `<div class="kpi-change ${changeClass}">${changeSymbol}${kpi.change}% YoY</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Render Guidance
        function renderGuidance() {
            if (!analysis.guidance || !analysis.guidance.items || analysis.guidance.items.length === 0) {
                document.getElementById('guidanceSection').style.display = 'none';
                return;
            }

            const guidance = analysis.guidance;
            document.getElementById('guidanceAsOf').textContent = guidance.as_of || '';
            document.getElementById('guidanceFY').textContent = guidance.fiscal_year || '';

            const grid = document.getElementById('guidanceGrid');
            grid.innerHTML = guidance.items.map(item => {
                const vsClass = item.vs_prior ? item.vs_prior.toLowerCase().replace('/', '\\/') : 'new';
                const vsLabel = item.vs_prior ? item.vs_prior.charAt(0).toUpperCase() + item.vs_prior.slice(1) : 'New';
                return `
                    <div class="guidance-card">
                        <div class="guidance-metric">${item.metric}</div>
                        <div class="guidance-target">${item.target}</div>
                        <div class="guidance-period">${item.period}</div>
                        <span class="guidance-vs-prior ${vsClass}">${vsLabel}</span>
                        ${item.notes ? `<div class="guidance-notes">${item.notes}</div>` : ''}
                    </div>
                `;
            }).join('');

            const commentary = document.getElementById('guidanceCommentary');
            if (guidance.management_commentary) {
                commentary.textContent = guidance.management_commentary;
                commentary.style.display = 'block';
            } else {
                commentary.style.display = 'none';
            }
        }

        // Render Charts
        function renderCharts() {
            // Revenue Growth
            new Chart(document.getElementById('revenueChart'), {
                type: 'bar',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [{
                        label: 'Revenue ($M)',
                        data: fyData.map(d => parseFloat(d.Revenue)),
                        backgroundColor: colors.primary,
                        borderRadius: 6
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, beginAtZero: true }
                    }
                }
            });

            // Profitability Trend
            new Chart(document.getElementById('profitabilityChart'), {
                type: 'line',
                data: {
                    labels: data.filter(d => d.Period.startsWith('Q')).map(d => d.Period),
                    datasets: [
                        {
                            label: 'Operating Income ($M)',
                            data: data.filter(d => d.Period.startsWith('Q')).map(d => parseFloat(d.OperatingIncome)),
                            borderColor: colors.primary,
                            backgroundColor: colors.primary + '20',
                            tension: 0.3
                        },
                        {
                            label: 'Net Income ($M)',
                            data: data.filter(d => d.Period.startsWith('Q')).map(d => parseFloat(d.NetIncome)),
                            borderColor: colors.tertiary,
                            backgroundColor: colors.tertiary + '20',
                            tension: 0.3
                        }
                    ]
                },
                options: chartDefaults
            });

            // Free Cash Flow
            new Chart(document.getElementById('fcfChart'), {
                type: 'bar',
                data: {
                    labels: data.filter(d => d.FreeCashFlow && d.FreeCashFlow !== '').map(d => d.Period),
                    datasets: [{
                        label: 'Free Cash Flow ($M)',
                        data: data.filter(d => d.FreeCashFlow && d.FreeCashFlow !== '').map(d => parseFloat(d.FreeCashFlow)),
                        backgroundColor: colors.secondary,
                        borderRadius: 6
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, beginAtZero: true }
                    }
                }
            });

            // Margins
            new Chart(document.getElementById('marginsChart'), {
                type: 'line',
                data: {
                    labels: data.filter(d => d.Period.startsWith('Q')).map(d => d.Period),
                    datasets: [
                        {
                            label: 'Gross Margin (%)',
                            data: data.filter(d => d.Period.startsWith('Q')).map(d => parseFloat(d.GrossMargin)),
                            borderColor: colors.primary,
                            tension: 0.3
                        },
                        {
                            label: 'Operating Margin (%)',
                            data: data.filter(d => d.Period.startsWith('Q')).map(d => parseFloat(d.OperatingMargin)),
                            borderColor: colors.tertiary,
                            tension: 0.3
                        }
                    ]
                },
                options: chartDefaults
            });

            // DAU
            new Chart(document.getElementById('dauChart'), {
                type: 'line',
                data: {
                    labels: data.filter(d => d.DAU && d.DAU !== '').map(d => d.Period),
                    datasets: [{
                        label: 'Daily Active Users (M)',
                        data: data.filter(d => d.DAU && d.DAU !== '').map(d => parseFloat(d.DAU)),
                        borderColor: colors.primary,
                        backgroundColor: colors.primary + '20',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: chartDefaults
            });

            // MAU
            new Chart(document.getElementById('mauChart'), {
                type: 'line',
                data: {
                    labels: data.filter(d => d.MAU && d.MAU !== '').map(d => d.Period),
                    datasets: [{
                        label: 'Monthly Active Users (M)',
                        data: data.filter(d => d.MAU && d.MAU !== '').map(d => parseFloat(d.MAU)),
                        borderColor: colors.tertiary,
                        backgroundColor: colors.tertiary + '20',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: chartDefaults
            });

            // Subscribers
            new Chart(document.getElementById('subscribersChart'), {
                type: 'bar',
                data: {
                    labels: data.filter(d => d.Subscribers && d.Subscribers !== '').map(d => d.Period),
                    datasets: [{
                        label: 'Paid Subscribers (M)',
                        data: data.filter(d => d.Subscribers && d.Subscribers !== '').map(d => parseFloat(d.Subscribers)),
                        backgroundColor: colors.quaternary,
                        borderRadius: 6
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, beginAtZero: true }
                    }
                }
            });

            // Engagement Ratio
            new Chart(document.getElementById('engagementChart'), {
                type: 'line',
                data: {
                    labels: data.filter(d => d.DAU && d.MAU && d.DAU !== '' && d.MAU !== '').map(d => d.Period),
                    datasets: [{
                        label: 'DAU/MAU Ratio (%)',
                        data: data.filter(d => d.DAU && d.MAU && d.DAU !== '' && d.MAU !== '').map(d =>
                            (parseFloat(d.DAU) / parseFloat(d.MAU) * 100).toFixed(1)
                        ),
                        borderColor: colors.warning,
                        backgroundColor: colors.warning + '20',
                        tension: 0.3
                    }]
                },
                options: chartDefaults
            });

            // Bookings
            new Chart(document.getElementById('bookingsChart'), {
                type: 'bar',
                data: {
                    labels: data.filter(d => d.Bookings && d.Bookings !== '').map(d => d.Period),
                    datasets: [{
                        label: 'Bookings ($M)',
                        data: data.filter(d => d.Bookings && d.Bookings !== '').map(d => parseFloat(d.Bookings)),
                        backgroundColor: colors.primary,
                        borderRadius: 6
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, beginAtZero: true }
                    }
                }
            });

            // Subscription Bookings
            new Chart(document.getElementById('subBookingsChart'), {
                type: 'bar',
                data: {
                    labels: data.filter(d => d.SubscriptionBookings && d.SubscriptionBookings !== '').map(d => d.Period),
                    datasets: [{
                        label: 'Subscription Bookings ($M)',
                        data: data.filter(d => d.SubscriptionBookings && d.SubscriptionBookings !== '').map(d => parseFloat(d.SubscriptionBookings)),
                        backgroundColor: colors.secondary,
                        borderRadius: 6
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, beginAtZero: true }
                    }
                }
            });

            // ARPU
            const arpuData = data.filter(d => d.Bookings && d.Subscribers && d.Bookings !== '' && d.Subscribers !== '');
            new Chart(document.getElementById('arpuChart'), {
                type: 'line',
                data: {
                    labels: arpuData.map(d => d.Period),
                    datasets: [{
                        label: 'ARPU ($)',
                        data: arpuData.map(d => (parseFloat(d.Bookings) / parseFloat(d.Subscribers)).toFixed(2)),
                        borderColor: colors.quaternary,
                        backgroundColor: colors.quaternary + '20',
                        tension: 0.3
                    }]
                },
                options: chartDefaults
            });

            // Conversion Rate
            const conversionData = data.filter(d => d.Subscribers && d.MAU && d.Subscribers !== '' && d.MAU !== '');
            new Chart(document.getElementById('conversionChart'), {
                type: 'line',
                data: {
                    labels: conversionData.map(d => d.Period),
                    datasets: [{
                        label: 'Subscriber Conversion (%)',
                        data: conversionData.map(d => (parseFloat(d.Subscribers) / parseFloat(d.MAU) * 100).toFixed(2)),
                        borderColor: colors.tertiary,
                        backgroundColor: colors.tertiary + '20',
                        tension: 0.3
                    }]
                },
                options: chartDefaults
            });
        }

        // DCF Functions
        let currentScenario = 'base';

        function initDCF() {
            if (!dcfData || !dcfData.valuation) return;

            // Set current price
            document.getElementById('dcfCurrent').textContent = '$' + dcfData.current_price.toFixed(2);

            // Show warning if growth diverges
            if (dcfData.historical_growth.growth_divergence_warning) {
                document.getElementById('growthWarning').style.display = 'flex';
                document.getElementById('warningText').textContent = dcfData.historical_growth.growth_divergence_warning;
            }

            // Set slider defaults from base case
            const base = dcfData.assumptions.base;
            document.getElementById('growthSlider').value = dcfData.historical_growth.selected_growth_rate;
            document.getElementById('waccSlider').value = base.wacc;
            document.getElementById('terminalSlider').value = base.terminal_growth;

            document.getElementById('growthValue').textContent = dcfData.historical_growth.selected_growth_rate + '%';
            document.getElementById('waccValue').textContent = base.wacc + '%';
            document.getElementById('terminalValue').textContent = base.terminal_growth + '%';

            document.getElementById('growthHint').textContent =
                'Based on ' + dcfData.historical_growth.growth_rate_source.replace(/_/g, ' ');

            renderDCFInputs();
            renderHistoricalGrowth();
            renderSensitivityMatrix();
            updateDCFDisplay();
            switchScenario('base');
        }

        function renderDCFInputs() {
            const inputs = dcfData.inputs;
            const currency = inputs.currency || '$';
            const units = inputs.units === 'millions' ? 'M' : inputs.units === 'billions' ? 'B' : '';

            const formatNum = (n) => {
                if (Math.abs(n) >= 1000) return currency + (n/1000).toFixed(1) + 'B';
                return currency + n.toFixed(0) + units;
            };

            document.getElementById('baseFCF').textContent = formatNum(inputs.last_fcf);

            const shares = inputs.shares_outstanding;
            document.getElementById('sharesOut').textContent = shares >= 1000 ? (shares/1000).toFixed(2) + 'B' : shares.toFixed(1) + 'M';

            const netDebt = inputs.net_debt;
            const netDebtEl = document.getElementById('netDebt');
            netDebtEl.textContent = (netDebt < 0 ? '-' : '') + formatNum(Math.abs(netDebt));
            if (netDebt < 0) netDebtEl.style.color = '#00d4aa';

            renderFCFProjections();
        }

        function renderFCFProjections() {
            const startGrowth = parseFloat(document.getElementById('growthSlider')?.value || dcfData.historical_growth.selected_growth_rate);
            const baseFCF = dcfData.inputs.last_fcf;
            const currency = dcfData.inputs.currency || '$';

            const formatFCF = (n) => {
                if (Math.abs(n) >= 1000) return currency + (n/1000).toFixed(1) + 'B';
                return currency + n.toFixed(0) + 'M';
            };

            const endGrowth = 10;
            const growthRates = [];
            for (let i = 0; i < 5; i++) {
                const rate = startGrowth > endGrowth
                    ? startGrowth - (startGrowth - endGrowth) * (i / 4)
                    : startGrowth;
                growthRates.push(rate);
            }

            let fcf = baseFCF;
            const fcfValues = [baseFCF];

            for (let i = 0; i < 5; i++) {
                fcf = fcf * (1 + growthRates[i] / 100);
                fcfValues.push(fcf);
            }

            let html = `
                <div class="fcf-projection-item header">Base</div>
                <div class="fcf-projection-item header">Year 1</div>
                <div class="fcf-projection-item header">Year 2</div>
                <div class="fcf-projection-item header">Year 3</div>
                <div class="fcf-projection-item header">Year 4</div>
                <div class="fcf-projection-item header">Year 5</div>
            `;

            html += `<div class="fcf-projection-item">
                <div class="fcf-value">${formatFCF(fcfValues[0])}</div>
                <div class="growth-rate">-</div>
            </div>`;

            for (let i = 1; i <= 5; i++) {
                html += `<div class="fcf-projection-item">
                    <div class="fcf-value">${formatFCF(fcfValues[i])}</div>
                    <div class="growth-rate">+${growthRates[i-1].toFixed(0)}%</div>
                </div>`;
            }

            document.getElementById('fcfProjectionTable').innerHTML = html;
        }

        function calculateDCF(startGrowth, wacc, terminalGrowth) {
            const years = 5;
            const fcf = dcfData.inputs.last_fcf;
            let pvFCF = 0;
            let projectedFCF = fcf;

            const endGrowth = 10;

            for (let i = 0; i < years; i++) {
                const yearGrowth = startGrowth > endGrowth
                    ? startGrowth - (startGrowth - endGrowth) * (i / 4)
                    : startGrowth;
                projectedFCF *= (1 + yearGrowth / 100);
                pvFCF += projectedFCF / Math.pow(1 + wacc/100, i + 1);
            }

            const terminalFCF = projectedFCF * (1 + terminalGrowth/100);
            const terminalValue = terminalFCF / (wacc/100 - terminalGrowth/100);
            const pvTerminal = terminalValue / Math.pow(1 + wacc/100, years);

            const enterpriseValue = pvFCF + pvTerminal;
            const equityValue = enterpriseValue - dcfData.inputs.net_debt;
            const iv = equityValue / dcfData.inputs.shares_outstanding;

            const terminalPerShare = terminalValue / dcfData.inputs.shares_outstanding;
            const entryPrice = terminalPerShare / Math.pow(1.15, years);

            return {
                iv: iv,
                entryPrice: entryPrice,
                terminalPerShare: terminalPerShare,
                pvFCF: pvFCF,
                pvTerminal: pvTerminal,
                enterpriseValue: enterpriseValue
            };
        }

        window.updateDCFDisplay = function() {
            const growth = parseFloat(document.getElementById('growthSlider').value);
            const wacc = parseFloat(document.getElementById('waccSlider').value);
            const terminal = parseFloat(document.getElementById('terminalSlider').value);

            document.getElementById('growthValue').textContent = growth + '%';
            document.getElementById('waccValue').textContent = wacc + '%';
            document.getElementById('terminalValue').textContent = terminal + '%';

            renderFCFProjections();

            const result = calculateDCF(growth, wacc, terminal);

            document.getElementById('dcfIV').textContent = '$' + result.iv.toFixed(0);
            document.getElementById('dcfEntry').textContent = '$' + result.entryPrice.toFixed(0);

            const upside = ((result.iv - dcfData.current_price) / dcfData.current_price * 100);
            const upsideEl = document.getElementById('dcfUpside');
            upsideEl.textContent = (upside >= 0 ? '+' : '') + upside.toFixed(0) + '% ' + (upside >= 0 ? 'upside' : 'downside');
            upsideEl.className = 'dcf-change ' + (upside >= 0 ? 'positive' : 'negative');

            document.getElementById('dcfWeighted').textContent = '$' + dcfData.probability_weighted.weighted_iv.toFixed(0);

            const grid = document.getElementById('assumptionGrid');
            if (grid) {
                grid.innerHTML = `
                    <div class="assumption-item">
                        <div class="label">Growth Rate</div>
                        <div class="value">${growth}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">WACC</div>
                        <div class="value">${wacc}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Terminal Growth</div>
                        <div class="value">${terminal}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Intrinsic Value</div>
                        <div class="value" style="color: #00d4aa;">$${result.iv.toFixed(0)}</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Entry Price</div>
                        <div class="value" style="color: #00d4aa;">$${result.entryPrice.toFixed(0)}</div>
                    </div>
                `;
            }
        };

        window.switchScenario = function(scenario) {
            currentScenario = scenario;

            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === scenario);
            });

            const assumptions = dcfData.assumptions[scenario];
            const valuation = dcfData.valuation[scenario];

            renderFCFProjections();

            document.getElementById('growthSlider').value = assumptions.growth_rates[0];
            document.getElementById('waccSlider').value = assumptions.wacc;
            document.getElementById('terminalSlider').value = assumptions.terminal_growth;

            const grid = document.getElementById('assumptionGrid');
            grid.innerHTML = `
                <div class="assumption-item">
                    <div class="label">Year 1 Growth</div>
                    <div class="value">${assumptions.growth_rates[0]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Year 5 Growth</div>
                    <div class="value">${assumptions.growth_rates[4]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">FCF Margin</div>
                    <div class="value">${assumptions.fcf_margin}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">WACC</div>
                    <div class="value">${assumptions.wacc}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Terminal Growth</div>
                    <div class="value">${assumptions.terminal_growth}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Intrinsic Value</div>
                    <div class="value" style="color: #00d4aa;">$${valuation.intrinsic_value.toFixed(0)}</div>
                </div>
            `;

            updateDCFDisplay();
        };

        function renderHistoricalGrowth() {
            const growth = dcfData.historical_growth;
            const selectedSource = growth.growth_rate_source;
            const grid = document.getElementById('growthGrid');

            const metrics = [
                { key: 'revenue_2yr_cagr', label: 'Revenue 2Y' },
                { key: 'revenue_3yr_cagr', label: 'Revenue 3Y' },
                { key: 'eps_2yr_cagr', label: 'EPS 2Y' },
                { key: 'eps_3yr_cagr', label: 'EPS 3Y' },
                { key: 'equity_1yr_cagr', label: 'Equity 1Y' },
                { key: 'equity_annualized_cagr', label: 'Equity Ann.' },
                { key: 'fcf_2yr_cagr', label: 'FCF 2Y' },
                { key: 'fcf_3yr_cagr', label: 'FCF 3Y' }
            ];

            grid.innerHTML = metrics.map(m => {
                const rate = growth[m.key];
                if (rate === null) return '';
                const isSelected = m.key === selectedSource;
                const colorClass = rate >= 0 ? 'positive' : 'negative';
                return `
                    <div class="growth-item ${isSelected ? 'selected' : ''}">
                        <div class="metric">${m.label}</div>
                        <div class="rate ${colorClass}">${rate >= 0 ? '+' : ''}${rate.toFixed(1)}%</div>
                    </div>
                `;
            }).filter(s => s !== '').join('');
        }

        function renderSensitivityMatrix() {
            const sens = dcfData.sensitivity;
            const table = document.getElementById('sensitivityMatrix');
            const currentPrice = dcfData.current_price;

            let html = '<tr><th>WACC \\ Term G</th>';
            sens.terminal_growth_range.forEach(tg => {
                html += `<th>${tg}%</th>`;
            });
            html += '</tr>';

            sens.wacc_range.forEach((wacc, i) => {
                html += `<tr><th>${wacc}%</th>`;
                sens.matrix[i].forEach((val, j) => {
                    const isHighlight = wacc === dcfData.assumptions.base.wacc &&
                                       sens.terminal_growth_range[j] === dcfData.assumptions.base.terminal_growth;
                    const colorClass = val >= currentPrice ? 'above-current' : 'below-current';
                    html += `<td class="${isHighlight ? 'highlight' : colorClass}">$${val.toFixed(0)}</td>`;
                });
                html += '</tr>';
            });

            table.innerHTML = html;
        }

        // Metric Descriptions
        const metricDescriptions = {
            revenue: {
                title: "Revenue",
                content: `
                    <p><strong>Revenue</strong> is Duolingo's total income from subscriptions (81%), advertising (15%), English Test (3%), and in-app purchases (1%).</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> Revenue grew 41% YoY in Q3 2025 to $271.7M. The company is transitioning from pure advertising-driven (mobile gaming) to subscription-dominated (SaaS), which drives higher margins and more predictable cash flows.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Subscription mix shift driving higher-quality revenue</li>
                        <li>Growth deceleration from 42% CAGR baseline</li>
                        <li>Impact of AI investments on monetization</li>
                    </ul>
                `
            },
            profitability: {
                title: "Profitability Trend",
                content: `
                    <p><strong>Operating Income</strong> and <strong>Net Income</strong> show Duolingo's path to sustainable profitability.</p>
                    <div class="metric-highlight">
                        <strong>Key Inflection:</strong> Duolingo turned consistently profitable in 2023-2024. Q4 2024 operating income was $13.9M (6.6% margin), up from losses in 2022. However, Q3 2025 net income of $292.2M includes $222.7M one-time tax benefit.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Operating margin expansion toward 15%+ (SaaS-like profile)</li>
                        <li>AI costs impacting gross margins (down 50 bps in FY2024)</li>
                        <li>Management guiding to "more measured" margin expansion in 2025</li>
                    </ul>
                `
            },
            fcf: {
                title: "Free Cash Flow",
                content: `
                    <p><strong>Free Cash Flow (FCF)</strong> is operating cash flow minus capital expenditures. It represents cash available for growth, acquisitions, or shareholder returns.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> TTM FCF is $289.6M (Q4 2024 + Q1-Q3 2025), representing ~39% FCF margin. Q4 2024 was exceptionally strong at $87.8M on $209.6M revenue (42% margin).
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>FCF margin sustainability above 30% as AI costs increase</li>
                        <li>Capital allocation: currently holding $960M net cash</li>
                        <li>FCF growth CAGR of 72.3% (3-year) is not sustainable</li>
                    </ul>
                `
            },
            margins: {
                title: "Profit Margins",
                content: `
                    <p><strong>Gross Margin</strong> and <strong>Operating Margin</strong> show profitability at different levels of the income statement.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> Gross margin is 72.5% (Q3 2025), down from 73%+ in 2023-2024 due to AI costs. Operating margin is 13.0% (Q3 2025), up from negative in 2022.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Gross margin pressure from Video Call (GPT-4 costs)</li>
                        <li>Operating leverage as revenue scales faster than costs</li>
                        <li>Path to 20%+ operating margins (typical for SaaS)</li>
                    </ul>
                `
            },
            dau: {
                title: "Daily Active Users (DAU)",
                content: `
                    <p><strong>DAU</strong> measures users who engage with Duolingo daily. It's the primary growth metric for the business.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> 50.5M DAUs in Q3 2025 (+36% YoY). However, growth is decelerating: 40% in Q2 â†’ 36% in Q3 â†’ ~30% in Q4 (preliminary). QoQ growth slowed from 15% in Q1 to 4% in Q4.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>DAU growth deceleration signaling market saturation</li>
                        <li>Impact of Energy feature and Chess expansion on engagement</li>
                        <li>Wells Fargo cut price target citing weaker DAU trends</li>
                    </ul>
                `
            },
            mau: {
                title: "Monthly Active Users (MAU)",
                content: `
                    <p><strong>MAU</strong> measures users who engage at least once per month. It's a broader engagement metric.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> 135.3M MAUs in Q3 2025. DAU/MAU ratio of 37.3% shows strong engagement compared to typical social apps (20-30%).
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>MAU growth sustainability</li>
                        <li>DAU/MAU ratio as indicator of habit formation</li>
                        <li>Conversion of MAU to paid subscribers (currently 8.5%)</li>
                    </ul>
                `
            },
            subscribers: {
                title: "Paid Subscribers",
                content: `
                    <p><strong>Paid Subscribers</strong> pay for Super ($9/month) or Max ($20/month) tiers. This is the primary monetization driver.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> 11.5M paid subscribers in Q3 2025 (+35% YoY). Only 8.5% of MAU are paying, indicating massive monetization runway but also suggesting weak value proposition.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Subscriber penetration rate (target: 10-12%+)</li>
                        <li>Max tier adoption (5% of subscribers by Q4 2024)</li>
                        <li>ARPU growth from mix shift to higher-priced tiers</li>
                    </ul>
                `
            },
            engagement: {
                title: "DAU/MAU Engagement Ratio",
                content: `
                    <p>The <strong>DAU/MAU Ratio</strong> measures daily engagement as a percentage of monthly users. Higher = stickier product.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> 37.3% in Q3 2025, up from 34.7% in Q4 2024. This is exceptionally high for education apps and shows gamification success. Over 10M users maintain year-long streaks.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Ratio sustainability above 35% as user base scales</li>
                        <li>Impact of Energy feature (replacing Hearts)</li>
                        <li>Correlation between engagement and subscriber conversion</li>
                    </ul>
                `
            },
            bookings: {
                title: "Bookings Growth",
                content: `
                    <p><strong>Bookings</strong> represent cash collected from customers (subscriptions + ads + tests + IAP). It's a leading indicator of revenue.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> $313.6M bookings in Q3 2025 (+38% YoY). FY2025 guidance is $1,151-1,157M (raised from prior guidance), representing 32%+ YoY growth.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Bookings growth deceleration trajectory</li>
                        <li>FX headwinds (every 1% dollar move = $1M quarterly impact)</li>
                        <li>Q4 2025 preliminary results at or above high end of guidance</li>
                    </ul>
                `
            },
            subBookings: {
                title: "Subscription Bookings",
                content: `
                    <p><strong>Subscription Bookings</strong> isolate the highest-quality, recurring revenue stream (81% of total).</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> $268.9M subscription bookings in Q3 2025. Mix shift to subscriptions drives margin expansion and valuation multiple.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Subscription bookings growth vs DAU growth (monetization efficiency)</li>
                        <li>ARPU growth from Max tier adoption</li>
                        <li>Family Plan expansion impact</li>
                    </ul>
                `
            },
            arpu: {
                title: "Average Revenue Per User (ARPU)",
                content: `
                    <p><strong>ARPU</strong> is bookings divided by paid subscribers. It measures pricing power and mix shift.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> ARPU growing 6-7% YoY, driven by mix shift to Max ($20/month) and Family Plan. Max tier reached 5% of subscribers by Q4 2024.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>ARPU acceleration from Max tier adoption (target: 10%+)</li>
                        <li>Price increases (last increase in 2023)</li>
                        <li>International pricing optimization</li>
                    </ul>
                `
            },
            conversion: {
                title: "Subscriber Conversion Rate",
                content: `
                    <p><strong>Conversion Rate</strong> is paid subscribers divided by MAU. It measures product value perception.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> 8.5% in Q3 2025, up slightly from 8.1% in Q4 2024. This is low compared to other subscription apps (10-15%+), suggesting either weak value proposition or massive monetization runway.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Conversion rate trajectory toward 10%+</li>
                        <li>Impact of CEO's Q3 statement prioritizing growth over monetization</li>
                        <li>Max tier differentiation driving conversion</li>
                    </ul>
                `
            }
        };

        // Initialize
        renderOverview();
        renderKPIs();
        renderGuidance();
        renderCharts();
        initDCF();

        // Bind slider events
        (function() {
            var growthSlider = document.getElementById('growthSlider');
            var waccSlider = document.getElementById('waccSlider');
            var terminalSlider = document.getElementById('terminalSlider');

            if (growthSlider) {
                growthSlider.oninput = window.updateDCFDisplay;
                growthSlider.onchange = window.updateDCFDisplay;
            }
            if (waccSlider) {
                waccSlider.oninput = window.updateDCFDisplay;
                waccSlider.onchange = window.updateDCFDisplay;
            }
            if (terminalSlider) {
                terminalSlider.oninput = window.updateDCFDisplay;
                terminalSlider.onchange = window.updateDCFDisplay;
            }
        })();
    </script>
</body>
</html>
