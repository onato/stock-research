<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duolingo (DUOL) Financial Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4aa, #00b894);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .header p {
            color: #888;
            font-size: 1.1rem;
        }
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        .kpi-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 170, 0.2);
        }
        .kpi-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 5px;
        }
        .kpi-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .kpi-change {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .kpi-change.positive { color: #00d4aa; }
        .kpi-change.negative { color: #ff6b6b; }
        /* Guidance Section */
        .guidance-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .guidance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .guidance-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .guidance-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .guidance-meta {
            font-size: 0.85rem;
            color: #888;
        }
        .guidance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .guidance-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease;
        }
        .guidance-card:hover {
            transform: translateY(-2px);
        }
        .guidance-metric {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .guidance-target {
            font-size: 1.4rem;
            font-weight: 600;
            color: #00d4aa;
            margin-bottom: 6px;
        }
        .guidance-period {
            font-size: 0.85rem;
            color: #e0e0e0;
            margin-bottom: 8px;
        }
        .guidance-vs-prior {
            display: inline-block;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        .guidance-vs-prior.raised {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
        }
        .guidance-vs-prior.lowered, .guidance-vs-prior.decelerated {
            background: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
        }
        .guidance-vs-prior.maintained {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }
        .guidance-vs-prior.met\/exceeded {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
        }
        .guidance-notes {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }
        .guidance-commentary {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 16px 20px;
            border-left: 3px solid #00d4aa;
            font-style: italic;
            color: #b0b0b0;
            line-height: 1.6;
        }
        .guidance-commentary::before {
            content: '"';
            font-size: 1.5rem;
            color: #00d4aa;
            margin-right: 4px;
        }
        .section-title {
            font-size: 1.5rem;
            color: #fff;
            margin: 40px auto 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0, 212, 170, 0.3);
            max-width: 1400px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .chart-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .help-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(0, 212, 170, 0.2);
            border: 1px solid #00d4aa;
            color: #00d4aa;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .help-btn:hover {
            background: #00d4aa;
            color: #1a1a2e;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: linear-gradient(135deg, #1e2a4a 0%, #16213e 100%);
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 212, 170, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 {
            color: #00d4aa;
            font-size: 1.4rem;
            margin: 0;
        }
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: #ff6b6b;
            color: #fff;
        }
        .modal-body {
            padding: 25px;
            line-height: 1.7;
        }
        .modal-body p { margin-bottom: 15px; }
        .modal-body strong { color: #00d4aa; }
        .modal-body ul { margin: 15px 0; padding-left: 20px; }
        .modal-body li { margin-bottom: 8px; }
        .metric-highlight {
            background: rgba(0, 212, 170, 0.1);
            border-left: 3px solid #00d4aa;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        /* Investment Overview Section */
        .overview-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .overview-toggle {
            width: 100%;
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid rgba(0, 212, 170, 0.3);
            border-radius: 12px;
            padding: 16px 24px;
            color: #00d4aa;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        .overview-toggle:hover {
            background: rgba(0, 212, 170, 0.2);
        }
        .overview-toggle .arrow {
            transition: transform 0.3s ease;
        }
        .overview-toggle.active .arrow {
            transform: rotate(180deg);
        }
        .overview-content {
            display: none;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            margin-top: -12px;
        }
        .overview-content.active {
            display: block;
        }
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        .overview-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .overview-card h3 {
            color: #00d4aa;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .overview-card p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        .overview-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .overview-card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            line-height: 1.5;
        }
        .overview-card li:last-child {
            border-bottom: none;
        }
        .overview-card.bull h3 { color: #00d4aa; }
        .overview-card.bear h3 { color: #ff6b6b; }
        .overview-card.risks h3 { color: #fdcb6e; }
        .risk-high { color: #ff6b6b; }
        .risk-moderate { color: #fdcb6e; }
        .risk-low { color: #00d4aa; }
        .revenue-stream {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .revenue-stream .percent {
            color: #00d4aa;
            font-weight: 600;
        }
        .trend-growing { color: #00d4aa; }
        .trend-stable { color: #888; }
        .trend-declining { color: #ff6b6b; }

        /* DCF Valuation Section */
        .dcf-section {
            max-width: 1400px;
            margin: 0 auto 40px;
        }
        .dcf-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dcf-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }
        .dcf-card:hover {
            transform: translateY(-3px);
        }
        .dcf-card.highlight {
            background: rgba(0, 212, 170, 0.1);
            border-color: rgba(0, 212, 170, 0.3);
        }
        .dcf-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .dcf-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #00d4aa;
        }
        .dcf-card:not(.highlight) .dcf-value {
            color: #fff;
        }
        .dcf-change {
            font-size: 1rem;
            margin-top: 8px;
            font-weight: 600;
        }
        .dcf-change.positive { color: #00d4aa; }
        .dcf-change.negative { color: #ff6b6b; }
        .dcf-sublabel {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
        }
        .dcf-warning {
            background: rgba(253, 203, 110, 0.15);
            border: 1px solid rgba(253, 203, 110, 0.4);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fdcb6e;
        }
        .warning-icon {
            font-size: 1.2rem;
        }
        /* DCF Inputs Display */
        .dcf-inputs {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .dcf-inputs h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        .dcf-inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .dcf-input-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .dcf-input-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .dcf-input-value {
            font-size: 1.3rem;
            font-weight: 600;
            color: #00d4aa;
        }
        .dcf-input-note {
            font-size: 0.7rem;
            color: #666;
            margin-top: 4px;
        }
        .fcf-projections h5 {
            color: #b0b0b0;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .fcf-projection-table {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 12px;
        }
        .fcf-projection-item {
            text-align: center;
        }
        .fcf-projection-item.header {
            font-size: 0.75rem;
            color: #888;
            font-weight: 600;
        }
        .fcf-projection-item .year {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 2px;
        }
        .fcf-projection-item .fcf-value {
            font-size: 1rem;
            color: #e0e0e0;
            font-weight: 500;
        }
        .fcf-projection-item .growth-rate {
            font-size: 0.75rem;
            color: #00d4aa;
            margin-top: 2px;
        }
        .dcf-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .slider-group label {
            font-size: 0.95rem;
            color: #e0e0e0;
            display: flex;
            justify-content: space-between;
        }
        .slider-group label span {
            color: #00d4aa;
            font-weight: 600;
        }
        .slider-group input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        .slider-hint {
            font-size: 0.8rem;
            color: #666;
        }
        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .scenario-tab {
            padding: 10px 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: #888;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .scenario-tab:hover {
            border-color: rgba(0, 212, 170, 0.5);
            color: #e0e0e0;
        }
        .scenario-tab.active {
            background: rgba(0, 212, 170, 0.15);
            border-color: #00d4aa;
            color: #00d4aa;
        }
        .scenario-details {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .scenario-details h4 {
            color: #00d4aa;
            margin-bottom: 15px;
        }
        .assumption-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .assumption-item {
            text-align: center;
        }
        .assumption-item .label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
        }
        .assumption-item .value {
            font-size: 1.1rem;
            color: #e0e0e0;
            font-weight: 500;
        }
        .sensitivity-section {
            margin-bottom: 30px;
        }
        .sensitivity-section h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .sensitivity-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            overflow: hidden;
        }
        .sensitivity-table th,
        .sensitivity-table td {
            padding: 12px 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .sensitivity-table th {
            background: rgba(0, 212, 170, 0.1);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td {
            color: #e0e0e0;
        }
        .sensitivity-table td.highlight {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td.below-current {
            color: #ff6b6b;
        }
        .sensitivity-table td.above-current {
            color: #00d4aa;
        }
        .historical-growth {
            margin-bottom: 30px;
        }
        .historical-growth h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .growth-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }
        .growth-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .growth-item .metric {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 6px;
        }
        .growth-item .rate {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .growth-item .rate.positive { color: #00d4aa; }
        .growth-item .rate.negative { color: #ff6b6b; }
        .growth-item.selected {
            border-color: #00d4aa;
            background: rgba(0, 212, 170, 0.1);
        }
        .dcf-download {
            text-align: center;
            margin-top: 30px;
        }
        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            background: rgba(0, 212, 170, 0.15);
            border: 1px solid #00d4aa;
            border-radius: 8px;
            color: #00d4aa;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
        }
        .download-btn:hover {
            background: #00d4aa;
            color: #1a1a2e;
        }
        .download-icon {
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .charts-container { grid-template-columns: 1fr; }
            .overview-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Duolingo, Inc. (DUOL)</h1>
        <p>Language Learning Platform | Current Price: $152.64</p>
    </div>

    <!-- Investment Overview Section -->
    <div class="overview-section">
        <button class="overview-toggle" onclick="toggleOverview()">
            <span>Investment Overview & Analysis</span>
            <span class="arrow">â–¼</span>
        </button>
        <div class="overview-content" id="overviewContent">
            <div class="overview-grid" id="overviewGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid" id="kpiGrid">
        <!-- Populated by JavaScript -->
    </div>

    <!-- Management Guidance Section -->
    <div class="guidance-section" id="guidanceSection">
        <div class="guidance-header">
            <h3>Management Guidance</h3>
            <span class="guidance-meta">As of <span id="guidanceAsOf"></span> | <span id="guidanceFY"></span></span>
        </div>
        <div class="guidance-grid" id="guidanceGrid">
            <!-- Populated by JavaScript -->
        </div>
        <div class="guidance-commentary" id="guidanceCommentary">
            <!-- Populated by JavaScript -->
        </div>
    </div>

    <!-- Financial Performance Section -->
    <h2 class="section-title">Financial Performance</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Revenue Growth</h3>
                <button class="help-btn" onclick="openModal('revenue')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Profitability Trend</h3>
                <button class="help-btn" onclick="openModal('profitability')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="profitabilityChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Free Cash Flow</h3>
                <button class="help-btn" onclick="openModal('fcf')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="fcfChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Profit Margins</h3>
                <button class="help-btn" onclick="openModal('margins')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="marginsChart"></canvas>
            </div>
        </div>
    </div>

    <!-- User Growth & Engagement Section -->
    <h2 class="section-title">User Growth & Engagement</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Daily Active Users (DAU)</h3>
                <button class="help-btn" onclick="openModal('dau')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="dauChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Monthly Active Users (MAU)</h3>
                <button class="help-btn" onclick="openModal('mau')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="mauChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Paid Subscribers</h3>
                <button class="help-btn" onclick="openModal('subscribers')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="subscribersChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>DAU/MAU Engagement Ratio</h3>
                <button class="help-btn" onclick="openModal('engagement')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="engagementChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Monetization Metrics Section -->
    <h2 class="section-title">Monetization Metrics</h2>
    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Bookings Growth</h3>
                <button class="help-btn" onclick="openModal('bookings')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="bookingsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Subscription Bookings</h3>
                <button class="help-btn" onclick="openModal('subBookings')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="subBookingsChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Quarterly ARPU</h3>
                <button class="help-btn" onclick="openModal('arpu')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="arpuChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3>Subscriber Conversion Rate</h3>
                <button class="help-btn" onclick="openModal('conversion')">?</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="conversionChart"></canvas>
            </div>
        </div>
    </div>

    <!-- DCF Valuation Section -->
    <h2 class="section-title">DCF Valuation</h2>
    <div class="dcf-section">
        <div class="dcf-summary">
            <div class="dcf-card highlight">
                <div class="dcf-label">Intrinsic Value</div>
                <div class="dcf-value" id="dcfIV">$219</div>
                <div class="dcf-change positive" id="dcfUpside">+44% upside</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Entry Price (15% CAGR)</div>
                <div class="dcf-value" id="dcfEntry">$124</div>
                <div class="dcf-sublabel">Buy below for 15% annual return</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Current Price</div>
                <div class="dcf-value" id="dcfCurrent">$152.64</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Prob-Weighted IV</div>
                <div class="dcf-value" id="dcfWeighted">$222</div>
                <div class="dcf-sublabel">25% Bull / 50% Base / 25% Bear</div>
            </div>
        </div>

        <div class="dcf-warning" id="growthWarning" style="display: none;">
            <span class="warning-icon">&#9888;</span>
            <span id="warningText"></span>
        </div>

        <div class="dcf-inputs">
            <h4>DCF Model Inputs</h4>
            <div class="dcf-inputs-grid">
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Base Year FCF</div>
                    <div class="dcf-input-value" id="baseFCF">$290M</div>
                    <div class="dcf-input-note">TTM Free Cash Flow</div>
                </div>
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Shares Outstanding</div>
                    <div class="dcf-input-value" id="sharesOut">49.1M</div>
                </div>
                <div class="dcf-input-card">
                    <div class="dcf-input-label">Net Debt</div>
                    <div class="dcf-input-value" id="netDebt">-$960M</div>
                    <div class="dcf-input-note">Negative = net cash</div>
                </div>
            </div>
            <div class="fcf-projections">
                <h5>Projected FCF (5-Year)</h5>
                <div class="fcf-projection-table" id="fcfProjectionTable">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="dcf-controls">
            <div class="slider-group">
                <label>Growth Rate: <span id="growthValue">42%</span></label>
                <input type="range" id="growthSlider" min="0" max="60" value="42" step="1">
                <div class="slider-hint" id="growthHint">Based on revenue 3yr CAGR</div>
            </div>
            <div class="slider-group">
                <label>WACC: <span id="waccValue">10.0%</span></label>
                <input type="range" id="waccSlider" min="6" max="18" value="10" step="0.5">
            </div>
            <div class="slider-group">
                <label>Terminal Growth: <span id="terminalValue">3.0%</span></label>
                <input type="range" id="terminalSlider" min="0" max="5" value="3" step="0.5">
            </div>
        </div>

        <div class="scenario-tabs">
            <button class="scenario-tab active" data-scenario="base" onclick="switchScenario('base')">Base Case</button>
            <button class="scenario-tab" data-scenario="bull" onclick="switchScenario('bull')">Bull Case</button>
            <button class="scenario-tab" data-scenario="bear" onclick="switchScenario('bear')">Bear Case</button>
        </div>

        <div class="scenario-details" id="scenarioDetails">
            <div class="scenario-assumptions">
                <h4>Assumptions</h4>
                <div class="assumption-grid" id="assumptionGrid">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="sensitivity-section">
            <h4>Sensitivity Analysis: Intrinsic Value by WACC & Terminal Growth</h4>
            <table class="sensitivity-table" id="sensitivityMatrix">
                <!-- Populated by JavaScript -->
            </table>
        </div>

        <div class="historical-growth">
            <h4>Historical Growth Rates (CAGR)</h4>
            <div class="growth-grid" id="growthGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // EMBEDDED CSV DATA
        const csvData = `Period,Revenue,GrossProfit,GrossMargin,OperatingIncome,OperatingMargin,EBITDA,NetIncome,NetMargin,EPSDiluted,OperatingCashFlow,CapEx,FreeCashFlow,ShareholdersEquity,TotalDebt,CashAndEquivalents,SharesOutstanding,DAU,MAU,Bookings,Subscribers,SubscriptionBookings
Q4 2021,73.0,54.0,74.0,-12.5,-17.1,4.6,-15.8,-21.6,,,12.5,,,,,10.1,42.4,83.7,2.5,62.9
Q1 2022,81.3,59.7,73.5,-8.3,-10.2,9.7,1.0,1.2,,-12.2,,16.9,,,,,12.5,49.2,93.8,2.9,72.9
Q2 2022,88.4,65.0,73.5,-4.5,-5.1,9.9,-4.4,-5.0,-0.10,,,18.2,,,,,13.3,52.3,104.8,3.3,82.4
Q3 2022,92.1,67.8,73.6,-5.3,-5.8,8.9,-5.3,-5.8,-0.12,,,15.9,,,,,14.9,54.8,106.1,3.7,90.8
Q4 2022,107.7,78.8,73.2,8.0,7.4,15.9,-5.0,-4.6,-0.11,,,22.7,,,,,16.3,60.7,133.3,4.2,103.9
FY2022,369.5,271.3,73.4,-10.1,-2.7,39.3,1.6,0.4,-0.04,60.8,9.5,73.3,,,,,14.9,54.8,438.0,4.2,350.0
Q1 2023,115.7,84.2,72.8,-8.5,-7.3,21.5,-2.6,-2.2,-0.06,,,24.9,,,,,20.3,72.6,138.5,4.8,114.7
Q2 2023,126.8,93.1,73.4,-4.9,-3.8,24.9,3.8,3.0,0.08,,,31.3,,,,,21.4,74.1,146.5,5.2,124.7
Q3 2023,137.6,101.4,73.7,-4.7,-3.4,31.2,2.8,2.0,0.06,,,38.9,,,,,24.2,83.1,159.8,5.8,133.9
Q4 2023,151.0,110.4,73.1,4.8,3.2,42.0,12.4,8.2,0.26,49.2,1.5,57.9,584.8,,747.6,44.8,26.9,88.4,191.0,6.6,152.1
FY2023,531.1,389.0,73.3,-13.3,-2.5,93.7,16.1,3.0,0.35,153.6,13.6,142.2,584.8,,747.6,44.8,24.2,83.1,635.8,6.6,525.4
Q1 2024,167.6,122.4,73.0,16.4,9.8,46.8,27.0,16.1,0.59,29.6,3.3,38.4,711.1,,747.6,45.4,31.4,97.6,196.8,7.4,168.6
Q2 2024,178.3,131.0,73.5,18.7,10.5,49.1,24.4,13.7,0.54,38.4,2.7,40.5,766.9,,747.6,45.4,34.1,103.6,206.3,8.0,180.3
Q3 2024,192.6,140.4,72.9,13.6,7.1,54.9,23.4,12.1,0.49,56.3,5.1,51.2,791.6,,787.6,45.4,37.2,113.1,223.6,8.6,189.9
Q4 2024,209.6,150.6,71.9,13.9,6.6,64.5,13.9,6.6,0.29,83.3,3.5,87.8,882.0,,838.6,46.0,40.5,116.7,271.6,9.5,213.9
FY2024,748.0,544.4,72.8,62.6,8.4,215.3,88.6,11.8,1.91,207.6,14.6,218.0,882.0,,838.6,46.0,40.5,116.7,898.3,9.5,752.7
Q1 2025,230.7,164.1,71.1,23.6,10.2,64.7,35.1,15.2,0.74,50.5,3.5,53.9,893.8,,877.6,46.0,46.0,126.6,267.7,10.4,232.7
Q2 2025,251.7,182.6,72.6,33.4,13.3,72.1,44.8,17.8,0.94,67.6,2.9,70.5,977.0,,1068.1,47.6,49.5,131.2,289.1,11.0,251.6
Q3 2025,271.7,196.9,72.5,35.2,13.0,80.3,292.2,107.5,5.95,84.2,6.8,77.4,1258.0,,959.5,49.1,50.5,135.3,313.6,11.5,268.9`;

        // EMBEDDED ANALYSIS JSON
        const analysis = {
            "ticker": "DUOL",
            "company_name": "Duolingo, Inc.",
            "analysis_date": "2026-01-28",
            "overview": "Duolingo is the leading mobile language learning platform globally, operating a freemium business model where the core educational content is free and monetization comes from premium subscriptions (Super and Max tiers), advertising, and the Duolingo English Test. The company's flagship app has become the world's most popular way to learn languages and the top-grossing app in the Education category on both Google Play and Apple App Store, with over 50 million daily active users as of Q3 2025.",
            "business_model": {
                "summary": "Freemium model with free educational content monetized through premium subscriptions (81% of FY2024 revenue), advertising (15%), English Test certification (3%), and in-app purchases (1%). Subscription tiers include Super (ad-free, unlimited hearts) and Max (adds AI features like Video Call).",
                "revenue_streams": [
                    {"name": "Subscription", "percent": 81, "trend": "growing"},
                    {"name": "Advertising", "percent": 15, "trend": "stable"},
                    {"name": "Duolingo English Test", "percent": 3, "trend": "stable"},
                    {"name": "In-App Purchases", "percent": 1, "trend": "stable"}
                ],
                "customer_type": "B2C primarily, with some B2B for English Test (institutions, employers, immigration programs)",
                "geographic_mix": "Over 50% of bookings from outside the US; global presence across Americas, Europe, Asia-Pacific with strong brand recognition"
            },
            "competitive_position": {
                "main_competitors": ["Babbel", "Rosetta Stone", "Busuu", "Memrise", "AI-native apps (Speak, Marvely AI)", "Large Language Models (ChatGPT, Gemini, Claude)"],
                "market_position": "Market leader in mobile language learning with 50.5M DAUs (Q3 2025) and dominant App Store presence. Named AdAge 'Marketer of the Year' 2024 for viral, brand-building campaigns.",
                "moat_factors": [
                    {"factor": "Network effects and gamification", "strength": "strong", "description": "Social features (Friend Streaks, leaderboards) drive engagement; DAU/MAU ratio of 34.7% in Q4 2024. Over 10M users maintain year-long streaks."},
                    {"factor": "Brand and viral marketing", "strength": "strong", "description": "Iconic owl mascot and 'unhinged' social media strategy drive organic growth. YouTube Shorts and Instagram Reels views grew 430%+ and 450%+ YoY in 2024."},
                    {"factor": "Data and AI advantage", "strength": "strong", "description": "Massive user base generates data for continuous product improvement. AI/ML powers personalized learning and new features like Video Call (GPT-4 powered)."},
                    {"factor": "Cost structure and freemium scale", "strength": "moderate", "description": "Free tier drives user acquisition at low CAC; 8.8% paid subscriber penetration (Q4 2024) provides growth runway but also signals conversion challenges."},
                    {"factor": "Product velocity and experimentation", "strength": "strong", "description": "'Green Machine' A/B testing culture enables rapid iteration. Published 7,500+ course units in 2024, up from 2,500 in 2021, driven by AI automation."}
                ],
                "weaknesses": [
                    "Low subscriber penetration (8.8%) compared to other subscription apps",
                    "Vulnerability to AI disintermediation from ChatGPT/Claude for conversational practice",
                    "Reliance on third-party platforms (iOS/Android app stores, cloud providers)",
                    "Slowing DAU growth (30% YoY in Q4 2025 vs 36% in Q3, 40% in Q2)",
                    "Advertising revenue dependent on DAU engagement; lower margin than subscriptions",
                    "Limited content depth for advanced learners compared to traditional methods"
                ]
            },
            "growth_drivers": [
                "Duolingo Max expansion: Premium AI-powered tier with Video Call feature showing strong adoption (5% of subscribers by Q4 2024)",
                "International expansion: Chess course fastest-growing subject; adding new language pairs (Chinese for Korean, German for Japanese)",
                "AI-driven product innovation: Automated content creation enabling 3x increase in course units published; Video Call now available in 8 languages",
                "Monetization improvements: Mix shift to higher-priced tiers (Max, Family Plan) driving 6-7% YoY ARPU growth",
                "EdTech market tailwinds: Global education technology market growing 13.3% CAGR, reaching $348B by 2030",
                "Content expansion beyond languages: Chess, Math, Music subjects attract new user segments and increase engagement",
                "Energy feature rollout: New gamification mechanic increasing DAUs, time spent, and subscriber conversion"
            ],
            "risks": {
                "business": [
                    {"risk": "AI disintermediation", "severity": "high", "description": "ChatGPT, Gemini, Claude offer real-time translation and conversational practice, reducing need for Duolingo. AI-native competitors like Speak ($100M ARR by 2025) offer lower-cost alternatives."},
                    {"risk": "User growth deceleration", "severity": "high", "description": "DAU growth slowed to 30% YoY in Q4 2025 (vs 36% Q3, 40% Q2). QoQ growth only 4% in Q4 vs 15% in Q1. Wells Fargo cut price target citing weaker DAU trends."},
                    {"risk": "Low conversion rate vulnerability", "severity": "moderate", "description": "8.8% paid subscriber penetration leaves large free user base exposed to competitor poaching. Conversion improvement required to sustain revenue growth."},
                    {"risk": "Platform dependency", "severity": "moderate", "description": "Reliance on iOS/Android app stores (30% fees), cloud providers (AWS/GCP), and social media platforms for distribution creates execution risk."},
                    {"risk": "Content quality perception", "severity": "moderate", "description": "Critics argue gamified approach lacks depth for serious learners; risk of brand dilution with non-language subjects (Chess, Music)."}
                ],
                "financial": [
                    {"risk": "Rising AI costs", "severity": "moderate", "description": "Generative AI and Video Call features increased cost of revenues; gross margin declined 50 bps in FY2024 to 72.8% despite revenue mix shift."},
                    {"risk": "Currency headwinds", "severity": "moderate", "description": "Over 50% of bookings from outside US; every 1% dollar move impacts bookings by $1M per quarter. FX drag expected in 2025."},
                    {"risk": "Margin compression risk", "severity": "moderate", "description": "Management guiding to slower margin expansion in 2025 due to AI investments and Video Call variable costs. Q4 2024 noted 'more measured pace' ahead."}
                ],
                "regulatory": [
                    {"risk": "Data privacy compliance", "severity": "moderate", "description": "Global data privacy regulations (GDPR, CCPA) increase compliance costs and constrain user targeting. EU digital services law changes could impact growth strategies."},
                    {"risk": "App store regulation", "severity": "low", "description": "Potential changes to app store fees or policies could impact economics, though education apps may receive favorable treatment."},
                    {"risk": "Content moderation", "severity": "low", "description": "User-generated content and social features require moderation; regulatory scrutiny of AI-generated content could increase."}
                ],
                "macro": [
                    {"risk": "Consumer spending slowdown", "severity": "moderate", "description": "Subscription revenue vulnerable in recession, though relatively low price point ($9-20/month) and educational focus provide some defensiveness."},
                    {"risk": "Strong dollar impact", "severity": "moderate", "description": "Dollar strength in 2024-2025 creating FX headwinds on international revenue; guidance assumes continued pressure."},
                    {"risk": "EdTech funding winter", "severity": "low", "description": "Venture capital pullback in EdTech could reduce competitive intensity but also limit acquisition opportunities."}
                ],
                "execution": [
                    {"risk": "CFO transition", "severity": "moderate", "description": "CFO Matt Skaruppa resigned January 2026 after nearly 6 years; stock dropped 8% on news despite strong preliminary Q4 results. New CFO Gillian Munson starts February 23."},
                    {"risk": "Balancing monetization vs growth", "severity": "moderate", "description": "CEO explicitly stated Q3 2025 shift toward prioritizing user growth over monetization could pressure near-term conversion metrics."},
                    {"risk": "Video Call execution", "severity": "moderate", "description": "Video Call is critical differentiator for Max tier but requires ongoing AI investment and quality improvement to justify premium pricing."}
                ]
            },
            "recent_developments": [
                {"date": "2026-01-12", "event": "CFO Matt Skaruppa announced resignation; Gillian Munson named new CFO effective Feb 23. Preliminary Q4 2025 showed DAU growth of ~30% YoY (vs 36% in Q3), but bookings exceeded guidance. Stock fell 8%."},
                {"date": "2025-11-05", "event": "Q3 2025: DAUs hit 50.5M (+36% YoY), revenue $271.7M (+41% YoY). Management announced strategic shift to prioritize long-term user growth and teaching improvements over near-term monetization."},
                {"date": "2025-09-16", "event": "Duocon 2025: Announced Video Call enhancements (longer sessions, interactive backgrounds), Energy feature rollout (replacing Hearts), and Chess PvP mode."},
                {"date": "2025-08-06", "event": "Q2 2025: DAU growth of 40% YoY, revenue $252.3M (+41% YoY). Chess course hit 1M+ DAUs, fastest-growing subject launch. Luckin Coffee partnership in Asia sold 10M+ branded drinks."},
                {"date": "2025-03-01", "event": "Q4 2024: Crossed 40M DAUs for first time; Duolingo Max reached 5% of paid subscribers. Named AdAge 'Marketer of the Year' for viral campaigns including 5-second Super Bowl ad."},
                {"date": "2024-09", "event": "Video Call AI feature launched for Duolingo Max subscribers on iOS (later expanded to Android and 5 additional languages). Research showed feature helps improve speaking skills."}
            ],
            "guidance": {
                "as_of": "Q3 2025 Earnings (November 5, 2025) + Q4 2025 Preliminary (January 12, 2026)",
                "fiscal_year": "FY2025",
                "items": [
                    {
                        "metric": "Q4 2025 Bookings",
                        "target": "$329.5-335.5M (preliminary: at or slightly above high end)",
                        "period": "Q4 2025",
                        "vs_prior": "met/exceeded",
                        "notes": "Represents 21.3-23.5% YoY growth as of Q3 guidance; 18.2-20.4% constant currency"
                    },
                    {
                        "metric": "Q4 2025 DAU Growth",
                        "target": "~30% YoY (preliminary)",
                        "period": "Q4 2025",
                        "vs_prior": "decelerated",
                        "notes": "Down from 36% in Q3, 40% in Q2. QoQ growth only 4% (52.7M DAUs preliminary)"
                    },
                    {
                        "metric": "FY2025 Bookings",
                        "target": "$1,151-1,157M",
                        "period": "FY2025",
                        "vs_prior": "raised",
                        "notes": "32.2-32.9% YoY growth reported; 31.2-31.9% constant currency. Raised from prior guidance."
                    },
                    {
                        "metric": "FY2025 Revenue",
                        "target": "$1,027.5-1,031.5M",
                        "period": "FY2025",
                        "vs_prior": "maintained",
                        "notes": "37.4-37.9% YoY growth; ~38% on constant currency basis"
                    },
                    {
                        "metric": "FY2025 Adjusted EBITDA Margin",
                        "target": "28.9-29.1%",
                        "period": "FY2025",
                        "vs_prior": "raised",
                        "notes": "Up from 28.75% prior guidance midpoint. Represents ~330 bps expansion vs FY2024 (25.7%)"
                    },
                    {
                        "metric": "FY2025 Gross Margin",
                        "target": "~80 bps decline YoY",
                        "period": "FY2025",
                        "vs_prior": "improved from -100 bps",
                        "notes": "Better than expected due to lower AI costs and strong advertising performance"
                    },
                    {
                        "metric": "Incremental Margin",
                        "target": "37.9% for FY2025",
                        "period": "FY2025",
                        "vs_prior": "N/A",
                        "notes": "Demonstrates operating leverage despite investments in AI and product development"
                    }
                ],
                "management_commentary": "CEO Luis von Ahn stated in Q3 letter that company is shifting balance toward longer-term initiatives, investing proportionally more in teaching quality and prioritizing user growth over monetization in A/B tests. Noted conviction that AI can fundamentally change what's possible in teaching. CFO guidance for Q4 reflected continued investment in product-led AI initiatives and marketing. FY2026 expected to show more measured margin expansion pace due to AI investments and Video Call variable costs."
            },
            "bull_case": [
                "Market leadership with dominant brand: 50M+ DAUs, #1 education app, iconic marketing creates defensible moat and pricing power for premium tiers",
                "AI-powered differentiation: Video Call and Max features leverage GPT-4 to offer affordable conversational practice previously requiring expensive tutors; strong adoption trajectory (5% of subs in first year)",
                "Massive monetization runway: Only 8.8% paid subscriber penetration leaves significant conversion opportunity; mix shift to Max/Family plans driving 6-7% ARPU growth",
                "Expanding TAM beyond languages: Chess (fastest-growing subject), Math, Music attract new demographics and increase engagement/retention beyond core language learners",
                "Operating leverage at scale: 37.9% incremental margins demonstrate ability to grow revenue faster than costs; Adjusted EBITDA margin expanded 800 bps from 2023 (17.6%) to 2024 (25.7%)",
                "Proven product velocity: 'Green Machine' experimentation culture + AI automation tripled content output; enables rapid response to market changes and user preferences",
                "Recession-resistant model: Low price point, educational focus, and freemium flexibility provide downside protection; free users can re-engage when finances improve",
                "Long-term growth visibility: EdTech market growing 13%+ CAGR; language learning subset growing 17%+ CAGR through 2035; secular shift to mobile-first, AI-personalized learning"
            ],
            "bear_case": [
                "User growth deceleration is structural: DAU growth slowing significantly (40% Q2 â†’ 36% Q3 â†’ 30% Q4); QoQ growth collapsing (15% Q1 â†’ 4% Q4) suggests market saturation or competitive pressure",
                "AI disintermediation threat is existential: Free LLMs (ChatGPT, Claude) offer real-time translation and conversation practice; AI-native competitors like Speak growing faster at lower costs; Duolingo's own 10-K warns of this risk",
                "Low conversion rate indicates weak value proposition: 8.8% paid penetration after years of optimization suggests limited willingness to pay; free tier may be 'good enough' for most users",
                "CFO departure signals internal concerns: Unexpected resignation of 6-year CFO who led IPO coinciding with growth slowdown raises questions about FY2026 outlook and strategic direction",
                "Margin expansion limited by AI costs: Gross margin declining despite favorable revenue mix; Video Call variable costs and generative AI compute prevent operating leverage; management guiding to 'more measured' margin expansion",
                "Valuation premium vulnerable: Trading at 7-8x forward sales (down from 20x peak but still premium to EdTech peers); multiple compression risk if growth continues decelerating",
                "Gamification risks pedagogical credibility: Critics argue Duolingo prioritizes engagement over learning efficacy; expansion into Chess/Music dilutes brand as serious education platform",
                "Platform concentration risk: 70%+ revenue through iOS/Android app stores (30% fees); changes to app store policies or economics could materially impact profitability"
            ]
        };

        // EMBEDDED DCF JSON
        const dcfData = {
            "ticker": "DUOL",
            "valuation_date": "2026-01-28",
            "current_price": 152.64,
            "inputs": {
                "shares_outstanding": 49.1,
                "net_debt": -959.5,
                "last_fcf": 289.6,
                "currency": "USD",
                "units": "millions"
            },
            "historical_growth": {
                "revenue_3yr_cagr": 42.0,
                "revenue_5yr_cagr": null,
                "eps_3yr_cagr": null,
                "eps_5yr_cagr": null,
                "equity_3yr_cagr": 53.6,
                "equity_5yr_cagr": null,
                "fcf_3yr_cagr": 72.3,
                "fcf_5yr_cagr": null,
                "selected_growth_rate": 42.0,
                "growth_rate_source": "revenue_3yr_cagr",
                "growth_divergence_warning": "High-growth company transitioning to profitability. Equity CAGR (53.6%) reflects strong earnings inflection. Revenue CAGR (42%) used as more stable baseline given volatile EPS history (negative in FY2022). FCF growth exceptional (72.3%) but not sustainable long-term."
            },
            "assumptions": {
                "base": {
                    "growth_rates": [35, 28, 22, 18, 15],
                    "fcf_margin": 30.0,
                    "wacc": 10.0,
                    "terminal_growth": 3.0,
                    "rationale": "Base case assumes deceleration from 42% revenue CAGR toward mature growth. Reflects AI-powered engagement, subscription mix shift to Max, and international expansion. FCF margin improves from 29% (TTM) to 30%+ as scale efficiencies offset AI costs. DAU growth moderates to 20-25% by Year 5."
                },
                "bull": {
                    "growth_rates": [45, 38, 30, 25, 20],
                    "fcf_margin": 32.0,
                    "wacc": 9.0,
                    "terminal_growth": 3.5,
                    "rationale": "Bull case: Video Call and Max tier drive ARPU acceleration (10%+ vs 6-7% base). AI-powered content creation unlocks new subjects/languages faster. Subscriber penetration expands from 8.8% to 12%+ as gamification hooks deepen. Operating leverage drives margin expansion to 32%+. DAU growth sustains 30%+ through 2027."
                },
                "bear": {
                    "growth_rates": [25, 18, 12, 8, 6],
                    "fcf_margin": 27.0,
                    "wacc": 12.0,
                    "terminal_growth": 2.5,
                    "rationale": "Bear case: AI disintermediation accelerates (ChatGPT, Claude steal conversational practice use cases). DAU growth continues decelerating (30% â†’ 20% â†’ 15%). Subscriber penetration stalls at 9% reflecting weak value proposition. AI compute costs compress margins. Competition from AI-native apps (Speak) intensifies."
                }
            },
            "projections": {
                "base": {
                    "years": ["Y1", "Y2", "Y3", "Y4", "Y5"],
                    "revenue": [1037.0, 1327.4, 1619.4, 1910.9, 2197.5],
                    "fcf": [391.1, 500.2, 610.4, 720.3, 829.1],
                    "discount_factors": [0.909, 0.826, 0.751, 0.683, 0.621],
                    "pv_fcf": [355.6, 413.2, 458.4, 491.9, 515.0]
                },
                "bull": {
                    "years": ["Y1", "Y2", "Y3", "Y4", "Y5"],
                    "revenue": [1114.2, 1537.6, 1998.9, 2498.6, 2998.3],
                    "fcf": [419.9, 579.4, 753.2, 941.5, 1129.4],
                    "discount_factors": [0.917, 0.842, 0.772, 0.708, 0.650],
                    "pv_fcf": [385.1, 487.9, 581.5, 666.6, 733.9]
                },
                "bear": {
                    "years": ["Y1", "Y2", "Y3", "Y4", "Y5"],
                    "revenue": [958.9, 1131.5, 1267.3, 1368.7, 1450.8],
                    "fcf": [362.0, 427.2, 478.5, 516.8, 547.5],
                    "discount_factors": [0.893, 0.797, 0.712, 0.636, 0.567],
                    "pv_fcf": [323.2, 340.5, 340.6, 328.7, 310.5]
                }
            },
            "valuation": {
                "base": {
                    "sum_pv_fcf": 2234.0,
                    "terminal_value": 12201.7,
                    "pv_terminal": 7577.3,
                    "enterprise_value": 9811.3,
                    "equity_value": 10770.8,
                    "intrinsic_value": 219.37,
                    "upside": 43.7
                },
                "bull": {
                    "sum_pv_fcf": 2855.0,
                    "terminal_value": 21367.8,
                    "pv_terminal": 13889.1,
                    "enterprise_value": 16744.1,
                    "equity_value": 17703.6,
                    "intrinsic_value": 360.57,
                    "upside": 136.2
                },
                "bear": {
                    "sum_pv_fcf": 1643.5,
                    "terminal_value": 6291.3,
                    "pv_terminal": 3567.1,
                    "enterprise_value": 5210.6,
                    "equity_value": 6170.1,
                    "intrinsic_value": 125.66,
                    "upside": -17.7
                }
            },
            "entry_price": {
                "base": {
                    "terminal_value_per_share": 248.50,
                    "years_to_terminal": 5,
                    "entry_price": 123.57,
                    "entry_discount_from_current": -19.0
                },
                "bull": {
                    "terminal_value_per_share": 435.23,
                    "years_to_terminal": 5,
                    "entry_price": 216.42,
                    "entry_discount_from_current": 41.8
                },
                "bear": {
                    "terminal_value_per_share": 128.14,
                    "years_to_terminal": 5,
                    "entry_price": 63.73,
                    "entry_discount_from_current": -58.3
                }
            },
            "sensitivity": {
                "wacc_range": [8, 9, 10, 11, 12],
                "terminal_growth_range": [2.0, 2.5, 3.0, 3.5, 4.0],
                "matrix": [
                    [278.45, 297.38, 319.62, 346.12, 378.54],
                    [249.87, 264.91, 282.18, 302.29, 326.15],
                    [226.44, 238.49, 252.15, 268.02, 286.83],
                    [207.12, 216.91, 227.88, 240.30, 254.54],
                    [190.78, 198.77, 207.63, 217.55, 228.78]
                ]
            },
            "probability_weighted": {
                "weights": {"bull": 0.25, "base": 0.50, "bear": 0.25},
                "weighted_iv": 221.56
            }
        };

        // Parse CSV
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
                return obj;
            });
        }

        const data = parseCSV(csvData);

        // Sort data chronologically (oldest first)
        data.sort((a, b) => {
            const parseDate = (p) => {
                const year = parseInt(p.match(/\d{4}/)?.[0] || '0');
                const isQ1 = p.includes('Q1');
                const isQ2 = p.includes('Q2');
                const isQ3 = p.includes('Q3');
                const isQ4 = p.includes('Q4');
                const isFY = p.startsWith('FY');
                const subOrder = isQ1 ? 1 : isQ2 ? 2 : isQ3 ? 4 : isQ4 ? 5 : isFY ? 7 : 0;
                return year * 10 + subOrder;
            };
            return parseDate(a.Period) - parseDate(b.Period);
        });

        // Filter for annual data
        const fyData = data.filter(d => d.Period.startsWith('FY'));

        // Color palette
        const colors = {
            primary: '#00d4aa',
            secondary: '#00b894',
            tertiary: '#0984e3',
            quaternary: '#6c5ce7',
            warning: '#fdcb6e',
            danger: '#ff6b6b'
        };

        // Chart defaults
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#e0e0e0', font: { size: 11 } } }
            },
            scales: {
                x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
        };

        // Toggle overview
        function toggleOverview() {
            const btn = document.querySelector('.overview-toggle');
            const content = document.getElementById('overviewContent');
            btn.classList.toggle('active');
            content.classList.toggle('active');
        }

        // Modal functions
        function openModal(key) {
            document.getElementById('modalTitle').textContent = metricDescriptions[key].title;
            document.getElementById('modalBody').innerHTML = metricDescriptions[key].content;
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay')) return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // Format numbers
        function formatNumber(num, decimals = 0) {
            if (!num || num === '' || isNaN(num)) return 'N/A';
            return parseFloat(num).toFixed(decimals);
        }

        function formatCurrency(num, decimals = 0) {
            if (!num || num === '' || isNaN(num)) return 'N/A';
            return '$' + parseFloat(num).toFixed(decimals) + 'M';
        }

        function calcYoYChange(current, previous) {
            if (!previous || !current || previous === '' || current === '') return null;
            return ((parseFloat(current) - parseFloat(previous)) / Math.abs(parseFloat(previous)) * 100).toFixed(1);
        }

        // Render Investment Overview
        function renderOverview() {
            const grid = document.getElementById('overviewGrid');

            // Company Overview
            let html = `<div class="overview-card">
                <h3>Company Overview</h3>
                <p>${analysis.overview}</p>
            </div>`;

            // Business Model
            html += `<div class="overview-card">
                <h3>Business Model</h3>
                <p>${analysis.business_model.summary}</p>
                <ul>
                    ${analysis.business_model.revenue_streams.map(s =>
                        `<li class="revenue-stream">
                            <span>${s.name}</span>
                            <span class="percent">${s.percent}%</span>
                        </li>`
                    ).join('')}
                </ul>
            </div>`;

            // Competitive Position
            html += `<div class="overview-card">
                <h3>Competitive Position</h3>
                <p><strong>Market Position:</strong> ${analysis.competitive_position.market_position}</p>
                <p><strong>Main Competitors:</strong> ${analysis.competitive_position.main_competitors.join(', ')}</p>
                <p><strong>Key Moat Factors:</strong></p>
                <ul>
                    ${analysis.competitive_position.moat_factors.map(m =>
                        `<li><strong>${m.factor}</strong> (${m.strength}): ${m.description}</li>`
                    ).join('')}
                </ul>
            </div>`;

            // Growth Drivers
            html += `<div class="overview-card">
                <h3>Growth Drivers</h3>
                <ul>
                    ${analysis.growth_drivers.map(d => `<li>${d}</li>`).join('')}
                </ul>
            </div>`;

            // Key Risks
            const allRisks = [
                ...analysis.risks.business.map(r => ({...r, category: 'Business'})),
                ...analysis.risks.financial.map(r => ({...r, category: 'Financial'})),
                ...analysis.risks.execution.map(r => ({...r, category: 'Execution'}))
            ];
            html += `<div class="overview-card risks">
                <h3>Key Risks</h3>
                <ul>
                    ${allRisks.map(r =>
                        `<li>
                            <span class="risk-${r.severity.toLowerCase()}">[${r.severity.toUpperCase()}]</span>
                            <strong>${r.risk}</strong>: ${r.description}
                        </li>`
                    ).join('')}
                </ul>
            </div>`;

            // Bull Case
            html += `<div class="overview-card bull">
                <h3>Bull Case</h3>
                <ul>
                    ${analysis.bull_case.map(b => `<li>${b}</li>`).join('')}
                </ul>
            </div>`;

            // Bear Case
            html += `<div class="overview-card bear">
                <h3>Bear Case</h3>
                <ul>
                    ${analysis.bear_case.map(b => `<li>${b}</li>`).join('')}
                </ul>
            </div>`;

            // Recent Developments
            html += `<div class="overview-card">
                <h3>Recent Developments</h3>
                <ul>
                    ${analysis.recent_developments.map(d =>
                        `<li><strong>${d.date}:</strong> ${d.event}</li>`
                    ).join('')}
                </ul>
            </div>`;

            grid.innerHTML = html;
        }

        // Render KPI Cards
        function renderKPIs() {
            const latest = data[data.length - 1];
            const previous = data[data.length - 5] || data[data.length - 2];

            const kpis = [
                {
                    label: 'Q3 2025 Revenue',
                    value: formatCurrency(latest.Revenue),
                    change: calcYoYChange(latest.Revenue, previous.Revenue)
                },
                {
                    label: 'Daily Active Users',
                    value: latest.DAU + 'M',
                    change: calcYoYChange(latest.DAU, previous.DAU)
                },
                {
                    label: 'Paid Subscribers',
                    value: latest.Subscribers + 'M',
                    change: calcYoYChange(latest.Subscribers, previous.Subscribers)
                },
                {
                    label: 'Free Cash Flow',
                    value: formatCurrency(latest.FreeCashFlow),
                    change: calcYoYChange(latest.FreeCashFlow, previous.FreeCashFlow)
                },
                {
                    label: 'Gross Margin',
                    value: formatNumber(latest.GrossMargin, 1) + '%',
                    change: (parseFloat(latest.GrossMargin) - parseFloat(previous.GrossMargin)).toFixed(1)
                },
                {
                    label: 'Operating Margin',
                    value: formatNumber(latest.OperatingMargin, 1) + '%',
                    change: (parseFloat(latest.OperatingMargin) - parseFloat(previous.OperatingMargin)).toFixed(1)
                },
                {
                    label: 'Subscriber Penetration',
                    value: (parseFloat(latest.Subscribers) / parseFloat(latest.MAU) * 100).toFixed(1) + '%',
                    change: ((parseFloat(latest.Subscribers) / parseFloat(latest.MAU) * 100) -
                             (parseFloat(previous.Subscribers) / parseFloat(previous.MAU) * 100)).toFixed(1)
                },
                {
                    label: 'DAU/MAU Ratio',
                    value: (parseFloat(latest.DAU) / parseFloat(latest.MAU) * 100).toFixed(1) + '%',
                    change: ((parseFloat(latest.DAU) / parseFloat(latest.MAU) * 100) -
                             (parseFloat(previous.DAU) / parseFloat(previous.MAU) * 100)).toFixed(1)
                }
            ];

            const grid = document.getElementById('kpiGrid');
            grid.innerHTML = kpis.map(kpi => {
                const changeClass = kpi.change > 0 ? 'positive' : kpi.change < 0 ? 'negative' : '';
                const changeSymbol = kpi.change > 0 ? '+' : '';
                return `
                    <div class="kpi-card">
                        <div class="kpi-value">${kpi.value}</div>
                        <div class="kpi-label">${kpi.label}</div>
                        ${kpi.change !== null ? `<div class="kpi-change ${changeClass}">${changeSymbol}${kpi.change}% YoY</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Render Guidance
        function renderGuidance() {
            if (!analysis.guidance || !analysis.guidance.items || analysis.guidance.items.length === 0) {
                document.getElementById('guidanceSection').style.display = 'none';
                return;
            }

            const guidance = analysis.guidance;
            document.getElementById('guidanceAsOf').textContent = guidance.as_of || '';
            document.getElementById('guidanceFY').textContent = guidance.fiscal_year || '';

            const grid = document.getElementById('guidanceGrid');
            grid.innerHTML = guidance.items.map(item => {
                const vsClass = item.vs_prior ? item.vs_prior.toLowerCase().replace('/', '\\/') : 'new';
                const vsLabel = item.vs_prior ? item.vs_prior.charAt(0).toUpperCase() + item.vs_prior.slice(1) : 'New';
                return `
                    <div class="guidance-card">
                        <div class="guidance-metric">${item.metric}</div>
                        <div class="guidance-target">${item.target}</div>
                        <div class="guidance-period">${item.period}</div>
                        <span class="guidance-vs-prior ${vsClass}">${vsLabel}</span>
                        ${item.notes ? `<div class="guidance-notes">${item.notes}</div>` : ''}
                    </div>
                `;
            }).join('');

            const commentary = document.getElementById('guidanceCommentary');
            if (guidance.management_commentary) {
                commentary.textContent = guidance.management_commentary;
                commentary.style.display = 'block';
            } else {
                commentary.style.display = 'none';
            }
        }

        // Render Charts
        function renderCharts() {
            // Revenue Growth
            new Chart(document.getElementById('revenueChart'), {
                type: 'bar',
                data: {
                    labels: fyData.map(d => d.Period),
                    datasets: [{
                        label: 'Revenue ($M)',
                        data: fyData.map(d => parseFloat(d.Revenue)),
                        backgroundColor: colors.primary,
                        borderRadius: 6
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, beginAtZero: true }
                    }
                }
            });

            // Profitability Trend
            new Chart(document.getElementById('profitabilityChart'), {
                type: 'line',
                data: {
                    labels: data.filter(d => d.Period.startsWith('Q')).map(d => d.Period),
                    datasets: [
                        {
                            label: 'Operating Income ($M)',
                            data: data.filter(d => d.Period.startsWith('Q')).map(d => parseFloat(d.OperatingIncome)),
                            borderColor: colors.primary,
                            backgroundColor: colors.primary + '20',
                            tension: 0.3
                        },
                        {
                            label: 'Net Income ($M)',
                            data: data.filter(d => d.Period.startsWith('Q')).map(d => parseFloat(d.NetIncome)),
                            borderColor: colors.tertiary,
                            backgroundColor: colors.tertiary + '20',
                            tension: 0.3
                        }
                    ]
                },
                options: chartDefaults
            });

            // Free Cash Flow
            new Chart(document.getElementById('fcfChart'), {
                type: 'bar',
                data: {
                    labels: data.filter(d => d.FreeCashFlow && d.FreeCashFlow !== '').map(d => d.Period),
                    datasets: [{
                        label: 'Free Cash Flow ($M)',
                        data: data.filter(d => d.FreeCashFlow && d.FreeCashFlow !== '').map(d => parseFloat(d.FreeCashFlow)),
                        backgroundColor: colors.secondary,
                        borderRadius: 6
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, beginAtZero: true }
                    }
                }
            });

            // Margins
            new Chart(document.getElementById('marginsChart'), {
                type: 'line',
                data: {
                    labels: data.filter(d => d.Period.startsWith('Q')).map(d => d.Period),
                    datasets: [
                        {
                            label: 'Gross Margin (%)',
                            data: data.filter(d => d.Period.startsWith('Q')).map(d => parseFloat(d.GrossMargin)),
                            borderColor: colors.primary,
                            tension: 0.3
                        },
                        {
                            label: 'Operating Margin (%)',
                            data: data.filter(d => d.Period.startsWith('Q')).map(d => parseFloat(d.OperatingMargin)),
                            borderColor: colors.tertiary,
                            tension: 0.3
                        }
                    ]
                },
                options: chartDefaults
            });

            // DAU
            new Chart(document.getElementById('dauChart'), {
                type: 'line',
                data: {
                    labels: data.filter(d => d.DAU && d.DAU !== '').map(d => d.Period),
                    datasets: [{
                        label: 'Daily Active Users (M)',
                        data: data.filter(d => d.DAU && d.DAU !== '').map(d => parseFloat(d.DAU)),
                        borderColor: colors.primary,
                        backgroundColor: colors.primary + '20',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: chartDefaults
            });

            // MAU
            new Chart(document.getElementById('mauChart'), {
                type: 'line',
                data: {
                    labels: data.filter(d => d.MAU && d.MAU !== '').map(d => d.Period),
                    datasets: [{
                        label: 'Monthly Active Users (M)',
                        data: data.filter(d => d.MAU && d.MAU !== '').map(d => parseFloat(d.MAU)),
                        borderColor: colors.tertiary,
                        backgroundColor: colors.tertiary + '20',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: chartDefaults
            });

            // Subscribers
            new Chart(document.getElementById('subscribersChart'), {
                type: 'bar',
                data: {
                    labels: data.filter(d => d.Subscribers && d.Subscribers !== '').map(d => d.Period),
                    datasets: [{
                        label: 'Paid Subscribers (M)',
                        data: data.filter(d => d.Subscribers && d.Subscribers !== '').map(d => parseFloat(d.Subscribers)),
                        backgroundColor: colors.quaternary,
                        borderRadius: 6
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, beginAtZero: true }
                    }
                }
            });

            // Engagement Ratio
            new Chart(document.getElementById('engagementChart'), {
                type: 'line',
                data: {
                    labels: data.filter(d => d.DAU && d.MAU && d.DAU !== '' && d.MAU !== '').map(d => d.Period),
                    datasets: [{
                        label: 'DAU/MAU Ratio (%)',
                        data: data.filter(d => d.DAU && d.MAU && d.DAU !== '' && d.MAU !== '').map(d =>
                            (parseFloat(d.DAU) / parseFloat(d.MAU) * 100).toFixed(1)
                        ),
                        borderColor: colors.warning,
                        backgroundColor: colors.warning + '20',
                        tension: 0.3
                    }]
                },
                options: chartDefaults
            });

            // Bookings
            new Chart(document.getElementById('bookingsChart'), {
                type: 'bar',
                data: {
                    labels: data.filter(d => d.Bookings && d.Bookings !== '').map(d => d.Period),
                    datasets: [{
                        label: 'Bookings ($M)',
                        data: data.filter(d => d.Bookings && d.Bookings !== '').map(d => parseFloat(d.Bookings)),
                        backgroundColor: colors.primary,
                        borderRadius: 6
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, beginAtZero: true }
                    }
                }
            });

            // Subscription Bookings
            new Chart(document.getElementById('subBookingsChart'), {
                type: 'bar',
                data: {
                    labels: data.filter(d => d.SubscriptionBookings && d.SubscriptionBookings !== '').map(d => d.Period),
                    datasets: [{
                        label: 'Subscription Bookings ($M)',
                        data: data.filter(d => d.SubscriptionBookings && d.SubscriptionBookings !== '').map(d => parseFloat(d.SubscriptionBookings)),
                        backgroundColor: colors.secondary,
                        borderRadius: 6
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, beginAtZero: true }
                    }
                }
            });

            // ARPU
            const arpuData = data.filter(d => d.Bookings && d.Subscribers && d.Bookings !== '' && d.Subscribers !== '');
            new Chart(document.getElementById('arpuChart'), {
                type: 'line',
                data: {
                    labels: arpuData.map(d => d.Period),
                    datasets: [{
                        label: 'ARPU ($)',
                        data: arpuData.map(d => (parseFloat(d.Bookings) / parseFloat(d.Subscribers)).toFixed(2)),
                        borderColor: colors.quaternary,
                        backgroundColor: colors.quaternary + '20',
                        tension: 0.3
                    }]
                },
                options: chartDefaults
            });

            // Conversion Rate
            const conversionData = data.filter(d => d.Subscribers && d.MAU && d.Subscribers !== '' && d.MAU !== '');
            new Chart(document.getElementById('conversionChart'), {
                type: 'line',
                data: {
                    labels: conversionData.map(d => d.Period),
                    datasets: [{
                        label: 'Subscriber Conversion (%)',
                        data: conversionData.map(d => (parseFloat(d.Subscribers) / parseFloat(d.MAU) * 100).toFixed(2)),
                        borderColor: colors.tertiary,
                        backgroundColor: colors.tertiary + '20',
                        tension: 0.3
                    }]
                },
                options: chartDefaults
            });
        }

        // DCF Functions
        let currentScenario = 'base';

        function initDCF() {
            if (!dcfData || !dcfData.valuation) return;

            // Set current price
            document.getElementById('dcfCurrent').textContent = '$' + dcfData.current_price.toFixed(2);

            // Show warning if growth diverges
            if (dcfData.historical_growth.growth_divergence_warning) {
                document.getElementById('growthWarning').style.display = 'flex';
                document.getElementById('warningText').textContent = dcfData.historical_growth.growth_divergence_warning;
            }

            // Set slider defaults from base case
            const base = dcfData.assumptions.base;
            document.getElementById('growthSlider').value = dcfData.historical_growth.selected_growth_rate;
            document.getElementById('waccSlider').value = base.wacc;
            document.getElementById('terminalSlider').value = base.terminal_growth;

            document.getElementById('growthValue').textContent = dcfData.historical_growth.selected_growth_rate + '%';
            document.getElementById('waccValue').textContent = base.wacc + '%';
            document.getElementById('terminalValue').textContent = base.terminal_growth + '%';

            document.getElementById('growthHint').textContent =
                'Based on ' + dcfData.historical_growth.growth_rate_source.replace(/_/g, ' ');

            renderDCFInputs();
            renderHistoricalGrowth();
            renderSensitivityMatrix();
            updateDCFDisplay();
            switchScenario('base');
        }

        function renderDCFInputs() {
            const inputs = dcfData.inputs;
            const currency = inputs.currency || '$';
            const units = inputs.units === 'millions' ? 'M' : inputs.units === 'billions' ? 'B' : '';

            const formatNum = (n) => {
                if (Math.abs(n) >= 1000) return currency + (n/1000).toFixed(1) + 'B';
                return currency + n.toFixed(0) + units;
            };

            document.getElementById('baseFCF').textContent = formatNum(inputs.last_fcf);

            const shares = inputs.shares_outstanding;
            document.getElementById('sharesOut').textContent = shares >= 1000 ? (shares/1000).toFixed(2) + 'B' : shares.toFixed(1) + 'M';

            const netDebt = inputs.net_debt;
            const netDebtEl = document.getElementById('netDebt');
            netDebtEl.textContent = (netDebt < 0 ? '-' : '') + formatNum(Math.abs(netDebt));
            if (netDebt < 0) netDebtEl.style.color = '#00d4aa';

            renderFCFProjections();
        }

        function renderFCFProjections() {
            const startGrowth = parseFloat(document.getElementById('growthSlider')?.value || dcfData.historical_growth.selected_growth_rate);
            const baseFCF = dcfData.inputs.last_fcf;
            const currency = dcfData.inputs.currency || '$';

            const formatFCF = (n) => {
                if (Math.abs(n) >= 1000) return currency + (n/1000).toFixed(1) + 'B';
                return currency + n.toFixed(0) + 'M';
            };

            const endGrowth = 10;
            const growthRates = [];
            for (let i = 0; i < 5; i++) {
                const rate = startGrowth > endGrowth
                    ? startGrowth - (startGrowth - endGrowth) * (i / 4)
                    : startGrowth;
                growthRates.push(rate);
            }

            let fcf = baseFCF;
            const fcfValues = [baseFCF];

            for (let i = 0; i < 5; i++) {
                fcf = fcf * (1 + growthRates[i] / 100);
                fcfValues.push(fcf);
            }

            let html = `
                <div class="fcf-projection-item header">Base</div>
                <div class="fcf-projection-item header">Year 1</div>
                <div class="fcf-projection-item header">Year 2</div>
                <div class="fcf-projection-item header">Year 3</div>
                <div class="fcf-projection-item header">Year 4</div>
                <div class="fcf-projection-item header">Year 5</div>
            `;

            html += `<div class="fcf-projection-item">
                <div class="fcf-value">${formatFCF(fcfValues[0])}</div>
                <div class="growth-rate">-</div>
            </div>`;

            for (let i = 1; i <= 5; i++) {
                html += `<div class="fcf-projection-item">
                    <div class="fcf-value">${formatFCF(fcfValues[i])}</div>
                    <div class="growth-rate">+${growthRates[i-1].toFixed(0)}%</div>
                </div>`;
            }

            document.getElementById('fcfProjectionTable').innerHTML = html;
        }

        function calculateDCF(startGrowth, wacc, terminalGrowth) {
            const years = 5;
            const fcf = dcfData.inputs.last_fcf;
            let pvFCF = 0;
            let projectedFCF = fcf;

            const endGrowth = 10;

            for (let i = 0; i < years; i++) {
                const yearGrowth = startGrowth > endGrowth
                    ? startGrowth - (startGrowth - endGrowth) * (i / 4)
                    : startGrowth;
                projectedFCF *= (1 + yearGrowth / 100);
                pvFCF += projectedFCF / Math.pow(1 + wacc/100, i + 1);
            }

            const terminalFCF = projectedFCF * (1 + terminalGrowth/100);
            const terminalValue = terminalFCF / (wacc/100 - terminalGrowth/100);
            const pvTerminal = terminalValue / Math.pow(1 + wacc/100, years);

            const enterpriseValue = pvFCF + pvTerminal;
            const equityValue = enterpriseValue - dcfData.inputs.net_debt;
            const iv = equityValue / dcfData.inputs.shares_outstanding;

            const terminalPerShare = terminalValue / dcfData.inputs.shares_outstanding;
            const entryPrice = terminalPerShare / Math.pow(1.15, years);

            return {
                iv: iv,
                entryPrice: entryPrice,
                terminalPerShare: terminalPerShare,
                pvFCF: pvFCF,
                pvTerminal: pvTerminal,
                enterpriseValue: enterpriseValue
            };
        }

        window.updateDCFDisplay = function() {
            const growth = parseFloat(document.getElementById('growthSlider').value);
            const wacc = parseFloat(document.getElementById('waccSlider').value);
            const terminal = parseFloat(document.getElementById('terminalSlider').value);

            document.getElementById('growthValue').textContent = growth + '%';
            document.getElementById('waccValue').textContent = wacc + '%';
            document.getElementById('terminalValue').textContent = terminal + '%';

            renderFCFProjections();

            const result = calculateDCF(growth, wacc, terminal);

            document.getElementById('dcfIV').textContent = '$' + result.iv.toFixed(0);
            document.getElementById('dcfEntry').textContent = '$' + result.entryPrice.toFixed(0);

            const upside = ((result.iv - dcfData.current_price) / dcfData.current_price * 100);
            const upsideEl = document.getElementById('dcfUpside');
            upsideEl.textContent = (upside >= 0 ? '+' : '') + upside.toFixed(0) + '% ' + (upside >= 0 ? 'upside' : 'downside');
            upsideEl.className = 'dcf-change ' + (upside >= 0 ? 'positive' : 'negative');

            document.getElementById('dcfWeighted').textContent = '$' + dcfData.probability_weighted.weighted_iv.toFixed(0);

            const grid = document.getElementById('assumptionGrid');
            if (grid) {
                grid.innerHTML = `
                    <div class="assumption-item">
                        <div class="label">Growth Rate</div>
                        <div class="value">${growth}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">WACC</div>
                        <div class="value">${wacc}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Terminal Growth</div>
                        <div class="value">${terminal}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Intrinsic Value</div>
                        <div class="value" style="color: #00d4aa;">$${result.iv.toFixed(0)}</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Entry Price</div>
                        <div class="value" style="color: #00d4aa;">$${result.entryPrice.toFixed(0)}</div>
                    </div>
                `;
            }
        };

        window.switchScenario = function(scenario) {
            currentScenario = scenario;

            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === scenario);
            });

            const assumptions = dcfData.assumptions[scenario];
            const valuation = dcfData.valuation[scenario];

            renderFCFProjections();

            document.getElementById('growthSlider').value = assumptions.growth_rates[0];
            document.getElementById('waccSlider').value = assumptions.wacc;
            document.getElementById('terminalSlider').value = assumptions.terminal_growth;

            const grid = document.getElementById('assumptionGrid');
            grid.innerHTML = `
                <div class="assumption-item">
                    <div class="label">Year 1 Growth</div>
                    <div class="value">${assumptions.growth_rates[0]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Year 5 Growth</div>
                    <div class="value">${assumptions.growth_rates[4]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">FCF Margin</div>
                    <div class="value">${assumptions.fcf_margin}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">WACC</div>
                    <div class="value">${assumptions.wacc}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Terminal Growth</div>
                    <div class="value">${assumptions.terminal_growth}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Intrinsic Value</div>
                    <div class="value" style="color: #00d4aa;">$${valuation.intrinsic_value.toFixed(0)}</div>
                </div>
            `;

            updateDCFDisplay();
        };

        function renderHistoricalGrowth() {
            const growth = dcfData.historical_growth;
            const selectedSource = growth.growth_rate_source;
            const grid = document.getElementById('growthGrid');

            const metrics = [
                { key: 'revenue_3yr_cagr', label: 'Revenue 3Y' },
                { key: 'revenue_5yr_cagr', label: 'Revenue 5Y' },
                { key: 'eps_3yr_cagr', label: 'EPS 3Y' },
                { key: 'eps_5yr_cagr', label: 'EPS 5Y' },
                { key: 'equity_3yr_cagr', label: 'Equity 3Y' },
                { key: 'equity_5yr_cagr', label: 'Equity 5Y' },
                { key: 'fcf_3yr_cagr', label: 'FCF 3Y' },
                { key: 'fcf_5yr_cagr', label: 'FCF 5Y' }
            ];

            grid.innerHTML = metrics.map(m => {
                const rate = growth[m.key];
                if (rate === null) return '';
                const isSelected = m.key === selectedSource;
                const colorClass = rate >= 0 ? 'positive' : 'negative';
                return `
                    <div class="growth-item ${isSelected ? 'selected' : ''}">
                        <div class="metric">${m.label}</div>
                        <div class="rate ${colorClass}">${rate >= 0 ? '+' : ''}${rate.toFixed(1)}%</div>
                    </div>
                `;
            }).filter(s => s !== '').join('');
        }

        function renderSensitivityMatrix() {
            const sens = dcfData.sensitivity;
            const table = document.getElementById('sensitivityMatrix');
            const currentPrice = dcfData.current_price;

            let html = '<tr><th>WACC \\ Term G</th>';
            sens.terminal_growth_range.forEach(tg => {
                html += `<th>${tg}%</th>`;
            });
            html += '</tr>';

            sens.wacc_range.forEach((wacc, i) => {
                html += `<tr><th>${wacc}%</th>`;
                sens.matrix[i].forEach((val, j) => {
                    const isHighlight = wacc === dcfData.assumptions.base.wacc &&
                                       sens.terminal_growth_range[j] === dcfData.assumptions.base.terminal_growth;
                    const colorClass = val >= currentPrice ? 'above-current' : 'below-current';
                    html += `<td class="${isHighlight ? 'highlight' : colorClass}">$${val.toFixed(0)}</td>`;
                });
                html += '</tr>';
            });

            table.innerHTML = html;
        }

        // Metric Descriptions
        const metricDescriptions = {
            revenue: {
                title: "Revenue",
                content: `
                    <p><strong>Revenue</strong> is Duolingo's total income from subscriptions (81%), advertising (15%), English Test (3%), and in-app purchases (1%).</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> Revenue grew 41% YoY in Q3 2025 to $271.7M. The company is transitioning from pure advertising-driven (mobile gaming) to subscription-dominated (SaaS), which drives higher margins and more predictable cash flows.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Subscription mix shift driving higher-quality revenue</li>
                        <li>Growth deceleration from 42% CAGR baseline</li>
                        <li>Impact of AI investments on monetization</li>
                    </ul>
                `
            },
            profitability: {
                title: "Profitability Trend",
                content: `
                    <p><strong>Operating Income</strong> and <strong>Net Income</strong> show Duolingo's path to sustainable profitability.</p>
                    <div class="metric-highlight">
                        <strong>Key Inflection:</strong> Duolingo turned consistently profitable in 2023-2024. Q4 2024 operating income was $13.9M (6.6% margin), up from losses in 2022. However, Q3 2025 net income of $292.2M includes $222.7M one-time tax benefit.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Operating margin expansion toward 15%+ (SaaS-like profile)</li>
                        <li>AI costs impacting gross margins (down 50 bps in FY2024)</li>
                        <li>Management guiding to "more measured" margin expansion in 2025</li>
                    </ul>
                `
            },
            fcf: {
                title: "Free Cash Flow",
                content: `
                    <p><strong>Free Cash Flow (FCF)</strong> is operating cash flow minus capital expenditures. It represents cash available for growth, acquisitions, or shareholder returns.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> TTM FCF is $289.6M (Q4 2024 + Q1-Q3 2025), representing ~39% FCF margin. Q4 2024 was exceptionally strong at $87.8M on $209.6M revenue (42% margin).
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>FCF margin sustainability above 30% as AI costs increase</li>
                        <li>Capital allocation: currently holding $960M net cash</li>
                        <li>FCF growth CAGR of 72.3% (3-year) is not sustainable</li>
                    </ul>
                `
            },
            margins: {
                title: "Profit Margins",
                content: `
                    <p><strong>Gross Margin</strong> and <strong>Operating Margin</strong> show profitability at different levels of the income statement.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> Gross margin is 72.5% (Q3 2025), down from 73%+ in 2023-2024 due to AI costs. Operating margin is 13.0% (Q3 2025), up from negative in 2022.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Gross margin pressure from Video Call (GPT-4 costs)</li>
                        <li>Operating leverage as revenue scales faster than costs</li>
                        <li>Path to 20%+ operating margins (typical for SaaS)</li>
                    </ul>
                `
            },
            dau: {
                title: "Daily Active Users (DAU)",
                content: `
                    <p><strong>DAU</strong> measures users who engage with Duolingo daily. It's the primary growth metric for the business.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> 50.5M DAUs in Q3 2025 (+36% YoY). However, growth is decelerating: 40% in Q2 â†’ 36% in Q3 â†’ ~30% in Q4 (preliminary). QoQ growth slowed from 15% in Q1 to 4% in Q4.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>DAU growth deceleration signaling market saturation</li>
                        <li>Impact of Energy feature and Chess expansion on engagement</li>
                        <li>Wells Fargo cut price target citing weaker DAU trends</li>
                    </ul>
                `
            },
            mau: {
                title: "Monthly Active Users (MAU)",
                content: `
                    <p><strong>MAU</strong> measures users who engage at least once per month. It's a broader engagement metric.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> 135.3M MAUs in Q3 2025. DAU/MAU ratio of 37.3% shows strong engagement compared to typical social apps (20-30%).
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>MAU growth sustainability</li>
                        <li>DAU/MAU ratio as indicator of habit formation</li>
                        <li>Conversion of MAU to paid subscribers (currently 8.5%)</li>
                    </ul>
                `
            },
            subscribers: {
                title: "Paid Subscribers",
                content: `
                    <p><strong>Paid Subscribers</strong> pay for Super ($9/month) or Max ($20/month) tiers. This is the primary monetization driver.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> 11.5M paid subscribers in Q3 2025 (+35% YoY). Only 8.5% of MAU are paying, indicating massive monetization runway but also suggesting weak value proposition.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Subscriber penetration rate (target: 10-12%+)</li>
                        <li>Max tier adoption (5% of subscribers by Q4 2024)</li>
                        <li>ARPU growth from mix shift to higher-priced tiers</li>
                    </ul>
                `
            },
            engagement: {
                title: "DAU/MAU Engagement Ratio",
                content: `
                    <p>The <strong>DAU/MAU Ratio</strong> measures daily engagement as a percentage of monthly users. Higher = stickier product.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> 37.3% in Q3 2025, up from 34.7% in Q4 2024. This is exceptionally high for education apps and shows gamification success. Over 10M users maintain year-long streaks.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Ratio sustainability above 35% as user base scales</li>
                        <li>Impact of Energy feature (replacing Hearts)</li>
                        <li>Correlation between engagement and subscriber conversion</li>
                    </ul>
                `
            },
            bookings: {
                title: "Bookings Growth",
                content: `
                    <p><strong>Bookings</strong> represent cash collected from customers (subscriptions + ads + tests + IAP). It's a leading indicator of revenue.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> $313.6M bookings in Q3 2025 (+38% YoY). FY2025 guidance is $1,151-1,157M (raised from prior guidance), representing 32%+ YoY growth.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Bookings growth deceleration trajectory</li>
                        <li>FX headwinds (every 1% dollar move = $1M quarterly impact)</li>
                        <li>Q4 2025 preliminary results at or above high end of guidance</li>
                    </ul>
                `
            },
            subBookings: {
                title: "Subscription Bookings",
                content: `
                    <p><strong>Subscription Bookings</strong> isolate the highest-quality, recurring revenue stream (81% of total).</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> $268.9M subscription bookings in Q3 2025. Mix shift to subscriptions drives margin expansion and valuation multiple.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Subscription bookings growth vs DAU growth (monetization efficiency)</li>
                        <li>ARPU growth from Max tier adoption</li>
                        <li>Family Plan expansion impact</li>
                    </ul>
                `
            },
            arpu: {
                title: "Average Revenue Per User (ARPU)",
                content: `
                    <p><strong>ARPU</strong> is bookings divided by paid subscribers. It measures pricing power and mix shift.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> ARPU growing 6-7% YoY, driven by mix shift to Max ($20/month) and Family Plan. Max tier reached 5% of subscribers by Q4 2024.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>ARPU acceleration from Max tier adoption (target: 10%+)</li>
                        <li>Price increases (last increase in 2023)</li>
                        <li>International pricing optimization</li>
                    </ul>
                `
            },
            conversion: {
                title: "Subscriber Conversion Rate",
                content: `
                    <p><strong>Conversion Rate</strong> is paid subscribers divided by MAU. It measures product value perception.</p>
                    <div class="metric-highlight">
                        <strong>For Duolingo:</strong> 8.5% in Q3 2025, up slightly from 8.1% in Q4 2024. This is low compared to other subscription apps (10-15%+), suggesting either weak value proposition or massive monetization runway.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Conversion rate trajectory toward 10%+</li>
                        <li>Impact of CEO's Q3 statement prioritizing growth over monetization</li>
                        <li>Max tier differentiation driving conversion</li>
                    </ul>
                `
            }
        };

        // Initialize
        renderOverview();
        renderKPIs();
        renderGuidance();
        renderCharts();
        initDCF();

        // Bind slider events
        (function() {
            var growthSlider = document.getElementById('growthSlider');
            var waccSlider = document.getElementById('waccSlider');
            var terminalSlider = document.getElementById('terminalSlider');

            if (growthSlider) {
                growthSlider.oninput = window.updateDCFDisplay;
                growthSlider.onchange = window.updateDCFDisplay;
            }
            if (waccSlider) {
                waccSlider.oninput = window.updateDCFDisplay;
                waccSlider.onchange = window.updateDCFDisplay;
            }
            if (terminalSlider) {
                terminalSlider.oninput = window.updateDCFDisplay;
                terminalSlider.onchange = window.updateDCFDisplay;
            }
        })();
    </script>
</body>
</html>
