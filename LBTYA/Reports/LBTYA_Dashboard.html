<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liberty Global (LBTYA) Financial Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4aa, #00b894);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        .header p {
            color: #888;
            font-size: 1.1rem;
        }

        /* Investment Overview Section */
        .overview-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .overview-toggle {
            width: 100%;
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid rgba(0, 212, 170, 0.3);
            border-radius: 12px;
            padding: 16px 24px;
            color: #00d4aa;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        .overview-toggle:hover {
            background: rgba(0, 212, 170, 0.2);
        }
        .overview-toggle .arrow {
            transition: transform 0.3s ease;
        }
        .overview-toggle.active .arrow {
            transform: rotate(180deg);
        }
        .overview-content {
            display: none;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            margin-top: -12px;
        }
        .overview-content.active {
            display: block;
        }
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        .overview-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .overview-card h3 {
            color: #00d4aa;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .overview-card p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        .overview-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .overview-card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            line-height: 1.5;
        }
        .overview-card li:last-child {
            border-bottom: none;
        }
        .overview-card.bull h3 { color: #00d4aa; }
        .overview-card.bear h3 { color: #ff6b6b; }
        .overview-card.risks h3 { color: #fdcb6e; }
        .risk-high { color: #ff6b6b; font-weight: 500; }
        .risk-moderate { color: #fdcb6e; font-weight: 500; }
        .risk-low { color: #00d4aa; font-weight: 500; }
        .revenue-stream {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .revenue-stream .percent {
            color: #00d4aa;
            font-weight: 600;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        .kpi-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 170, 0.2);
        }
        .kpi-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 5px;
        }
        .kpi-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .kpi-change {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .kpi-change.positive { color: #00d4aa; }
        .kpi-change.negative { color: #ff6b6b; }

        /* Guidance Section */
        .guidance-section {
            max-width: 1400px;
            margin: 0 auto 30px;
        }
        .guidance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .guidance-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .guidance-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .guidance-meta {
            font-size: 0.85rem;
            color: #888;
        }
        .guidance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .guidance-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease;
        }
        .guidance-card:hover {
            transform: translateY(-2px);
        }
        .guidance-metric {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .guidance-target {
            font-size: 1.4rem;
            font-weight: 600;
            color: #00d4aa;
            margin-bottom: 6px;
        }
        .guidance-period {
            font-size: 0.85rem;
            color: #e0e0e0;
            margin-bottom: 8px;
        }
        .guidance-vs-prior {
            display: inline-block;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        .guidance-vs-prior.raised {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
        }
        .guidance-vs-prior.lowered {
            background: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
        }
        .guidance-vs-prior.maintained, .guidance-vs-prior.confirmed {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }
        .guidance-vs-prior.new, .guidance-vs-prior.updated {
            background: rgba(99, 102, 241, 0.15);
            color: #818cf8;
        }
        .guidance-notes {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }
        .guidance-commentary {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 16px 20px;
            border-left: 3px solid #00d4aa;
            font-style: italic;
            color: #b0b0b0;
            line-height: 1.6;
        }
        .guidance-commentary::before {
            content: '"';
            font-size: 1.5rem;
            color: #00d4aa;
            margin-right: 4px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #fff;
            margin: 40px auto 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0, 212, 170, 0.3);
            max-width: 1400px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .chart-header h3 {
            color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-header h3::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, #00d4aa, #00b894);
            border-radius: 2px;
        }
        .help-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(0, 212, 170, 0.2);
            border: 1px solid #00d4aa;
            color: #00d4aa;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .help-btn:hover {
            background: #00d4aa;
            color: #1a1a2e;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: linear-gradient(135deg, #1e2a4a 0%, #16213e 100%);
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 212, 170, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 {
            color: #00d4aa;
            font-size: 1.4rem;
            margin: 0;
        }
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: #ff6b6b;
            color: #fff;
        }
        .modal-body {
            padding: 25px;
            line-height: 1.7;
        }
        .modal-body p { margin-bottom: 15px; }
        .modal-body strong { color: #00d4aa; }
        .modal-body ul { margin: 15px 0; padding-left: 20px; }
        .modal-body li { margin-bottom: 8px; }
        .metric-highlight {
            background: rgba(0, 212, 170, 0.1);
            border-left: 3px solid #00d4aa;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        /* DCF Valuation Section */
        .dcf-section {
            max-width: 1400px;
            margin: 0 auto 40px;
        }
        .dcf-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dcf-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }
        .dcf-card:hover {
            transform: translateY(-3px);
        }
        .dcf-card.highlight {
            background: rgba(0, 212, 170, 0.1);
            border-color: rgba(0, 212, 170, 0.3);
        }
        .dcf-label {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .dcf-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #00d4aa;
        }
        .dcf-card:not(.highlight) .dcf-value {
            color: #fff;
        }
        .dcf-change {
            font-size: 1rem;
            margin-top: 8px;
            font-weight: 600;
        }
        .dcf-change.positive { color: #00d4aa; }
        .dcf-change.negative { color: #ff6b6b; }
        .dcf-sublabel {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
        }
        .dcf-warning {
            background: rgba(253, 203, 110, 0.15);
            border: 1px solid rgba(253, 203, 110, 0.4);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fdcb6e;
        }
        .warning-icon {
            font-size: 1.2rem;
        }
        .dcf-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .slider-group label {
            font-size: 0.95rem;
            color: #e0e0e0;
            display: flex;
            justify-content: space-between;
        }
        .slider-group label span {
            color: #00d4aa;
            font-weight: 600;
        }
        .slider-group input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .slider-group input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        .slider-group input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4aa;
            cursor: pointer;
            border: none;
        }
        .slider-hint {
            font-size: 0.8rem;
            color: #666;
        }
        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .scenario-tab {
            padding: 10px 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: #888;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .scenario-tab:hover {
            border-color: rgba(0, 212, 170, 0.5);
            color: #e0e0e0;
        }
        .scenario-tab.active {
            background: rgba(0, 212, 170, 0.15);
            border-color: #00d4aa;
            color: #00d4aa;
        }
        .scenario-details {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .scenario-details h4 {
            color: #00d4aa;
            margin-bottom: 15px;
        }
        .assumption-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .assumption-item {
            text-align: center;
        }
        .assumption-item .label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
        }
        .assumption-item .value {
            font-size: 1.1rem;
            color: #e0e0e0;
            font-weight: 500;
        }
        .sensitivity-section {
            margin-bottom: 30px;
        }
        .sensitivity-section h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .sensitivity-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            overflow: hidden;
        }
        .sensitivity-table th,
        .sensitivity-table td {
            padding: 12px 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .sensitivity-table th {
            background: rgba(0, 212, 170, 0.1);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td {
            color: #e0e0e0;
        }
        .sensitivity-table td.highlight {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
            font-weight: 600;
        }
        .sensitivity-table td.below-current {
            color: #ff6b6b;
        }
        .sensitivity-table td.above-current {
            color: #00d4aa;
        }
        .historical-growth {
            margin-bottom: 30px;
        }
        .historical-growth h4 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .growth-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }
        .growth-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .growth-item .metric {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 6px;
        }
        .growth-item .rate {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .growth-item .rate.positive { color: #00d4aa; }
        .growth-item .rate.negative { color: #ff6b6b; }
        .growth-item.selected {
            border-color: #00d4aa;
            background: rgba(0, 212, 170, 0.1);
        }

        @media (max-width: 768px) {
            .charts-container { grid-template-columns: 1fr; }
            .overview-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Liberty Global Ltd. (LBTYA)</h1>
        <p>European Telecom Holding Company - Complex Value Unlock Story</p>
    </div>

    <!-- Investment Overview Section -->
    <div class="overview-section">
        <button class="overview-toggle" onclick="toggleOverview()">
            <span>Investment Overview & Analysis</span>
            <span class="arrow">▼</span>
        </button>
        <div class="overview-content" id="overviewContent">
            <div class="overview-grid">
                <!-- Company Overview -->
                <div class="overview-card">
                    <h3>Company Overview</h3>
                    <p>Liberty Global is a Bermuda-domiciled holding company operating through three strategic platforms: Liberty Telecom (100%-owned converged telecom businesses in Belgium, Ireland, Slovakia plus 50% JVs in UK/Netherlands), Liberty Growth ($3.4B portfolio), and Liberty Services (technology and finance platforms). The company provides broadband, video, telephony, and mobile services to approximately 80 million connections across Europe through brands including Telenet, Virgin Media Ireland, VMO2, and VodafoneZiggo.</p>
                </div>

                <!-- Business Model -->
                <div class="overview-card">
                    <h3>Business Model</h3>
                    <p>Holding company structure with three value-creation engines: (1) Liberty Telecom generates recurring telecom revenue from owned assets and quarterly dividend distributions from 50% JVs (VMO2, VodafoneZiggo); (2) Liberty Growth rotates capital through venture investments with $500-750M annual disposal target; (3) Liberty Services monetizes scaled tech/finance platforms. Capital allocation prioritizes shareholder returns via share buybacks (10% annually) and asset monetization to unlock conglomerate discount.</p>
                    <ul>
                        <li class="revenue-stream">
                            <span>Liberty Telecom - Consolidated</span>
                            <span class="percent">82%</span>
                        </li>
                        <li class="revenue-stream">
                            <span>Liberty Growth</span>
                            <span class="percent">2%</span>
                        </li>
                        <li class="revenue-stream">
                            <span>Liberty Services & Corporate</span>
                            <span class="percent">16%</span>
                        </li>
                        <li style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; margin-top: 10px;">
                            <strong>Note:</strong> JV distributions (~$650M annually from VMO2 and VodafoneZiggo) are NOT in consolidated revenue but critical to value
                        </li>
                    </ul>
                </div>

                <!-- Competitive Position -->
                <div class="overview-card">
                    <h3>Competitive Position</h3>
                    <p><strong>Main Competitors:</strong> BT/Openreach (UK), Proximus (Belgium), KPN (Netherlands), Orange Belgium, Vodafone, fiber overbuilders, MVNOs, OTT video (Netflix, Disney+, Amazon), Digi (entered Belgium Dec 2024)</p>
                    <p><strong>Market Position:</strong> Leading or co-leading converged FMC provider in each market: Belgium market leader (Telenet); UK co-leader (VMO2 #1 mobile); Netherlands top-2 (VodafoneZiggo); Ireland challenger position. Facing intense fiber overbuild competition.</p>
                    <p><strong>Moat Factors:</strong></p>
                    <ul>
                        <li><strong>Infrastructure assets (moderate-strong):</strong> Fiber-rich HFC and expanding FTTH networks (VMO2 7M fiber premises, Wyre targeting 70% by 2030, Ireland 73% by 2025)</li>
                        <li><strong>FMC convergence (moderate-strong):</strong> Quad-play bundles create stickiness. Telenet BASE FMC offer added 25,000+ broadband subs since June 2024</li>
                        <li><strong>Technology platforms (moderate):</strong> Proprietary Horizon 5 entertainment platform, DOCSIS 4.0 enabling 10Gbps over HFC</li>
                        <li><strong>Scale in core markets (moderate):</strong> VMO2 and VodafoneZiggo JVs generate $18B+ combined revenue</li>
                    </ul>
                    <p><strong>Weaknesses:</strong> Intense fiber overbuild competition, video cord-cutting, JV structure limits control, complex holding company structure trading at conglomerate discount (~5.5x EBITDA vs. Sunrise 8x post-spin), concentrated in mature European markets, high leverage (4-5x target)</p>
                </div>

                <!-- Growth Drivers -->
                <div class="overview-card">
                    <h3>Growth Drivers</h3>
                    <ul>
                        <li><strong>Fiber network upgrades and wholesale monetization:</strong> VMO2 targeting 80% UK coverage; Ireland 73% FTTH by end-2025; Wyre secured €4.35B facility for buildout to 70% by 2030</li>
                        <li><strong>Mobile spectrum expansion:</strong> VMO2 acquiring 78.8 MHz from Vodafone/Three merger for £343M; VodafoneZiggo acquired 100 MHz 3.5GHz</li>
                        <li><strong>B2B segment growth:</strong> VMO2 Daisy acquisition contributing £125M revenue in 2025; higher-margin than consumer</li>
                        <li><strong>Value unlock initiatives:</strong> Management committed to exploring separation of operating businesses in 12-24 months to unlock conglomerate discount. Sunrise spin-off demonstrated value creation (trades at 8x vs. LBTYA 5.5x)</li>
                        <li><strong>Liberty Growth portfolio:</strong> $3.4B FMV with Formula E control position (66%, 500M+ viewership), data centers (EdgeConneX, AtlasEdge valued >$1B) benefiting from AI infrastructure demand</li>
                        <li><strong>FMC household penetration:</strong> Telenet BASE brand driving FMC growth; quad-play bundles reduce churn and increase ARPU</li>
                    </ul>
                </div>

                <!-- Key Risks -->
                <div class="overview-card risks">
                    <h3>Key Risks</h3>
                    <ul>
                        <li><span class="risk-high">[HIGH]</span> <strong>Intense fiber overbuild competition:</strong> Netherlands 70%+ overbuilt; VodafoneZiggo guiding mid-to-high single-digit EBITDA decline 2025. VMO2 competing with BT/Openreach 25M FTTH target</li>
                        <li><span class="risk-high">[HIGH]</span> <strong>Video cord-cutting acceleration:</strong> Secular decline in traditional pay-TV as customers shift to OTT. Programming cost inflation limits pricing flexibility</li>
                        <li><span class="risk-moderate">[MODERATE-HIGH]</span> <strong>One Touch Switching (UK):</strong> New rules (Sept 2024) reduce switching friction and may accelerate churn</li>
                        <li><span class="risk-moderate">[MODERATE]</span> <strong>JV partner conflicts and lack of control:</strong> 50/50 ownership with Telefonica (VMO2) and Vodafone (VodafoneZiggo) requires partner alignment; cannot unilaterally pursue value-enhancing transactions</li>
                        <li><span class="risk-moderate">[MODERATE-HIGH]</span> <strong>High leverage and refinancing:</strong> $9.9B total debt; average tenor 3.3 years requires continuous refinancing. Floating-rate exposure to EURIBOR/SOFR/SONIA</li>
                        <li><span class="risk-high">[HIGH]</span> <strong>Wholesale access mandates (Belgium):</strong> Telenet deemed SMP; must provide bitstream access at regulated rates, strengthening competitors without infrastructure investment</li>
                        <li><span class="risk-moderate">[MODERATE-HIGH]</span> <strong>European economic weakness:</strong> Consumer spending pressures from inflation and cost-of-living crisis drive downgrades and churn</li>
                    </ul>
                </div>

                <!-- Bull Case -->
                <div class="overview-card bull">
                    <h3>Bull Case</h3>
                    <ul>
                        <li><strong>Value unlock catalyst imminent:</strong> Management committed to business separations in 12-24 months to eliminate conglomerate discount. Sunrise spin demonstrated value creation (8x vs LBTYA 5.5x)</li>
                        <li><strong>Stable JV dividend streams:</strong> VMO2 and VodafoneZiggo targeting £350-400M and €200-250M annual distributions (~$650M+ to LBTYA) funding buybacks independent of operating performance</li>
                        <li><strong>Infrastructure monetization optionality:</strong> Wyre €4.35B facility fully funds buildout; stake sale in early marketing stages. nexfibre wholesale model expands VMO2 footprint without capital</li>
                        <li><strong>Capital allocation discipline:</strong> $700M buyback in 2024 (10% of shares); corporate cost reduction from ~$200M to ~$100M by 2026 (50% improvement); $2.2B cash balance</li>
                        <li><strong>Liberty Growth upside:</strong> Data center assets (EdgeConneX, AtlasEdge) valued >$1B benefiting from AI infrastructure boom. Formula E control position (66%) with 500M+ viewership</li>
                        <li><strong>Technology leadership extends asset life:</strong> DOCSIS 4.0 enabling 10Gbps over HFC defers full fiber migration costs; Horizon 5 platform creates licensing revenue</li>
                        <li><strong>FMC momentum reducing churn:</strong> Telenet BASE FMC offer added 25k+ broadband subs since June 2024; quad-play bundles increase ARPU</li>
                        <li><strong>FCF inflection from 2026:</strong> CapEx reductions expected as fiber buildouts complete; corporate costs improving 50%</li>
                    </ul>
                </div>

                <!-- Bear Case -->
                <div class="overview-card bear">
                    <h3>Bear Case</h3>
                    <ul>
                        <li><strong>Structural telecom decline accelerating:</strong> European cable operators facing existential fiber overbuild threat. VMO2 broadband net losses despite investments. Video cord-cutting persistent</li>
                        <li><strong>Conglomerate discount may persist indefinitely:</strong> Complex holding structure obscures value. Separation timing uncertain (12-24 months) and not guaranteed. JV partners may not support</li>
                        <li><strong>Unsustainable leverage in rising-rate environment:</strong> $9.9B debt with floating-rate exposure. Average tenor only 3.3 years requires continuous refinancing. 10% annual buyback reduces cash for debt paydown</li>
                        <li><strong>Capital intensity never-ending treadmill:</strong> Fiber upgrades require >€1,300 per home. VMO2 full FTTH by 2028, Ireland 73% by 2025, Belgium 70% by 2030 = multi-billion multi-year capex. Returns uncertain</li>
                        <li><strong>JV governance risks and no control:</strong> 50/50 ownership requires partner alignment. Cannot unilaterally pursue value-enhancing transactions. Partners could reduce distributions or demand strategic changes</li>
                        <li><strong>Regulatory headwinds intensifying:</strong> Belgium SMP wholesale mandate strengthens competitors at regulated prices. NIS 2 Directive security obligations, CSRD sustainability reporting increase compliance burden</li>
                        <li><strong>Macro headwinds mounting:</strong> European economic weakness pressures consumer spending. Geopolitical tensions create supply chain and energy volatility. Cybersecurity threats elevated</li>
                        <li><strong>One Touch Switching and competitive dynamics:</strong> UK switching rules reduce churn barriers. MVNO competition intensifying. Pricing power limited</li>
                        <li><strong>Small market concentration after Sunrise spin:</strong> Owned operations in Belgium, Ireland, Slovakia only. No scale advantages or geographic diversification</li>
                    </ul>
                </div>

                <!-- Recent Developments -->
                <div class="overview-card">
                    <h3>Recent Developments</h3>
                    <ul>
                        <li><strong>2024-Nov:</strong> Completed Sunrise (Swiss operations) spin-off - CHF 3.0B tax-free dividend. Sunrise now trades ~8x EBITDA vs. LBTYA ~5.5x</li>
                        <li><strong>2024-Dec:</strong> Completed $700M share buyback (10% of shares); authorized 2025 program targeting ~5% repurchase</li>
                        <li><strong>2024-Oct:</strong> Increased Formula E ownership to 66% (controlling stake); began consolidating results Q4 2024. Season 11 viewership approaching 500M</li>
                        <li><strong>2025-Q1:</strong> Wyre secured €4.35B underwritten debt facility fully funding Belgian fiber buildout. Stake sale in early marketing stages</li>
                        <li><strong>2025-Q2:</strong> VM Ireland announced wholesale deal with Digiweb; VodafoneZiggo launched 2 Gbps service across footprint; Delta Fiber wholesale deal announced</li>
                        <li><strong>2025-Q3:</strong> Management committed to business separation exploration targeting 12-24 months. Corporate costs further improved to ~$150M (from ~$175M, original <$200M) with 2026 target ~$100M</li>
                        <li><strong>2025-YTD:</strong> Achieved ~$300M of $500-750M non-core asset disposal target including partial ITV disposal</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid" id="kpiGrid"></div>

    <!-- Guidance Section -->
    <div class="guidance-section" id="guidanceSection">
        <div class="guidance-header">
            <h3>Management Guidance</h3>
            <span class="guidance-meta">As of <span id="guidanceAsOf"></span> | <span id="guidanceFY"></span></span>
        </div>
        <div class="guidance-grid" id="guidanceGrid"></div>
        <div class="guidance-commentary" id="guidanceCommentary"></div>
    </div>

    <!-- Charts Section -->
    <h2 class="section-title">Financial Performance</h2>
    <div class="charts-container" id="chartsContainer"></div>

    <h2 class="section-title">Balance Sheet & Efficiency</h2>
    <div class="charts-container" id="balanceContainer"></div>

    <h2 class="section-title">DCF Valuation</h2>
    <div class="dcf-section">
        <!-- Valuation Summary Cards -->
        <div class="dcf-summary">
            <div class="dcf-card highlight">
                <div class="dcf-label">Intrinsic Value (Base)</div>
                <div class="dcf-value" id="dcfIV">$19.07</div>
                <div class="dcf-change positive" id="dcfUpside">+85.7% upside</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Entry Price (15% CAGR)</div>
                <div class="dcf-value" id="dcfEntry">$13.58</div>
                <div class="dcf-sublabel">Buy below for 15% annual return</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Current Price</div>
                <div class="dcf-value" id="dcfCurrent">$10.27</div>
            </div>
            <div class="dcf-card">
                <div class="dcf-label">Prob-Weighted IV</div>
                <div class="dcf-value" id="dcfWeighted">$22.62</div>
                <div class="dcf-sublabel">30% Bull / 50% Base / 20% Bear</div>
            </div>
        </div>

        <!-- Growth Rate Warning -->
        <div class="dcf-warning" id="growthWarning">
            <span class="warning-icon">&#9888;</span>
            <span id="warningText"></span>
        </div>

        <!-- Interactive Sliders -->
        <div class="dcf-controls">
            <div class="slider-group">
                <label>Growth Rate: <span id="growthValue">0%</span></label>
                <input type="range" id="growthSlider" min="-5" max="10" value="0" step="1">
                <div class="slider-hint" id="growthHint">JV distributions + consolidated FCF growth</div>
            </div>
            <div class="slider-group">
                <label>WACC: <span id="waccValue">10.5%</span></label>
                <input type="range" id="waccSlider" min="6" max="18" value="10.5" step="0.5">
            </div>
            <div class="slider-group">
                <label>Terminal Growth: <span id="terminalValue">0%</span></label>
                <input type="range" id="terminalSlider" min="-2" max="3" value="0" step="0.5">
            </div>
        </div>

        <!-- Scenario Tabs -->
        <div class="scenario-tabs">
            <button class="scenario-tab active" data-scenario="base" onclick="switchScenario('base')">Base Case</button>
            <button class="scenario-tab" data-scenario="bull" onclick="switchScenario('bull')">Bull Case</button>
            <button class="scenario-tab" data-scenario="bear" onclick="switchScenario('bear')">Bear Case</button>
        </div>

        <!-- Scenario Details -->
        <div class="scenario-details" id="scenarioDetails">
            <div class="scenario-assumptions">
                <h4>Assumptions</h4>
                <div class="assumption-grid" id="assumptionGrid"></div>
            </div>
        </div>

        <!-- Sensitivity Table -->
        <div class="sensitivity-section">
            <h4>Sensitivity Analysis: Intrinsic Value by WACC & Terminal Growth</h4>
            <table class="sensitivity-table" id="sensitivityMatrix"></table>
        </div>

        <!-- Historical Growth Rates -->
        <div class="historical-growth">
            <h4>Historical Growth Rates (CAGR) - Distorted by Structural Changes</h4>
            <div class="growth-grid" id="growthGrid"></div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // EMBEDDED DATA - CSV
        const csvData = `Period,Revenue,GrossProfit,GrossMargin,OperatingIncome,OperatingMargin,EBITDA,NetIncome,NetMargin,EPSBasic,EPSDiluted,FreeCashFlow,ShareholdersEquity,TotalDebt,CashAndEquivalents,SharesOutstanding
FY2015,18280.0,,,2349.2,12.9,,−1152.5,−6.3,−0.19,−0.19,2432.1,10174.3,46749.1,,884.0
FY2016,17285.0,,,2482.2,14.4,,1960.8,11.3,2.20,2.18,1978.9,14732.0,37510.8,,891.7
FY2017,15048.9,,,1947.5,12.9,,−1943.6,−12.9,−2.29,−2.29,1551.2,6393.0,42214.9,552.6,847.9
FY2018,11957.9,,,839.1,7.0,,−1532.0,−12.8,−1.97,−1.97,107.8,4681.4,29805.2,1327.2,778.7
FY2019,11541.5,,,745.5,6.5,,−1525.8,−13.2,−2.16,−2.16,631.3,13606.2,28182.5,1327.2,705.8
FY2020,11980.1,,,2117.7,17.7,,−1628.0,−13.6,−2.70,−2.70,1069.8,13662.6,29849.2,1327.2,602.1
FY2021,10311.3,,,1320.3,12.8,,13426.8,130.2,24.16,23.59,1289.5,25934.9,34892.5,910.6,555.7
FY2022,7195.7,,,146.8,2.0,,1473.2,20.5,3.01,2.96,1118.0,22436.4,32779.7,1726.2,489.6
FY2023,7491.4,,,−244.5,−3.3,,−4051.7,−54.1,−9.52,−9.52,575.6,19062.6,34854.4,1415.9,425.7
FY2024,4341.9,,,−60.1,−1.4,,1588.0,36.6,4.33,4.23,311.7,12365.9,9066.9,1816.3,366.7`;

        // EMBEDDED DATA - Analysis JSON
        const analysis = {"ticker":"LBTYA","company_name":"Liberty Global Ltd.","analysis_date":"2026-01-22","overview":"Liberty Global is a Bermuda-domiciled holding company operating through three strategic platforms: Liberty Telecom (100%-owned converged telecom businesses in Belgium, Ireland, Slovakia plus 50% JVs in UK/Netherlands), Liberty Growth (venture portfolio of ~70 companies valued at $3.4B including controlling stake in Formula E), and Liberty Services (technology and finance platforms). The company provides broadband, video, telephony, and mobile services to approximately 80 million connections across Europe through brands including Telenet, Virgin Media Ireland, VMO2, and VodafoneZiggo.","guidance":{"as_of":"Q3 2025 Earnings (October 30, 2025)","fiscal_year":"FY2025","items":[{"metric":"VMO2 Revenue (ex-handsets, ex-nexfibre construction)","target":"Growth","period":"FY2025","vs_prior":"confirmed","notes":"IFRS basis. Supported by pricing, nexfibre penetration, step down in one-off 2024 opex investment."},{"metric":"VMO2 Adjusted EBITDA (ex-nexfibre construction)","target":"Growth","period":"FY2025","vs_prior":"confirmed","notes":"IFRS basis. Benefiting from cost efficiencies and lower nexfibre construction impact."},{"metric":"VMO2 P&E Additions","target":"£2.0-2.2B","period":"FY2025","vs_prior":"confirmed","notes":"Excludes ROU additions. Elevated 5G and FTTH spend through Fibre Up program."},{"metric":"VMO2 Adjusted FCF and Cash Distributions","target":"£350-400M each","period":"FY2025","vs_prior":"confirmed","notes":"Both metrics in same range. Cash distributions to shareholders (50% to Liberty Global)."},{"metric":"VodafoneZiggo Revenue","target":"Low-single digit decline","period":"FY2025","vs_prior":"confirmed","notes":"U.S. GAAP basis. New strategic plan impact; front book repricing offset by customer base decline."},{"metric":"VodafoneZiggo Adjusted EBITDA","target":"Mid- to high-single digit decline","period":"FY2025","vs_prior":"confirmed","notes":"Higher programming costs (UEFA broadcast), strategic plan investments, partially offset by cost control."},{"metric":"VodafoneZiggo P&E Additions","target":"20-22% of sales","period":"FY2025","vs_prior":"confirmed","notes":"DOCSIS 4.0 upgrade preparations; 1.8GHz upgrade underway."},{"metric":"VodafoneZiggo Adjusted FCF and Cash Distributions","target":"€200-250M each","period":"FY2025","vs_prior":"confirmed","notes":"Both metrics in same range. Cash distributions to shareholders (50% to Liberty Global)."},{"metric":"Telenet Revenue","target":"Broadly stable","period":"FY2025","vs_prior":"confirmed","notes":"IFRS basis. FY2024 base: €2,851.4M. Price adjustments offset by competitive pressure."},{"metric":"Telenet Adjusted EBITDAaL","target":"Low-single digit decline","period":"FY2025","vs_prior":"updated","notes":"IFRS basis. FY2024 base: €1,279.9M. At top-end of previous range due to strong H1 performance despite tough Q3 comparator."},{"metric":"Telenet P&E Additions","target":"~38% of revenue","period":"FY2025","vs_prior":"confirmed","notes":"Elevated due to Wyre fiber buildout. Reductions expected from 2026."},{"metric":"Telenet Adjusted FCF","target":"-€180M to -€150M","period":"FY2025","vs_prior":"confirmed","notes":"Negative due to high capex for fiber infrastructure. Improvement expected from 2026."},{"metric":"Liberty Services & Corporate Adj. EBITDA","target":"-~$150M","period":"FY2025","vs_prior":"updated","notes":"Cost optimization initiatives ongoing. Corporate reshaping delivering ahead of plan."},{"metric":"Liberty Services & Corporate Adj. EBITDA","target":"-~$100M","period":"FY2026","vs_prior":"new","notes":"50% reduction from 2025 through corporate operating model transformation. Significant cost savings."},{"metric":"Non-core asset disposals","target":"$500-750M","period":"FY2025","vs_prior":"maintained","notes":"~$300M achieved YTD through Q3 including partial ITV disposal. Continuing to rotate capital."},{"metric":"Share buyback","target":"~5% of outstanding shares","period":"FY2025","vs_prior":"lowered","notes":"Flexible timing based on market conditions, corporate priorities, value unlock transactions. $700M completed in 2024."}],"management_commentary":"CEO Mike Fries stated company is 'committed to exploring the separation of one or more operating businesses for strategic clarity and value unlock' with target completion in next 12-24 months, independent of M&A. Key factors supporting successful separations: rational markets, deleveraged balance sheets, clear network strategies, predictable capex, solid FCF and dividend policies (citing Sunrise success). Nearing decision on potential ECM transactions in Benelux region. Pursuing fiber network monetization through Wyre stake sale (early marketing stages) and potential UK netco transactions. Strong balance sheet with $2.2B expected year-end cash, average debt tenor 3.3 years, fully-swapped cost 3.7%. Corporate reshaping delivering ahead of plan with further cost reductions in 2026."}};

        // EMBEDDED DATA - DCF JSON
        const dcfData = {"ticker":"LBTYA","valuation_date":"2026-01-22","current_price":10.27,"methodology_note":"Hybrid DCF approach combining JV dividend distributions (~$650M annually from VMO2 and VodafoneZiggo) with consolidated FCF from owned operations (Telenet, Ireland, Slovakia). Traditional DCF on consolidated revenue is misleading due to JV deconsolidations and structural changes.","inputs":{"shares_outstanding":349,"total_debt":9066.9,"cash_and_equivalents":1816.3,"net_debt":7250.6,"last_fcf":311.7,"jv_annual_distributions":650,"liberty_growth_fmv":3400},"historical_growth":{"revenue_3yr_cagr":-19.8,"revenue_5yr_cagr":-18.7,"eps_3yr_cagr":-27.9,"equity_3yr_cagr":-17.4,"equity_5yr_cagr":-1.9,"fcf_3yr_cagr":-21.3,"fcf_5yr_cagr":-13.2,"selected_growth_rate":0.0,"growth_rate_source":"qualitative_adjustment_for_mature_markets","growth_divergence_warning":"CRITICAL: Historical growth rates heavily distorted by JV deconsolidations (VMO2 2021, VodafoneZiggo), Sunrise spin-off (2024), and portfolio restructuring. Consolidated revenue declined from $18.3B (FY2015) to $4.3B (FY2024) due to structural changes, NOT organic decline. Using 0% base growth for mature European telecom markets with offsetting competitive pressures and pricing power."},"assumptions":{"base":{"description":"Conservative case: Mature markets with competitive pressures offset by pricing power and FMC growth. JV distributions stable. Liberty Growth portfolio maintained at current value.","total_distributable_cash_y0":961.7,"growth_rates":[2,1,1,0,0],"wacc":10.5,"terminal_growth":0.0},"bull":{"description":"Value unlock scenario: Business separations crystallize infrastructure value at premium multiples. FMC momentum reduces churn. CapEx declines materialize post-2026.","total_distributable_cash_y0":1111.7,"growth_rates":[8,6,5,4,3],"wacc":9.5,"terminal_growth":1.0},"bear":{"description":"Structural decline scenario: Fiber overbuild accelerates customer losses. Video cord-cutting intensifies. JV distributions cut due to competitive EBITDA pressure.","total_distributable_cash_y0":811.7,"growth_rates":[-5,-5,-3,-2,-1],"wacc":12.0,"terminal_growth":-1.0}},"valuation":{"base":{"intrinsic_value":19.07,"upside":85.7},"bull":{"intrinsic_value":39.72,"upside":286.7},"bear":{"intrinsic_value":5.81,"upside":-43.4}},"entry_price":{"base":{"entry_price":13.58,"entry_discount_from_current":32.2},"bull":{"entry_price":24.85,"entry_discount_from_current":142.0},"bear":{"entry_price":7.44,"entry_discount_from_current":-27.5}},"sensitivity":{"wacc_range":[8.5,9.5,10.5,11.5,12.5],"terminal_growth_range":[-1.0,-0.5,0.0,0.5,1.0],"matrix":[[27.53,29.31,31.40,33.87,36.84],[23.49,24.87,26.47,28.34,30.55],[20.37,21.45,22.68,24.09,25.72],[18.00,18.86,19.85,20.97,22.27],[16.18,16.89,17.68,18.57,19.58]]},"probability_weighted":{"weights":{"bull":0.30,"base":0.50,"bear":0.20},"weighted_iv":22.62,"upside_from_current":120.3}};

        // Parse CSV
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => {
                    const val = values[i]?.trim() || '';
                    obj[h.trim()] = val.replace(/−/g, '-');
                });
                return obj;
            });
        }

        const data = parseCSV(csvData);

        // Sort chronologically (oldest first)
        data.sort((a, b) => {
            const parseDate = (p) => {
                const year = parseInt(p.match(/\d{4}/)?.[0] || '0');
                const isQ1 = p.includes('Q1');
                const isQ2 = p.includes('Q2');
                const isQ3 = p.includes('Q3');
                const isQ4 = p.includes('Q4');
                const isH1 = p.includes('H1');
                const isH2 = p.includes('H2');
                const isFY = p.startsWith('FY');
                const subOrder = isQ1 ? 1 : isQ2 ? 2 : isH1 ? 3 : isQ3 ? 4 : isQ4 ? 5 : isH2 ? 6 : isFY ? 7 : 0;
                return year * 10 + subOrder;
            };
            return parseDate(a.Period) - parseDate(b.Period);
        });

        const fyData = data.filter(d => d.Period.startsWith('FY'));

        // Utility functions
        function formatCurrency(val, decimals = 1) {
            if (!val || val === '') return 'N/A';
            const num = parseFloat(val);
            if (isNaN(num)) return 'N/A';
            if (Math.abs(num) >= 1000) return '$' + (num / 1000).toFixed(decimals) + 'B';
            return '$' + num.toFixed(decimals) + 'M';
        }

        function formatPercent(val, decimals = 1) {
            if (!val || val === '') return 'N/A';
            const num = parseFloat(val);
            if (isNaN(num)) return 'N/A';
            return num.toFixed(decimals) + '%';
        }

        function formatNumber(val, decimals = 1) {
            if (!val || val === '') return 'N/A';
            const num = parseFloat(val);
            if (isNaN(num)) return 'N/A';
            return num.toFixed(decimals);
        }

        function calcYoYChange(current, previous) {
            if (!previous || !current) return null;
            const c = parseFloat(current);
            const p = parseFloat(previous);
            if (isNaN(c) || isNaN(p) || p === 0) return null;
            return ((c - p) / Math.abs(p) * 100).toFixed(1);
        }

        // Toggle overview
        function toggleOverview() {
            const btn = document.querySelector('.overview-toggle');
            const content = document.getElementById('overviewContent');
            btn.classList.toggle('active');
            content.classList.toggle('active');
        }

        // Render KPIs
        const latest = fyData[fyData.length - 1];
        const previous = fyData[fyData.length - 2];

        const kpis = [
            {
                label: 'Revenue (FY2024)',
                value: formatCurrency(latest.Revenue, 1),
                change: calcYoYChange(latest.Revenue, previous.Revenue)
            },
            {
                label: 'Operating Income',
                value: formatCurrency(latest.OperatingIncome, 1),
                change: calcYoYChange(latest.OperatingIncome, previous.OperatingIncome)
            },
            {
                label: 'Net Income',
                value: formatCurrency(latest.NetIncome, 1),
                change: calcYoYChange(latest.NetIncome, previous.NetIncome)
            },
            {
                label: 'Free Cash Flow',
                value: formatCurrency(latest.FreeCashFlow, 1),
                change: calcYoYChange(latest.FreeCashFlow, previous.FreeCashFlow)
            },
            {
                label: 'EPS (Diluted)',
                value: '$' + formatNumber(latest.EPSDiluted, 2),
                change: calcYoYChange(latest.EPSDiluted, previous.EPSDiluted)
            },
            {
                label: 'Shareholders Equity',
                value: formatCurrency(latest.ShareholdersEquity, 1),
                change: calcYoYChange(latest.ShareholdersEquity, previous.ShareholdersEquity)
            },
            {
                label: 'Total Debt',
                value: formatCurrency(latest.TotalDebt, 1),
                change: calcYoYChange(latest.TotalDebt, previous.TotalDebt)
            },
            {
                label: 'Debt/Equity Ratio',
                value: (parseFloat(latest.TotalDebt) / parseFloat(latest.ShareholdersEquity)).toFixed(2) + 'x',
                change: null
            }
        ];

        const kpiGrid = document.getElementById('kpiGrid');
        kpiGrid.innerHTML = kpis.map(kpi => {
            let changeHTML = '';
            if (kpi.change !== null) {
                const changeClass = parseFloat(kpi.change) >= 0 ? 'positive' : 'negative';
                const changeSign = parseFloat(kpi.change) >= 0 ? '+' : '';
                changeHTML = `<div class="kpi-change ${changeClass}">${changeSign}${kpi.change}% YoY</div>`;
            }
            return `
                <div class="kpi-card">
                    <div class="kpi-value">${kpi.value}</div>
                    <div class="kpi-label">${kpi.label}</div>
                    ${changeHTML}
                </div>
            `;
        }).join('');

        // Render Guidance
        function renderGuidance() {
            if (!analysis.guidance || !analysis.guidance.items || analysis.guidance.items.length === 0) {
                document.getElementById('guidanceSection').style.display = 'none';
                return;
            }

            const guidance = analysis.guidance;
            document.getElementById('guidanceAsOf').textContent = guidance.as_of || '';
            document.getElementById('guidanceFY').textContent = guidance.fiscal_year || '';

            const grid = document.getElementById('guidanceGrid');
            grid.innerHTML = guidance.items.map(item => {
                const vsClass = (item.vs_prior || 'new').toLowerCase().replace(/\/|\s/g, '');
                const vsLabel = item.vs_prior ? item.vs_prior.charAt(0).toUpperCase() + item.vs_prior.slice(1) : 'New';
                return `
                    <div class="guidance-card">
                        <div class="guidance-metric">${item.metric}</div>
                        <div class="guidance-target">${item.target}</div>
                        <div class="guidance-period">${item.period}</div>
                        <span class="guidance-vs-prior ${vsClass}">${vsLabel}</span>
                        ${item.notes ? `<div class="guidance-notes">${item.notes}</div>` : ''}
                    </div>
                `;
            }).join('');

            const commentary = document.getElementById('guidanceCommentary');
            if (guidance.management_commentary) {
                commentary.textContent = guidance.management_commentary;
                commentary.style.display = 'block';
            } else {
                commentary.style.display = 'none';
            }
        }
        renderGuidance();

        // Chart defaults
        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#e0e0e0', font: { size: 11 } } }
            },
            scales: {
                x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } }
            }
        };

        const colors = {
            primary: '#00d4aa',
            secondary: '#00b894',
            tertiary: '#0984e3',
            quaternary: '#6c5ce7',
            warning: '#fdcb6e',
            danger: '#ff6b6b'
        };

        // Metric descriptions
        const metricDescriptions = {
            revenue: {
                title: "Revenue Trends",
                content: `
                    <p><strong>Revenue</strong> for Liberty Global has declined dramatically from $18.3B (FY2015) to $4.3B (FY2024), but this is NOT organic decline.</p>
                    <div class="metric-highlight">
                        <strong>For Liberty Global:</strong> Revenue decline is due to structural changes:
                        <ul>
                            <li>VMO2 JV formation (2021) deconsolidated UK operations</li>
                            <li>VodafoneZiggo JV deconsolidated Netherlands operations</li>
                            <li>Sunrise spin-off (2024) removed Swiss operations</li>
                        </ul>
                        Current consolidated revenue (~$4.3B) includes only Telenet (Belgium), Virgin Media Ireland, UPC Slovakia, Liberty Growth, and Liberty Services.
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li><strong>JV dividend distributions:</strong> VMO2 targeting £350-400M and VodafoneZiggo €200-250M annually (~$650M+ to Liberty Global) are NOT in consolidated revenue but critical to value</li>
                        <li><strong>Consolidated revenue stability:</strong> Telenet guiding "broadly stable" FY2025; Ireland growing from fiber buildout</li>
                        <li><strong>Liberty Growth monetization:</strong> $500-750M annual disposal target recycling capital</li>
                    </ul>
                `
            },
            operating: {
                title: "Operating Income Trends",
                content: `
                    <p><strong>Operating Income</strong> has been volatile and turned negative in FY2023-2024 due to competitive pressures and restructuring costs.</p>
                    <div class="metric-highlight">
                        <strong>For Liberty Global:</strong> Operating margins compressed by:
                        <ul>
                            <li>Intense fiber overbuild competition (Netherlands 70%+ overbuilt)</li>
                            <li>Video cord-cutting and programming cost inflation</li>
                            <li>Heavy CapEx for fiber network upgrades (Telenet ~38% of revenue)</li>
                            <li>Corporate costs (improving from ~$200M to ~$100M target by 2026)</li>
                        </ul>
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Telenet Adjusted EBITDAaL guiding low-single-digit decline FY2025 but improved from prior guidance</li>
                        <li>VodafoneZiggo EBITDA guiding mid-to-high single-digit decline FY2025 (competitive pressure)</li>
                        <li>Corporate cost reduction trajectory (targeting 50% improvement to ~$100M by 2026)</li>
                        <li>CapEx reductions from 2026 as fiber buildouts complete should improve margins</li>
                    </ul>
                `
            },
            netincome: {
                title: "Net Income & EPS Trends",
                content: `
                    <p><strong>Net Income</strong> highly volatile with FY2021 spike ($13.4B) from VMO2 JV formation gain, and FY2023 loss (-$4.1B) from impairments.</p>
                    <div class="metric-highlight">
                        <strong>For Liberty Global:</strong> Net income volatility driven by:
                        <ul>
                            <li>FY2021: $13.4B gain from VMO2 JV formation (non-recurring)</li>
                            <li>FY2023: -$4.1B loss from asset impairments and restructuring</li>
                            <li>FY2024: $1.6B positive from improved operations and Formula E consolidation</li>
                        </ul>
                        EPS highly volatile due to both earnings volatility and significant share buybacks (349M shares down from 884M in FY2015).
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Normalized operating earnings ex-one-time gains/impairments</li>
                        <li>Share buyback pace (~5% FY2025 targeting ~$350M at current prices)</li>
                        <li>JV equity method earnings contributions from VMO2 and VodafoneZiggo</li>
                        <li>Liberty Growth portfolio fair value adjustments</li>
                    </ul>
                `
            },
            fcf: {
                title: "Free Cash Flow Trends",
                content: `
                    <p><strong>Free Cash Flow</strong> has declined from $2.4B (FY2015) to $312M (FY2024) as consolidated operations shrunk and CapEx intensity remained high.</p>
                    <div class="metric-highlight">
                        <strong>For Liberty Global:</strong> FCF decline primarily from:
                        <ul>
                            <li>Deconsolidations (VMO2, VodafoneZiggo) removed major cash flow sources from consolidated financials</li>
                            <li>JV cash distributions (~$650M+ annually) are received but not in consolidated FCF calculation</li>
                            <li>High CapEx at remaining operations (Telenet negative -€180M to -€150M FY2025)</li>
                            <li>Corporate costs drag (~$150M FY2025, improving to ~$100M FY2026)</li>
                        </ul>
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li><strong>Total distributable cash:</strong> JV distributions $650M+ PLUS consolidated FCF $312M = $962M+ available for shareholders</li>
                        <li>Telenet FCF expected to improve from 2026 as Wyre fiber buildout CapEx declines</li>
                        <li>VM Ireland FCF improving as 73% FTTH buildout completes end-2025</li>
                        <li>Corporate cost savings materializing (50% reduction target)</li>
                        <li>$500-750M annual asset disposals adding to cash available for buybacks</li>
                    </ul>
                `
            },
            balance: {
                title: "Balance Sheet Trends",
                content: `
                    <p><strong>Balance Sheet</strong> shows declining equity from $25.9B (FY2021) to $12.4B (FY2024) and declining debt from $46.7B (FY2015) to $9.1B (FY2024) due to deconsolidations.</p>
                    <div class="metric-highlight">
                        <strong>For Liberty Global:</strong> Balance sheet changes reflect:
                        <ul>
                            <li>Debt reduction from $46.7B to $9.1B primarily from VMO2/VodafoneZiggo JV deconsolidations (JV debt is non-recourse to parent)</li>
                            <li>Equity reduction from Sunrise spin-off (CHF 3.0B dividend to shareholders Nov 2024)</li>
                            <li>Share buybacks reducing equity ($700M in 2024, ongoing ~5% program 2025)</li>
                            <li>Current net debt $7.3B with $1.8B cash ($2.2B expected year-end 2025)</li>
                        </ul>
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Target leverage 4-5x Adjusted EBITDA (excluding JVs)</li>
                        <li>Average debt tenor 3.3 years; blended fully-swapped cost 3.7%</li>
                        <li>Refinancing progress (nearly 80% of 2028 maturities refinanced YTD)</li>
                        <li>Wyre €4.35B facility (non-recourse to Telenet servco) fully funds Belgian fiber buildout</li>
                        <li>Cash balance provides strategic flexibility for value unlock transactions</li>
                    </ul>
                `
            },
            debtratio: {
                title: "Debt/Equity Ratio Trends",
                content: `
                    <p><strong>Debt/Equity Ratio</strong> spiked dramatically in FY2024 to 0.73x from 1.46x in FY2023 due to massive debt reduction from Sunrise deconsolidation.</p>
                    <div class="metric-highlight">
                        <strong>For Liberty Global:</strong> Debt/Equity improvement from:
                        <ul>
                            <li>Total debt declined from $34.9B to $9.1B (74% reduction) after Sunrise deconsolidation</li>
                            <li>Equity declined from $19.1B to $12.4B (35% reduction) from Sunrise spin-off dividend and buybacks</li>
                            <li>Resulting ratio 0.73x is significantly improved leverage position</li>
                            <li>HOWEVER: JV debt ($25B+ at VMO2 and VodafoneZiggo combined) is non-recourse to Liberty Global</li>
                        </ul>
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Consolidated leverage manageable at 4-5x EBITDA target with $7.3B net debt</li>
                        <li>JV leverage ratios separate: VMO2 and VodafoneZiggo manage own capital structures</li>
                        <li>Wyre netco separation will further segregate Belgium fiber infrastructure debt from Telenet servco</li>
                        <li>Strong cash position ($2.2B expected year-end) provides deleveraging optionality</li>
                        <li>Asset monetization proceeds (Wyre stake sale, tower sales) can reduce debt</li>
                    </ul>
                `
            },
            margin: {
                title: "Operating Margin Trends",
                content: `
                    <p><strong>Operating Margin</strong> turned negative in FY2023-2024 (-3.3% and -1.4%) after averaging 7-18% in prior years due to competitive pressures.</p>
                    <div class="metric-highlight">
                        <strong>For Liberty Global:</strong> Margin compression from:
                        <ul>
                            <li>Intense competition in remaining consolidated markets (Belgium, Ireland, Slovakia)</li>
                            <li>Programming cost inflation and must-carry obligations limiting video pricing power</li>
                            <li>Heavy corporate overhead (~$150M FY2025) on smaller consolidated revenue base (~$4.3B)</li>
                            <li>Liberty Growth portfolio consolidation (Formula E) adding revenue but lower margins</li>
                        </ul>
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Telenet margins improving from FMC momentum (BASE brand added 25k+ broadband subs since June 2024)</li>
                        <li>Corporate cost reduction to ~$100M by 2026 will materially improve consolidated margins</li>
                        <li>CapEx reductions from 2026 improving cash margins even if GAAP margins remain pressured</li>
                        <li>JV margins (VMO2 and VodafoneZiggo) are healthier and contribute via distributions</li>
                    </ul>
                `
            },
            shares: {
                title: "Shares Outstanding Trends",
                content: `
                    <p><strong>Shares Outstanding</strong> declined dramatically from 884M (FY2015) to 367M (FY2024), a 58% reduction through aggressive share buybacks.</p>
                    <div class="metric-highlight">
                        <strong>For Liberty Global:</strong> Share count reduction driven by:
                        <ul>
                            <li>$700M buyback completed in 2024 (10% of shares at ~$10-11 prices)</li>
                            <li>Ongoing ~5% annual repurchase program in 2025 (~$350M at current prices)</li>
                            <li>Management prioritizes buybacks over dividends given stock trading below intrinsic value</li>
                            <li>Sunrise spin-off proceeds and asset disposals recycled into buybacks</li>
                        </ul>
                    </div>
                    <p><strong>What to watch:</strong></p>
                    <ul>
                        <li>Buyback pace flexible based on market conditions and value unlock transactions</li>
                        <li>At $10-11 prices, buybacks accretive to per-share value if intrinsic value $19-40 range</li>
                        <li>Share count reduction amplifies EPS growth and per-share equity value over time</li>
                        <li>Potential suspension of buybacks if major value unlock transactions (separations) pursued</li>
                    </ul>
                `
            }
        };

        // Modal functions
        function openModal(key) {
            document.getElementById('modalTitle').textContent = metricDescriptions[key].title;
            document.getElementById('modalBody').innerHTML = metricDescriptions[key].content;
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay')) return;
            document.getElementById('modalOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // Render charts
        const charts = [
            {
                title: 'Revenue & Operating Income Trends',
                key: 'revenue',
                type: 'bar',
                datasets: [
                    { label: 'Revenue', data: fyData.map(d => parseFloat(d.Revenue)), color: colors.primary },
                    { label: 'Operating Income', data: fyData.map(d => parseFloat(d.OperatingIncome)), color: colors.tertiary }
                ]
            },
            {
                title: 'Net Income and EPS Trends',
                key: 'netincome',
                type: 'line',
                datasets: [
                    { label: 'Net Income ($M)', data: fyData.map(d => parseFloat(d.NetIncome)), color: colors.quaternary, yAxisID: 'y' },
                    { label: 'EPS (Diluted)', data: fyData.map(d => parseFloat(d.EPSDiluted)), color: colors.warning, yAxisID: 'y1' }
                ],
                dualAxis: true
            },
            {
                title: 'Free Cash Flow Trends',
                key: 'fcf',
                type: 'bar',
                datasets: [
                    { label: 'Free Cash Flow', data: fyData.map(d => parseFloat(d.FreeCashFlow)), color: colors.secondary }
                ]
            },
            {
                title: 'Operating Margin Trends',
                key: 'margin',
                type: 'line',
                datasets: [
                    { label: 'Operating Margin (%)', data: fyData.map(d => parseFloat(d.OperatingMargin)), color: colors.danger }
                ]
            }
        ];

        const balanceCharts = [
            {
                title: 'Balance Sheet: Equity, Debt, Cash',
                key: 'balance',
                type: 'bar',
                datasets: [
                    { label: 'Shareholders Equity', data: fyData.map(d => parseFloat(d.ShareholdersEquity)), color: colors.primary },
                    { label: 'Total Debt', data: fyData.map(d => parseFloat(d.TotalDebt)), color: colors.danger },
                    { label: 'Cash', data: fyData.map(d => parseFloat(d.CashAndEquivalents) || 0), color: colors.tertiary }
                ]
            },
            {
                title: 'Debt/Equity Ratio',
                key: 'debtratio',
                type: 'line',
                datasets: [
                    { label: 'Debt/Equity Ratio', data: fyData.map(d => parseFloat(d.TotalDebt) / parseFloat(d.ShareholdersEquity)), color: colors.warning }
                ]
            },
            {
                title: 'Shares Outstanding (Millions)',
                key: 'shares',
                type: 'line',
                datasets: [
                    { label: 'Shares Outstanding', data: fyData.map(d => parseFloat(d.SharesOutstanding)), color: colors.tertiary }
                ]
            }
        ];

        function renderCharts(chartList, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = chartList.map((chart, idx) => `
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>${chart.title}</h3>
                        <button class="help-btn" onclick="openModal('${chart.key}')">?</button>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chart${containerId}${idx}"></canvas>
                    </div>
                </div>
            `).join('');

            chartList.forEach((chart, idx) => {
                const ctx = document.getElementById(`chart${containerId}${idx}`).getContext('2d');
                const config = {
                    type: chart.type,
                    data: {
                        labels: fyData.map(d => d.Period),
                        datasets: chart.datasets.map(ds => ({
                            label: ds.label,
                            data: ds.data,
                            backgroundColor: ds.color + '99',
                            borderColor: ds.color,
                            borderWidth: 2,
                            fill: false,
                            yAxisID: ds.yAxisID || 'y'
                        }))
                    },
                    options: {
                        ...chartDefaults,
                        scales: chart.dualAxis ? {
                            x: chartDefaults.scales.x,
                            y: { ...chartDefaults.scales.y, position: 'left' },
                            y1: { ...chartDefaults.scales.y, position: 'right', grid: { drawOnChartArea: false } }
                        } : chartDefaults.scales
                    }
                };
                new Chart(ctx, config);
            });
        }

        renderCharts(charts, 'chartsContainer');
        renderCharts(balanceCharts, 'balanceContainer');

        // DCF Functions
        let currentScenario = 'base';

        function initDCF() {
            if (!dcfData || !dcfData.valuation) return;

            document.getElementById('dcfCurrent').textContent = '$' + dcfData.current_price.toFixed(2);

            if (dcfData.historical_growth.growth_divergence_warning) {
                document.getElementById('growthWarning').style.display = 'flex';
                document.getElementById('warningText').textContent = dcfData.historical_growth.growth_divergence_warning;
            }

            const base = dcfData.assumptions.base;
            document.getElementById('growthSlider').value = dcfData.historical_growth.selected_growth_rate;
            document.getElementById('waccSlider').value = base.wacc;
            document.getElementById('terminalSlider').value = base.terminal_growth;

            document.getElementById('growthValue').textContent = dcfData.historical_growth.selected_growth_rate + '%';
            document.getElementById('waccValue').textContent = base.wacc + '%';
            document.getElementById('terminalValue').textContent = base.terminal_growth + '%';

            document.getElementById('growthHint').textContent = 'JV distributions + consolidated FCF growth';

            renderHistoricalGrowth();
            renderSensitivityMatrix();
            updateDCFDisplay();
            switchScenario('base');
        }

        function calculateDCF(growthRate, wacc, terminalGrowth) {
            const years = 5;
            const baseCash = dcfData.inputs.last_fcf + dcfData.inputs.jv_annual_distributions;
            let pvCash = 0;
            let projectedCash = baseCash;

            for (let i = 0; i < years; i++) {
                projectedCash *= (1 + growthRate / 100);
                pvCash += projectedCash / Math.pow(1 + wacc/100, i + 1);
            }

            const terminalCash = projectedCash * (1 + terminalGrowth/100);
            const terminalValue = terminalCash / (wacc/100 - terminalGrowth/100);
            const pvTerminal = terminalValue / Math.pow(1 + wacc/100, years);

            const enterpriseValue = pvCash + pvTerminal;
            const equityValue = enterpriseValue - dcfData.inputs.net_debt + dcfData.inputs.liberty_growth_fmv;
            const iv = equityValue / dcfData.inputs.shares_outstanding;

            const terminalPerShare = terminalValue / dcfData.inputs.shares_outstanding;
            const entryPrice = terminalPerShare / Math.pow(1.15, years);

            return {
                iv: iv,
                entryPrice: entryPrice,
                terminalPerShare: terminalPerShare,
                pvCash: pvCash,
                pvTerminal: pvTerminal,
                enterpriseValue: enterpriseValue
            };
        }

        window.updateDCFDisplay = function() {
            const growth = parseFloat(document.getElementById('growthSlider').value);
            const wacc = parseFloat(document.getElementById('waccSlider').value);
            const terminal = parseFloat(document.getElementById('terminalSlider').value);

            document.getElementById('growthValue').textContent = growth + '%';
            document.getElementById('waccValue').textContent = wacc + '%';
            document.getElementById('terminalValue').textContent = terminal + '%';

            const result = calculateDCF(growth, wacc, terminal);

            document.getElementById('dcfIV').textContent = '$' + result.iv.toFixed(2);
            document.getElementById('dcfEntry').textContent = '$' + result.entryPrice.toFixed(2);

            const upside = ((result.iv - dcfData.current_price) / dcfData.current_price * 100);
            const upsideEl = document.getElementById('dcfUpside');
            upsideEl.textContent = (upside >= 0 ? '+' : '') + upside.toFixed(1) + '% ' + (upside >= 0 ? 'upside' : 'downside');
            upsideEl.className = 'dcf-change ' + (upside >= 0 ? 'positive' : 'negative');

            document.getElementById('dcfWeighted').textContent = '$' + dcfData.probability_weighted.weighted_iv.toFixed(2);

            const grid = document.getElementById('assumptionGrid');
            if (grid) {
                grid.innerHTML = `
                    <div class="assumption-item">
                        <div class="label">Growth Rate</div>
                        <div class="value">${growth}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">WACC</div>
                        <div class="value">${wacc}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Terminal Growth</div>
                        <div class="value">${terminal}%</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Intrinsic Value</div>
                        <div class="value" style="color: #00d4aa;">$${result.iv.toFixed(2)}</div>
                    </div>
                    <div class="assumption-item">
                        <div class="label">Entry Price</div>
                        <div class="value" style="color: #00d4aa;">$${result.entryPrice.toFixed(2)}</div>
                    </div>
                `;
            }
        };

        window.switchScenario = function(scenario) {
            currentScenario = scenario;

            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === scenario);
            });

            const assumptions = dcfData.assumptions[scenario];
            const valuation = dcfData.valuation[scenario];

            document.getElementById('growthSlider').value = assumptions.growth_rates[0];
            document.getElementById('waccSlider').value = assumptions.wacc;
            document.getElementById('terminalSlider').value = assumptions.terminal_growth;

            const grid = document.getElementById('assumptionGrid');
            grid.innerHTML = `
                <div class="assumption-item">
                    <div class="label">Base Cash Flow</div>
                    <div class="value">$${assumptions.total_distributable_cash_y0.toFixed(0)}M</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Year 1 Growth</div>
                    <div class="value">${assumptions.growth_rates[0]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Year 5 Growth</div>
                    <div class="value">${assumptions.growth_rates[4]}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">WACC</div>
                    <div class="value">${assumptions.wacc}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Terminal Growth</div>
                    <div class="value">${assumptions.terminal_growth}%</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Intrinsic Value</div>
                    <div class="value" style="color: #00d4aa;">$${valuation.intrinsic_value.toFixed(2)}</div>
                </div>
                <div class="assumption-item">
                    <div class="label">Upside/Downside</div>
                    <div class="value" style="color: ${valuation.upside >= 0 ? '#00d4aa' : '#ff6b6b'};">${valuation.upside >= 0 ? '+' : ''}${valuation.upside.toFixed(1)}%</div>
                </div>
            `;

            updateDCFDisplay();
        };

        function renderHistoricalGrowth() {
            const growth = dcfData.historical_growth;
            const selectedSource = growth.growth_rate_source;
            const grid = document.getElementById('growthGrid');

            const metrics = [
                { key: 'revenue_3yr_cagr', label: 'Revenue 3Y' },
                { key: 'revenue_5yr_cagr', label: 'Revenue 5Y' },
                { key: 'eps_3yr_cagr', label: 'EPS 3Y' },
                { key: 'equity_3yr_cagr', label: 'Equity 3Y' },
                { key: 'equity_5yr_cagr', label: 'Equity 5Y' },
                { key: 'fcf_3yr_cagr', label: 'FCF 3Y' },
                { key: 'fcf_5yr_cagr', label: 'FCF 5Y' }
            ];

            grid.innerHTML = metrics.map(m => {
                const rate = growth[m.key];
                if (rate === null) return '';
                const isSelected = m.key === selectedSource;
                const colorClass = rate >= 0 ? 'positive' : 'negative';
                return `
                    <div class="growth-item ${isSelected ? 'selected' : ''}">
                        <div class="metric">${m.label}</div>
                        <div class="rate ${colorClass}">${rate >= 0 ? '+' : ''}${rate.toFixed(1)}%</div>
                    </div>
                `;
            }).filter(h => h).join('');
        }

        function renderSensitivityMatrix() {
            const sens = dcfData.sensitivity;
            const table = document.getElementById('sensitivityMatrix');
            const currentPrice = dcfData.current_price;

            let html = '<tr><th>WACC \\ Term G</th>';
            sens.terminal_growth_range.forEach(tg => {
                html += `<th>${tg}%</th>`;
            });
            html += '</tr>';

            sens.wacc_range.forEach((wacc, i) => {
                html += `<tr><th>${wacc}%</th>`;
                sens.matrix[i].forEach((val, j) => {
                    const isHighlight = wacc === dcfData.assumptions.base.wacc &&
                                       sens.terminal_growth_range[j] === dcfData.assumptions.base.terminal_growth;
                    const colorClass = val >= currentPrice ? 'above-current' : 'below-current';
                    html += `<td class="${isHighlight ? 'highlight' : colorClass}">$${val.toFixed(2)}</td>`;
                });
                html += '</tr>';
            });

            table.innerHTML = html;
        }

        initDCF();

        (function() {
            var growthSlider = document.getElementById('growthSlider');
            var waccSlider = document.getElementById('waccSlider');
            var terminalSlider = document.getElementById('terminalSlider');

            if (growthSlider) {
                growthSlider.oninput = window.updateDCFDisplay;
                growthSlider.onchange = window.updateDCFDisplay;
            }
            if (waccSlider) {
                waccSlider.oninput = window.updateDCFDisplay;
                waccSlider.onchange = window.updateDCFDisplay;
            }
            if (terminalSlider) {
                terminalSlider.oninput = window.updateDCFDisplay;
                terminalSlider.onchange = window.updateDCFDisplay;
            }
        })();
    </script>
</body>
</html>
